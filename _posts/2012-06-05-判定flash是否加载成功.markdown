---
layout: post
title:  "判定flash是否加载成功"
date:   2012-06-05 14:02:00
author: 司徒正美
categories: program
---

## 判定flash是否加载成功
### by 司徒正美
### at 2012-06-05 14:02:00
### original <http://www.cnblogs.com/rubylouvre/archive/2012/06/05/2536590.html>

<p>取得FLASH对象的PercentLoaded方法,看其返回是否为100。下面是个小示例：</p><br>&lt;!doctype html&gt;<br>&lt;html&gt;<br>    &lt;head&gt;<br>        &lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html&quot; charset=&quot;UTF-8&quot;  allowfullscreen=&quot;true&quot;/&gt;<br>        &lt;title&gt;FLASH 播放器 by 司徒正美&lt;/title&gt;<br>        &lt;script language=&quot;javascript&quot; type=&quot;text/javascript&quot;&gt; &lt;/script&gt;<br>        &lt;style type=&quot;text/css&quot;&gt;<br>            html, body, #mask{<br>                width:100%;<br>                height:100%;<br>            }<br>            #mask{<br>                background:url(http://softwarelivre.sapo.pt/projects/quizcreator/export/13/trunk/core/res/loading.gif) center center no-repeat;<br>            }<br>        &lt;/style&gt;<br><br>    &lt;/head&gt;<br><br>    &lt;body&gt;<br>        &lt;div id=&quot;mask&quot;&gt;<br>            &lt;!--这里是蒙板--&gt;<br>        &lt;/div&gt;<br>        &lt;div id=&quot;player&quot;&gt;<br>            &lt;!--这里是播放器--&gt;<br>        &lt;/div&gt;<br><br>        &lt;script type=&quot;text/javascript&quot;&gt;<br>           <br>            //通过ID取得页面元素<br>            function $(id){<br>                return document.getElementById(id)<br>            }<br>            //判定是否加载成功<br>            function checkLoaded(flash){<br>                try{<br>                    return Math.floor(flash.PercentLoaded()) == 100<br>                }catch(e){<br>                    return false;<br>                }<br>            }<br>            //取得flash的播放地址<br>            function getFlashURL(){<br>                return 'http://player.youku.com/player.php/sid/XMzkwNTgzMTIw/v.swf';<br>            }<br>            function createFlashHTML(u,w,h,i,wm,v){<br>                var g= "";<br>                if(window.ActiveXObject){<br>                    g=&#39;&lt;OBJECT classid=&quot;clsid:d27cdb6e-ae6d-11cf-96b8-444553540000&quot; codebase=&quot; http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,28,0&quot; id=&quot;&#39;+i+&#39;&quot; name=&quot;&#39;+i+&#39;&quot; border=&quot;0&quot; width=&quot;&#39;+w+&#39;&quot; height=&quot;&#39;+h+&#39;&quot;&gt;&lt;param name=&quot;movie&quot; value=&quot;&#39;+u+&#39;&quot; /&gt;&lt;param name=&quot;quality&quot; value=&quot;high&quot; /&gt;&lt;param name=&quot;allowScriptAccess&quot; value=&quot;always&quot; /&gt;&lt;param name=&quot;menu&quot; value=&quot;false&quot; /&gt;&lt;param name=&quot;allowFullScreen&quot; value=&quot;true&quot; /&gt;&lt;param name=&quot;wmode&quot; value=&quot;&#39;+wm+&#39;&quot; /&gt;&lt;param name=&quot;flashvars&quot; value=&quot;&#39;+v+&#39;&quot; /&gt;&lt;/OBJECT&gt;&#39;<br>                }else{<br>                    g=&#39;&lt;embed name=&quot;&#39;+i+&#39;&quot; width=&quot;&#39;+w+&#39;&quot; height=&quot;&#39;+h+&#39;&quot; type=&quot;application/x-shockwave-flash&quot; pluginspage=&quot; http://www.adobe.com/shockwave/download/download.cgi?P1_Prod_Version=ShockwaveFlash&quot; allowScriptAccess=&quot;always&quot; allowFullScreen=&quot;true&quot; quality=&quot;high&quot; menu=&quot;false&quot; wmode=&quot;&#39;+wm+&#39;&quot; flashvars=&quot;&#39;+v+&#39;&quot; src=&quot;&#39;+u+&#39;&quot;&gt;&lt;/embed&gt;&#39;<br>                }<br>                return g;<br>            }<br>            var flashHTML = createFlashHTML(getFlashURL(),&#39;100%&#39;,&#39;100%&#39;,&quot;videoPlayer&quot;,&quot;Opaque&quot;,&quot;autoPlay=true&amp;isAutoPlay=true&amp;auto=1&amp;playMovie=true&amp;adss=0&amp;api=1&quot;);<br>            $("player").innerHTML = flashHTML<br>            var flash = $("player").children[0];<br>            var intervalID =  setInterval(function(){<br>                if(checkLoaded(flash)){<br>                    clearInterval(intervalID);<br>                    $("mask").style.display = "none";<br>                    intervalID = null;<br>                }<br>            },60)<br>                       <br>        &lt;/script&gt;<br>    &lt;/body&gt;<br>&lt;/html&gt;<br><img src="http://www.cnblogs.com/rubylouvre/aggbug/2536590.html?type=1" width="1" height="1" alt=""><p><a href="http://www.cnblogs.com/rubylouvre/archive/2012/06/05/2536590.html">本文链接</a></p>