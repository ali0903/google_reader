---
layout: post
title:  "理解Windws中的路由表"
date:   2011-03-19 16:22:33
author: iGFW
categories: program
---

## 理解Windws中的路由表
### by iGFW
### at 2011-03-19 16:22:33
### original <http://igfw.tk/archives/1896>

<p>前文<a href="https://wangyan.org/blog/tcp-ipv4.html">《网络基础技术：详解IP地址》</a>及<a href="https://wangyan.org/blog/ipv4-mask.html">子网划分及子网掩码计算方法</a>讲了 IP协议和子网掩码的一些基础知识，这一切都是为今天的路由知识准备的…</p>
<h3>一、名词理解</h3>
<h4>1.1、路由表：</h4>
<p>指<a href="http://baike.baidu.com/view/1360.htm">路由器</a>或者其他互联网网络设备上存储的表，该表中存有到达特定网络终端的路径，在某些情况下，还有一些与这些路径相关的度量。</p>
<p>在命令提示符下输入“route print”，显示如下图所示的本地路由表：<span></span></p>
<p><a href="https://s3.amazonaws.com/wangyan/pic/r/route.png"><img src="https://s3.amazonaws.com/wangyan/pic/r/route.png" alt="本地路由表" width="450"> </a></p>
<h4>1.2、Network Destination（网络目标地址）：</h4>
<p>1) 网络目标地址和网络掩码相与的结果，用于定义本地计算机可以到达的范围。</p>
<p>2) 在添加路由时，Windows要求输入的网络目标地址和网络掩码相与后的结果必须等于网络目标地址，否则路由添加会失败。</p>
<p>故：网络目标地址包有四种可能；</p>
<ol>
<li>某个特定主机的地址，如：192.168.1.101，网络掩码为255.255.255.255</li>
<li>某个特定子网的地址，如：192.168.1.240，网络掩码为255.255.255.240</li>
<li>某个特定网络的地址，如：192.168.1.0，  网络掩码为255.255.255.0</li>
<li>默认路由，所有未在路由表中指定的网络地址，如：0.0.0.0，网络掩码为0.0.00</li>
</ol>
<h4>1.3、Gateway（网关）：</h4>
<p>1）网关又称为下一跳服务器，指发送IP数据包时，如果目标主机非同一个网络，则数据包会发送到网关。</p>
<p>2）如果是本地计算机直接连接到网络，网关通常是本地计算机对应的网络接口。（接口必须同网关一致）</p>
<p>3）如果是远程网络，网关通常是本地计算机所连接到的网络上的某个服务器或路由器。 （网关同路由器IP一致）</p>
<h4>1.4、Interface（接口）：</h4>
<p>1)本地计算机用于发送数据包的网络接口。</p>
<p>2)网关必须位于和接口相同的子网（默认网关除外）。</p>
<h4>1.5、Metric（跃点数）：</h4>
<p>用于指出路由的成本，是路由算法用以确定到达网络目标地址的最佳路径的计量标准，如：路径长度（一个跃点代表经过一个路由器）、可靠性、延迟、带宽、负载、通信代价。当具有多条到达相同目的网络的路由项时，TCP/IP会选择具有更低跃点数的路由项。</p>
<h3>二、工作流程</h3>
<p>当TCP/IP需要向某个IP地址发起通信时，它会对路由表进行评估，以确定如何发送数据包。过程如下：</p>
<p>2.1、TCP/IP将该IP地址和路由表中每个路由项的网络掩码进行相与计算，如果结果匹配对应路由项的网络目标地址，则记录下此路由项。如果有多个匹配项，则会根据相关规则选择最佳路由项，然后通过接口和网关发送数据。</p>
<p>2.2、 如果相与后的结果不匹配任何路由项，那么TCP/IP就会选择默认路由项，默认路由的网络地址为0.0.0.0，网络掩码为0.0.0.0，它匹配任何网 络通信。设置默认路由后，数据包的路由责任移交到了路由器，这可以大大简化本地路由表和配置，但会占用了额外的网络流量。</p>
<h3>三、路由命令</h3>
<p>route命令主要用于手动配置静态路由表 ，语法如下：</p>
<blockquote><p>route [-f] [-p] [-4:-6] Command [Destination] [mask Netmask] [Gateway] [metric Metric] [if Interface]]</p></blockquote>
<h4>3.1. 参数解释：</h4>
<p>-f<br>
清除所有网关项路由表（掩码为255.255.255.255的路由、目标为127.0.0.0，掩码为255.255.255.0的路由、目标为 224.0.0.0，掩码为240.0.0.0的路由）。如果它与命令之一（例如 add、change 或  delete）结合使用，表会在运行命令之前清除。</p>
<p>-p<br>
与 ADD 命令结合使用时，将路由设置为在系统引导期间保持不变。默认情况下，重新启不保存路由。</p>
<p>-4<br>
强制使用IPv4</p>
<p>-6<br>
强制使用IPv6</p>
<p>Command<br>
指定要运行的命令。</p>
<p>1) add 添加路由<br>
2) change 更改现存路由<br>
3) delete 删除路由<br>
4) print 打印路由</p>
<p>Destination<br>
指定路由的网络目标地址。</p>
<p>mask subnetmask<br>
指定与网络目标地址相关联的网掩码。子网掩码对于 IP 网络地址可以是一适当的子网掩码，对于主机路由是 255.255.255.255 ，对于默认路由是 0.0.0.0。如果忽略，则使用子网掩码 255.255.255.255。</p>
<p>Gateway<br>
指定网关</p>
<p>metric Metric<br>
指定跃点数</p>
<p>if Interface<br>
指定路由接口号码，忽略 if 参数时，接口由网关地址确定。</p>
<h4>3.2. 使用范例</h4>
<p>route print<br>
显示本地路由表的完整内容</p>
<p>route print 10.*<br>
显示本地路由表中以10. 开始的路由</p>
<p>route add 0.0.0.0 mask 0.0.0.0 192.168.0.1<br>
要添加默认网关地址为 192.168.0.1 的默认路由</p>
<p>route add 192.168.0.100 mask 255.255.255.255 192.168.0.1<br>
要添加目标为 10.41.0.0，子网掩码为 255.255.0.0，网关为 192.168.0.1 的路由</p>
<p>route -p add 192.168.0.100 mask 255.255.255.255 192.168.0.1<br>
要添加目标为 10.41.0.0，子网掩码为 255.255.0.0，网关为 192.168.0.1 的永久路由</p>
<p>route add 192.168.0.100 mask 255.255.255.255 192.168.0.1 metric 7<br>
要添加目标为 10.41.0.0，子网掩码为 255.255.0.0，网关为 192.168.0.1设置 ，跃点数为 7 的路由</p>
<p>……</p>
<p> </p>
<p><strong>来源</strong>：<a href="https://wangyan.org/blog/routing-table.html">https://wangyan.org/blog/routing-table.html</a></p>