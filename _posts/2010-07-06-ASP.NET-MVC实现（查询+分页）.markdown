---
layout: post
title:  "ASP.NET MVC实现（查询+分页）"
date:   2010-07-06 23:52:00
author: Dacey
categories: program
---

## ASP.NET MVC实现（查询+分页）
### by Dacey
### at 2010-07-06 23:52:00
### original <http://www.cnblogs.com/duanseven/archive/2010/07/06/1772538.html>

<p><a href="http://www.cnblogs.com/duanseven/"><img src="http://pic.cnblogs.com/face/u37176.jpg" alt="" border="0"></a><br>作者: <a href="http://www.cnblogs.com/duanseven/">Dacey</a> 发表于 2010-07-06 23:52 <a href="http://www.cnblogs.com/duanseven/archive/2010/07/06/1772538.html">原文链接</a> 阅读: 1262 评论: 6</p><p><span style="font-family:宋体;font-size:10pt">　　　</span><span style="font-family:宋体;font-size:10pt"><span style="font-family:宋体;font-size:10pt">在</span><span style="font-family:&#39;Courier New&#39;;font-size:10pt" lang="EN-
US">asp.net</span><span>中我们知道有</span><span style="font-family:&#39;Courier New&#39;;font-size:10pt" lang="EN-US">viewstate</span><span style="font-family:宋体;font-size:10pt">这样的页面级容器为我们保存表单数据，这样我们每次提交时数据都不会丢失，很容易的完成查询+<font size="2">分页的实现</font>。</span></span><span style="font-size:10pt"><span>找过相关<span style="font-family:&#39;Courier New&#39;;font-size:10pt" lang="EN-US">MVC</span><span style="font-family:宋体;font-size:10pt">分页的例子，都是扩展</span><span style="font-family:&#39;Courier New&#39;;font-size:10pt" lang="EN-US">HtmlHelper</span><span style="font-family:宋体;font-size:10pt">方法来实现。我想大家在</span><span style="font-family:&#39;Courier New&#39;;font-size:10pt" lang="EN-US">ASP.NET</span><span style="font-family:宋体;font-size:10pt">开发中都用过 </span><span style="font-family:&#39;Courier New&#39;;font-size:10pt" lang="EN-US">wuqi</span><span style="font-family:宋体;font-size:10pt">的</span><span style="font-size:10pt" lang="EN-
US">AspNetPager</span><span style="font-family:宋体;font-size:10pt">分页控件以及</span><span style="font-family:&#39;Courier New&#39;;font-size:10pt" lang="EN-US">dacey</span><span style="font-family:宋体;font-size:10pt">的</span><span style="font-size:10pt" lang="EN-
US">NSunPage</span><span style="font-family:宋体;font-size:10pt">用来开发</span><span style="font-size:10pt" lang="EN-
US">Winform</span><span style="font-family:宋体;font-size:10pt">项目的分页控件非常方便的满足了大家的分页需求。那么我们来看下在MVC中的查询+分页是怎么实现的。（这里我用到了wuqi的mvcpager） </span></span></span></p>
<p><span style="font-family:宋体;font-size:10pt"><span style="font-family:宋体;font-size:10pt"></span><span style="font-family:宋体;font-size:10pt">下面例子是</span><span style="font-family:&#39;Courier New&#39;;font-size:10pt" lang="EN-US">asp.net</span><span style="font-family:宋体">中的分页查询：</span></span></p>
<p><span style="font-family:宋体;font-size:10pt"><span style="font-family:宋体"></span><span style="font-family:&#39;Courier New&#39;;font-size:10pt" lang="EN-US"><font face="宋体">前台代码：</font></span></span></p>
<div>
<div><span style="color:#0000ff">&lt;</span><span style="color:#800000">html</span><span style="color:#0000ff">&gt;</span><span style="color:#000000"><br>
</span><span style="color:#0000ff">&lt;</span><span style="color:#800000">body</span><span style="color:#0000ff">&gt;</span><span style="color:#000000"><br>
</span><span style="color:#0000ff">&lt;</span><span style="color:#800000">form </span><span style="color:#ff0000">id</span><span style="color:#0000ff">="form1"</span><span style="color:#ff0000"> runat</span><span style="color:#0000ff">="server"</span><span style="color:#0000ff">&gt;</span><span style="color:#000000"><br>
部门编号：</span><span style="color:#0000ff">&lt;</span><span style="color:#800000">asp:TextBox </span><span style="color:#ff0000">ID</span><span style="color:#0000ff">="deptcode"</span><span style="color:#ff0000"> Width</span><span style="color:#0000ff">="80px"</span><span style="color:#ff0000"> runat</span><span style="color:#0000ff">="server"</span><span style="color:#0000ff">&gt;&lt;/</span><span style="color:#800000">asp:TextBox</span><span style="color:#0000ff">&gt;</span><span style="color:#000000"><br>
部门名称：</span><span style="color:#0000ff">&lt;</span><span style="color:#800000">asp:TextBox </span><span style="color:#ff0000">ID</span><span style="color:#0000ff">="deptname"</span><span style="color:#ff0000"> Width</span><span style="color:#0000ff">="80px"</span><span style="color:#ff0000"> runat</span><span style="color:#0000ff">="server"</span><span style="color:#ff0000"> </span><span style="color:#0000ff">&gt;&lt;/</span><span style="color:#800000">asp:TextBox</span><span style="color:#0000ff">&gt;</span><span style="color:#000000"><br>
</span><span style="color:#0000ff">&lt;</span><span style="color:#800000">asp:Button </span><span style="color:#ff0000">ID</span><span style="color:#0000ff">="btnquery"</span><span style="color:#ff0000"> runat</span><span style="color:#0000ff">="server"</span><span style="color:#ff0000"> Text</span><span style="color:#0000ff">="查询"</span><span style="color:#ff0000"> onclick</span><span style="color:#0000ff">=&quot; btnquery_Click&quot;</span><span style="color:#0000ff">/&gt;</span><span style="color:#000000"><br>
</span><span style="color:#0000ff">&lt;</span><span style="color:#800000">table </span><span style="color:#ff0000">class</span><span style="color:#0000ff">="TableBlock"</span><span style="color:#ff0000"> width</span><span style="color:#0000ff">="100%"</span><span style="color:#ff0000"> style</span><span style="color:#0000ff">=&quot;margin-top: 10px;&quot;</span><span style="color:#0000ff">&gt;</span><span style="color:#000000"><br>
              </span><span style="color:#0000ff">&lt;</span><span style="color:#800000">tr</span><span style="color:#0000ff">&gt;</span><span style="color:#000000"><br>
              </span><span style="color:#0000ff">&lt;</span><span style="color:#800000">th</span><span style="color:#0000ff">&gt;</span><span style="color:#000000">编号</span><span style="color:#0000ff">&lt;/</span><span style="color:#800000">th</span><span style="color:#0000ff">&gt;</span><span style="color:#000000"><br>
              </span><span style="color:#0000ff">&lt;</span><span style="color:#800000">th</span><span style="color:#0000ff">&gt;</span><span style="color:#000000">名称</span><span style="color:#0000ff">&lt;/</span><span style="color:#800000">th</span><span style="color:#0000ff">&gt;</span><span style="color:#000000"><br>
              </span><span style="color:#0000ff">&lt;/</span><span style="color:#800000">tr</span><span style="color:#0000ff">&gt;</span><span style="color:#000000"><br>
</span><span style="color:#0000ff">&lt;</span><span style="color:#800000">asp:Repeater </span><span style="color:#ff0000">ID</span><span style="color:#0000ff">="TableBlockList"</span><span style="color:#ff0000"> runat</span><span style="color:#0000ff">="server"</span><span style="color:#0000ff">&gt;</span><span style="color:#000000"><br>
  </span><span style="color:#0000ff">&lt;</span><span style="color:#800000">ItemTemplate</span><span style="color:#0000ff">&gt;</span><span style="color:#000000"><br>
              </span><span style="color:#0000ff">&lt;</span><span style="color:#800000">tr</span><span style="color:#0000ff">&gt;</span><span style="color:#000000"><br>
              </span><span style="color:#0000ff">&lt;</span><span style="color:#800000">td</span><span style="color:#0000ff">&gt;</span><span style="background-color:#ffff00;color:#000000">&lt;%</span><span style="background-color:#f5f5f5;color:#000000">#</span><span style="background-color:#f5f5f5;color:#0000ff">Eval</span><span style="background-color:#f5f5f5;color:#000000">(</span><span style="background-color:#f5f5f5;color:#800000">"</span><span style="background-color:#f5f5f5;color:#800000">code</span><span style="background-color:#f5f5f5;color:#800000">"</span><span style="background-color:#f5f5f5;color:#000000">)  </span><span style="background-color:#ffff00;color:#000000">%&gt;</span><span style="color:#0000ff">&lt;/</span><span style="color:#800000">td</span><span style="color:#0000ff">&gt;</span><span style="color:#000000"><br>
              </span><span style="color:#0000ff">&lt;</span><span style="color:#800000">td</span><span style="color:#0000ff">&gt;</span><span style="background-color:#ffff00;color:#000000">&lt;%</span><span style="background-color:#f5f5f5;color:#000000">#</span><span style="background-color:#f5f5f5;color:#0000ff">Eval</span><span style="background-color:#f5f5f5;color:#000000">(</span><span style="background-color:#f5f5f5;color:#800000">"</span><span style="background-color:#f5f5f5;color:#800000">name</span><span style="background-color:#f5f5f5;color:#800000">"</span><span style="background-color:#f5f5f5;color:#000000">)  </span><span style="background-color:#ffff00;color:#000000">%&gt;</span><span style="color:#0000ff">&lt;/</span><span style="color:#800000">td</span><span style="color:#0000ff">&gt;</span><span style="color:#000000"><br>
</span><span style="color:#0000ff">&lt;/</span><span style="color:#800000">tr</span><span style="color:#0000ff">&gt;</span><span style="color:#000000"><br>
  </span><span style="color:#0000ff">&lt;/</span><span style="color:#800000">ItemTemplate</span><span style="color:#0000ff">&gt;</span><span style="color:#000000"><br>
  </span><span style="color:#0000ff">&lt;/</span><span style="color:#800000">asp:Repeater</span><span style="color:#0000ff">&gt;</span><span style="color:#000000"><br>
</span><span style="color:#0000ff">&lt;/</span><span style="color:#800000">table</span><span style="color:#0000ff">&gt;</span><span style="color:#000000"><br>
</span><span style="color:#0000ff">&lt;/</span><span style="color:#800000">form</span><span style="color:#0000ff">&gt;</span><span style="color:#000000"><br>
</span><span style="color:#0000ff">&lt;/</span><span style="color:#800000">body</span><span style="color:#0000ff">&gt;</span><span style="color:#000000"><br>
</span><span style="color:#0000ff">&lt;/</span><span style="color:#800000">html</span><span style="color:#0000ff">&gt;</span><span style="color:#000000"><br>
<br>
</span></div>
</div>
<p> 后台代码:
<p><span style="font-family:宋体;font-size:10pt"></span></p>
<div>
<div><span style="color:#0000ff">protected</span><span style="color:#000000"> </span><span style="color:#0000ff">virtual</span><span style="color:#000000"> SelectSqlSection GetSelectSearch()<br>
{<br>
      SelectSqlSection select </span><span style="color:#000000">=</span><span style="color:#000000"> db.GetSelectSqlSection ();<br>
      </span><span style="color:#0000ff">if</span><span style="color:#000000"> (</span><span style="color:#000000">!</span><span style="color:#0000ff">string</span><span style="color:#000000">.IsNullOrEmpty (deptname.Text))  {                 <br>
          select.Where (View_DeptQueryInfo.__name.Like(deptname.Text  </span><span style="color:#000000">+</span><span style="color:#000000"> </span><span style="color:#800000">"</span><span style="color:#800000">%</span><span style="color:#800000">"</span><span style="color:#000000">));<br>
      }<br>
      </span><span style="color:#0000ff">if</span><span style="color:#000000">(</span><span style="color:#000000">!</span><span style="color:#0000ff">string</span><span style="color:#000000">.IsNullOrEmpty(deptcode.Text)){<br>
          select.Where (View_DeptQueryInfo.__code.Like(deptcode.Text  </span><span style="color:#000000">+</span><span style="color:#000000"> </span><span style="color:#800000">"</span><span style="color:#800000">%</span><span style="color:#800000">"</span><span style="color:#000000">));<br>
      }<br>
      </span><span style="color:#0000ff">return</span><span style="color:#000000"> select; <br>
}<br>
</span><span style="color:#0000ff">protected</span><span style="color:#000000"> </span><span style="color:#0000ff">void</span><span style="color:#000000"> BindTable(Repeater rpt, AspNetPager anp)<br>
{<br>
      </span><span style="color:#0000ff">int</span><span style="color:#000000"> countPage </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#800080">0</span><span style="color:#000000">;<br>
      DataTable dt </span><span style="color:#000000">=</span><span style="color:#000000">db.SelectPageToDataTable(GetSelectSearch (), anp.PageSize, anp.CurrentPageIndex, <br>
</span><span style="color:#0000ff">out</span><span style="color:#000000"> countPage);<br>
      anp.RecordCount </span><span style="color:#000000">=</span><span style="color:#000000"> countPage;<br>
      rpt.DataSource </span><span style="color:#000000">=</span><span style="color:#000000"> dt;<br>
      rpt.DataBind();<br>
} <br>
<br>
</span></div>
</div>
<p><span style="font-family:宋体;font-size:10pt">    以上就完成了查询分页的功能，没什么特别的和我们做</span><span style="font-family:&#39;Courier New&#39;;font-size:10pt" lang="EN-US">winform</span><span style="font-family:宋体;font-size:10pt">的差不多。第二次查询一样能获得表单内的值。</span> </p>
<p> </p>
<p style="text-align:left;text-indent:21pt;margin:0cm 0cm 0pt" align="left"><span style="font-family:宋体;font-size:10pt"></span><span style="font-family:&#39;Courier New&#39;;font-size:10pt" lang="EN-US"></span></p>
<p style="text-align:left;margin:0cm 0cm 0pt" align="left"><span>    那么</span><span style="font-family:&#39;Courier New&#39;;font-size:10pt" lang="EN-US">asp.net mvc</span><span style="font-family:宋体;font-size:10pt">中怎么实现呢？用什么来保存表单数据呢？记得原来写</span><span style="font-family:&#39;Courier New&#39;;font-size:10pt" lang="EN-US">java</span><span style="font-family:宋体;font-size:10pt">的时候我是用</span><span style="font-family:&#39;Courier New&#39;;font-size:10pt" lang="EN-US">session</span><span style="font-family:宋体;font-size:10pt">这样笨拙的方法来保存查询提交后的方法来保存用户查询条件的。那么在</span><span style="font-family:&#39;Courier New&#39;;font-size:10pt" lang="EN-US">asp.net mvc</span><span style="font-family:宋体;font-size:10pt">中我们该怎么实现呢？</span></p>
<p style="text-align:left;margin:0cm 0cm 0pt" align="left"><span style="font-family:宋体;font-size:10pt"></span> </p>
<p style="text-align:left;margin:0cm 0cm 0pt" align="left"> 页面代码：</p>
<div>
<div><span style="color:#0000ff">&lt;</span><span style="color:#800000">html</span><span style="color:#0000ff">&gt;</span><span style="color:#000000"><br>
</span><span style="color:#0000ff">&lt;</span><span style="color:#800000">body</span><span style="color:#0000ff">&gt;</span><span style="color:#000000"><br>
    </span><span style="color:#0000ff">&lt;</span><span style="color:#800000">form </span><span style="color:#ff0000">id</span><span style="color:#0000ff">="form1"</span><span style="color:#ff0000"> method</span><span style="color:#0000ff">="post"</span><span style="color:#ff0000"> action</span><span style="color:#0000ff">="/Dept/Dept"</span><span style="color:#ff0000"> runat</span><span style="color:#0000ff">="server"</span><span style="color:#0000ff">&gt;</span><span style="color:#000000"> <br>
     部门名称：</span><span style="color:#0000ff">&lt;</span><span style="color:#800000">input </span><span style="color:#ff0000">id</span><span style="color:#0000ff">="deptname"</span><span style="color:#ff0000"> name</span><span style="color:#0000ff">=&quot; deptname &quot;</span><span style="color:#ff0000"> type</span><span style="color:#0000ff">="text"</span><span style="color:#ff0000"> value</span><span style="color:#0000ff">=&#39;&lt;%=ViewData </span><span style="color:#ff0000">[&quot;deptname &quot;] %</span><span style="color:#0000ff">&gt;</span><span style="color:#000000">&#39;/&gt;<br>
     部门编号：</span><span style="color:#0000ff">&lt;</span><span style="color:#800000">input </span><span style="color:#ff0000">id</span><span style="color:#0000ff">="deptcode"</span><span style="color:#ff0000"> name</span><span style="color:#0000ff">=&quot; deptcode &quot;</span><span style="color:#ff0000"> type</span><span style="color:#0000ff">="text"</span><span style="color:#ff0000"> value</span><span style="color:#0000ff">=&#39;&lt;%=ViewData </span><span style="color:#ff0000">[&quot;deptcode &quot;] %</span><span style="color:#0000ff">&gt;</span><span style="color:#000000">&#39;/&gt; <br>
</span><span style="color:#0000ff">&lt;</span><span style="color:#800000">input </span><span style="color:#ff0000">id</span><span style="color:#0000ff">="btnquery"</span><span style="color:#ff0000"> type</span><span style="color:#0000ff">="submit"</span><span style="color:#ff0000"> value</span><span style="color:#0000ff">=&quot;查询 &quot;</span><span style="color:#0000ff">/&gt;</span><span style="color:#000000"><br>
</span><span style="color:#0000ff">&lt;</span><span style="color:#800000">table </span><span style="color:#ff0000">class</span><span style="color:#0000ff">="TableBlock"</span><span style="color:#ff0000"> width</span><span style="color:#0000ff">="100%"</span><span style="color:#0000ff">&gt;</span><span style="color:#000000"><br>
        </span><span style="color:#0000ff">&lt;</span><span style="color:#800000">tr</span><span style="color:#0000ff">&gt;</span><span style="color:#000000"> <br>
            </span><span style="color:#0000ff">&lt;</span><span style="color:#800000">th</span><span style="color:#0000ff">&gt;</span><span style="color:#000000">编号</span><span style="color:#0000ff">&lt;/</span><span style="color:#800000">th</span><span style="color:#0000ff">&gt;</span><span style="color:#000000"><br>
            </span><span style="color:#0000ff">&lt;</span><span style="color:#800000">th</span><span style="color:#0000ff">&gt;</span><span style="color:#000000">部门名称</span><span style="color:#0000ff">&lt;/</span><span style="color:#800000">th</span><span style="color:#0000ff">&gt;</span><span style="color:#000000"><br>
       </span><span style="color:#0000ff">&lt;/</span><span style="color:#800000">tr</span><span style="color:#0000ff">&gt;</span><span style="color:#000000"><br>
</span><span style="color:#0000ff">&lt;</span><span style="color:#800000">asp:MvcRepeater </span><span style="color:#ff0000">ID</span><span style="color:#0000ff">="MvcRepeater1"</span><span style="color:#ff0000"> Key</span><span style="color:#0000ff">="deptlist"</span><span style="color:#ff0000"> runat</span><span style="color:#0000ff">="server"</span><span style="color:#0000ff">&gt;</span><span style="color:#000000"><br>
            </span><span style="color:#0000ff">&lt;</span><span style="color:#800000">ItemTemplate</span><span style="color:#0000ff">&gt;</span><span style="color:#000000"><br>
              </span><span style="color:#0000ff">&lt;</span><span style="color:#800000">tr</span><span style="color:#0000ff">&gt;</span><span style="color:#000000"> <br>
              </span><span style="color:#0000ff">&lt;</span><span style="color:#800000">td </span><span style="color:#ff0000">style</span><span style="color:#0000ff">="width:5;"</span><span style="color:#0000ff">&gt;</span><span style="background-color:#ffff00;color:#000000">&lt;%</span><span style="background-color:#f5f5f5;color:#000000"># </span><span style="background-color:#f5f5f5;color:#0000ff">Eval</span><span style="background-color:#f5f5f5;color:#000000">(</span><span style="background-color:#f5f5f5;color:#800000">"</span><span style="background-color:#f5f5f5;color:#800000">code</span><span style="background-color:#f5f5f5;color:#800000">"</span><span style="background-color:#f5f5f5;color:#000000">)</span><span style="background-color:#ffff00;color:#000000">%&gt;</span><span style="color:#0000ff">&lt;/</span><span style="color:#800000">td</span><span style="color:#0000ff">&gt;</span><span style="color:#000000"><br>
              </span><span style="color:#0000ff">&lt;</span><span style="color:#800000">td </span><span style="color:#ff0000">style</span><span style="color:#0000ff">="width:10;"</span><span style="color:#0000ff">&gt;</span><span style="background-color:#ffff00;color:#000000">&lt;%</span><span style="background-color:#f5f5f5;color:#000000"># </span><span style="background-color:#f5f5f5;color:#0000ff">Eval</span><span style="background-color:#f5f5f5;color:#000000">(</span><span style="background-color:#f5f5f5;color:#800000">"</span><span style="background-color:#f5f5f5;color:#800000">name</span><span style="background-color:#f5f5f5;color:#800000">"</span><span style="background-color:#f5f5f5;color:#000000">)</span><span style="background-color:#ffff00;color:#000000">%&gt;</span><span style="color:#0000ff">&lt;/</span><span style="color:#800000">td</span><span style="color:#0000ff">&gt;</span><span style="color:#000000"><br>
              </span><span style="color:#0000ff">&lt;/</span><span style="color:#800000">tr</span><span style="color:#0000ff">&gt;</span><span style="color:#000000"><br>
            </span><span style="color:#0000ff">&lt;/</span><span style="color:#800000">ItemTemplate</span><span style="color:#0000ff">&gt;</span><span style="color:#000000"><br>
</span><span style="color:#0000ff">&lt;/</span><span style="color:#800000">asp:MvcRepeater</span><span style="color:#0000ff">&gt;</span><span style="color:#000000">   <br>
</span><span style="color:#0000ff">&lt;/</span><span style="color:#800000">table</span><span style="color:#0000ff">&gt;</span><span style="color:#000000"><br>
</span><span style="color:#0000ff">&lt;</span><span style="color:#800000">div </span><span style="color:#ff0000">class</span><span style="color:#0000ff">="pager"</span><span style="color:#ff0000"> style</span><span style="color:#0000ff">="width:100%;text-align:right;"</span><span style="color:#0000ff">&gt;</span><span style="color:#000000"><br>
        </span><span style="color:#0000ff">&lt;</span><span style="color:#800000">div </span><span style="color:#ff0000">class</span><span style="color:#0000ff">="pager"</span><span style="color:#ff0000"> align</span><span style="color:#0000ff">="left"</span><span style="color:#ff0000"> style</span><span style="color:#0000ff">=&quot;float: left; width: 40%;&quot;</span><span style="color:#0000ff">&gt;</span><span style="color:#000000"><br>
</span><span style="background-color:#ffff00;color:#000000">&lt;%</span><span style="background-color:#f5f5f5;color:#000000">=</span><span style="background-color:#f5f5f5;color:#800000">"</span><span style="background-color:#f5f5f5;color:#800000">共 </span><span style="background-color:#f5f5f5;color:#800000">"</span><span style="background-color:#f5f5f5;color:#000000">+</span><span style="background-color:#f5f5f5;color:#000000"> ((Webdiyer.WebControls.Mvc.PagedList</span><span style="background-color:#f5f5f5;color:#000000">&lt;</span><span style="background-color:#f5f5f5;color:#000000">DepartmentInfo</span><span style="background-color:#f5f5f5;color:#000000">&gt;</span><span style="background-color:#f5f5f5;color:#000000">)ViewData [</span><span style="background-color:#f5f5f5;color:#800000">"</span><span style="background-color:#f5f5f5;color:#800000">deptlist</span><span style="background-color:#f5f5f5;color:#800000">"</span><span style="background-color:#f5f5f5;color:#000000">]).TotalPageCount </span><span style="background-color:#f5f5f5;color:#000000">+</span><span style="background-color:#f5f5f5;color:#000000"> </span><span style="background-color:#f5f5f5;color:#800000">"</span><span style="background-color:#f5f5f5;color:#800000">页</span><span style="background-color:#f5f5f5;color:#800000">"</span><span style="background-color:#f5f5f5;color:#000000"> </span><span style="background-color:#f5f5f5;color:#000000">+</span><span style="background-color:#f5f5f5;color:#000000">  ((Webdiyer.WebControls.Mvc.PagedList</span><span style="background-color:#f5f5f5;color:#000000">&lt;</span><span style="background-color:#f5f5f5;color:#000000">DepartmentInfo</span><span style="background-color:#f5f5f5;color:#000000">&gt;</span><span style="background-color:#f5f5f5;color:#000000">)ViewData [</span><span style="background-color:#f5f5f5;color:#800000">"</span><span style="background-color:#f5f5f5;color:#800000">deptlist</span><span style="background-color:#f5f5f5;color:#800000">"</span><span style="background-color:#f5f5f5;color:#000000">]).TotalItemCount </span><span style="background-color:#f5f5f5;color:#000000">+</span><span style="background-color:#f5f5f5;color:#000000"> </span><span style="background-color:#f5f5f5;color:#800000">"</span><span style="background-color:#f5f5f5;color:#800000">条</span><span style="background-color:#f5f5f5;color:#800000">"</span><span style="background-color:#ffff00;color:#000000">%&gt;</span><span style="color:#0000ff">&lt;/</span><span style="color:#800000">div</span><span style="color:#0000ff">&gt;</span><span style="color:#000000"><br>
</span><span style="color:#0000ff">&lt;</span><span style="color:#800000">div </span><span style="color:#ff0000">align</span><span style="color:#0000ff">="right"</span><span style="color:#ff0000"> class</span><span style="color:#0000ff">="pager"</span><span style="color:#ff0000"> style</span><span style="color:#0000ff">=&quot;width: 60%; float: left;&quot;</span><span style="color:#0000ff">&gt;</span><span style="color:#000000"> </span><span style="background-color:#ffff00;color:#000000">&lt;%</span><span style="background-color:#f5f5f5;color:#000000">=</span><span style="background-color:#f5f5f5;color:#000000">Html.Pager</span><span style="background-color:#f5f5f5;color:#000000">&lt;</span><span style="background-color:#f5f5f5;color:#000000">DepartmentInfo</span><span style="background-color:#f5f5f5;color:#000000">&gt;</span><span style="background-color:#f5f5f5;color:#000000"> ((Webdiyer.WebControls.Mvc.PagedList</span><span style="background-color:#f5f5f5;color:#000000">&lt;</span><span style="background-color:#f5f5f5;color:#000000">DepartmentInfo</span><span style="background-color:#f5f5f5;color:#000000">&gt;</span><span style="background-color:#f5f5f5;color:#000000">)ViewData [</span><span style="background-color:#f5f5f5;color:#800000">"</span><span style="background-color:#f5f5f5;color:#800000">deptlist</span><span style="background-color:#f5f5f5;color:#800000">"</span><span style="background-color:#f5f5f5;color:#000000">], </span><span style="background-color:#f5f5f5;color:#0000ff">new</span><span style="background-color:#f5f5f5;color:#000000"> PagerOptions() { PageIndexParameterName </span><span style="background-color:#f5f5f5;color:#000000">=</span><span style="background-color:#f5f5f5;color:#000000"> </span><span style="background-color:#f5f5f5;color:#800000">"</span><span style="background-color:#f5f5f5;color:#800000">id</span><span style="background-color:#f5f5f5;color:#800000">"</span><span style="background-color:#f5f5f5;color:#000000">, CurrentPagerItemWrapperFormatString </span><span style="background-color:#f5f5f5;color:#000000">=</span><span style="background-color:#f5f5f5;color:#000000"> </span><span style="background-color:#f5f5f5;color:#800000">"</span><span style="background-color:#f5f5f5;color:#800000">&lt;span class=\</span><span style="background-color:#f5f5f5;color:#800000">"</span><span style="background-color:#f5f5f5;color:#000000">cpb</span><span style="background-color:#f5f5f5;color:#000000">\</span><span style="background-color:#f5f5f5;color:#800000">"</span><span style="background-color:#f5f5f5;color:#800000">&gt; {0}&lt;/span&gt;</span><span style="background-color:#f5f5f5;color:#800000">"</span><span style="background-color:#f5f5f5;color:#000000">, NumericPagerItemWrapperFormatString </span><span style="background-color:#f5f5f5;color:#000000">=</span><span style="background-color:#f5f5f5;color:#000000"> </span><span style="background-color:#f5f5f5;color:#800000">"</span><span style="background-color:#f5f5f5;color:#800000">&lt;span class=\</span><span style="background-color:#f5f5f5;color:#800000">"</span><span style="background-color:#f5f5f5;color:#000000">item</span><span style="background-color:#f5f5f5;color:#000000">\</span><span style="background-color:#f5f5f5;color:#800000">"</span><span style="background-color:#f5f5f5;color:#800000">&gt; {0}&lt;/span&gt;</span><span style="background-color:#f5f5f5;color:#800000">"</span><span style="background-color:#f5f5f5;color:#000000">, CssClass </span><span style="background-color:#f5f5f5;color:#000000">=</span><span style="background-color:#f5f5f5;color:#000000"> </span><span style="background-color:#f5f5f5;color:#800000">"</span><span style="background-color:#f5f5f5;color:#800000">pages</span><span style="background-color:#f5f5f5;color:#800000">"</span><span style="background-color:#f5f5f5;color:#000000">, SeparatorHtml </span><span style="background-color:#f5f5f5;color:#000000">=</span><span style="background-color:#f5f5f5;color:#000000"> </span><span style="background-color:#f5f5f5;color:#800000">""</span><span style="background-color:#f5f5f5;color:#000000">,IsPost</span><span style="background-color:#f5f5f5;color:#000000">=</span><span style="background-color:#f5f5f5;color:#0000ff">true</span><span style="background-color:#f5f5f5;color:#000000"> })</span><span style="background-color:#ffff00;color:#000000">%&gt;</span><span style="color:#0000ff">&lt;/</span><span style="color:#800000">div</span><span style="color:#0000ff">&gt;</span><span style="color:#000000"><br>
    </span><span style="color:#0000ff">&lt;/</span><span style="color:#800000">div</span><span style="color:#0000ff">&gt;</span><span style="color:#000000"><br>
    </span><span style="color:#0000ff">&lt;/</span><span style="color:#800000">form</span><span style="color:#0000ff">&gt;</span><span style="color:#000000"><br>
</span><span style="color:#0000ff">&lt;/</span><span style="color:#800000">body</span><span style="color:#0000ff">&gt;</span><span style="color:#000000"><br>
</span><span style="color:#0000ff">&lt;/</span><span style="color:#800000">html</span><span style="color:#0000ff">&gt;</span></div>
</div>
<p>
<p> </p>
      首先用到了<span style="font-family:&#39;Courier New&#39;;font-size:9pt" lang="EN-US">Repeater</span><span style="font-family:宋体;font-size:9pt">，在</span><span style="font-family:&#39;Courier New&#39;;font-size:9pt" lang="EN-US">mvc</span><span>中</span><span style="font-family:&#39;Courier New&#39;;font-size:9pt" lang="EN-US">Repeater</span><span style="font-family:宋 体;font-size:9pt">的使用需要我们重写一下。如果想用</span><span style="font-family:&#39;Courier New&#39;;font-size:9pt" lang="EN-
US">for</span><span>循环来实现也可以。我们继承</span><span style="font-family:&#39;Courier New&#39;;font-size:9pt" lang="EN-US">Repeater</span><span>然后重写</span><span style="font-family:Consolas;color:#010001;font-size:9pt" lang="EN-
US">OnLoad</span><span style="font-family:Consolas;font-size:9pt" lang="EN-US">(EventArgs <span style="color:#010001">e</span>)</span><span style="font-family:宋体;font-size:9pt"> 方法得到</span><span style="font-family:Consolas;font-size:9pt" lang="EN-US">Controller</span><span style="font-family:宋体;color:#010001;font-size:9pt">中放入</span><span style="font-family:Consolas;color:#010001;font-size:9pt" lang="EN-
US">ViewData</span><span style="font-family:宋体;color:#010001;font-size:9pt">的数据。我们添加一个公开的属性来取得对应</span><span style="font-family:Consolas;color:#010001;font-size:9pt" lang="EN-
US">ViewDate</span><span style="font-family:宋体;color:#010001;font-size:9pt">的值。</span>
<p> </p>
<p style="text-align:left;margin:0cm 0cm 0pt" align="left"><span style="font-family:Consolas;color:#010001;font-size:9pt" lang="EN-US"><span style="font-family:&#39;Courier New&#39;;font-size:9pt" lang="EN-US">     Repeater重写：</span></span></p>
<div>
<div><span style="color:#000000">    </span><span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">string</span><span style="color:#000000"> Key { </span><span style="color:#0000ff">get</span><span style="color:#000000">; </span><span style="color:#0000ff">set</span><span style="color:#000000">; }<br>
    </span><span style="color:#008000">//</span><span style="color:#008000">绑定数据 </span><span style="color:#008000"><br>
</span><span style="color:#000000">    </span><span style="color:#0000ff">protected</span><span style="color:#000000"> </span><span style="color:#0000ff">override</span><span style="color:#000000"> </span><span style="color:#0000ff">void</span><span style="color:#000000"> OnLoad(EventArgs e)<br>
    {<br>
       </span><span style="color:#0000ff">this</span><span style="color:#000000">.DataSource </span><span style="color:#000000">=</span><span style="color:#000000"> (</span><span style="color:#0000ff">base</span><span style="color:#000000">.Page </span><span style="color:#0000ff">as</span><span style="color:#000000"> ViewPage).ViewData[</span><span style="color:#0000ff">this</span><span style="color:#000000">.Key];<br>
<br>
       </span><span style="color:#0000ff">this</span><span style="color:#000000">.DataBind();    <br>
<br>
       </span><span style="color:#0000ff">base</span><span style="color:#000000">.OnLoad(e);<br>
    }<br>
</span></div>
</div>
<p style="text-align:left;margin:0cm 0cm 0pt" align="left"><span style="font-family:Consolas;font-size:9pt" lang="EN-US">   </span><span style="font-family:Consolas;font-size:9pt" lang="EN-
US"><span style="font-family:宋体;color:#010001;font-size:9pt"> 这样就得到我们想要的</span><span style="font-family:Consolas;color:#010001;font-size:9pt" lang="EN-US">MVC</span><span style="font-family:宋体;color:#010001;font-size:9pt">中的</span><span style="font-family:&#39;Courier New&#39;;font-size:9pt" lang="EN-
US">Repeater</span><span>，因为</span><span style="font-family:&#39;Courier New&#39;;font-size:9pt" lang="EN-US">Repeater</span><span style="font-family:宋体;font-size:9pt">必须放在</span><span style="font-family:&#39;Courier New&#39;;font-size:9pt" lang="EN-US">runat="server"</span><span style="font-family:宋体;font-size:9pt">的</span><span style="font-family:&#39;Courier New&#39;;font-size:9pt" lang="EN-US">form</span><span>中所以这里</span><span lang="EN-US">action</span><span style="font-family:宋体;font-size:9pt">没有使用</span><span style="font-size:9pt" lang="EN-US">UrlHepler</span><span style="font-family:宋体;font-size:9pt">给我们提供的方法来写。 </span></span></p>
<p style="text-align:left;margin:0cm 0cm 0pt" align="left"><span style="font-family:Consolas;font-size:9pt" lang="EN-US"><span style="font-family:宋体;font-size:9pt">    </span><span lang="EN-US"><span style="font-family:宋体;font-size:9pt">我们把查询条件放入</span><span style="font-family:&#39;Courier New&#39;;font-size:9pt" lang="EN-US">ViewData</span><span style="font-family:宋体;font-size:9pt">为了提交后的保存与显示。</span></span></span></p>
<p style="text-align:left;margin:0cm 0cm 0pt" align="left"><span style="font-family:Consolas;font-size:9pt" lang="EN-US"> </span></p>
<div>
<div><span style="color:#0000ff">&lt;</span><span style="color:#800000">input </span><span style="color:#ff0000">id</span><span style="color:#0000ff">="deptname"</span><span style="color:#ff0000"> name</span><span style="color:#0000ff">=&quot; deptname &quot;</span><span style="color:#ff0000"> type</span><span style="color:#0000ff">="text"</span><span style="color:#ff0000"> value</span><span style="color:#0000ff">=&#39;&lt;%=ViewData [&quot;deptname</span><span style="color:#ff0000">&quot;] %</span><span style="color:#0000ff">&gt;</span><span style="color:#000000">&#39;/&gt;</span></div>
</div>
<p style="text-align:left;margin:0cm 0cm 0pt" align="left">   后台保存：</p>
<div>
<div><span style="color:#0000ff">public</span><span style="color:#000000"> ActionResult Dept (</span><span style="color:#0000ff">int</span><span style="color:#000000">?</span><span style="color:#000000"> id)<br>
        {<br>
            ViewData [</span><span style="color:#800000">"</span><span style="color:#800000">deptlist</span><span style="color:#800000">"</span><span style="color:#000000">] </span><span style="color:#000000">=</span><span style="color:#000000"> BindTable(id);<br>
            </span><span style="color:#0000ff">return</span><span style="color:#000000"> View();<br>
        }<br>
        </span><span style="color:#0000ff">protected</span><span style="color:#000000"> Webdiyer.WebControls.Mvc.PagedList</span><span style="color:#000000">&lt;</span><span style="color:#000000">DepartmentInfo</span><span style="color:#000000">&gt;</span><span style="color:#000000"> BindTable(</span><span style="color:#0000ff">int</span><span style="color:#000000">?</span><span style="color:#000000"> id)<br>
        {<br>
            </span><span style="color:#0000ff">int</span><span style="color:#000000"> countPage </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#800080">0</span><span style="color:#000000">;<br>
            List</span><span style="color:#000000">&lt;</span><span style="color:#000000">DepartmentInfo</span><span style="color:#000000">&gt;</span><span style="color:#000000"> dt </span><span style="color:#000000">=</span><span style="color:#000000"> db.SelectPageToList(GetSelectSearch(), </span><span style="color:#800080">10</span><span style="color:#000000">, id </span><span style="color:#000000">??</span><span style="color:#000000"> </span><span style="color:#800080">1</span><span style="color:#000000">, </span><span style="color:#0000ff">out</span><span style="color:#000000"> countPage);<br>
            Webdiyer.WebC ontrols.Mvc.PagedList</span><span style="color:#000000">&lt;</span><span style="color:#000000">DepartmentInfo</span><span style="color:#000000">&gt;</span><span style="color:#000000"> p </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">new</span><span style="color:#000000"> Webdiyer.WebControls.Mvc.PagedList</span><span style="color:#000000">&lt;</span><span style="color:#000000">DepartmentInfo</span><span style="color:#000000">&gt;</span><span style="color:#000000">(dt, id </span><span style="color:#000000">??</span><span style="color:#000000"> </span><span style="color:#800080">1</span><span style="color:#000000">, </span><span style="color:#800080">10</span><span style="color:#000000">, countPage);<br>
            </span><span style="color:#0000ff">return</span><span style="color:#000000"> p;<br>
        }<br>
        </span><span style="color:#0000ff">protected</span><span style="color:#000000"> </span><span style="color:#0000ff">virtual</span><span style="color:#000000"> SelectSqlSection GetSelectSearch()<br>
        {<br>
            SelectSqlSectio n select </span><span style="color:#000000">=</span><span style="color:#000000"> db.GetSelectSqlSection();<br>
            select.OrderBy (DepartmentInfo.__ordernumber.Asc);<br>
            </span><span style="color:#0000ff">if</span><span style="color:#000000"> (</span><span style="color:#000000">!</span><span style="color:#0000ff">string</span><span style="color:#000000">.IsNullOrWhiteSpace(Request[</span><span style="color:#800000">"</span><span style="color:#800000">deptname</span><span style="color:#800000">"</span><span style="color:#000000">]))<br>
            {<br>
                </span><span style="color:#000000">select.Where(DepartmentInfo.__name.Like(</span><span style="color:#800000">"</span><span style="color:#800000">%</span><span style="color:#800000">"</span><span style="color:#000000"> </span><span style="color:#000000">+</span><span style="color:#000000"> GetFormValue(</span><span style="color:#800000">"</span><span style="color:#800000">deptname</span><span style="color:#800000">"</span><span style="color:#000000">) </span><span style="color:#000000">+</span><span style="color:#000000"> </span><span style="color:#800000">"</span><span style="color:#800000">%</span><span style="color:#800000">"</span><span style="color:#000000">));<br>
            }<br>
            </span><span style="color:#0000ff">if</span><span style="color:#000000"> (</span><span style="color:#000000">!</span><span style="color:#0000ff">string</span><span style="color:#000000">.IsNullOrWhiteSpace(Request[</span><span style="color:#800000">"</span><span style="color:#800000">deptcode</span><span style="color:#800000">"</span><span style="color:#000000">]))<br>
            {<br>
                </span><span style="color:#000000">select.Where(DepartmentInfo.__code.Like(</span><span style="color:#800000">"</span><span style="color:#800000">%</span><span style="color:#800000">"</span><span style="color:#000000"> </span><span style="color:#000000">+</span><span style="color:#000000"> GetFormValue(</span><span style="color:#800000">"</span><span style="color:#800000">deptcode</span><span style="color:#800000">"</span><span style="color:#000000">) </span><span style="color:#000000">+</span><span style="color:#000000"> </span><span style="color:#800000">"</span><span style="color:#800000">%</span><span style="color:#800000">"</span><span style="color:#000000">));<br>
            }<br>
            </span><span style="color:#0000ff">return</span><span style="color:#000000"> select;<br>
        }<br>
        </span><span style="color:#0000ff">private</span><span style="color:#000000"> </span><span style="color:#0000ff">object</span><span style="color:#000000"> GetFormValue(</span><span style="color:#0000ff">string</span><span style="color:#000000"> name)<br>
        {<br>
            ViewData [name] </span><span style="color:#000000">=</span><span style="color:#000000"> Request[name];<br>
            </span><span style="color:#0000ff">return</span><span style="color:#000000"> ViewData[name];<br>
        }<br>
</span></div>
</div>
<p> </p>
<p>      <span style="font-family:宋体;font-size:9pt">这里出现问题了，在查询时候的确可以获得表单的值，也可以这样保存显示，那么查询后点分页怎么办？分页可是</span><span style="font-family:Consolas;font-size:9pt" lang="EN-US">a</span><span style="font-family:宋体;font-size:9pt">标签，难道让</span><span style="font-family:Consolas;font-size:9pt" lang="EN-US">a</span><span style="font-family:宋体;font-size:9pt">标签也提交么？</span> </p>
<p style="text-align:left;text-indent:21pt;margin:0cm 0cm 0pt" align="left"><span style="font-family:Consolas;font-size:9pt" lang="EN-US"><span style="font-family:Consolas;font-size:9pt" lang="EN-
US">OK</span><span style="font-family:宋体;font-size:9pt">，那么我们就来实现</span><span style="font-family:Consolas;font-size:9pt" lang="EN-US">a</span><span style="font-family:宋体;font-size:9pt">标签的提交，<span style="font-size:10pt">我们就来给它分页时做提交功能。 </span></span></span></p>
<p style="text-align:left;text-indent:21pt;margin:0cm 0cm 0pt" align="left"><span style="font-family:Consolas;font-size:9pt" lang="EN-US"><span style="font-family:宋体;font-size:9pt"><span style="font-size:10pt"></span></span></span><span style="font-family:Consolas;font-size:9pt" lang="EN-US"><span style="font-family:宋体;font-size:9pt"><span style="font-family:&#39;Courier New&#39;;font-size:10pt" lang="EN-
US"> </span></span></span></p>
<p style="text-align:left;margin:0cm 0cm 0pt" align="left"><span>     因为每次分页都提交表单可能不是各个场景都需要，这里我对 </span><span style="font-family:Consolas;color:red;font-size:9pt" lang="EN-US">PagerOptions</span><span style="font-family:宋体;font-size:9pt">类扩展了</span><span style="font-family:Consolas;font-size:9pt" lang="EN-
US">2</span><span style="font-family:宋体;font-size:9pt">个属性一个是 </span><span style="font-family:Consolas;font-size:9pt" lang="EN-US">ispost</span><span style="font-family:宋体;font-size:9pt">（分页是否提交，默认是</span><span style="font-family:Consolas;font-size:9pt" lang="EN-US">false</span><span style="font-family:宋体;font-size:9pt">）</span><span style="font-family:&#39;Courier New&#39;;font-size:9pt" lang="EN-US"><span>    </span></span><span style="font-family:宋体;font-size:9pt">，</span><span style="font-family:Consolas;color:#010001;font-size:9pt" lang="EN-
US">FormName</span><span style="font-family:宋体;color:#010001;font-size:9pt">（提交表单</span><span style="font-family:Consolas;color:#010001;font-size:9pt" lang="EN-US">id</span><span style="font-family:宋体;color:#010001;font-size:9pt">，这里默认是 </span><span style="font-family:Consolas;color:#010001;font-size:9pt" lang="EN-US">asp.net</span><span style="font-family:宋体;color:#010001;font-size:9pt">生成的</span><span style="font-family:Consolas;color:#010001;font-size:9pt" lang="EN-US">form1</span><span style="font-family:宋体;color:#010001;font-size:9pt">）。</span></p>
<p style="text-align:left;margin:0cm 0cm 0pt" align="left"><span style="font-family:宋体;color:#010001;font-size:9pt"></span><span style="font-family:Consolas;color:#010001;font-size:9pt" lang="EN-US"></span> </p>
<p style="text-align:left;margin:0cm 0cm 0pt" align="left"><span style="font-family:宋体;color:#010001;font-size:9pt">     再来看怎么生成控件到页面，我们看</span><span style="font-family:Consolas;color:red;font-size:9pt" lang="EN-US">PagerBu</span><span style="font-family:Consolas;color:red;font-size:9pt" lang="EN-US">ilder</span><span style="font-family:宋体;font-size:9pt">类，找到</span><span style="font-family:Consolas;color:red;font-size:9pt" lang="EN-
US">GeneratePagerElement</span><span style="font-family:宋体;color:#010001;font-size:9pt">方法，看最后一句</span><span style="font-family:Consolas;color:red;font-size:9pt" lang="EN-US">String.Format (&quot;&lt;a href=&#39;{0}&#39;&gt;{1}&lt;/a&gt;&quot;, url, item.Text));</span><span style="font-family:宋体;font-size:9pt">默认是生成只带连接的</span><span style="font-family:Consolas" lang="EN-US">a</span><span style="font-family:宋体;font-size:9pt">标签，我们来改造他吧。 </span></p>
<p style="text-align:left;margin:0cm 0cm 0pt" align="left"><span style="font-family:宋体;font-size:9pt"></span> </p>
<p style="text-align:left;text-indent:21pt;margin:0cm 0cm 0pt" align="left"></p>
<p style="text-align:left;text-indent:21pt;margin:0cm 0cm 0pt" align="left"><span style="font-family:宋体;font-size:9pt">我们重新写这个方法名字就叫</span><span style="font-family:Consolas;color:red" lang="EN-
US">GeneratePagerElementPost</span><span style="font-family:宋体;color:#010001;font-size:9pt">，我们把</span><span style="font-family:Consolas;color:#010001;font-size:9pt" lang="EN-
US">a</span><span style="font-family:宋体;color:#010001;font-size:9pt"> 标签的</span><span style="font-family:Consolas;color:#010001;font-size:9pt" lang="EN-US">href</span><span style="font-family:宋体;color:#010001;font-size:9pt">执行一段脚本，把刚才那句替换为 </span><span style="font-family:Consolas;color:red;font-size:9pt" lang="EN-US">String.Format(&quot;&lt;a href=&#39;javascript:_PagePostSubmit (\&quot;{0}\&quot;)&#39;&gt;{1}&lt;/a&gt;&quot;, url, item.Text)); </span></p>
<p style="text-align:left;text-indent:21pt;margin:0cm 0cm 0pt" align="left"><span style="font-family:Consolas;color:red;font-size:9pt" lang="EN-US"></span><span style="font-family:Consolas;font-size:9pt" lang="EN-US"></span> </p>
<p style="text-align:left;margin:0cm 0cm 0pt" align="left"><a name="OLE_LINK2"></a><a name="OLE_LINK1"><span><span style="font-family:Consolas;font-size:9pt" lang="EN-US">_PagePostSubmit</span></span></a><span><span><span style="font-family:宋体;font-size:9pt">这个</span></span></span><span><span><span style="font-family:Consolas;font-size:9pt" lang="EN-
US">js</span></span></span><span><span><span style="font-family:宋体;font-size:9pt">方法 </span></span></span><span style="font-family:宋体;font-size:9pt">就是用来点击</span><span style="font-family:Consolas;font-size:9pt" lang="EN-US">a</span><span style="font-family:宋体;font-size:9pt">标签进行表单的提交的。那么我们看这个方法是怎么实现和生成到页面的。找到</span><span style="font-family:Consolas;color:#010001;font-size:9pt" lang="EN-US">RenderPager</span><span style="font-family:宋体;color:#010001;font-size:9pt">方法，我们拉到方法最后看到如下代码，这里是添加脚本到客户端。</span></p>
<p style="text-align:left;margin:0cm 0cm 0pt" align="left"><span style="font-family:宋体;color:#010001;font-size:9pt"></span> </p>
<p style="text-align:left;text-indent:21pt;margin:0cm 0cm 0pt" align="left"></p>
<p style="text-align:left;margin:0cm 0cm 0pt" align="left"><span style="font-family:Consolas;font-size:9pt" lang="EN-US">    </span><span style="font-family:Consolas;color:red;font-size:9pt" lang="EN-US">if (!string.IsNullOrEmpty(pagerScript))</span></p>
<p style="text-align:left;text-indent:21pt;margin:0cm 0cm 0pt" align="left"><span style="font-family:Consolas;color:red;font-size:9pt" lang="EN-US">     pagerScript = &quot;&lt;script language=\&quot;javascript\&quot; type=\&quot;text/javascript\&quot;&gt;&quot; + pagerScript + &quot;&lt;/script&gt;&quot;;</span><span style="font-family:Consolas;font-size:9pt" lang="EN-US"></span></p>
<p style="text-align:left;margin:0cm 0cm 0pt" align="left"><span style="font-family:宋体;color:#010001;font-size:9pt">     在这个方面上面添加一下代码：首先我们判断下客户端是否需要每次分页都提交页面，然后加入我们的</span><span style="font-family:Consolas;font-size:9pt" lang="EN-US">_PagePostSubmit</span><span style="font-family:宋体;font-size:9pt">这个</span><span style="font-family:Consolas;font-size:9pt" lang="EN-
US">js</span><span style="font-family:宋体;font-size:9pt">方法 </span></p>
<p style="text-align:left;margin:0cm 0cm 0pt" align="left"><span style="font-family:宋体;font-size:9pt"></span><span style="font-family:Consolas;color:#010001;font-size:9pt" lang="EN-US"></span> </p>
<p style="text-align:left;margin:0cm 0cm 0pt" align="left"><span style="font-family:Consolas;font-size:9pt" lang="EN-US">   </span><span style="font-family:Consolas;color:red;font-size:9pt" lang="EN-US"> if (_pagerOptions.IsPost)</span></p>
<p style="text-align:left;margin:0cm 0cm 0pt" align="left"><span style="font-family:Consolas;color:red;font-size:9pt" lang="EN-US">    {</span></p>
<p style="text-align:left;margin:0cm 0cm 0pt 21pt" align="left"><span style="font-family:Consolas;color:red;font-size:9pt" lang="EN-US">     //</span><span style="font-family:宋体;color:red;font-size:9pt">通过 </span><span style="font-family:Consolas;color:red;font-size:9pt" lang="EN-US">_pagerOptions.FormName</span><span style="color:red;font-size:9pt">获得用户选定表单名称，修改其 </span><span style="font-family:Consolas;color:red;font-size:9pt" lang="EN-US">action</span><span style="font-family:宋体;color:red;font-size:9pt">，然后提交。</span><span style="font-family:Consolas;font-size:9pt" lang="EN-
US"></span></p>
<p style="text-align:left;margin:0cm 0cm 0pt" align="left"><span style="font-family:Consolas;font-size:9pt" lang="EN-US"><span>         </span></span><span style="font-family:Consolas;color:red;font-size:9pt" lang="EN-US">pagerScript += " function _PagePostSubmit(href){ document.forms['" + _pagerOptions.FormName + "'].action=href;document.forms['" + _pagerOptions.FormName + "'].submit();}";</span></p>
<p style="text-align:left;margin:0cm 0cm 0pt" align="left"><span style="font-family:Consolas;color:red;font-size:9pt" lang="EN-US">    }</span></p>
<p style="text-align:left;margin:0cm 0cm 0pt" align="left"><span style="font-family:Consolas;color:red;font-size:9pt" lang="EN-US"></span> </p>
<p style="text-align:left;margin:0cm 0cm 0pt" align="left"><span style="font-family:Consolas;color:red;font-size:9pt" lang="EN-US"></span></p>
<p style="text-align:left;margin:0cm 0cm 0pt" align="left"><span style="font-family:Consolas;color:#000000;font-size:9pt" lang="EN-US">    Ok</span><span style="font-family:宋体;color:#000000;font-size:9pt">，这样每个 </span><span style="font-family:Consolas;color:#000000;font-size:9pt" lang="EN-US">a</span><span style="font-family:宋体;color:#000000;font-size:9pt">标签都能提交表单了，我们在页面添加下面代码就完成了查询</span><span style="font-family:Consolas;color:#000000;font-size:9pt" lang="EN-US">+</span><span style="font-family:宋体;color:#000000;font-size:9pt">分页的实现</span></p>
<p style="text-align:left;margin:0cm 0cm 0pt" align="left"><span style="font-family:宋体;color:#000000;font-size:9pt">     </span><span style="font-family:Consolas;font-size:9pt" lang="EN-US"></span></p>
<p style="text-align:left;margin:0cm 0cm 0pt" align="left"></p>
<div>
<div><span style="background-color:#ffff00;color:#000000">&lt;%</span><span style="background-color:#f5f5f5;color:#000000">=</span><span style="background-color:#f5f5f5;color:#000000">Html.Pager</span><span style="background-color:#f5f5f5;color:#000000">&lt;</span><span style="background-color:#f5f5f5;color:#000000">DepartmentInfo</span><span style="background-color:#f5f5f5;color:#000000">&gt;</span><span style="background-color:#f5f5f5;color:#000000"> ((Webdiyer.WebControls.Mvc.PagedList</span><span style="background-color:#f5f5f5;color:#000000">&lt;</span><span style="background-color:#f5f5f5;color:#000000">DepartmentInfo</span><span style="background-color:#f5f5f5;color:#000000">&gt;</span><span style="background-color:#f5f5f5;color:#000000">)ViewData [</span><span style="background-color:#f5f5f5;color:#800000">"</span><span style="background-color:#f5f5f5;color:#800000">deptlist</span><span style="background-color:#f5f5f5;color:#800000">"</span><span style="background-color:#f5f5f5;color:#000000">], </span><span style="background-color:#f5f5f5;color:#0000ff">new</span><span style="background-color:#f5f5f5;color:#000000"> PagerOptions() { PageIndexParameterName </span><span style="background-color:#f5f5f5;color:#000000">=</span><span style="background-color:#f5f5f5;color:#000000"> </span><span style="background-color:#f5f5f5;color:#800000">"</span><span style="background-color:#f5f5f5;color:#800000">id</span><span style="background-color:#f5f5f5;color:#800000">"</span><span style="background-color:#f5f5f5;color:#000000">, CurrentPagerItemWrapperFormatString </span><span style="background-color:#f5f5f5;color:#000000">=</span><span style="background-color:#f5f5f5;color:#000000"> </span><span style="background-color:#f5f5f5;color:#800000">"</span><span style="background-color:#f5f5f5;color:#800000">&lt;span class=\</span><span style="background-color:#f5f5f5;color:#800000">"</span><span style="background-color:#f5f5f5;color:#000000">cpb</span><span style="background-color:#f5f5f5;color:#000000">\</span><span style="background-color:#f5f5f5;color:#800000">"</span><span style="background-color:#f5f5f5;color:#800000">&gt; {0}&lt;/span&gt;</span><span style="background-color:#f5f5f5;color:#800000">"</span><span style="background-color:#f5f5f5;color:#000000">, NumericPagerItemWrapperFormatString </span><span style="background-color:#f5f5f5;color:#000000">=</span><span style="background-color:#f5f5f5;color:#000000"> </span><span style="background-color:#f5f5f5;color:#800000">"</span><span style="background-color:#f5f5f5;color:#800000">&lt;span class=\</span><span style="background-color:#f5f5f5;color:#800000">"</span><span style="background-color:#f5f5f5;color:#000000">item</span><span style="background-color:#f5f5f5;color:#000000">\</span><span style="background-color:#f5f5f5;color:#800000">"</span><span style="background-color:#f5f5f5;color:#800000">&gt; {0}&lt;/span&gt;</span><span style="background-color:#f5f5f5;color:#800000">"</span><span style="background-color:#f5f5f5;color:#000000">, CssClass </span><span style="background-color:#f5f5f5;color:#000000">=</span><span style="background-color:#f5f5f5;color:#000000"> </span><span style="background-color:#f5f5f5;color:#800000">"</span><span style="background-color:#f5f5f5;color:#800000">pages</span><span style="background-color:#f5f5f5;color:#800000">"</span><span style="background-color:#f5f5f5;color:#000000">, SeparatorHtml </span><span style="background-color:#f5f5f5;color:#000000">=</span><span style="background-color:#f5f5f5;color:#000000"> </span><span style="background-color:#f5f5f5;color:#800000">""</span><span style="background-color:#f5f5f5;color:#000000">,IsPost</span><span style="background-color:#f5f5f5;color:#000000">=</span><span style="background-color:#f5f5f5;color:#0000ff">true</span><span style="background-color:#f5f5f5;color:#000000"> })</span><span style="color:#000000">%&gt;</span></div>
</div>
<p> </p>
<p style="text-align:left;margin:0cm 0cm 0pt" align="left">      <span style="font-family:宋体;font-size:9pt">把刚加的 </span><span style="font-family:Consolas;color:red;font-size:9pt" lang="EN-US">IsPost</span><span style="font-family:宋体;font-size:9pt">属性变为 </span><span style="font-family:Consolas;color:#000000;font-size:9pt" lang="EN-US">true,默认FormName=form1这里就没有在赋值了。 </span></p>
<p style="text-align:left;margin:0cm 0cm 0pt" align="left"><span style="font-family:Consolas;color:#000000;font-size:9pt" lang="EN-US">    </span></p>
<p style="text-align:left;margin:0cm 0cm 0pt" align="left"><span style="font-family:Consolas;color:#000000;font-size:9pt" lang="EN-US">    实现DEMO：<a title="ASP.NET MVC查询+分页 DEMO" href="http://files.cnblogs.com/duanseven/MvcSearchPageDemo.rar">ASP.NET MVC查询+分页 DEMO</a></span></p>
<p style="text-align:left;margin:0cm 0cm 0pt" align="left"><span style="font-family:Consolas;color:#000000;font-size:9pt" lang="EN-US">    修改后的MVCPAGER： </span> <a title="ModifyPostMvcPagerSrc" href="http://files.cnblogs.com/duanseven/ModifyPostMvcPagerSrc_Cn.rar">ModifyPostMvcPagerSrc</a><a></a></p>
<p style="text-align:left;text-indent:21pt;margin:0cm 0cm 0pt" align="left"> </p><img src="http://www.cnblogs.com/duanseven/aggbug/1772538.html?type=1" width="1" height="1" alt=""><p>评论: 6　<a href="http://www.cnblogs.com/duanseven/archive/2010/07/06/1772538.html#pagedcomment">查看评论</a>　<a href="http://www.cnblogs.com/duanseven/archive/2010/07/06/1772538.html#commentform">发表评论</a></p><p><a href="http://job.cnblogs.com/enterprise/2453/">百度期待您的加盟</a></p><hr><p>最新新闻：<br>· <a href="http://news.cnblogs.com/n/67774/">微软Xbox Live服务年收入或将首次突破10亿美元</a><span style="color:gray">(2010-07-07 17:59)</span><br>· <a href="http://news.cnblogs.com/n/67773/">另类推广 微软Bing寻找Laday Gaga超级粉丝</a><span style="color:gray">(2010-07-07 17:59)</span><br>· <a href="http://news.cnblogs.com/n/67772/">柳传志的512天</a><span style="color:gray">(2010-07-07 17:48)</span><br>· <a href="http://news.cnblogs.com/n/67771/">若即若离的云朵 云运算普及还需跨越“三座大山”</a><span style="color:gray">(2010-07-07 17:42)</span><br>· <a href="http://news.cnblogs.com/n/67770/">Windows 7 SP1包含升级版系统激活技术</a><span style="color:gray">(2010-07-07 17:28)</span><br></p><p>编辑推荐：<a href="http://www.cnblogs.com/cmt/archive/2010/07/07/1772722.html">博客园上海俱乐部七月份活动通知</a><br></p><p>网站导航：<a href="http://www.cnblogs.com">博客园首页</a>  <a href="http://home.cnblogs.com/">个人主页</a>  <a href="http://news.cnblogs.com">新闻</a>  <a href="http://home.cnblogs.com/ing/">闪存</a>  <a href="http://home.cnblogs.com/group/">小组</a>  <a href="http://space.cnblogs.com/q/">博问</a>  <a href="http://space.cnblogs.com">社区</a>  <a href="http://kb.cnblogs.com">知识库</a></p></p></p>