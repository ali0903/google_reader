---
layout: post
title:  "修改jquery.lazyload.js实现页面延迟载入"
date:   2010-12-21 10:17:00
author: 午夜圣歌
categories: program
---

## 修改jquery.lazyload.js实现页面延迟载入
### by 午夜圣歌
### at 2010-12-21 10:17:00
### original <http://www.cnblogs.com/cnevan/archive/2010/12/21/1912323.html>

<p><p>jquery.lazyload.js并未真正的实现页面延迟载入，它的实现原理是页面载入完毕后将html中所有img标签的src属性都替换为空，把src的初始值存储到一个自定义的属性中，当页面滚动到img标签位置时再将图片载入进来。虽然实现了延迟载入的视觉效果，但是通过httpwatch等工具就可以看到，页面载入完毕后又发布很多空请求，而空请求就是由这些被替换过的img标签产生的，空请求也会一定程度上增加页面的打开时间，所以jquery.lazyload.js并未真生的实现页面延迟载入。</p>
<p>我对jquery.lazyload.js做了一些修改，实现了页面的延迟载入，不仅仅是图片，html代码同样可以延迟载入，大大减少了页面发出的请求数，提高了页面的打开速度。</p>
<p>修改后的jquery.lazyload.js代码如下：</p>
<p>
<div><img src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt=""><img src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" alt=""><span>jquery.lazyload.js</span>
<div>
<pre><div><span style="color:#008080">  1</span> <span style="color:#008000">/*</span><span style="color:#008000"><br></span><span style="color:#008080">  2</span> <span style="color:#008000"> * Lazy Load - jQuery plugin for lazy loading images<br></span><span style="color:#008080">  3</span> <span style="color:#008000"> *<br></span><span style="color:#008080">  4</span> <span style="color:#008000"> * Copyright (c) 2007-2009 Mika Tuupola<br></span><span style="color:#008080">  5</span> <span style="color:#008000"> *<br></span><span style="color:#008080">  6</span> <span style="color:#008000"> * Licensed under the MIT license:<br></span><span style="color:#008080">  7</span> <span style="color:#008000"> *   http://www.opensource.org/licenses/mit-license.php<br></span><span style="color:#008080">  8</span> <span style="color:#008000"> *<br></span><span style="color:#008080">  9</span> <span style="color:#008000"> * Project home:<br></span><span style="color:#008080"> 10</span> <span style="color:#008000"> *   http://www.appelsiini.net/projects/lazyload<br></span><span style="color:#008080"> 11</span> <span style="color:#008000"> *<br></span><span style="color:#008080"> 12</span> <span style="color:#008000"> * Version:  1.5.0<br></span><span style="color:#008080"> 13</span> <span style="color:#008000"> * <br></span><span style="color:#008080"> 14</span> <span style="color:#008000"> * Modify by @cnbaiying<br></span><span style="color:#008080"> 15</span> <span style="color:#008000"> * Modify time: 2010-12-16<br></span><span style="color:#008080"> 16</span> <span style="color:#008000"> </span><span style="color:#008000">*/</span><span style="color:#000000"><br></span><span style="color:#008080"> 17</span> <span style="color:#000000">(</span><span style="color:#0000ff">function</span><span style="color:#000000">($) {<br></span><span style="color:#008080"> 18</span> <span style="color:#000000"><br></span><span style="color:#008080"> 19</span> <span style="color:#000000">    $.fn.lazyload </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">function</span><span style="color:#000000">(options) {<br></span><span style="color:#008080"> 20</span> <span style="color:#000000">        </span><span style="color:#0000ff">var</span><span style="color:#000000"> settings </span><span style="color:#000000">=</span><span style="color:#000000"> {<br></span><span style="color:#008080"> 21</span> <span style="color:#000000">            threshold    : </span><span style="color:#000000">0</span><span style="color:#000000">,        </span><span style="color:#008000">//</span><span style="color:#008000">阀值</span><span style="color:#008000"><br></span><span style="color:#008080"> 22</span> <span style="color:#008000"> </span><span style="color:#000000">            failurelimit : </span><span style="color:#000000">0</span><span style="color:#000000">,<br></span><span style="color:#008080"> 23</span> <span style="color:#000000">            event        : </span><span style="color:#000000">"</span><span style="color:#000000">scroll</span><span style="color:#000000">"</span><span style="color:#000000">,<br></span><span style="color:#008080"> 24</span> <span style="color:#000000">            effect       : </span><span style="color:#000000">"</span><span style="color:#000000">show</span><span style="color:#000000">"</span><span style="color:#000000">,<br></span><span style="color:#008080"> 25</span> <span style="color:#000000">            container    : window<br></span><span style="color:#008080"> 26</span> <span style="color:#000000">        };<br></span><span style="color:#008080"> 27</span> <span style="color:#000000">                <br></span><span style="color:#008080"> 28</span> <span style="color:#000000">        </span><span style="color:#0000ff">if</span><span style="color:#000000">(options) {<br></span><span style="color:#008080"> 29</span> <span style="color:#000000">            <br></span><span style="color:#008080"> 30</span> <span style="color:#000000">            $.extend(settings, options);<br></span><span style="color:#008080"> 31</span> <span style="color:#000000">        }<br></span><span style="color:#008080"> 32</span> <span style="color:#000000">        <br></span><span style="color:#008080"> 33</span> <span style="color:#000000">        </span><span style="color:#008000">/*</span><span style="color:#008000"> Fire one scroll event per scroll. Not one scroll event per image. </span><span style="color:#008000">*/</span><span style="color:#000000"><br></span><span style="color:#008080"> 34</span> <span style="color:#000000">        </span><span style="color:#0000ff">var</span><span style="color:#000000"> elements </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">this</span><span style="color:#000000">;<br></span><span style="color:#008080"> 35</span> <span style="color:#000000">        <br></span><span style="color:#008080"> 36</span> <span style="color:#000000">        </span><span style="color:#0000ff">if</span><span style="color:#000000"> (</span><span style="color:#000000">"</span><span style="color:#000000">scroll</span><span style="color:#000000">"</span><span style="color:#000000"> </span><span style="color:#000000">==</span><span style="color:#000000"> settings.event) {<br></span><span style="color:#008080"> 37</span> <span style="color:#000000">            $(settings.container).bind(</span><span style="color:#000000">"</span><span style="color:#000000">scroll</span><span style="color:#000000">"</span><span style="color:#000000">, </span><span style="color:#0000ff">function</span><span style="color:#000000">(event) {<br></span><span style="color:#008080"> 38</span> <span style="color:#000000">                </span><span style="color:#0000ff">var</span><span style="color:#000000"> counter </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#000000">0</span><span style="color:#000000">;<br></span><span style="color:#008080"> 39</span> <span style="color:#000000">                elements.each(</span><span style="color:#0000ff">function</span><span style="color:#000000">() {<br></span><span style="color:#008080"> 40</span> <span style="color:#000000">                    </span><span style="color:#0000ff">if</span><span style="color:#000000"> ($.abovethetop($(</span><span style="color:#0000ff">this</span><span style="color:#000000">).parent(), settings) </span><span style="color:#000000">||</span><span style="color:#000000"> $.leftofbegin($(</span><span style="color:#0000ff">this</span><span style="color:#000000">).parent(), settings)) {<br></span><span style="color:#008080"> 41</span> <span style="color:#000000">                            </span><span style="color:#008000">/*</span><span style="color:#008000"> Nothing. </span><span style="color:#008000">*/</span><span style="color:#000000"><br></span><span style="color:#008080"> 42</span> <span style="color:#000000">                    } </span><span style="color:#0000ff">else</span><span style="color:#000000"> </span><span style="color:#0000ff">if</span><span style="color:#000000"> (</span><span style="color:#000000">!</span><span style="color:#000000">$.belowthefold($(</span><span style="color:#0000ff">this</span><span style="color:#000000">).parent(), settings) </span><span style="color:#000000">&amp;&amp;</span><span style="color:#000000"> </span><span style="color:#000000">!</span><span style="color:#000000">$.rightoffold($(</span><span style="color:#0000ff">this</span><span style="color:#000000">).parent(), settings)) {<br></span><span style="color:#008080"> 43</span> <span style="color:#000000">                        $(</span><span style="color:#0000ff">this</span><span style="color:#000000">).trigger(</span><span style="color:#000000">"</span><span style="color:#000000">appear</span><span style="color:#000000">"</span><span style="color:#000000">);<br></span><span style="color:#008080"> 44</span> <span style="color:#000000">                    } </span><span style="color:#0000ff">else</span><span style="color:#000000"> {<br></span><span style="color:#008080"> 45</span> <span style="color:#000000">                        </span><span style="color:#0000ff">if</span><span style="color:#000000"> (counter</span><span style="color:#000000">++</span><span style="color:#000000"> </span><span style="color:#000000">&gt;</span><span style="color:#000000"> settings.failurelimit) {<br></span><span style="color:#008080"> 46</span> <span style="color:#000000">                            </span><span style="color:#0000ff">return</span><span style="color:#000000"> </span><span style="color:#0000ff">false</span><span style="color:#000000">;<br></span><span style="color:#008080"> 47</span> <span style="color:#000000">                        }<br></span><span style="color:#008080"> 48</span> <span style="color:#000000">                    }<br></span><span style="color:#008080"> 49</span> <span style="color:#000000">                });<br></span><span style="color:#008080"> 50</span> <span style="color:#000000">                </span><span style="color:#008000">/*</span><span style="color:#008000"> Remove image from array so it is not looped next time. </span><span style="color:#008000">*/</span><span style="color:#000000"><br></span><span style="color:#008080"> 51</span> <span style="color:#000000">                </span><span style="color:#0000ff">var</span><span style="color:#000000"> temp </span><span style="color:#000000">=</span><span style="color:#000000"> $.grep(elements, </span><span style="color:#0000ff">function</span><span style="color:#000000">(element) {<br></span><span style="color:#008080"> 52</span> <span style="color:#000000">                    </span><span style="color:#0000ff">return</span><span style="color:#000000"> </span><span style="color:#000000">!</span><span style="color:#000000">element.loaded;<br></span><span style="color:#008080"> 53</span> <span style="color:#000000">                });<br></span><span style="color:#008080"> 54</span> <span style="color:#000000">                elements </span><span style="color:#000000">=</span><span style="color:#000000"> $(temp);<br></span><span style="color:#008080"> 55</span> <span style="color:#000000">            });<br></span><span style="color:#008080"> 56</span> <span style="color:#000000">        }<br></span><span style="color:#008080"> 57</span> <span style="color:#000000">        <br></span><span style="color:#008080"> 58</span> <span style="color:#000000">        </span><span style="color:#0000ff">this</span><span style="color:#000000">.each(</span><span style="color:#0000ff">function</span><span style="color:#000000">() {<br></span><span style="color:#008080"> 59</span> <span style="color:#000000">            </span><span style="color:#0000ff">var</span><span style="color:#000000"> self </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">this</span><span style="color:#000000">;<br></span><span style="color:#008080"> 60</span> <span style="color:#000000">            </span><span style="color:#008000">/*</span><span style="color:#008000"> When appear is triggered load original image. </span><span style="color:#008000">*/</span><span style="color:#000000"><br></span><span style="color:#008080"> 61</span> <span style="color:#000000">            $(self).one(</span><span style="color:#000000">"</span><span style="color:#000000">appear</span><span style="color:#000000">"</span><span style="color:#000000">, </span><span style="color:#0000ff">function</span><span style="color:#000000">() {<br></span><span style="color:#008080"> 62</span> <span style="color:#000000">                </span><span style="color:#0000ff">if</span><span style="color:#000000"> (</span><span style="color:#000000">!</span><span style="color:#0000ff">this</span><span style="color:#000000">.loaded) {<br></span><span style="color:#008080"> 63</span> <span style="color:#000000">                    </span><span style="color:#008000">//</span><span style="color:#008000">alert($(self).parent().html($(self).html()));</span><span style="color:#008000"><br></span><span style="color:#008080"> 64</span> <span style="color:#000000">                    </span><span style="color:#0000ff">var</span><span style="color:#000000"> tmp_str </span><span style="color:#000000">=</span><span style="color:#000000"> $(self).html();<br></span><span style="color:#008080"> 65</span> <span style="color:#000000">                    tmp_str </span><span style="color:#000000">=</span><span style="color:#000000"> tmp_str.replace(</span><span style="color:#000000">"</span><span style="color:#000000">&amp;lt;</span><span style="color:#000000">"</span><span style="color:#000000">, </span><span style="color:#000000">"</span><span style="color:#000000">&lt;</span><span style="color:#000000">"</span><span style="color:#000000">);<br></span><span style="color:#008080"> 66</span> <span style="color:#000000">                    tmp_str </span><span style="color:#000000">=</span><span style="color:#000000"> tmp_str.replace(</span><span style="color:#000000">"</span><span style="color:#000000">&amp;gt;</span><span style="color:#000000">"</span><span style="color:#000000">, </span><span style="color:#000000">"</span><span style="color:#000000">&gt;</span><span style="color:#000000">"</span><span style="color:#000000">);<br></span><span style="color:#008080"> 67</span> <span style="color:#000000">                    $(self).parent().append(tmp_str);<br></span><span style="color:#008080"> 68</span> <span style="color:#000000">                    self.loaded </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">true</span><span style="color:#000000">;<br></span><span style="color:#008080"> 69</span> <span style="color:#000000">                }<br></span><span style="color:#008080"> 70</span> <span style="color:#000000">            });<br></span><span style="color:#008080"> 71</span> <span style="color:#000000"><br></span><span style="color:#008080"> 72</span> <span style="color:#000000">            </span><span style="color:#008000">/*</span><span style="color:#008000"> When wanted event is triggered load original image </span><span style="color:#008000">*/</span><span style="color:#000000"><br></span><span style="color:#008080"> 73</span> <span style="color:#000000">            </span><span style="color:#008000">/*</span><span style="color:#008000"> by triggering appear.                              </span><span style="color:#008000">*/</span><span style="color:#000000"><br></span><span style="color:#008080"> 74</span> <span style="color:#000000">            </span><span style="color:#0000ff">if</span><span style="color:#000000"> (</span><span style="color:#000000">"</span><span style="color:#000000">scroll</span><span style="color:#000000">"</span><span style="color:#000000"> </span><span style="color:#000000">!=</span><span style="color:#000000"> settings.event) {<br></span><span style="color:#008080"> 75</span> <span style="color:#000000">                $(self).bind(settings.event, </span><span style="color:#0000ff">function</span><span style="color:#000000">(event) {<br></span><span style="color:#008080"> 76</span> <span style="color:#000000">                    </span><span style="color:#0000ff">if</span><span style="color:#000000"> (</span><span style="color:#000000">!</span><span style="color:#000000">self.loaded) {<br></span><span style="color:#008080"> 77</span> <span style="color:#000000">                        $(self).trigger(</span><span style="color:#000000">"</span><span style="color:#000000">appear</span><span style="color:#000000">"</span><span style="color:#000000">);<br></span><span style="color:#008080"> 78</span> <span style="color:#000000">                    }<br></span><span style="color:#008080"> 79</span> <span style="color:#000000">                });<br></span><span style="color:#008080"> 80</span> <span style="color:#000000">            }<br></span><span style="color:#008080"> 81</span> <span style="color:#000000">        });<br></span><span style="color:#008080"> 82</span> <span style="color:#000000">        <br></span><span style="color:#008080"> 83</span> <span style="color:#000000">        </span><span style="color:#008000">/*</span><span style="color:#008000"> Force initial check if images should appear. </span><span style="color:#008000">*/</span><span style="color:#000000"><br></span><span style="color:#008080"> 84</span> <span style="color:#000000">        $(settings.container).trigger(settings.event);<br></span><span style="color:#008080"> 85</span> <span style="color:#000000">        <br></span><span style="color:#008080"> 86</span> <span style="color:#000000">        </span><span style="color:#0000ff">return</span><span style="color:#000000"> </span><span style="color:#0000ff">this</span><span style="color:#000000">;<br></span><span style="color:#008080"> 87</span> <span style="color:#000000"><br></span><span style="color:#008080"> 88</span> <span style="color:#000000">    };<br></span><span style="color:#008080"> 89</span> <span style="color:#000000"><br></span><span style="color:#008080"> 90</span> <span style="color:#000000">    </span><span style="color:#008000">/*</span><span style="color:#008000"> Convenience methods in jQuery namespace.           </span><span style="color:#008000">*/</span><span style="color:#000000"><br></span><span style="color:#008080"> 91</span> <span style="color:#000000">    </span><span style="color:#008000">/*</span><span style="color:#008000"> Use as  $.belowthefold(element, {threshold : 100, container : window}) </span><span style="color:#008000">*/</span><span style="color:#000000"><br></span><span style="color:#008080"> 92</span> <span style="color:#000000"><br></span><span style="color:#008080"> 93</span> <span style="color:#000000">    $.belowthefold </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">function</span><span style="color:#000000">(element, settings) {<br></span><span style="color:#008080"> 94</span> <span style="color:#000000">        </span><span style="color:#0000ff">if</span><span style="color:#000000"> (settings.container </span><span style="color:#000000">===</span><span style="color:#000000"> undefined </span><span style="color:#000000">||</span><span style="color:#000000"> settings.container </span><span style="color:#000000">===</span><span style="color:#000000"> window) {<br></span><span style="color:#008080"> 95</span> <span style="color:#000000">            </span><span style="color:#0000ff">var</span><span style="color:#000000"> fold </span><span style="color:#000000">=</span><span style="color:#000000"> $(window).height() </span><span style="color:#000000">+</span><span style="color:#000000"> $(window).scrollTop();<br></span><span style="color:#008080"> 96</span> <span style="color:#000000">        } </span><span style="color:#0000ff">else</span><span style="color:#000000"> {<br></span><span style="color:#008080"> 97</span> <span style="color:#000000">            </span><span style="color:#0000ff">var</span><span style="color:#000000"> fold </span><span style="color:#000000">=</span><span style="color:#000000"> $(settings.container).offset().top </span><span style="color:#000000">+</span><span style="color:#000000"> $(settings.container).height();<br></span><span style="color:#008080"> 98</span> <span style="color:#000000">        }<br></span><span style="color:#008080"> 99</span> <span style="color:#000000">        </span><span style="color:#0000ff">return</span><span style="color:#000000"> fold </span><span style="color:#000000">&lt;=</span><span style="color:#000000"> $(element).offset().top </span><span style="color:#000000">-</span><span style="color:#000000"> settings.threshold;<br></span><span style="color:#008080">100</span> <span style="color:#000000">    };<br></span><span style="color:#008080">101</span> <span style="color:#000000">    <br></span><span style="color:#008080">102</span> <span style="color:#000000">    $.rightoffold </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">function</span><span style="color:#000000">(element, settings) {<br></span><span style="color:#008080">103</span> <span style="color:#000000">        </span><span style="color:#0000ff">if</span><span style="color:#000000"> (settings.container </span><span style="color:#000000">===</span><span style="color:#000000"> undefined </span><span style="color:#000000">||</span><span style="color:#000000"> settings.container </span><span style="color:#000000">===</span><span style="color:#000000"> window) {<br></span><span style="color:#008080">104</span> <span style="color:#000000">            </span><span style="color:#0000ff">var</span><span style="color:#000000"> fold </span><span style="color:#000000">=</span><span style="color:#000000"> $(window).width() </span><span style="color:#000000">+</span><span style="color:#000000"> $(window).scrollLeft();<br></span><span style="color:#008080">105</span> <span style="color:#000000">        } </span><span style="color:#0000ff">else</span><span style="color:#000000"> {<br></span><span style="color:#008080">106</span> <span style="color:#000000">            </span><span style="color:#0000ff">var</span><span style="color:#000000"> fold </span><span style="color:#000000">=</span><span style="color:#000000"> $(settings.container).offset().left </span><span style="color:#000000">+</span><span style="color:#000000"> $(settings.container).width();<br></span><span style="color:#008080">107</span> <span style="color:#000000">        }<br></span><span style="color:#008080">108</span> <span style="color:#000000">        </span><span style="color:#0000ff">return</span><span style="color:#000000"> fold </span><span style="color:#000000">&lt;=</span><span style="color:#000000"> $(element).offset().left </span><span style="color:#000000">-</span><span style="color:#000000"> settings.threshold;<br></span><span style="color:#008080">109</span> <span style="color:#000000">    };<br></span><span style="color:#008080">110</span> <span style="color:#000000">        <br></span><span style="color:#008080">111</span> <span style="color:#000000">    $.abovethetop </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">function</span><span style="color:#000000">(element, settings) {<br></span><span style="color:#008080">112</span> <span style="color:#000000">        </span><span style="color:#0000ff">if</span><span style="color:#000000"> (settings.container </span><span style="color:#000000">===</span><span style="color:#000000"> undefined </span><span style="color:#000000">||</span><span style="color:#000000"> settings.container </span><span style="color:#000000">===</span><span style="color:#000000"> window) {<br></span><span style="color:#008080">113</span> <span style="color:#000000">            </span><span style="color:#0000ff">var</span><span style="color:#000000"> fold </span><span style="color:#000000">=</span><span style="color:#000000"> $(window).scrollTop();<br></span><span style="color:#008080">114</span> <span style="color:#000000">        } </span><span style="color:#0000ff">else</span><span style="color:#000000"> {<br></span><span style="color:#008080">115</span> <span style="color:#000000">            </span><span style="color:#0000ff">var</span><span style="color:#000000"> fold </span><span style="color:#000000">=</span><span style="color:#000000"> $(settings.container).offset().top;<br></span><span style="color:#008080">116</span> <span style="color:#000000">        }<br></span><span style="color:#008080">117</span> <span style="color:#000000">        </span><span style="color:#0000ff">return</span><span style="color:#000000"> fold </span><span style="color:#000000">&gt;=</span><span style="color:#000000"> $(element).offset().top </span><span style="color:#000000">+</span><span style="color:#000000"> settings.threshold  </span><span style="color:#000000">+</span><span style="color:#000000"> $(element).height();<br></span><span style="color:#008080">118</span> <span style="color:#000000">    };<br></span><span style="color:#008080">119</span> <span style="color:#000000">    <br></span><span style="color:#008080">120</span> <span style="color:#000000">    $.leftofbegin </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">function</span><span style="color:#000000">(element, settings) {<br></span><span style="color:#008080">121</span> <span style="color:#000000">        </span><span style="color:#0000ff">if</span><span style="color:#000000"> (settings.container </span><span style="color:#000000">===</span><span style="color:#000000"> undefined </span><span style="color:#000000">||</span><span style="color:#000000"> settings.container </span><span style="color:#000000">===</span><span style="color:#000000"> window) {<br></span><span style="color:#008080">122</span> <span style="color:#000000">            </span><span style="color:#0000ff">var</span><span style="color:#000000"> fold </span><span style="color:#000000">=</span><span style="color:#000000"> $(window).scrollLeft();<br></span><span style="color:#008080">123</span> <span style="color:#000000">        } </span><span style="color:#0000ff">else</span><span style="color:#000000"> {<br></span><span style="color:#008080">124</span> <span style="color:#000000">            </span><span style="color:#0000ff">var</span><span style="color:#000000"> fold </span><span style="color:#000000">=</span><span style="color:#000000"> $(settings.container).offset().left;<br></span><span style="color:#008080">125</span> <span style="color:#000000">        }<br></span><span style="color:#008080">126</span> <span style="color:#000000">        </span><span style="color:#0000ff">return</span><span style="color:#000000"> fold </span><span style="color:#000000">&gt;=</span><span style="color:#000000"> $(element).offset().left </span><span style="color:#000000">+</span><span style="color:#000000"> settings.threshold </span><span style="color:#000000">+</span><span style="color:#000000"> $(element).width();<br></span><span style="color:#008080">127</span> <span style="color:#000000">    };<br></span><span style="color:#008080">128</span> <span style="color:#000000">    </span><span style="color:#008000">/*</span><span style="color:#008000"> Custom selectors for your convenience.   </span><span style="color:#008000">*/</span><span style="color:#000000"><br></span><span style="color:#008080">129</span> <span style="color:#000000">    </span><span style="color:#008000">/*</span><span style="color:#008000"> Use as $("img:below-the-fold").something() </span><span style="color:#008000">*/</span><span style="color:#000000"><br></span><span style="color:#008080">130</span> <span style="color:#000000"><br></span><span style="color:#008080">131</span> <span style="color:#000000">    $.extend($.expr[</span><span style="color:#000000">'</span><span style="color:#000000">:</span><span style="color:#000000">'</span><span style="color:#000000">], {<br></span><span style="color:#008080">132</span> <span style="color:#000000">        </span><span style="color:#000000">"</span><span style="color:#000000">below-the-fold</span><span style="color:#000000">"</span><span style="color:#000000"> : </span><span style="color:#000000">"</span><span style="color:#000000">$.belowthefold(a, {threshold : 0, container: window})</span><span style="color:#000000">"</span><span style="color:#000000">,<br></span><span style="color:#008080">133</span> <span style="color:#000000">        </span><span style="color:#000000">"</span><span style="color:#000000">above-the-fold</span><span style="color:#000000">"</span><span style="color:#000000"> : </span><span style="color:#000000">"</span><span style="color:#000000">!$.belowthefold(a, {threshold : 0, container: window})</span><span style="color:#000000">"</span><span style="color:#000000">,<br></span><span style="color:#008080">134</span> <span style="color:#000000">        </span><span style="color:#000000">"</span><span style="color:#000000">right-of-fold</span><span style="color:#000000">"</span><span style="color:#000000">  : </span><span style="color:#000000">"</span><span style="color:#000000">$.rightoffold(a, {threshold : 0, container: window})</span><span style="color:#000000">"</span><span style="color:#000000">,<br></span><span style="color:#008080">135</span> <span style="color:#000000">        </span><span style="color:#000000">"</span><span style="color:#000000">left-of-fold</span><span style="color:#000000">"</span><span style="color:#000000">   : </span><span style="color:#000000">"</span><span style="color:#000000">!$.rightoffold(a, {threshold : 0, container: window})</span><span style="color:#000000">"</span><span style="color:#000000"><br></span><span style="color:#008080">136</span> <span style="color:#000000">    });<br></span><span style="color:#008080">137</span> <span style="color:#000000">    <br></span><span style="color:#008080">138</span> <span style="color:#000000">})(jQuery);</span></div></pre>
</div>
</div>
<p> </p>
</p>
<p>下面是测试页面的html代码</p>
<p>
<div>
<pre>&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot; &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;&gt;
&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt;
&lt;head&gt;
&lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=EmulateIE7&quot; /&gt;
&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=utf-8&quot; /&gt;
&lt;meta name=&quot;keywords&quot; content=&quot;汽车图片,汽车图片壁纸, 汽车图片桌面, 汽车图片库,汽车图片大全&quot; /&gt;
&lt;meta name=&quot;description&quot; content=&quot;汽车图片，网上车市汽车图片大全频道为网友提供各种汽车图片及美女图片下载，各种车型汽车图片桌面，汽车图片壁纸，车展美女图片，美女车模图片等。精彩图片，尽在网上车市。&quot; /&gt;
&lt;title&gt;【汽车图片|汽车美女图片-汽车图片大全】-网上车市&lt;/title&gt;
&lt;style&gt;
.switch_textarea {display:none;}
.div_style {width:600px; height:400px; }
&lt;/style&gt;
&lt;script type=&quot;text/javascript&quot; src=&quot;http://js.cheshi-img.com/jquery/jquery.1.4.4.js&quot;&gt;&lt;/script&gt;
&lt;script type=&quot;text/javascript&quot; src=&quot;lazyload.jquery.js&quot;&gt;&lt;/script&gt;

&lt;script&gt;
$().ready(function(){
	$(&quot;.switch_textarea&quot;).lazyload();
});
&lt;/script&gt;

&lt;/head&gt;
&lt;body&gt;
&lt;H2&gt;第1张图&lt;/H2&gt;
&lt;div class=&quot;div_style&quot;&gt;&lt;textarea class=&quot;switch_textarea&quot;&gt;&lt;img src=&quot;http://img.cheshi-img.com/product/1_720/1957/4bdfd2385fd03.jpg&quot; /&gt;&lt;/textarea&gt;&lt;/div&gt;
&lt;H2&gt;第2张图&lt;/H2&gt;
&lt;div class=&quot;div_style&quot;&gt;&lt;textarea class=&quot;switch_textarea&quot;&gt;&lt;img src=&quot;http://img.cheshi-img.com/product/1_720/1957/4bdfd2366adec.jpg&quot; /&gt;&lt;/textarea&gt;&lt;/div&gt;
&lt;H2&gt;第3张图&lt;/H2&gt;
&lt;div class=&quot;div_style&quot;&gt;&lt;textarea class=&quot;switch_textarea&quot;&gt;&lt;img src=&quot;http://img.cheshi-img.com/product/1_720/1957/4bdfd233b8da4.jpg&quot; /&gt;&lt;/textarea&gt;&lt;/div&gt;
&lt;H2&gt;第4张图&lt;/H2&gt;
&lt;div class=&quot;div_style&quot;&gt;&lt;textarea class=&quot;switch_textarea&quot;&gt;&lt;img src=&quot;http://img.cheshi-img.com/product/1_720/1957/4bdfd231a0fd8.jpg&quot; /&gt;&lt;/textarea&gt;&lt;/div&gt;
&lt;H2&gt;第5张图&lt;/H2&gt;
&lt;div class=&quot;div_style&quot;&gt;&lt;textarea class=&quot;switch_textarea&quot;&gt;&lt;img src=&quot;http://img.cheshi-img.com/product/1_720/1957/4bdfd22e68f56.jpg&quot; /&gt;&lt;/textarea&gt;&lt;/div&gt;
&lt;H2&gt;第6张图&lt;/H2&gt;
&lt;div class=&quot;div_style&quot;&gt;&lt;textarea class=&quot;switch_textarea&quot;&gt;&lt;img src=&quot;http://img.cheshi-img.com/product/1_720/1957/4bdfd22c55a5d.jpg&quot; /&gt;&lt;/textarea&gt;&lt;/div&gt;
&lt;H2&gt;第7张图&lt;/H2&gt;
&lt;div class=&quot;div_style&quot;&gt;&lt;textarea class=&quot;switch_textarea&quot;&gt;&lt;img src=&quot;http://img.cheshi-img.com/product/1_720/1957/4bdfd2278872b.jpg&quot; /&gt;&lt;/textarea&gt;&lt;/div&gt;
&lt;H2&gt;第8张图&lt;/H2&gt;
&lt;div class=&quot;div_style&quot;&gt;&lt;textarea class=&quot;switch_textarea&quot;&gt;&lt;img src=&quot;http://img.cheshi-img.com/product/1_720/1957/4bdfd224a0f6e.jpg&quot; /&gt;&lt;/textarea&gt;&lt;/div&gt;
&lt;H2&gt;第9张图&lt;/H2&gt;
&lt;div class=&quot;div_style&quot;&gt;&lt;textarea class=&quot;switch_textarea&quot;&gt;&lt;img src=&quot;http://img.cheshi-img.com/product/1_720/1957/4bdfd21fb42bc.jpg&quot; /&gt;&lt;/textarea&gt;&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;

</pre>
</div>
</p>
<p>测试页面的html代码中将所有要载入的图片都放到了textarea标签中，其目的就是防止页面载入时这些img标签向服务器发出请求，从而实现减少不必要的请求数，实际应用中也可以将不需第一次载入的html代码放到textarea中。</p><img src="http://www.cnblogs.com/cnevan/aggbug/1912323.html?type=1" width="1" height="1" alt=""><p>作者: <a href="http://www.cnblogs.com/cnevan/">午夜圣歌</a> 发表于 2010-12-21 10:17 <a href="http://www.cnblogs.com/cnevan/archive/2010/12/21/1912323.html">原文链接</a></p><p>评论: 20　<a href="http://www.cnblogs.com/cnevan/archive/2010/12/21/1912323.html#pagedcomment">查看评论</a>　<a href="http://www.cnblogs.com/cnevan/archive/2010/12/21/1912323.html#commentform">发表评论</a></p><hr><p>最新新闻：<br>· <a href="http://news.cnblogs.com/n/85313/">评论：苹果为何不参加CES国际消费电子展</a><span style="color:gray">(2010-12-21 15:03)</span><br>· <a href="http://news.cnblogs.com/n/85312/">Sysomos：2010年twitter用户调查报告</a><span style="color:gray">(2010-12-21 14:53)</span><br>· <a href="http://news.cnblogs.com/n/85311/">“微创新”杀手的三个关键特征</a><span style="color:gray">(2010-12-21 14:41)</span><br>· <a href="http://news.cnblogs.com/n/85309/">About.Me CEO回应出售：团队需要资金</a><span style="color:gray">(2010-12-21 14:22)</span><br>· <a href="http://news.cnblogs.com/n/85308/">Foursqure启蒙：国内LBS探索新模式</a><span style="color:gray">(2010-12-21 14:18)</span><br></p><p>编辑推荐：<a href="http://news.cnblogs.com/n/85282/">微软推出公测版Dryad并行软件平台</a><br></p><p>网站导航：<a href="http://www.cnblogs.com">博客园首页</a>  <a href="http://home.cnblogs.com/">我的园子</a>  <a href="http://news.cnblogs.com">新闻</a>  <a href="http://home.cnblogs.com/ing/">闪存</a>  <a href="http://home.cnblogs.com/group/">小组</a>  <a href="http://space.cnblogs.com/q/">博问</a>  <a href="http://kb.cnblogs.com">知识库</a></p></p>