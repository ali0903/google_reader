---
layout: post
title:  "代码才是最好的注释"
date:   2010-10-30 01:54:00
author: 麒麟
categories: program
---

## 代码才是最好的注释
### by 麒麟
### at 2010-10-30 01:54:00
### original <http://www.cnblogs.com/zhuqil/archive/2010/10/30/1864882.html>

<p><p>    一直以来都存在代码注释的作用的讨论。很多人认为注释是不必要的，写注释那是因为代码可读性太差了。我也同意这个原则。如果必须添加注释，我觉得可以添加一些解释代码为什么，而不是做什么的注释。下面我举个例子说明该如何除去代码中的注释。</p>
<p>    我们直接看代码，下面的代码是我要对注释进行清除的例子。（这段代码只是作为一个例子，没有做过多的考虑。）</p>
<div>
<pre><div><span style="color:#008080"> 1</span> <span style="color:#000000">     </span><span style="color:#0000ff">public</span><span style="color:#000000"> String recommendGift(</span><span style="color:#0000ff">double</span><span style="color:#000000"> budget){ <br></span><span style="color:#008080"> 2</span> <span style="color:#000000">     </span><span style="color:#008000">//</span><span style="color:#008000"> get gifts from helper </span><span style="color:#008000"><br></span><span style="color:#008080"> 3</span> <span style="color:#000000">     String[] gifts </span><span style="color:#000000">=</span><span style="color:#000000"> giftHelper.getGifts(); <br></span><span style="color:#008080"> 4</span> <span style="color:#000000">     String gift </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">null</span><span style="color:#000000">; <br></span><span style="color:#008080"> 5</span> <span style="color:#000000">     <br></span><span style="color:#008080"> 6</span> <span style="color:#000000">     </span><span style="color:#0000ff">for</span><span style="color:#000000"> (</span><span style="color:#0000ff">int</span><span style="color:#000000"> i </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#800080">0</span><span style="color:#000000">; i </span><span style="color:#000000">&amp;</span><span style="color:#000000">lt; gifts.length; i</span><span style="color:#000000">++</span><span style="color:#000000">) { <br></span><span style="color:#008080"> 7</span> <span style="color:#000000">     <br></span><span style="color:#008080"> 8</span> <span style="color:#000000">     gift </span><span style="color:#000000">=</span><span style="color:#000000"> gifts[i]; <br></span><span style="color:#008080"> 9</span> <span style="color:#000000">     <br></span><span style="color:#008080">10</span> <span style="color:#000000">     </span><span style="color:#008000">//</span><span style="color:#008000"> find out if gift already given </span><span style="color:#008000"><br></span><span style="color:#008080">11</span> <span style="color:#000000">     boolean isAlreadyGiven </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">false</span><span style="color:#000000">; <br></span><span style="color:#008080">12</span> <span style="color:#000000">     </span><span style="color:#0000ff">for</span><span style="color:#000000"> (String given : giftsGiven) { <br></span><span style="color:#008080">13</span> <span style="color:#000000">     </span><span style="color:#0000ff">if</span><span style="color:#000000">(gift.equals(given)){ <br></span><span style="color:#008080">14</span> <span style="color:#000000">     isAlreadyGiven </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">true</span><span style="color:#000000">; <br></span><span style="color:#008080">15</span> <span style="color:#000000">     </span><span style="color:#0000ff">break</span><span style="color:#000000">; <br></span><span style="color:#008080">16</span> <span style="color:#000000">     } <br></span><span style="color:#008080">17</span> <span style="color:#000000">     } <br></span><span style="color:#008080">18</span> <span style="color:#000000">     <br></span><span style="color:#008080">19</span> <span style="color:#000000">     </span><span style="color:#008000">//</span><span style="color:#008000"> calculate rating and budget </span><span style="color:#008000"><br></span><span style="color:#008080">20</span> <span style="color:#000000">     </span><span style="color:#0000ff">int</span><span style="color:#000000"> x </span><span style="color:#000000">=</span><span style="color:#000000"> rating </span><span style="color:#000000">*</span><span style="color:#000000"> </span><span style="color:#800080">200</span><span style="color:#000000">; <br></span><span style="color:#008080">21</span> <span style="color:#000000">     boolean ok </span><span style="color:#000000">=</span><span style="color:#000000"> budget </span><span style="color:#000000">&amp;</span><span style="color:#000000">lt; x; <br></span><span style="color:#008080">22</span> <span style="color:#000000">     <br></span><span style="color:#008080">23</span> <span style="color:#000000">     </span><span style="color:#008000">//</span><span style="color:#008000"> if both conditions satisfy, give it. </span><span style="color:#008000"><br></span><span style="color:#008080">24</span> <span style="color:#000000">     </span><span style="color:#0000ff">if</span><span style="color:#000000">(</span><span style="color:#000000">!</span><span style="color:#000000">isAlreadyGiven </span><span style="color:#000000">&amp;</span><span style="color:#000000">amp;</span><span style="color:#000000">&amp;</span><span style="color:#000000">amp; ok){ <br></span><span style="color:#008080">25</span> <span style="color:#000000">     giftsGiven.add(gift); <br></span><span style="color:#008080">26</span> <span style="color:#000000">     </span><span style="color:#008000">//</span><span style="color:#008000"> increment maintenance cost of the girlfriend </span><span style="color:#008000"><br></span><span style="color:#008080">27</span> <span style="color:#000000">     maintenanceCost </span><span style="color:#000000">+=</span><span style="color:#000000"> budget; <br></span><span style="color:#008080">28</span> <span style="color:#000000">     </span><span style="color:#0000ff">return</span><span style="color:#000000"> gift; <br></span><span style="color:#008080">29</span> <span style="color:#000000">     } <br></span><span style="color:#008080">30</span> <span style="color:#000000">     } <br></span><span style="color:#008080">31</span> <span style="color:#000000">     <br></span><span style="color:#008080">32</span> <span style="color:#000000">     </span><span style="color:#0000ff">return</span><span style="color:#000000"> gift; <br></span><span style="color:#008080">33</span> <span style="color:#000000">     }</span></div></pre>
</div>
<p>这段代码是相当简单的。从礼物清单中挑选出不在已赠送的礼物列表中的而且不超过预算的第一份礼物。这段代码有如下几个问题：</p>
<p>1、方法过长</p>
<p>2、这个方法做的事情太多</p>
<p>3、可读性差，即使加了注释</p>
<p>4、注释告诉我们代码是干什么的，这些应该是代码自己的事情才对。</p>
<p>让我们开始整理一下这段代码。</p>
<p>首先，看下面代码段，非常明显，这些代码注释是不必要的。这种代码注释我们应该避免。它并没有提高代码的可读性，事实上起到了相反的效果。</p>
<div>
<pre><div><span style="color:#000000">     </span><span style="color:#008000">//</span><span style="color:#008000"> get gifts from helper </span><span style="color:#008000"><br></span><span style="color:#000000">     String[] gifts </span><span style="color:#000000">=</span><span style="color:#000000"> giftHelper.getGifts(); </span></div></pre>
</div>
<p>接着，我将下面带注释的代码移动到一个分离的方法中。方法的命名可以来自给出的注释。</p>
<div>
<pre><div><span style="color:#000000">     </span><span style="color:#008000">//</span><span style="color:#008000"> find out if gift already given </span><span style="color:#008000"><br></span><span style="color:#000000">     boolean isAlreadyGiven </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">false</span><span style="color:#000000">; <br>     </span><span style="color:#0000ff">for</span><span style="color:#000000"> (String given </span><span style="color:#0000ff">in</span><span style="color:#000000"> giftsGiven) { <br>     </span><span style="color:#0000ff">if</span><span style="color:#000000">(gift.equals(given)){ <br>     isAlreadyGiven </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">true</span><span style="color:#000000">; <br>     </span><span style="color:#0000ff">break</span><span style="color:#000000">; <br>     } <br>     } </span></div></pre>
</div>
<p>修改后的代码：</p>
<div>
<pre><div><span style="color:#0000ff">private</span><span style="color:#000000"> boolean isGiftNotAlreadyGiven(String gift) {<br>        boolean isAlreadyGiven </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">true</span><span style="color:#000000">;<br>        </span><span style="color:#0000ff">for</span><span style="color:#000000"> (String given </span><span style="color:#0000ff">in</span><span style="color:#000000"> giftsGiven) {<br>            </span><span style="color:#0000ff">if</span><span style="color:#000000">(gift.equals(given)){<br>                isAlreadyGiven </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">false</span><span style="color:#000000">;<br>                </span><span style="color:#0000ff">break</span><span style="color:#000000">;<br>            }<br>        }<br>        </span><span style="color:#0000ff">return</span><span style="color:#000000"> isAlreadyGiven;<br>    }</span></div></pre>
</div>
<p>然后按照相同的方式继续下去，最终的代码如下：</p>
<div>
<pre><div><span style="color:#000000">  </span><span style="color:#0000ff">public</span><span style="color:#000000"> String recommendGift(</span><span style="color:#0000ff">double</span><span style="color:#000000"> budget)<br>   {<br>    String recommendedGift </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">null</span><span style="color:#000000">;<br>    </span><span style="color:#0000ff">for</span><span style="color:#000000"> (String gift </span><span style="color:#0000ff">in</span><span style="color:#000000"> giftHelper.getGifts()) <br>    {<br>         recommendedGift </span><span style="color:#000000">=</span><span style="color:#000000"> gift;<br>        </span><span style="color:#0000ff">if</span><span style="color:#000000">(isGiftNotAlreadyGiven(recommendedGift)</span><span style="color:#000000">&amp;&amp;</span><span style="color:#000000">isUnderBudget(budget))<br>        {<br>            updateMaintenanceCostAndGiftsGiven(budget, recommendedGift);<br>            </span><span style="color:#0000ff">return</span><span style="color:#000000"> recommendedGift;<br>       }<br>    }<br>    </span><span style="color:#0000ff">return</span><span style="color:#000000"> recommendedGift;<br>   }<br><br>     </span><span style="color:#0000ff">private</span><span style="color:#000000"> </span><span style="color:#0000ff">void</span><span style="color:#000000"> updateMaintenanceCostAndGiftsGiven(</span><span style="color:#0000ff">double</span><span style="color:#000000"> budget, String gift)<br>     {<br>         giftsGiven.add(gift);<br>  </span><span style="color:#000000">       maintenanceCost </span><span style="color:#000000">+=</span><span style="color:#000000"> budget;<br>     }<br><br>     </span><span style="color:#0000ff">private</span><span style="color:#000000"> boolean isUnderBudget(</span><span style="color:#0000ff">double</span><span style="color:#000000"> budget)<br>     {<br>         </span><span style="color:#0000ff">int</span><span style="color:#000000"> x </span><span style="color:#000000">=</span><span style="color:#000000"> rating </span><span style="color:#000000">*</span><span style="color:#000000"> </span><span style="color:#800080">200</span><span style="color:#000000">;<br>         boolean ok </span><span style="color:#000000">=</span><span style="color:#000000"> budget </span><span style="color:#000000">&lt;</span><span style="color:#000000"> x;<br>         </span><span style="color:#0000ff">return</span><span style="color:#000000"> ok;<br>     }<br><br>     </span><span style="color:#0000ff">private</span><span style="color:#000000"> boolean isGiftNotAlreadyGiven(String gift) <br>     {<br>        boolean isAlreadyGiven </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">true</span><span style="color:#000000">;<br>        </span><span style="color:#0000ff">for</span><span style="color:#000000"> (String given </span><span style="color:#0000ff">in</span><span style="color:#000000"> giftsGiven) {<br>            </span><span style="color:#0000ff">if</span><span style="color:#000000">(gift.Equals(given)){<br>                isAlreadyGiven </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">false</span><span style="color:#000000">;<br>                </span><span style="color:#0000ff">break</span><span style="color:#000000">;<br>        }<br>      }<br>       </span><span style="color:#0000ff">return</span><span style="color:#000000"> isAlreadyGiven;<br>    }</span></div></pre>
</div>
<p>这里有几件需要注意的事情：</p>
<p>1、一个大方法按照它的功能被分割成几个小方法，这样代码就比较容易阅读了。</p>
<p>2、每个方法大概4到5行，非常理想！</p>
<p>3、注释去掉了，但是目的却达到了。用代码来代替了注释。</p>
<p>译自：<a href="http://onsoftwareandstuff.com/2010/10/12/better-way-to-comment-code-it/#comments">Better way to comment.. code it.</a></p>
<p><span style="color:#ff0000">译者说明：</span></p>
<p><span style="color:#ff0000">1、文章的那段代码很有特色，正在恋爱的男程可以试一下代码里面的方法。</span></p>
<p><span style="color:#ff0000">2、确实用代码来代替了注释。</span></p>
<p><span style="color:#ff0000">3、从文章可以看到这段代码的演变主要是将注释变成了函数名和变量名。</span></p>
<p><span style="color:#ff0000">4、对于老外来说，英文和代码类似，所以这样做就非常受用，通过看函数名，变量名就能明白函数的功能，Clean Code书中也是这样建议的。</span></p>
<p><span style="color:#ff0000">5、对我们来说第一语言是中文的，英语不好情况就不一样了，这就是为什么国人的建议大多要求注释详尽，让代码更易读易懂；而老外的建议几乎是尽可能的少。</span></p>
<p><span style="color:#ff0000">6、我建议符合我们的国情：尽可能多的注释。</span></p><img src="http://www.cnblogs.com/zhuqil/aggbug/1864882.html?type=1" width="1" height="1" alt=""><p>作者: <a href="http://www.cnblogs.com/zhuqil/">麒麟</a> 发表于 2010-10-30 01:54 <a href="http://www.cnblogs.com/zhuqil/archive/2010/10/30/1864882.html">原文链接</a></p><p>评论: 34　<a href="http://www.cnblogs.com/zhuqil/archive/2010/10/30/1864882.html#pagedcomment">查看评论</a>　<a href="http://www.cnblogs.com/zhuqil/archive/2010/10/30/1864882.html#commentform">发表评论</a></p><hr><p>最新新闻：<br>· <a href="http://news.cnblogs.com/n/79141/">“鸽子首页木马” 成近期最大病毒</a><span style="color:gray">(2010-10-31 07:56)</span><br>· <a href="http://news.cnblogs.com/n/79140/">如何使 IE 9 平台预览版拥有完整用户界面？</a><span style="color:gray">(2010-10-31 07:53)</span><br>· <a href="http://news.cnblogs.com/n/79139/">财富杂志采访 Verizon CEO，确定明年初期发布 CDMA 版的 iPhone</a><span style="color:gray">(2010-10-31 07:50)</span><br>· <a href="http://news.cnblogs.com/n/79136/">网络群架升级外挂大战 360保镖对撼可牛361特警</a><span style="color:gray">(2010-10-30 22:37)</span><br>· <a href="http://news.cnblogs.com/n/79132/">腾讯最新动作：若安装升级补丁必须退出360</a><span style="color:gray">(2010-10-30 21:53)</span><br></p><p>编辑推荐：<a href="http://news.cnblogs.com/n/79114/">【重磅新闻】微软Silverlight战略发生转移 回归HTML5</a><br></p><p>网站导航：<a href="http://www.cnblogs.com">博客园首页</a>  <a href="http://home.cnblogs.com/">我的园子</a>  <a href="http://news.cnblogs.com">新闻</a>  <a href="http://home.cnblogs.com/ing/">闪存</a>  <a href="http://home.cnblogs.com/group/">小组</a>  <a href="http://space.cnblogs.com/q/">博问</a>  <a href="http://kb.cnblogs.com">知识库</a></p></p>