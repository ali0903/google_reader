---
layout: post
title:  "C#实现做秒杀器系列之一 网站登录"
date:   2010-09-07 21:43:00
author: 啊峰
categories: program
---

## C#实现做秒杀器系列之一 网站登录
### by 啊峰
### at 2010-09-07 21:43:00
### original <http://www.cnblogs.com/chjf2008/archive/2010/09/07/1820972.html>

<p><a href="http://www.cnblogs.com/chjf2008/"><img src="http://pic.cnblogs.com/face/u36277.jpg" alt="" border="0"></a><br>作者: <a href="http://www.cnblogs.com/chjf2008/">啊峰</a> 发表于 2010-09-07 21:43 <a href="http://www.cnblogs.com/chjf2008/archive/2010/09/07/1820972.html">原文链接</a> 阅读: 1999 评论: 19</p><p>         秒杀本来是网络游戏里的一个词，自从2009年9月26日淘宝网举行的一元秒杀包邮笔记本电脑的事件后，现在的秒杀更多指的是网络抢购。</p>
<p>自从4月份在园子里发表了一篇 《《<a href="http://www.cnblogs.com/chjf2008/archive/2010/04/14/1711811.html">socket 实现淘宝秒杀器（抢拍器） 附源码与截图</a>》》文章后，后来有好多园子里和其他网友都问我关于秒杀器的事情。</p>
<p>本人虽然是个写程序的（其实很烂），但本人也运营秒杀网（<a href="http://www.miaosha.cc/">http://www.miaosha.cc/</a>）认为是广告的不要点，哈哈，所以对电子商务互联网这块关注的也比较多，互联网上有什么新鲜事，我都能早早的了解。</p>
<p>    几天前得知农夫山泉又花大钱做秒杀活动，秒杀的商品很诱人，但有点的门槛，看到这些诱人的宝贝，又让我投入针对农夫山泉网站的秒杀研究中。</p>
<p>贴个图吧，但不是广告哦：</p>
<p><img border="0" alt="" src="http://images.cnblogs.com/cnblogs_com/chjf2008/z_x.png" width="704" height="268"></p>
<p> </p>
<p>切入正题,</p>
<p>如何实现秒杀器步骤如下：</p>
<p>据我所知 ASP.NET程序的网站和非asp.net的网站的数据提交有点不一样。</p>
<p> </p>
<p>第一步、抓包（推荐用httpwatch或者用火狐插件 live http headers 我个人比较喜欢后者）</p>
<p>第二步、获得需要的数据 post到验证页面 然后保存返回的Cookies</p>
<p>第三步、带上获取到的Cookies去访问需要登录的页面（当然提交订单的那个页面也是需要带上这个Cookies的）</p>
<p>下面就以登录农夫山泉水溶C100秒杀活动为例，登录地址：</p>
<p><img border="0" alt="" src="http://images.cnblogs.com/cnblogs_com/chjf2008/QQ%E6%88%AA%E5%9B%BE%E6%9C%AA%E5%91%BD%E5%90%8D.png" width="306" height="42">  </p>
<p>通过抓包得知 登录该网站需要如下的数据：</p>
<p>其实下面这一长串数据只有4个键值对的数据有用，其他的都可以不要，但为了保险期间，我抓到多少数据包提交给服务器，我就提交多少，一个不少。嘿嘿。</p>
<p>下面红色的标记的就是我们登入到该网站所必须的数据包。</p>
<p>注意看下都是键值对的形式</p>
<p>如：</p>
<p><span style="color:red">ctl00</span><span style="color:red">%</span><span style="color:red">24ContentPlaceHolder1</span><span style="color:red">%</span><span style="color:red">24login_email</span><span style="color:red">=</span><span style="color:red">这是我的用户名</span></p>
<p><span style="color:#000000"></span><span style="color:red">ctl00</span><span style="color:red">%</span><span style="color:red">24ContentPlaceHolder1</span><span style="color:red">%</span><span style="color:red">24login_pwd</span><span style="color:red">=</span><span style="color:red">这是我的密码</span></p>
<p><span style="color:red">由于这个是asp.net的网站而且这个网站估计用了模板页才导致用户名和密码的名字如此之长。</span></p>
<p><span style="color:red">由于是asp.net的网站 还需要一起带上<span style="color:red"><strong>__VIEWSTATE</strong></span> 以及<span style="color:red">__EVENTVALIDATION</span>的值，否则你是登入不了的。</span></p>
<p><span style="color:red">其他的数据如果你看着不爽，你就卡擦掉吧。</span></p>
<p> </p>
<div><img alt="" src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif"><img src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif"><span>代码</span> 
<div>
<div><span style="color:#000000">__EVENTTARGET</span><span style="color:#000000">=&amp;</span><span style="color:#000000">__EVENTARGUMENT</span><span style="color:#000000">=&amp;</span><span style="color:#000000">__LASTFOCUS</span><span style="color:#000000">=&amp;</span><span style="color:red"><strong>__VIEWSTATE</strong></span><span style="color:red">=%</span><span style="color:red">2FwEPDwUKLTUyNTY0OTUxNw9kFgJmD2QWAgIDD2QWBAICDw8WAh4HVmlzaWJsZWdkZAIED2QWAgIPD2QWAmYPZBYCAgEPEGQPFiICAQICAgMCBAIFAgYCBwIIAgkCCgILAgwCDQIOAg8CEAIRAhICEwIUAhUCFgIXAhgCGQIaAhsCHAIdAh4CHwIgAiECIhYiEAUJ5YyX5Lqs5biCBQYxMTAwMDBnEAUJ5aSp5rSl5biCBQYxMjAwMDBnEAUJ5rKz5YyX55yBBQYxMzAwMDBnEAUJ5bGx6KW</span><span style="color:red">%</span><span style="color:red">2F55yBBQYxNDAwMDBnEAUS5YaF6JKZ5Y</span><span style="color:red">%</span><span style="color:red">2Bk6Ieq5rK75Yy6BQYxNTAwMDBnEAUJ6L695a6B55yBBQYyMTAwMDBnEAUJ5ZCJ5p6X55yBBQYyMjAwMDBnEAUM6buR6b6Z5rGf55yBBQYyMzAwMDBnEAUJ5LiK5rW35biCBQYzMTAwMDBnEAUJ5rGf6IuP55yBBQYzMjAwMDBnEAUJ5rWZ5rGf55yBBQYzMzAwMDBnEAUJ5a6J5b6955yBBQYzNDAwMDBnEAUJ56aP5bu655yBBQYzNTAwMDBnEAUJ5rGf6KW</span><span style="color:red">%</span><span style="color:red">2F55yBBQYzNjAwMDBnEAUJ5bGx5Lic55yBBQYzNzAwMDBnEAUJ5rKz5Y2X55yBBQY0MTAwMDBnEAUJ5rmW5YyX55yBBQY0MjAwMDBnEAUJ5rmW5Y2X55yBBQY0MzAwMDBnEAUJ5bm</span><span style="color:red">%</span><span style="color:red">2F5Lic55yBBQY0NDAwMDBnEAUV5bm</span><span style="color:red">%</span><span style="color:red">2F6KW</span><span style="color:red">%</span><span style="color:red">2F5aOu5peP6Ieq5rK75Yy6BQY0NTAwMDBnEAUJ5rW35Y2X55yBBQY0NjAwMDBnEAUJ6YeN5bqG5biCBQY1MDAwMDBnEAUJ5Zub5bed55yBBQY1MTAwMDBnEAUJ6LS15bee55yBBQY1MjAwMDBnEAUJ5LqR5Y2X55yBBQY1MzAwMDBnEAUP6KW</span><span style="color:red">%</span><span style="color:red">2F6JeP6Ieq5rK75Yy6BQY1NDAwMDBnEAUJ6ZmV6KW</span><span style="color:red">%</span><span style="color:red">2F55yBBQY2MTAwMDBnEAUJ55SY6IKD55yBBQY2MjAwMDBnEAUJ6Z2S5rW355yBBQY2MzAwMDBnEAUV5a6B5aSP5Zue5peP6Ieq5rK75Yy6BQY2NDAwMDBnEAUJ5paw55aG55yBBQY2NTAwMDBnEAUJ5Y</span><span style="color:red">%</span><span style="color:red">2Bw5rm</span><span style="color:red">%</span><span style="color:red">2B55yBBQY3MTAwMDBnEAUV6aaZ5riv54m55Yir6KGM5pS</span><span style="color:red">%</span><span style="color:red">2F5Yy6BQY4MTAwMDBnEAUV5r6z6Zeo54m55Yir6KGM5pS</span><span style="color:red">%</span><span style="color:red">2F5Yy6BQY4MjAwMDBnFgFmZBgBBR5fX0NvbnRyb2xzUmVxdWlyZVBvc3RCYWNrS2V5X18WAQUqY3RsMDAkQ29udGVudFBsYWNlSG9sZGVyMSRDaGVja0JveFJlbWVtYmVyXP5f5jFjFGi8OOk7nQAhxyULuLo</span><span style="color:red">%</span><span style="color:red">3D</span><span style="color:#000000">&amp;</span><span style="color:red">__EVENTVALIDATION</span><span style="color:red">=%</span><span style="color:red">2FwEWLgLp5bngCALQmrSOBwKK1</span><span style="color:red">%</span><span style="color:red">2FXwAQLpjKrHDQL524n8BQKX</span><span style="color:red">%</span><span style="color:red">2BK6hAgLqq9jUBgK6n</span><span style="color:red">%</span><span style="color:red">2BHDDwK6n</span><span style="color:red">%</span><span style="color:red">2BHDDwK1i4XeBAK1i4HdBAK1i73YBAK1i7nfBAK1i7XaBAKUjIXeBAKUjIHdBAKUjL3YBAL3jIXeBAL3jIHdBAL3jL3YBAL3jLnfBAL3jLXaBAL3jLHZBAL3jK3UBALWjYXeBALWjYHdBALWjb3YBALWjbnfBALWjbXaBALWjbHZBAKxjInjBAKxjIXeBAKxjIHdBAKxjL3YBAKxjLnfBAKQjYXeBAKQjYHdBAKQjb3YBAKQjbnfBAKQjbXaBALzjYXeBALiioXeBALiioHdBAKxnro6Asig8</span><span style="color:red">%</span><span style="color:red">2BwEAtWi</span><span style="color:red">%</span><span style="color:red">2BfcIm9NV4F5lF0N7QkXHQYZWhnvGqgM</span><span style="color:red">%</span><span style="color:red">3D</span><span style="color:#000000">&amp;</span><span style="color:#000000">action1</span><span style="color:#000000">=&amp;</span><span style="color:red">ctl00</span><span style="color:red">%</span><span style="color:red">24ContentPlaceHolder1</span><span style="color:red">%</span><span style="color:red">24login_email</span><span style="color:red">=</span><span style="color:red">这是我的用户名</span><span style="color:#000000">&amp;</span><span style="color:red">ctl00</span><span style="color:red">%</span><span style="color:red">24ContentPlaceHolder1</span><span style="color:red">%</span><span style="color:red">24login_pwd</span><span style="color:red">=</span><span style="color:red">这是我的密码</span><span style="color:#000000">&amp;</span><span style="color:#000000">ctl00</span><span style="color:#000000">%</span><span style="color:#000000">24ContentPlaceHolder1</span><span style="color:#000000">%</span><span style="color:#000000">24OnLoginin</span><span style="color:#000000">=%</span><span style="color:#000000">E7</span><span style="color:#000000">%</span><span style="color:#800080">99</span><span style="color:#000000">%</span><span style="color:#000000">BB</span><span style="color:#000000">%</span><span style="color:#000000">E5</span><span style="color:#000000">%</span><span style="color:#000000">BD</span><span style="color:#000000">%</span><span style="color:#800080">95</span><span style="color:#000000">&amp;</span><span style="color:#000000">ctl00</span><span style="color:#000000">%</span><span style="color:#000000">24ContentPlaceHolder1</span><span style="color:#000000">%</span><span style="color:#000000">24email</span><span style="color:#000000">=&amp;</span><span style="color:#000000">ctl00</span><span style="color:#000000">%</span><span style="color:#000000">24ContentPlaceHolder1</span><span style="color:#000000">%</span><span style="color:#000000">24nickname</span><span style="color:#000000">=&amp;</span><span style="color:#000000">ctl00</span><span style="color:#000000">%</span><span style="color:#000000">24ContentPlaceHolder1</span><span style="color:#000000">%</span><span style="color:#000000">24DropDownListProvince</span><span style="color:#000000">=&amp;</span><span style="color:#000000">ctl00</span><span style="color:#000000">%</span><span style="color:#000000">24ContentPlaceHolder1</span><span style="color:#000000">%</span><span style="color:#000000">24DropDownListCity</span><span style="color:#000000">=&amp;</span><span style="color:#000000">ctl00</span><span style="color:#000000">%</span><span style="color:#000000">24ContentPlaceHolder1</span><span style="color:#000000">%</span><span style="color:#000000">24password</span><span style="color:#000000">=&amp;</span><span style="color:#000000">ctl00</span><span style="color:#000000">%</span><span style="color:#000000">24ContentPlaceHolder1</span><span style="color:#000000">%</span><span style="color:#000000">24password2</span><span style="color:#000000">=&amp;</span><span style="color:#000000">b</span><span style="color:#000000">=</span></div></div></div>
<p> </p>
<p>带上这些数据 我们登入他的网站</p>
<p>之前的那篇文章用的是socket去实现的，但这片文章我用</p>
<p>        HttpWebRequest request与HttpWebResponse response 等对象去实现。</p>
<p>下面来讲我具体是如何登录到系统的：</p>
<p>登录的地址：<br><img border="0" alt="" src="http://images.cnblogs.com/cnblogs_com/chjf2008/QQ%E6%88%AA%E5%9B%BE%E6%9C%AA%E5%91%BD%E5%90%8D.png" width="306" height="42"></p>
<p>需要提交的数据在上面贴出来了。</p>
<p>贴登入的代码</p>
<p>其中postUrl就是上面的网址，postString 就是上面的一对代码。</p>
<p>方法返回波尔值 登录成功后获得服务器发送到客户端的Cookies，并保存起来，下一步用的着，浏览其他需要登录后才能浏览的页面需要带上这个Cookies</p>
<p>全局变量里我定义了一个 ，用来保存Cookies的。</p>
<p>代码中有些变量声明 我是全局定义的如：</p>
<p>如果对此感兴趣 你也可以跟我交流哈。。。。顺便说下 淘宝网又要秒汽车了。。。哈哈。</p>
<p> </p>
<p><span style="color:red">下一篇：C#实现做秒杀器系列之二  如何去提交订单</span></p>
<p><span style="color:red"></span>        CookieContainer cookieContainer = new CookieContainer();<br>        HttpWebRequest request = null;<br>        HttpWebResponse response = null; </p>
<div><img alt="" src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif"><img src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif"><span>代码</span> 
<div>
<div><span style="color:#0000ff">#region</span><span style="color:#000000"> 实现登录并保存Cookies </span><span style="color:#000000"><br>        </span><span style="color:#0000ff">private</span><span style="color:#000000"> </span><span style="color:#0000ff">bool</span><span style="color:#000000"> login(</span><span style="color:#0000ff">string</span><span style="color:#000000"> postUrl, </span><span style="color:#0000ff">string</span><span style="color:#000000"> postString)<br>        {<br>            </span><span style="color:#0000ff">bool</span><span style="color:#000000"> loginFlag </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">false</span><span style="color:#000000">; <br>            </span><span style="color:#0000ff">byte</span><span style="color:#000000">[] postData </span><span style="color:#000000">=</span><span style="color:#000000"> Encoding.UTF8.GetBytes(postString);<br>            request </span><span style="color:#000000">=</span><span style="color:#000000"> WebRequest.Create(postUrl) </span><span style="color:#0000ff">as</span><span style="color:#000000"> HttpWebRequest;<br>            request.Method </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#800000">"</span><span style="color:#800000">POST</span><span style="color:#800000">"</span><span style="color:#000000">;<br>            request.KeepAlive </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">false</span><span style="color:#000000">;<br>            request.ContentType </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#800000">"</span><span style="color:#800000">application/x-www-form-urlencoded</span><span style="color:#800000">"</span><span style="color:#000000">;<br>            request.CookieContainer </span><span style="color:#000000">=</span><span style="color:#000000"> cookieContainer;<br>            request.ContentLength </span><span style="color:#000000">=</span><span style="color:#000000"> postData.Length;<br><br>            </span><span style="color:#008000">//</span><span style="color:#008000"> 提交请求数据</span><span style="color:#008000"><br></span><span style="color:#000000">            </span><span style="color:#0000ff">using</span><span style="color:#000000"> (System.IO.Stream outputStream </span><span style="color:#000000">=</span><span style="color:#000000"> request.GetRequestStream())<br>            {<br>                outputStream.Write(postData, </span><span style="color:#800080">0</span><span style="color:#000000">, postData.Length);<br>                outputStream.Close();<br>                response </span><span style="color:#000000">=</span><span style="color:#000000"> request.GetResponse() </span><span style="color:#0000ff">as</span><span style="color:#000000"> HttpWebResponse;<br>                </span><span style="color:#0000ff">using</span><span style="color:#000000"> (System.IO.Stream responseStream </span><span style="color:#000000">=</span><span style="color:#000000"> response.GetResponseStream())<br>                {<br>                    </span><span style="color:#0000ff">using</span><span style="color:#000000"> (System.IO.StreamReader reader </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">new</span><span style="color:#000000"> System.IO.StreamReader(responseStream, Encoding.GetEncoding(</span><span style="color:#800000">"</span><span style="color:#800000">utf-8</span><span style="color:#800000">"</span><span style="color:#000000">)))<br>                    {<br>                        </span><span style="color:#0000ff">string</span><span style="color:#000000"> srcString </span><span style="color:#000000">=</span><span style="color:#000000"> reader.ReadToEnd(); </span><span style="color:#008000">//</span><span style="color:#008000"> 接收返回的页面<br>                        </span><span style="color:#008000">//</span><span style="color:#008000">只要登录成功后，如果返回的源代码里面有退出的字样，那说明登入成功了。</span><span style="color:#008000"><br></span><span style="color:#000000">                        </span><span style="color:#0000ff">if</span><span style="color:#000000"> (srcString.IndexOf(</span><span style="color:#800000">"</span><span style="color:#800000">退出</span><span style="color:#800000">"</span><span style="color:#000000">) </span><span style="color:#000000">&gt;</span><span style="color:#000000"> </span><span style="color:#800080">0</span><span style="color:#000000">)<br>                        {<br>                            loginFlag </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">true</span><span style="color:#000000">;<br>                            </span><span style="color:#008000">//</span><span style="color:#008000">请在此处保存cookieContainer，浏览其他需要登录的页面需要带上它</span><span style="color:#008000"><br></span><span style="color:#000000">                            <br>                        }<br>                       <br>                    }<br>                }<br>            }<br><br>            </span><span style="color:#0000ff">return</span><span style="color:#000000"> loginFlag;<br>        }<br><br>        </span><span style="color:#0000ff">#endregion</span><span style="color:#000000"><br></span></div></div></div>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p><br> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p><img src="http://www.cnblogs.com/chjf2008/aggbug/1820972.html?type=1" width="1" height="1" alt=""><p>评论: 19　<a href="http://www.cnblogs.com/chjf2008/archive/2010/09/07/1820972.html#pagedcomment">查看评论</a>　<a href="http://www.cnblogs.com/chjf2008/archive/2010/09/07/1820972.html#commentform">发表评论</a></p><p><a href="http://job.cnblogs.com/">程序员找工作，就在博客园</a></p><hr><p>最新新闻：<br>· <a href="http://news.cnblogs.com/n/73581/">【夭折的创新】UT斯达康沉浮</a><span style="color:gray">(2010-09-08 13:56)</span><br>· <a href="http://news.cnblogs.com/n/73580/">中国IT产业人才分布地图</a><span style="color:gray">(2010-09-08 13:51)</span><br>· <a href="http://news.cnblogs.com/n/73579/">家酿机器人社区——智能创想，精确控制，趣人趣事</a><span style="color:gray">(2010-09-08 13:43)</span><br>· <a href="http://news.cnblogs.com/n/73578/">谷歌中国前高管尘埃落定 回归尚待时日</a><span style="color:gray">(2010-09-08 13:29)</span><br>· <a href="http://news.cnblogs.com/n/73577/">暴雪的秘密</a><span style="color:gray">(2010-09-08 13:08)</span><br></p><p>编辑推荐：<a href="http://www.cnblogs.com/cmt/archive/2010/09/07/1820392.html">博客园电子期刊2010年8月刊发布</a><br></p><p>网站导航：<a href="http://www.cnblogs.com">博客园首页</a>  <a href="http://home.cnblogs.com/">个人主页</a>  <a href="http://news.cnblogs.com">新闻</a>  <a href="http://home.cnblogs.com/ing/">闪存</a>  <a href="http://home.cnblogs.com/group/">小组</a>  <a href="http://space.cnblogs.com/q/">博问</a>  <a href="http://space.cnblogs.com">社区</a>  <a href="http://kb.cnblogs.com">知识库</a></p>