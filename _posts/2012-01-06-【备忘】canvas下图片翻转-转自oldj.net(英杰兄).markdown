---
layout: post
title:  "【备忘】canvas下图片翻转-转自oldj.net(英杰兄)"
date:   2012-01-06 16:44:00
author: 岑安
categories: program
---

## 【备忘】canvas下图片翻转-转自oldj.net(英杰兄)
### by 岑安
### at 2012-01-06 16:44:00
### original <http://www.cnblogs.com/hongru/archive/2012/01/06/2314871.html>

<p>原文链接：<a href="http://oldj.net/article/flip-images-in-html5/">http://oldj.net/article/flip-images-in-html5/</a></p><p>貌似 HTML5 的 Canvas 只提供了图片的旋转、缩放功能，没有提供图片翻转（水平翻转或垂直翻转）的支持，搜索加试验之后，得到几种实现图片翻转的方法，记录一下。</p><p>第一种最简单的是使用 CSS，代码片断如下：</p><div><div><div><table><tbody><tr><td><code>1</code></td><td><code>&lt;</code><code>style</code><code>&gt;</code></td></tr></tbody></table></div><div><table><tbody><tr><td><code>2</code></td><td><code>.flip-x {</code></td></tr></tbody></table></div><div><table><tbody><tr><td><code>3</code></td><td><code>    </code><code>filter: FlipH; /* IE only */</code></td></tr></tbody></table></div><div><table><tbody><tr><td><code>4</code></td><td><code>    </code><code>-moz-transform: matrix(-1, 0, 0, 1, 0, 0);</code></td></tr></tbody></table></div><div><table><tbody><tr><td><code>5</code></td><td><code>    </code><code>-webkit-transform: matrix(-1, 0, 0, 1, 0, 0);</code></td></tr></tbody></table></div><div><table><tbody><tr><td><code>6</code></td><td><code>}</code></td></tr></tbody></table></div><div><table><tbody><tr><td><code>7</code></td><td><code>&lt;/</code><code>style</code><code>&gt;</code></td></tr></tbody></table></div><div><table><tbody><tr><td><code>8</code></td><td><code>&lt;</code><code>img</code> <code>src</code><code>=</code><code>"<a href="http://oldj.net/images/oldj.net.png">http://oldj.net/images/oldj.net.png</a>"</code> <code>class</code><code>=</code><code>"flip-x"</code> <code>/&gt;</code></td></tr></tbody></table></div></div></div><p>支持 IE 、Firefox 等各大浏览器。不过，如果想在 HTML5 的 Canvas 中翻转一个图片，CSS 就无能为力了。</p><p>在 Canvas 中翻转图片大致有两种思路，一种是先“翻转”画布，在上面画好需要的图片后再将画布“翻转”回来；另一种是先在画布上正常画上原图，用 getImageData 方法取得图片的每一个象素的数据，再将数据镜像交换一下。</p><p>先来看“翻转”画布的方法，代码大致类似于这样：</p><div><div><div><table><tbody><tr><td><code>01</code></td><td><code>// 正常绘制：</code></td></tr></tbody></table></div><div><table><tbody><tr><td><code>02</code></td><td><code>// ctx.drawImage(img, px, py);</code></td></tr></tbody></table></div><div><table><tbody><tr><td><code>03</code></td><td> </td></tr></tbody></table></div><div><table><tbody><tr><td><code>04</code></td><td><code>// 水平“翻转”画布</code></td></tr></tbody></table></div><div><table><tbody><tr><td><code>05</code></td><td><code>ctx.translate(canvas_width, 0);</code></td></tr></tbody></table></div><div><table><tbody><tr><td><code>06</code></td><td><code>ctx.scale(-1, 1);</code></td></tr></tbody></table></div><div><table><tbody><tr><td><code>07</code></td><td><code>// 下面画的图片是水平翻转的</code></td></tr></tbody></table></div><div><table><tbody><tr><td><code>08</code></td><td><code>ctx.drawImage(img, canvas_width - img.width - px, py);</code></td></tr></tbody></table></div><div><table><tbody><tr><td><code>09</code></td><td><code>// 画布恢复正常</code></td></tr></tbody></table></div><div><table><tbody><tr><td><code>10</code></td><td><code>ctx.translate(canvas_width, 0);</code></td></tr></tbody></table></div><div><table><tbody><tr><td><code>11</code></td><td><code>ctx.scale(-1, 1);</code></td></tr></tbody></table></div></div></div><p>可以看到，主要用到了 translate 以及 scale 方法。先用 translate 方法将坐标原点设为画布右上角（默认为左上角），再用 scale(-1, 1) 的方式将画布水平翻转，在上面画好图之后再恢复即可。</p><p>另一种象素级的操作原理上也非常简单，就不多解释了，可以直接看源码：</p><div><div><div><a title="view source" href="http://oldj.net/article/flip-images-in-html5/#viewSource">view source</a><div></div><a title="print" href="http://oldj.net/article/flip-images-in-html5/#printSource">print</a><a title="?" href="http://oldj.net/article/flip-images-in-html5/#about">?</a></div></div><div><div><table><tbody><tr><td><code>01</code></td><td><code>&lt;!doctype html&gt;</code></td></tr></tbody></table></div><div><table><tbody><tr><td><code>02</code></td><td><code>&lt;html&gt;</code></td></tr></tbody></table></div><div><table><tbody><tr><td><code>03</code></td><td><code>&lt;head&gt;</code></td></tr></tbody></table></div><div><table><tbody><tr><td><code>04</code></td><td><code>&lt;meta charset=</code><code>"UTF-8"</code> <code>/&gt;</code></td></tr></tbody></table></div><div><table><tbody><tr><td><code>05</code></td><td><code>&lt;title&gt;test&lt;/title&gt;</code></td></tr></tbody></table></div><div><table><tbody><tr><td><code>06</code></td><td><code>&lt;style type=</code><code>"text/css"</code><code>&gt;</code></td></tr></tbody></table></div><div><table><tbody><tr><td><code>07</code></td><td><code>#cv {</code></td></tr></tbody></table></div><div><table><tbody><tr><td><code>08</code></td><td><code>border: solid 1px</code> <code>#333;</code></td></tr></tbody></table></div><div><table><tbody><tr><td><code>09</code></td><td><code>}</code></td></tr></tbody></table></div><div><table><tbody><tr><td><code>10</code></td><td><code>&lt;/style&gt;</code></td></tr></tbody></table></div><div><table><tbody><tr><td><code>11</code></td><td><code>&lt;/head&gt;</code></td></tr></tbody></table></div><div><table><tbody><tr><td><code>12</code></td><td><code>&lt;body&gt;</code></td></tr></tbody></table></div><div><table><tbody><tr><td><code>13</code></td><td><code>&lt;canvas id=</code><code>"cv"</code> <code>width=</code><code>"300"</code> <code>height=</code><code>"240"</code><code>&gt;&lt;/canvas&gt;</code></td></tr></tbody></table></div><div><table><tbody><tr><td><code>14</code></td><td><code>&lt;script&gt;</code></td></tr></tbody></table></div><div><table><tbody><tr><td><code>15</code></td><td><code>var</code> <code>canvas = document.getElementById(</code><code>"cv"</code><code>),</code></td></tr></tbody></table></div><div><table><tbody><tr><td><code>16</code></td><td><code>    </code><code>ctx = canvas.getContext(</code><code>"2d"</code><code>),</code></td></tr></tbody></table></div><div><table><tbody><tr><td><code>17</code></td><td><code>    </code><code>img = </code><code>new</code> <code>Image();</code></td></tr></tbody></table></div><div><table><tbody><tr><td><code>18</code></td><td> </td></tr></tbody></table></div><div><table><tbody><tr><td><code>19</code></td><td><code>img.src = </code><code>"/images/oldj_gmail.png"</code><code>;</code></td></tr></tbody></table></div><div><table><tbody><tr><td><code>20</code></td><td> </td></tr></tbody></table></div><div><table><tbody><tr><td><code>21</code></td><td><code>function</code> <code>show() {</code></td></tr></tbody></table></div><div><table><tbody><tr><td><code>22</code></td><td><code>    </code><code>// 正常图片</code></td></tr></tbody></table></div><div><table><tbody><tr><td><code>23</code></td><td><code>    </code><code>ctx.drawImage(img, 10, 10);</code></td></tr></tbody></table></div><div><table><tbody><tr><td><code>24</code></td><td> </td></tr></tbody></table></div><div><table><tbody><tr><td><code>25</code></td><td><code>    </code><code>// 水平翻转</code></td></tr></tbody></table></div><div><table><tbody><tr><td><code>26</code></td><td><code>    </code><code>ctx.translate(300, 0);</code></td></tr></tbody></table></div><div><table><tbody><tr><td><code>27</code></td><td><code>    </code><code>ctx.scale(-1, 1);</code></td></tr></tbody></table></div><div><table><tbody><tr><td><code>28</code></td><td><code>    </code><code>// 下面画的图片是水平翻转的</code></td></tr></tbody></table></div><div><table><tbody><tr><td><code>29</code></td><td><code>    </code><code>ctx.drawImage(img, 300 - img.width - 10, 60);</code></td></tr></tbody></table></div><div><table><tbody><tr><td><code>30</code></td><td><code>    </code><code>// 恢复正常</code></td></tr></tbody></table></div><div><table><tbody><tr><td><code>31</code></td><td><code>    </code><code>ctx.translate(300, 0);</code></td></tr></tbody></table></div><div><table><tbody><tr><td><code>32</code></td><td><code>    </code><code>ctx.scale(-1, 1);</code></td></tr></tbody></table></div><div><table><tbody><tr><td><code>33</code></td><td> </td></tr></tbody></table></div><div><table><tbody><tr><td><code>34</code></td><td><code>    </code><code>// 下面的图片是正常的</code></td></tr></tbody></table></div><div><table><tbody><tr><td><code>35</code></td><td><code>    </code><code>ctx.drawImage(img, 10, 110);</code></td></tr></tbody></table></div><div><table><tbody><tr><td><code>36</code></td><td> </td></tr></tbody></table></div><div><table><tbody><tr><td><code>37</code></td><td> </td></tr></tbody></table></div><div><table><tbody><tr><td><code>38</code></td><td><code>    </code><code>// 象素级水平翻转图片的方法</code></td></tr></tbody></table></div><div><table><tbody><tr><td><code>39</code></td><td><code>    </code><code>show2();</code></td></tr></tbody></table></div><div><table><tbody><tr><td><code>40</code></td><td><code>}</code></td></tr></tbody></table></div><div><table><tbody><tr><td><code>41</code></td><td> </td></tr></tbody></table></div><div><table><tbody><tr><td><code>42</code></td><td><code>function</code> <code>show2() {</code></td></tr></tbody></table></div><div><table><tbody><tr><td><code>43</code></td><td><code>    </code><code>// 象素级水平翻转的方法</code></td></tr></tbody></table></div><div><table><tbody><tr><td><code>44</code></td><td> </td></tr></tbody></table></div><div><table><tbody><tr><td><code>45</code></td><td><code>    </code><code>// 先画一个正常的画片</code></td></tr></tbody></table></div><div><table><tbody><tr><td><code>46</code></td><td><code>    </code><code>var</code> <code>px = 10,</code></td></tr></tbody></table></div><div><table><tbody><tr><td><code>47</code></td><td><code>        </code><code>py = 160;</code></td></tr></tbody></table></div><div><table><tbody><tr><td><code>48</code></td><td> </td></tr></tbody></table></div><div><table><tbody><tr><td><code>49</code></td><td><code>    </code><code>ctx.drawImage(img, px, py);</code></td></tr></tbody></table></div><div><table><tbody><tr><td><code>50</code></td><td> </td></tr></tbody></table></div><div><table><tbody><tr><td><code>51</code></td><td><code>    </code><code>// 取得这个图片的数据，图片与当前页面必须同域，否则会出错</code></td></tr></tbody></table></div><div><table><tbody><tr><td><code>52</code></td><td><code>    </code><code>var</code> <code>img_data = ctx.getImageData(px, py, img.width, img.height),</code></td></tr></tbody></table></div><div><table><tbody><tr><td><code>53</code></td><td> </td></tr></tbody></table></div><div><table><tbody><tr><td><code>54</code></td><td><code>        </code><code>x, y, p, i, i2, t,</code></td></tr></tbody></table></div><div><table><tbody><tr><td><code>55</code></td><td><code>        </code><code>h = img_data.height;</code></td></tr></tbody></table></div><div><table><tbody><tr><td><code>56</code></td><td><code>        </code><code>w = img_data.width,</code></td></tr></tbody></table></div><div><table><tbody><tr><td><code>57</code></td><td><code>        </code><code>w_2 = w / 2;</code></td></tr></tbody></table></div><div><table><tbody><tr><td><code>58</code></td><td> </td></tr></tbody></table></div><div><table><tbody><tr><td><code>59</code></td><td><code>    </code><code>// 将 img_data 的数据水平翻转</code></td></tr></tbody></table></div><div><table><tbody><tr><td><code>60</code></td><td><code>    </code><code>for</code> <code>(y = 0; y &lt; h; y ++) {</code></td></tr></tbody></table></div><div><table><tbody><tr><td><code>61</code></td><td><code>        </code><code>for</code> <code>(x = 0; x &lt; w_2; x ++) {</code></td></tr></tbody></table></div><div><table><tbody><tr><td><code>62</code></td><td><code>            </code><code>i = (y&lt;&lt;2) * w + (x&lt;&lt;2);</code></td></tr></tbody></table></div><div><table><tbody><tr><td><code>63</code></td><td><code>            </code><code>i2 = ((y + 1) &lt;&lt; 2) * w - ((x + 1) &lt;&lt; 2);</code></td></tr></tbody></table></div><div><table><tbody><tr><td><code>64</code></td><td><code>            </code><code>for</code> <code>(p = 0; p &lt; 4; p ++) {</code></td></tr></tbody></table></div><div><table><tbody><tr><td><code>65</code></td><td><code>                </code><code>t = img_data.data[i + p];</code></td></tr></tbody></table></div><div><table><tbody><tr><td><code>66</code></td><td><code>                </code><code>img_data.data[i + p] = img_data.data[i2 + p];</code></td></tr></tbody></table></div><div><table><tbody><tr><td><code>67</code></td><td><code>                </code><code>img_data.data[i2 + p] = t;</code></td></tr></tbody></table></div><div><table><tbody><tr><td><code>68</code></td><td><code>            </code><code>}</code></td></tr></tbody></table></div><div><table><tbody><tr><td><code>69</code></td><td><code>        </code><code>}</code></td></tr></tbody></table></div><div><table><tbody><tr><td><code>70</code></td><td><code>    </code><code>}</code></td></tr></tbody></table></div><div><table><tbody><tr><td><code>71</code></td><td> </td></tr></tbody></table></div><div><table><tbody><tr><td><code>72</code></td><td><code>    </code><code>// 重绘水平翻转后的图片</code></td></tr></tbody></table></div><div><table><tbody><tr><td><code>73</code></td><td><code>    </code><code>ctx.putImageData(img_data, px, py);</code></td></tr></tbody></table></div><div><table><tbody><tr><td><code>74</code></td><td><code>}</code></td></tr></tbody></table></div><div><table><tbody><tr><td><code>75</code></td><td> </td></tr></tbody></table></div><div><table><tbody><tr><td><code>76</code></td><td><code>img.onload = </code><code>function</code> <code>() {</code></td></tr></tbody></table></div><div><table><tbody><tr><td><code>77</code></td><td><code>    </code><code>show();</code></td></tr></tbody></table></div><div><table><tbody><tr><td><code>78</code></td><td><code>};</code></td></tr></tbody></table></div><div><table><tbody><tr><td><code>79</code></td><td><code>&lt;/script&gt;</code></td></tr></tbody></table></div><div><table><tbody><tr><td><code>80</code></td><td><code>&lt;/body&gt;</code></td></tr></tbody></table></div><div><table><tbody><tr><td><code>81</code></td><td><code>&lt;/html&gt;</code></td></tr></tbody></table></div></div></div><img src="http://www.cnblogs.com/hongru/aggbug/2314871.html?type=1" width="1" height="1" alt=""><p><a href="http://www.cnblogs.com/hongru/archive/2012/01/06/2314871.html">本文链接</a></p>