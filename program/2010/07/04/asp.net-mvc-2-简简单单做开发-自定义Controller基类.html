<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>asp.net mvc 2 简简单单做开发 自定义Controller基类</title>
        <meta name="viewport" content="width=device-width">

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/google_reader/css/syntax.css">

        <!-- Custom CSS -->
        <link rel="stylesheet" href="/google_reader/css/main.css">

    </head>
    <body>

        <div class="container">
          <div class="site">
            <div class="header">
              <h1 class="title"><a href="/google_reader/">Google Reader</a></h1>
              <a class="extra" href="/google_reader/">home</a>
            </div>

                <h2>asp.net mvc 2 简简单单做开发 自定义Controller基类</h2>
<p class="meta">2010-07-04 01:18</p>

<div class="post">
<h2>asp.net mvc 2 简简单单做开发 自定义Controller基类</h2>

<h3>by 王继坤</h3>

<h3>at 2010-07-03 17:18:00</h3>

<h3>original <a href="http://www.cnblogs.com/wangjikun3/archive/2010/07/03/1770532.html">http://www.cnblogs.com/wangjikun3/archive/2010/07/03/1770532.html</a></h3>

<p>作者: <a href="http://www.cnblogs.com/wangjikun3/">王继坤</a> 发表于 2010-07-03 17:18 <a href="http://www.cnblogs.com/wangjikun3/archive/2010/07/03/1770532.html">原文链接</a> 阅读: 251 评论: 0</p>


<p>　　以前使用asp.net时总是自定义一个基类来继承Page类，来实现一些页面中常用的操作来减少代码。asp.net mvc 2 里没有分页功能，就在基类里实现分页的功能吧，在页面中定义分页常用的变量，如 RecordCount、PageSize、CurPage等。通过GetPager() 把分页字符串赋给ViewData["Page"],view页面中直接输出ViewData["page"]。</p>


<p>    实例代码 BaseController.cs</p>


<div>
<div><span style="color:#008080"> 1</span> <span style="color:#000000"> </span><span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">class</span><span style="color:#000000"> BaseController : Controller<br></span><span style="color:#008080"> 2</span> <span style="color:#000000">    {<br></span><span style="color:#008080"> 3</span> <span style="color:#000000">        </span><span style="color:#008000">//</span><span style="color:#008000">linq数据操作类db</span><span style="color:#008000"><br></span><span style="color:#008080"> 4</span> <span style="color:#008000"></span><span style="color:#000000">        </span><span style="color:#0000ff">public</span><span style="color:#000000"> DB db </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">new</span><span style="color:#000000"> DB();<br></span><span style="color:#008080"> 5</span> <span style="color:#000000">        </span><span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">int</span><span style="color:#000000"> RecordCount </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#800080">0</span><span style="color:#000000">;<br></span><span style="color:#008080"> 6</span> <span style="color:#000000">        </span><span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">int</span><span style="color:#000000"> PageSize </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#800080">10</span><span style="color:#000000">;<br></span><span style="color:#008080"> 7</span> <span style="color:#000000">      <br></span><span style="color:#008080"> 8</span> <span style="color:#000000">        </span><span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">int</span><span style="color:#000000"> CurPage<br></span><span style="color:#008080"> 9</span> <span style="color:#000000">        {<br></span><span style="color:#008080">10</span> <span style="color:#000000">            </span><span style="color:#0000ff">get</span><span style="color:#000000"><br></span><span style="color:#008080">11</span> <span style="color:#000000">            {<br></span><span style="color:#008080">12</span> <span style="color:#000000">                </span><span style="color:#0000ff">return</span><span style="color:#000000"> DNTRequest.GetInt(</span><span style="color:#800000">"</span><span style="color:#800000">page</span><span style="color:#800000">"</span><span style="color:#000000">, </span><span style="color:#800080">1</span><span style="color:#000000">);<br></span><span style="color:#008080">13</span> <span style="color:#000000">            }<br></span><span style="color:#008080">14</span> <span style="color:#000000">        }<br></span><span style="color:#008080">15</span> <span style="color:#000000">        </span><span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">void</span><span style="color:#000000"> GetPager()<br></span><span style="color:#008080">16</span> <span style="color:#000000">        {<br></span><span style="color:#008080">17</span> <span style="color:#000000">            </span><span style="color:#0000ff">int</span><span style="color:#000000"> PageCount </span><span style="color:#000000">=</span><span style="color:#000000"> (</span><span style="color:#0000ff">int</span><span style="color:#000000">)Math.Ceiling(RecordCount</span><span style="color:#000000">/</span><span style="color:#000000"> ((</span><span style="color:#0000ff">double</span><span style="color:#000000">)PageSize));<br></span><span style="color:#008080">18</span> <span style="color:#000000">            ViewData[</span><span style="color:#800000">"</span><span style="color:#800000">Page</span><span style="color:#800000">"</span><span style="color:#000000">] </span><span style="color:#000000">=</span><span style="color:#000000"> Utils.GetPageNumbers(CurPage, PageCount, GetUrl(), </span><span style="color:#800080">5</span><span style="color:#000000">);<br></span><span style="color:#008080">19</span> <span style="color:#000000">        }<br></span><span style="color:#008080">20</span> <span style="color:#000000">        </span><span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">string</span><span style="color:#000000"> GetUrl()<br></span><span style="color:#008080">21</span> <span style="color:#000000">        {<br></span><span style="color:#008080">22</span> <span style="color:#000000">            </span><span style="color:#0000ff">string</span><span style="color:#000000"> url </span><span style="color:#000000">=</span><span style="color:#000000"> Request.Url.ToString();<br></span><span style="color:#008080">23</span> <span style="color:#000000">            url </span><span style="color:#000000">=</span><span style="color:#000000"> url.Substring(url.LastIndexOf(</span><span style="color:#800000">"</span><span style="color:#800000">/</span><span style="color:#800000">"</span><span style="color:#000000">) </span><span style="color:#000000">+</span><span style="color:#000000"> </span><span style="color:#800080">1</span><span style="color:#000000">);<br></span><span style="color:#008080">24</span> <span style="color:#000000"><br></span><span style="color:#008080">25</span> <span style="color:#000000">            Regex reg </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">new</span><span style="color:#000000"> Regex(</span><span style="color:#800000">@"</span><span style="color:#800000">&amp;page=([0-9]+)</span><span style="color:#800000">"</span><span style="color:#000000">, RegexOptions.IgnoreCase);<br></span><span style="color:#008080">26</span> <span style="color:#000000">            Match m </span><span style="color:#000000">=</span><span style="color:#000000"> reg.Match(url);<br></span><span style="color:#008080">27</span> <span style="color:#000000">            </span><span style="color:#0000ff">if</span><span style="color:#000000"> (m.Success)<br></span><span style="color:#008080">28</span> <span style="color:#000000">            {<br></span><span style="color:#008080">29</span> <span style="color:#000000">                url </span><span style="color:#000000">=</span><span style="color:#000000"> url.Replace(m.Groups[</span><span style="color:#800080">0</span><span style="color:#000000">].Value, </span><span style="color:#800000">""</span><span style="color:#000000">);<br></span><span style="color:#008080">30</span> <span style="color:#000000">            }<br></span><span style="color:#008080">31</span> <span style="color:#000000">            reg </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">new</span><span style="color:#000000"> Regex(</span><span style="color:#800000">@"</span><span style="color:#800000">\?page=([0-9]+)</span><span style="color:#800000">"</span><span style="color:#000000">, RegexOptions.IgnoreCase);<br></span><span style="color:#008080">32</span> <span style="color:#000000">            m </span><span style="color:#000000">=</span><span style="color:#000000"> reg.Match(url);<br></span><span style="color:#008080">33</span> <span style="color:#000000">            </span><span style="color:#0000ff">if</span><span style="color:#000000"> (m.Success)<br></span><span style="color:#008080">34</span> <span style="color:#000000">            {<br></span><span style="color:#008080">35</span> <span style="color:#000000">                url </span><span style="color:#000000">=</span><span style="color:#000000"> url.Replace(m.Groups[</span><span style="color:#800080">0</span><span style="color:#000000">].Value, </span><span style="color:#800000">"</span><span style="color:#800000">?1=1</span><span style="color:#800000">"</span><span style="color:#000000">);<br></span><span style="color:#008080">36</span> <span style="color:#000000">            }<br></span><span style="color:#008080">37</span> <span style="color:#000000">            </span><span style="color:#0000ff">return</span><span style="color:#000000"> url;<br></span><span style="color:#008080">38</span> <span style="color:#000000">        }<br></span><span style="color:#008080">39</span> <span style="color:#000000">    }</span></div></div>


<p> </p>


<p>ArticleController.cs </p>


<p> </p>


<div><img src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt=""><img src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif"><span>代码</span>
<div>
<div><span style="color:#000000"> </span><span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">class</span><span style="color:#000000"> ArticleController : BaseController<br>    {<br>        </span><span style="color:#0000ff">protected</span><span style="color:#000000"> </span><span style="color:#0000ff">override</span><span style="color:#000000"> </span><span style="color:#0000ff">void</span><span style="color:#000000"> OnResultExecuting(ResultExecutingContext filterContext)<br>        {<br>            var cate</span><span style="color:#000000">=</span><span style="color:#000000">db.Category.ToList();<br>            cate.Insert(</span><span style="color:#800080">0</span><span style="color:#000000">,</span><span style="color:#0000ff">new</span><span style="color:#000000"> Category() {Id</span><span style="color:#000000">=</span><span style="color:#800080">0</span><span style="color:#000000">, Name</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">未设置</span><span style="color:#800000">"</span><span style="color:#000000">});<br>            ViewData[</span><span style="color:#800000">"</span><span style="color:#800000">category</span><span style="color:#800000">"</span><span style="color:#000000">] </span><span style="color:#000000">=</span><span style="color:#000000"> cate;<br>            </span><span style="color:#0000ff">base</span><span style="color:#000000">.OnResultExecuting(filterContext);<br>        <br>        }<br><br><br>       <br>        </span><span style="color:#0000ff">public</span><span style="color:#000000"> ActionResult Index(Article art)<br>        {<br><br>            ViewData[</span><span style="color:#800000">"</span><span style="color:#800000">searchModel</span><span style="color:#800000">"</span><span style="color:#000000">] </span><span style="color:#000000">=</span><span style="color:#000000"> art;<br>            var article </span><span style="color:#000000">=</span><span style="color:#000000"> db.Find</span><span style="color:#000000">&lt;</span><span style="color:#000000">Article</span><span style="color:#000000">&gt;</span><span style="color:#000000">(art);<br>            var list </span><span style="color:#000000">=</span><span style="color:#000000"> db.Article.Where(d </span><span style="color:#000000">=&gt;</span><span style="color:#000000">d.title.Contains(</span><span style="color:#800000">"</span><span style="color:#800000">22</span><span style="color:#800000">"</span><span style="color:#000000">));<br>            RecordCount </span><span style="color:#000000">=</span><span style="color:#000000"> article.Count();<br>            article </span><span style="color:#000000">=</span><span style="color:#000000"> article.Skip((CurPage </span><span style="color:#000000">-</span><span style="color:#000000"> </span><span style="color:#800080">1</span><span style="color:#000000">) </span><span style="color:#000000">*</span><span style="color:#000000"> PageSize).Take(PageSize);<br>            GetPager();<br>            </span><span style="color:#0000ff">return</span><span style="color:#000000"> View(</span><span style="color:#800000">"</span><span style="color:#800000">index</span><span style="color:#800000">"</span><span style="color:#000000">, article);<br>        }<br><br>        </span><span style="color:#008000">//</span><span style="color:#008000">public ActionResult Index()<br>        </span><span style="color:#008000">//</span><span style="color:#008000">{<br>        </span><span style="color:#008000">//</span><span style="color:#008000">    ViewData[&quot;searchModel&quot;] = new Article();<br>        </span><span style="color:#008000">//</span><span style="color:#008000">    var article = from d in db.Article<br>        </span><span style="color:#008000">//</span><span style="color:#008000">                  select d;<br>        </span><span style="color:#008000">//</span><span style="color:#008000">    RecordCount = article.Count();<br>       <br>        </span><span style="color:#008000">//</span><span style="color:#008000">    article = article.Skip((CurPage-1)*PageSize).Take(PageSize);<br>        </span><span style="color:#008000">//</span><span style="color:#008000">    GetPager();<br>        </span><span style="color:#008000">//</span><span style="color:#008000">    return View(&quot;index&quot;,article);<br><br>        </span><span style="color:#008000">//</span><span style="color:#008000">}</span><span style="color:#008000"><br></span><span style="color:#000000">        </span><span style="color:#0000ff">public</span><span style="color:#000000"> ActionResult Add()<br>        {<br>            Article art </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">new</span><span style="color:#000000"> Article();<br>            art.CreateTime </span><span style="color:#000000">=</span><span style="color:#000000"> DateTime.Now;<br>            </span><span style="color:#0000ff">return</span><span style="color:#000000"> View(art);<br>        }<br>        [HttpPost]<br>        [ValidateInput(</span><span style="color:#0000ff">false</span><span style="color:#000000">)]<br>        </span><span style="color:#0000ff">public</span><span style="color:#000000"> ActionResult Add(Article art)<br>        {<br>            </span><span style="color:#0000ff">try</span><span style="color:#000000"><br>            {<br>                </span><span style="color:#0000ff">if</span><span style="color:#000000"> (</span><span style="color:#0000ff">this</span><span style="color:#000000">.ModelState.IsValid)<br>                {<br>                    db.Article.InsertOnSubmit(art);<br>                    db.SubmitChanges();<br>                    </span><span style="color:#0000ff">return</span><span style="color:#000000"> RedirectToAction(</span><span style="color:#800000">"</span><span style="color:#800000">index</span><span style="color:#800000">"</span><span style="color:#000000">);<br>                }<br>                </span><span style="color:#0000ff">else</span><span style="color:#000000"><br>                {<br>                    </span><span style="color:#0000ff">return</span><span style="color:#000000"> View(art);<br>                }<br>            }<br>            </span><span style="color:#0000ff">catch</span><span style="color:#000000">(Exception e)<br>            {<br>                </span><span style="color:#0000ff">return</span><span style="color:#000000"> Content(e.Message);<br>            }<br>           <br>        }<br>        </span><span style="color:#0000ff">public</span><span style="color:#000000"> ActionResult Edit(</span><span style="color:#0000ff">int</span><span style="color:#000000"> id)<br>        {<br>            </span><span style="color:#0000ff">return</span><span style="color:#000000"> View(db.Article.FirstOrDefault(d</span><span style="color:#000000">=&gt;</span><span style="color:#000000">d.Id</span><span style="color:#000000">==</span><span style="color:#000000">id));<br>        }<br>        [HttpPost]<br>        [ValidateInput(</span><span style="color:#0000ff">false</span><span style="color:#000000">)]<br>        </span><span style="color:#0000ff">public</span><span style="color:#000000"> ActionResult Edit(</span><span style="color:#0000ff">int</span><span style="color:#000000"> id,Article art1)<br>        {<br>            </span><span style="color:#0000ff">try</span><span style="color:#000000"><br>            {<br>                Article art</span><span style="color:#000000">=</span><span style="color:#000000">db.Article.FirstOrDefault(d</span><span style="color:#000000">=&gt;</span><span style="color:#000000">d.Id</span><span style="color:#000000">==</span><span style="color:#000000">id);<br>                UpdateModel(art);<br>                db.SubmitChanges();<br>                </span><span style="color:#0000ff">return</span><span style="color:#000000"> </span><span style="color:#0000ff">this</span><span style="color:#000000">.RedirectToAction(</span><span style="color:#800000">"</span><span style="color:#800000">index</span><span style="color:#800000">"</span><span style="color:#000000">);<br>            }<br>            </span><span style="color:#0000ff">catch</span><span style="color:#000000"><br>            {<br>                </span><span style="color:#0000ff">return</span><span style="color:#000000"> View(art1);<br>            }<br>        }<br>        </span><span style="color:#0000ff">public</span><span style="color:#000000"> ActionResult Delete(</span><span style="color:#0000ff">int</span><span style="color:#000000"> id)<br>        {<br>           db.Article.DeleteOnSubmit(db.Article.FirstOrDefault(d </span><span style="color:#000000">=&gt;</span><span style="color:#000000"> d.Id </span><span style="color:#000000">==</span><span style="color:#000000"> id));<br>           db.SubmitChanges();<br>         </span><span style="color:#0000ff">return</span><span style="color:#000000"> RedirectToAction(</span><span style="color:#800000">"</span><span style="color:#800000">index</span><span style="color:#800000">"</span><span style="color:#000000">);<br>        }<br><br>    }</span></div></div></div>


<p> </p>


<p> </p>


<p> <img src="http://www.cnblogs.com/wangjikun3/aggbug/1770532.html?type=1" width="1" height="1" alt=""><p>评论: 0　<a href="http://www.cnblogs.com/wangjikun3/archive/2010/07/03/1770532.html#pagedcomment">查看评论</a>　<a href="http://www.cnblogs.com/wangjikun3/archive/2010/07/03/1770532.html#commentform">发表评论</a></p><p><a href="http://mpd.cnblogs.com/">软件研发团队管理年会(上海，7.10-7.11)</a></p><hr><p>最新新闻：<br>· <a href="http://news.cnblogs.com/n/67519/">苹果雷人解释：公式差错致iPhone信号失常</a><span style="color:gray">(2010-07-03 18:55)</span><br>· <a href="http://news.cnblogs.com/n/67518/">网易回应黑客攻击事件：员工电脑被入侵所致</a><span style="color:gray">(2010-07-03 18:52)</span><br>· <a href="http://news.cnblogs.com/n/67517/">网易四大邮箱集体遭入侵 黑客留言称只是玩笑</a><span style="color:gray">(2010-07-03 16:19)</span><br>· <a href="http://news.cnblogs.com/n/67516/">微软KIN手机的生与死：高层勾心斗角</a><span style="color:gray">(2010-07-03 16:07)</span><br>· <a href="http://news.cnblogs.com/n/67512/">腾讯投资韩国7家网游公司</a><span style="color:gray">(2010-07-03 15:15)</span><br></p><p>编辑推荐：<a href="http://www.cnblogs.com/sumtec/archive/2010/07/02/1768490.html">老调重弹——如何面试（一）</a><br></p><p>网站导航：<a href="http://www.cnblogs.com">博客园首页</a>  <a href="http://home.cnblogs.com/">个人主页</a>  <a href="http://news.cnblogs.com">新闻</a>  <a href="http://home.cnblogs.com/ing/">闪存</a>  <a href="http://home.cnblogs.com/group/">小组</a>  <a href="http://space.cnblogs.com/q/">博问</a>  <a href="http://space.cnblogs.com">社区</a>  <a href="http://kb.cnblogs.com">知识库</a></p></p>

</div>


            <div class="footer">
              <div class="contact">
                <p>
                  Your Name<br />
                  What You Are<br />
                  your@email.com
                </p>
              </div>
              <div class="contact">
                <p>
                  <a href="http://github.com/lyuehh/">github.com/lyuehh</a><br />
                  <a href="http://twitter.com/lyuehh/">twitter.com/lyuehh</a><br />
                </p>
              </div>
            </div>
          </div>
        </div> <!-- /container -->

    </body>
</html>
