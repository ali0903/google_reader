<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>PuTTY 中文教程</title>
        <meta name="viewport" content="width=device-width">

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/google_reader/css/syntax.css">

        <!-- Custom CSS -->
        <link rel="stylesheet" href="/google_reader/css/main.css">

    </head>
    <body>

        <div class="container">
          <div class="site">
            <div class="header">
              <h1 class="title"><a href="/google_reader/">Google Reader</a></h1>
              <a class="extra" href="/google_reader/">home</a>
            </div>

                <h2>PuTTY 中文教程</h2>
<p class="meta">2010-07-08 09:16</p>

<div class="post">
<h2>PuTTY 中文教程</h2>

<h3>by GFW BLOG 功夫网</h3>

<h3>at 2010-07-08 01:16:42</h3>

<h3>original <a href="http://feedproxy.google.com/~r/chinagfwblog/~3/JOmiHNra9jE/putty.html">http://feedproxy.google.com/~r/chinagfwblog/~3/JOmiHNra9jE/putty.html</a></h3>

<p>来源：<a href="http://www.bzxy.net/index.php?article/netshool/2010-07-08/16631.html">http://www.bzxy.net/index.php?article/netshool/2010-07-08/16631.html</a><br><br>转自：[url]<a href="http://blog.csdn.net/slancer/archive/2007/07/16">http://blog.csdn.net/slancer/archive/2007/07/16</a> /1694169.aspx[/url] <br><h2>序言 </h2>懒，是一个优点，有些时候还是要学一学才能会了的。  <br>                                                  ——  柴锋（1979-       ）   <br>我的这些文字是从这几年来的 PuTTY 使用经验中慢慢得来的，也不仅仅是介绍  PuTTY，还包括了一些相关的软件，比如：优秀的 FTP 工具 FileZilla、功能强大的 SFTP 客户端 WinSCP。  <br>杂七 杂八的乱说了一些，这里把大致内容罗列如下：  <br><ul><li>最简单的使用，登录 SSH 主机 </li><li>中文乱码的处理 </li><li>PuTTY  常用配置的说明 <ul><li>复制、粘贴 </li><li>保存会话 </li><li>注销 </li><li>自动登录用户名 </li><li>自 动设置环境变量 </li><li>设置代理服务器 </li><li>自动执行命令 </li><li>备份、删除 PuTTY 的设置<br></li></ul>  </li><li>PuTTY 的 X11 转发<br> </li><li>如何用 PuTTY 建立 SSH 隧道 </li><li>如何用  PuTTY 建立反向的 SSH 隧道，像个特洛伊木马一样突破防火墙 </li><li>把 PuTTY 作为一个安全的代理服务器 <ul><li>安 全的上网不被嗅探<br> </li><li>避免 MSN 等聊天工具被监听<br></li></ul> </li><li>怎样用  PSCP、PSFTP 安全的传输文件 <ul><li>功能强大的 SFTP 客户端 WinSCP<br></li></ul> </li><li>用  PuTTYgen 生成密钥，登录 SSH 主机不再需要口令<br> </li><li>Pagent 代理密钥，每次开机只需要输入一次密钥口令 </li><li>Plink  简单而又迅速的执行 SSH 主机上的程序 </li><li>常见问题<br></li></ul>除了上面的这些，还夹杂了一些 PuTTY  使用上的技巧、服务器配置的一些安全建议。说起来这是一些有关 PuTTY 的使用教程，其实也就是 SSH  的参考教程，绝大多数的内容在其他系统或软件上也都是一样的。不同的是参数、配置、命令行之类的，只要会了一个，其他也就触类旁通了。<br> <br><h2>一些基本知识 </h2>如果你已经知道 SSH、Telnet、Rlogin 这是什么，就跳过这一部分，看下面的吧。  <br>(以后补充，暂时空 下)<br>   <br><h2>简介 </h2>PuTTY  的官方网站：[url]<a href="http://www.chiark.greenend.org.uk/~sgtatham/putty/%5B/url%5D">http://www.chiark.greenend.org.uk/~sgtatham/putty/[/url]</a>，截止到 <strike>2006 年11月，发布的最高稳定版本是 0.58</strike> 2007年6月，发布的最高稳定版本是 0.6。<br>PuTTY  是一个跨平台的远程登录工具，包含了一组程序，包括：<br> <br><ul><li>PuTTY (Telnet 和 SSH 客户端) </li><li>PSCP  (SCP 客户端, 命令行下通过 SSH 拷贝文件，类似于 Unix/Linux 下的 scp 命令) </li><li>PSFTP  (SFTP 的命令行客户端，类似于 FTP 的文件传输，只不过使用的是 SSH 的 22 端口，而非 FTP 的 21 端口，类似于  Unix/Linux 下的 sftp 命令) </li><li>PuTTYtel (仅仅是一个 Telnet 客户端) </li><li>Plink  (命令行工具，执行远程服务器上的命令) </li><li>Pageant (PuTTY、PSCP、Plink 的 SSH  认证代理，用这个可以不用每次都输入口令了) </li><li>PuTTYgen (用来生成 RSA 和 DSA 密钥的工具). </li></ul>虽 然包含了这么多，但平时经常见到只是用 PuTTY 登录服务器，完全没有发挥出 PuTTY 的强大功能。<br>PuTTY  作为一个组件也存在于很多的软件中，比如 FileZilla、WinSCP<br>在后面的文字中，如非特别说明，默认的登录的协议是 SSH。毕竟用  PuTTY 主要就是登录 SSH 主机，用 Telnet、RLogin 没法体现出 PuTTY 的强大功能。<br> <br><h2>安装 </h2>下载页面在这里：[url]<a href="http://www.chiark.greenend.org.uk/~sgtatham/putty">http://www.chiark.greenend.org.uk/~sgtatham/putty</a> /download.html[/url]<br>PuTTY 需要安装么？需要么？需要么？真的需要么？不需要。PuTTY  是一个准绿色软件，说它绿色是因为直接就能使用，完全没有任何的安装程序。准绿色是指 PuTTY  的所有配置都保存到了注册表，如果不记得备份注册表中的相关内容，下次重装机器所有配置就没了，而且配置也不方便用闪存盘随身携带。但是 PuTTY  的配置删除还是蛮方便的，运行时指定个参数 -cleanup 就可以清除 PuTTY 的所有配置信息。<br> <br><h2>第一印象，开始登录 一台远程主机 </h2>运行 PuTTY 就可以看到下面这个界面<br><br>在这里输入服务器的 IP  或主机名，选择好登录协议，还有协议的端口，如果希望把这次的输入保存起来，以后就不需要再重新输入了，就在第4步输入好会话保存的名称，比 如：mail-server，或者干脆就是主机的地址，点击保存就可以了。<br><br>最后点下面的 Open  按钮，输入正确的用户名和口令，就可以登录服务器了。<br> <br><h2>首次登录一台主机时 </h2>第一次登录时，会看到这个对话框<br><br>这是要告诉你登录的主机密钥指纹，点 Yes 就保存起来，以后就不会再弹出这个窗口，然后就正常登录。点 No  不保存，下次还是要提示你，然后也可以正常登录。如果一台主机我们只是临时登录一下，当然就是点 No 了。Cancel  就是取消，也就是取消了这次登录。<br>如果你曾经登录过这台主机，但是又弹出来这个对话框，可能有以下几种情形：<br> <br><ul><li>主 机重新安装了操作系统 </li><li>这台主机可能有多个IP，这次用的是另外一个 IP </li><li>有其他不怀好意的主机来冒充，诱骗我们 登录，窃取隐秘信息<br></li></ul>前两个情形很常见，一般点 Yes 就行了。后面这个嘛……唔……唔……，点  No/Cancel，再去询问相关的主机管理人员。<br> <br><h2>又看到了中文乱码 </h2>成功登录主机后，输入命令，这……这……显 示，又是乱码。唉，中文乱码是一个老生常谈的问题，提起来就头大。原因嘛，不外乎字符集、终端编码之类的，还是可以解决的。<br><br>PuTTY 的默认字体和字符集并不适合中文显示， 在窗口标题上点击右键，选择 Change Settings...<br><br>在打开的配置窗口左边选择  Appearance，在右边点 Font settings 里面的 Change 按钮，选择好中文字体，比如：宋体、新宋体之类的<br><br>字体选择好了，还要确定字符集。<br>选择配置窗口左边的 Translation，在右边的 Received  data assumed to be in which character set 下拉列表中选择最后一个“Use font  encoding”，最后点下面的 Apply 按钮就生效了。<br><br>重新执行命令 ls -l，就可以正常看到中文了<br><br><h2>怎么还是乱码？ </h2>如果还是乱码的话，就执行以下命令，看看系统的字符集<br>echo  $LANG $LANGUAGE<br><br>哦，原来系统的字符集是 UTF-8 呀。重新返回上面选择字符集的那一步， 选择配置窗口左边的  Translation，在右边的 Received data assumed to be in which character set  下拉列表中选择“UTF-8”<br><br>这下99%的情形下，汉字是不会有乱码了。最后，总之一下  PuTTY 中乱码的解决办法：<br>先看看系统的字符集，如果是 UTF-8 的，那就简单了，选择好中文字体，然后编码选择 UTF-8 就行了。<br>如 果编码是 GB2312、GBK、GB18030，当然也包括 BIG5这些，在 PuTTY 的编码选择中看不到这些编码，那就选择最后一个“Use  font encoding”，绝大部分情况下这样就没啥问题了，反正我是没碰到有什么例外的情况。<br>现在的 Linux  如果默认语言选择为中文，默认的编码就是 UTF-8 了。以前安装 Redhat AS 3 时，语言选择为中文，默认的编码是  zh_CN.gb2312, zh_CN.gb18030，好像从 AS 3 update 6 开始，包括现在的  AS4、AS5，中文的默认编码都成了 zh_CN.utf8。至于 Debian、Ubuntu 等等这些上面，好像一直都是 UTF-8。<br>至 于是使用 UTF-8呢，还是用 GB2312、GBK 或者 GB18030呢？我个人还是倾向于  UTF-8。毕竟我们使用的大多数软件都是国外的，处理中文编码多多少少有些问题，PuTTY 自然也不例外。<br>下面的这个图上，我把终端编码修改 为 zh_CN.utf8，然后也按照前面的所说的方法把 PuTTY 的字符集修改为  UTF-8。然后在终端中输入汉字“柴锋”，按左方向键，可以看到汉字显示很正常。<br><br>我重新把终端的编码修改为 zh_CN.gb2312，同样的，把  PuTTY 的字符集修改为最后一个“Use font encoding”。还是在终端上输入汉字“柴锋”，按下左方向键以后，会看到汉字乱码了。<br><br>至于用哪个编码，主要还是 看领导的决定了，我们的领导就喜欢 GBK，连 GB18030 都不行。以前在用 Debian 的时候，好像默认都不支持 GBK  编码。这几年公司的开发在汉字编码问题上出过几次麻烦，还不就是在 ISO8859-1,  GB2312/GBK/GB18030和UTF-8上折腾来折腾去。<br>给大家看一张 emacs  的截图，看看上面的这么多语言的文字共同显示，这个会是用 GB2312/GBK/GB18030 的编码么？<br><br>用 UTF-8  也不是为了要在一个屏幕上显示好几种不认识的文字，也不一定非要是跟国际接轨弄个外包给老外开发程序做个其他语言的界面让老外用，起码不要在那么多编码里 折腾了，顶多两个 ISO8859-1 和 UTF-8。发发牢骚，下面继续……<br> <br><h2>在 PuTTY 里面怎样选中，复制和粘贴？  </h2>在 PuTTY 的窗口里面复制、粘贴可不能用 Windows 里的这些 Ctrl+C, Ctrl+Ins, Ctrl+V  这些快捷键，Ctrl+C 在控制台上可是终止当前的命令执行。<br>PuTTY 的选择、复制、粘贴这些操作都是通过鼠标来完成的。<br>在  Window-〉Selection 这里可以设置复制和粘贴的方式。<br><br>默认的 Action of mouse buttons  （鼠标按键的功能）的选项是  Compromise，这种方式下选中有两种方式，一是直接用鼠标左键拖拉选中就可以了，二是用鼠标中键单击选中区域的开头，用滚动条拖拉到期望选中区域 的末尾，再用鼠标中键单击，就可以选中了。<br>选中以后，单击鼠标左键就把选中部分复制到剪贴板了。粘贴也很简单，单击鼠标右键。<br>Action  of mouse buttons 的第一个选项是 Windows （Windows  方式的），鼠标中键的操作跟前面提到的一样。右键不是粘贴了，而是打开了右键菜单。<br><br>其实这个右键菜单在标题栏上点击，也都可以看得到。<br><br>第三个选项是  xterm （xterm 方式），这个跟默认的 Compromise 方式相反的，中键和右键的操作调换了一下，就不多说了。<br>下面那个  Shift overrides application&amp;#39;s use of mouse 是和 Shift 键有关的。有些 Rogue Like  的程序，比如 mc、links、Lynx、VIM  等等，都支持鼠标操作，想在用鼠标在上面选择或粘贴就不行了。这个选项默认是选中的，在支持鼠标操作的 Rogue Like 界面下，按住 Shift  键，就可以像前面的那样用鼠标来选择、复制、粘贴了。<br>看下面的这个图片，用 Links 打开了 Google 的首页，用鼠标去选中  顶部中间的 Google，我们会发现，弹出了保存的对话框。<br><br>按住 Shift 键重新操作一次，哈哈，这次选中了。<br><br>在 Control use  of mouse 里面还有个 Default selection mode （默认的选择模式），默认是  Normal，就像文字处理工具里这样的选择<br><br>另外一个是 Rectangular  block（块选择方式），至于用哪种方式就看自己的选择了。<br><br><h1>实时保存会话 </h1>这次更改配置参数了，关 闭窗口后，下次使用还是要重新选择的，麻烦。<br>还是回到上面修改配置的哪个地方，选择左边的  Session，在右边选择要覆盖的会话名称，或者重新输入一个新的名称，点击 Save 按钮保存。<br> <br><h2>关于注销登录的一些事情 </h2>成功登录主机后，也能正常看到中文了。这样， 我们就可以完成大部分的工作。最后要关闭窗口了，该怎么办呢？我见过很多人，包括我们公司负责专职维护的同事，都是直接点击窗口上的关闭按钮，完全没有理 会弹出警告窗口，直接点击了 Yes。<br><br>这样做是不对的，首先这不是正确的注销方式，应该输入命令 exit  来正常注销；其次直接关闭窗口后，你的登录其实还在服务器上，如果一连多次的这样强制关闭窗口，用命令 w 或者 who  命令查看时，可以看到很多的用户还在系统上登录，占用了系统的资源。最重要的是，你的这次登录可能只是为了启动一下 WebLogic  或者其他什么应用服务器，直接关闭窗口后，可能会导致你的业务在随后的几分钟内也被终止，这应该不是你所希望看到的吧。<br>如果上述的理由是每次要输 入 exit 然后回车，比较麻烦。你可以用快捷键 Ctrl+d 来注销登录，一般情况下，快捷键一按窗口都直接关闭了，还省了两次鼠标点击。<br>在 前面说道保存会话时，大家或许也注意到，下面有个 Close window on exit 有三个选项：<br> <br><ul><li>Always  （不管怎样，窗口总是要关闭的） </li><li>Never （无论是否有程序还在运行，都不要关闭窗口） </li><li>Only on  clear exit （这个是默认选中的，只有在本次登录中运行的程序都正常终止或者在后台运行，窗口才关闭）<br></li></ul>有的程序在 执行时，虽然在命令最后面加上  “&amp;”就能放到后台运行。但是正常注销登录后，窗口没有被自动关闭，还能看到程序的输出，这时强制关闭窗口还是可以的。为了避免这种情形，可以使 用 nohup 命令。<br>用法嘛就是： nohup 命令 命令参数，这样就可以了。<br> <br><h2>窗口保存的输出有点少，前面的都看 不到了 </h2>执行了一个命令，输出了好多东西，但是默认的配置下，PuTTY只保存了最后200行的内容，满足不了我们的需求。<br>还是在标题 栏上点右键选择 Change settings...，在配置窗口的左边选择 Window，修改右边的 Lines of  scrollback，改大点，比如 20000、80000的<br><br>在上面的 Set the size of the window 里设置的是窗口显示的行数和列数，默认是 24  行、80 列，根据自己的需要来修改吧。<br>When window is resized  这个选项配置的是，当窗口大小发生改变时该采取什么动作。<br> <br><ul><li>Change the number of rows  and columns（这个是默认的，改变窗口大小时，自动修改行数和列数） </li><li>Change the size of the  font（这个是根据窗口的大小来修改字体的大小，窗口最大化的时候，字都是很大的） </li><li>Change font size only  when maximised（只有在窗口最大化的时候才改变字体大小） </li><li>Forbid resizing  completely（完全禁止改变窗口大小，一了百了） </li></ul>在现代的 Unix/Linux  主机上，默认选项已经不存在任何问题了。如果是 Solaris 8 这样的老式 Unix 上最好用第2或第4个选项。<br>第3个选项嘛，要求你的 屏幕不是宽屏的，选中这个选项以后，大家可以先把窗口往窄的缩一下，然后最大化窗口，哈哈，满足一下不是宽屏的虚荣心。<br>顺便说一下，在  PuTTY 中的前后翻页，与 Linux 终端一样，用 Shift+PageUp/PageDown 来上下翻页，而  Ctrl+PageUp/PageDown 则是一行一行的。<br> <br><h2>新建一个会话时，还有些东西再�嗦一下 </h2>前面把如何用  PuTTY 登录一台主机到注销的过程聊了一遍，但是在新建会话时还是有些东西需要再�嗦一下的。<br> <br><h3>保持连接，不要自动断开 </h3>在  Connection 里面有个 Seconds between  keepaliaves，这里就是每间隔指定的秒数，就给服务器发送一个空的数据包，来保持连接。以免登录的主机那边在长时间没接到数据后，会自动断开  SSH 的连接。<br>默认输入 0 是禁用保持连接，在这里我习惯的设置了 10。<br>下面的那两个复选框都保持默认选中吧。<br><br><h3>自动登录用户  </h3>在 Connection-〉Data 里面有个 Auto-login  username，可以指定默认的登录用户。如果每次登录主机都是用同一个用户，不妨在这里设置一下。SSH、Telnet、Rlogin  这三种协议都支持，但不是所有的 Telnet 服务器支持自动登录用户<br> <br><h3>自动设置环境变量 </h3>还 是前面的那个界面，下面有个 Environment variables，在 Variable  输入环境变量的名称，Value里设置上环境变量的值，登录主机后就会自动设置上，但是这个不一定能用，有些主机为了安全，可能会禁用这个特性，一旦登录 就会收到这样一个错误提示：<br> <br><blockquote>Server refused to set environment  variables<br></blockquote><h3>设置代理服务器 </h3>这个经常用到，设置方法大同小异，注意选择好 Proxy  type（代理服务器的类型）就可以了。<br>代理服务器的地址填写到 Proxy hostname 这里，Port  就是代理服务的端口（HTTP代理常用端口有 3128、8080，Socks5代理常用端口有 1080）<br>Exclude Hosts/IPs  这里是填写排除的主机地址和IP，有些地址不需要代理，就在这里填写。<br>有些代理需要认证，用户名填写到 Username，密码则填写到下面的  Password。<br> <br><h3>自动执行一个命令 </h3>在  Connection-〉SSH 里有个 Remote command，在这里面填写上远程服务器上的某个命令，比如：df，登录后就会自动执行。<br>我 们在 Unix 上用 ssh 登录主机时用的命令 ssh，在 ssh 的最后面加上远程主机上的命令，就跟这个一样。<br>但是……，先别着急，一 旦设置上这个选项，你会发现在登录成功后，窗口一下就关闭了，嘿，怎么啦？什么也没看见。<br>因为命令执行完毕的同时，本次 SSH  登录连接也随之关闭。<br><br>你 可以把远程自动执行的命令修改成 sleep 10，然后重新登录，再看看效果。<br>登录成功后，没有出现命令提示符，10秒钟后，窗口自动关闭。这 也验证了刚才我说的，命令执行完毕后，SSH 连接自动断开。<br>冰雪聪明的你一定会想到，如果每次登录主机，都是要重新启动一下  tomcat，那这里就可以填写上这样的命令：<br> <br><blockquote>export  CATALINA_HOME=&amp;quot;~/apache-tomcat-5.5.17&amp;quot;;export  JAVA_HOME=&amp;quot;~/jdk1.5.0_07&amp;quot;;export PATH=$JAVA_HOME/bin;$PATH ; cd  $CATALINA_HOME/bin;./shutdown.sh;./startup.sh;tail -f  $CATALINA_HOME/logs/catalina.out<br></blockquote>（上面的命令是一行的哦）<br>先自动设置一下 环境变量（前面有提到，服务器可能会禁用自动设置环境变量，为了保险起见，在这里设置了一下），然后进入 tomcat 的 bin 目录，用  shutdown.sh 停止 tomcat，然后再 startup.sh 启动 tomcat，最后 tail 命令持续观察 tomcat  的日志输出，不想看了，就直接 Ctrl+C 就可以终止 SSH 的会话了。<br>哈哈，是不是很方便？<br>不过前面提到的命令 sleep  10，只是建立了 SSH 连接，然后 10 秒钟后自动断开。是不是觉得很无聊没什么用途啊？其实这个命令配合后面提到的  Tunnels（隧道），可以自动保持隧道一定时间的开放，如果指定时间内（在这里就是 10 秒钟）隧道没有被使用，就自动关闭 SSH 连接和隧道。<br>如 果选中了 Don&amp;#39;t start a shell or command at all 就禁用了自动执行命令这一个特性，这个主要是配合  Tunnels （隧道）来使用的。因为有时候，我们只需要利用隧道建立一个  VPN，而并不需要登录上去执行命令。用这个方法建立好隧道以后，就一直开放了，除非自己手工关闭。<br><br>嗯，还有个问题哦，如果一次要执行的命令 很多，该怎么办呢？嗯，给 PuTTY 用 -m 选项指定一个包含远程主机上执行的命令的文本文件。不过以后还会说到  Plink，就是专门做这个用的，慢慢来慢慢来。<br> <br><h3>数据自动压缩传输，变相的提高传输速率 </h3>还是前面的那个界 面，Protocol options 里面有个 Enable  compression，这个选项的意思就是传输时压缩数据，在连接速度不变的情况下，变相的提高了传输速率。一般的 SSH  服务器都会允许这个选项的，所以还是选中好了。<br> <br><h3>无需口令登录 </h3>在  Connection-〉SSH-〉Auth 这里面有两个需要了解的，以后在讲到 PuTTYGEN 和 Pagent 时会详细介绍的。<br>一个 是 Allow agent forwarding，作用是允许私钥代理的转发。<br>另外一个是最下面的 Private key file for  authentication，选择私钥认证文件。<br>这两个可以让你用 SSH  登录不用输入主机口令，但是私钥的口令还是需要输入的，如果使用了私钥代理 Pagent  ，私钥口令也可以省略。再配合前面提到的自动指定用户名登录，可以实现自动登录主机。登录到主机上以后，用 SSH  登录另外一个同样配置了相同的私钥认证的主机，也可以不用再次输入口令。<br>这些可以大大减轻了我们的重复工作，不用单调枯燥的输入用户名和口令，但 是这样使用有个后遗症就是如果主机密码没有在另外一个地方记录下来的话，这个密码很快会忘记的，好处嘛，密码可以设置的很长很变态 XD。<br> <br><h3>X11 转发能够让你在 Windows 上使用  Linux 的程序 </h3>这里很简单，选中 Enable X11 forwarding 后登录主机，记得在我们本地运行 X  服务端程序（比如：免费好用的 Xming）。<br><br>然后在控制台直接输入 X  环境下运行的程序，比如：xlogo，我们就可以看到 Linux 上的GUI界面的程序在Windows桌面上打开了。<br> <br>运行个复杂的，比如 gnome-session，这个是  GNOME 的启动命令，如果想打开 KDE 就是 startkde<br> <br>这样跟在本地使用 X Window  几乎是一样的了，而且还是运行在 Windows 的桌面上呢，骗骗小 mm 还是不错的。或许你会问这样用跟 vnc  那还不一样了？答案是，不一样。如果网络环境不好，还是用vnc吧，否则迟钝的图形响应速度会让你抓狂的。<br> <br>打开了 GNOME  桌面，怎么关闭呢？点菜单的注销吧。如果你点了关机，这可关不了你的Windows，关的是远程主机。<br> <br><h3>用 SSH  Tunnels（SSH 隧道），突破防火墙 </h3>哇哦，突破防火墙！是不是忽然有了做黑客的感觉呢？呀！子弹，我躲——，身子往后仰，继续 闪……，噢，肚皮被子弹蹭了一下。<br>简单的说一下，SSH 协议能够通过已经建立好的 SSH  加密链路来转发任意的网络连接，从而避免了网络中的明文传输，也就无法用一些 Sniffer 工具嗅探到我们的隐秘信息了。<br>先说一下大致的使用 过程，登录到主机上以后，就可以建立好一个 SSH  隧道，这时在你的机器本地会开放一个端口，通过本地的这个端口访问，就相当于在主机上去直接访问。很像代理服务器吧，如果隧道另一端的端口是动态 的，SSH 隧道就是一个代理了，SSH 隧道的意思大致就是这个。通过 SSH 隧道，我们可以保证从我们这一段到主机那一端是安全的，不会被监听到。<br>说 了这么多，实际演练演练就知道了。在 PuTTY 的 Connection-〉SSH-〉Tunnels 这里就是配置 SSH 隧道的。<br>Add  new forwarded port 这里就是添加隧道转发端口的，其中 Source port  是隧道的源端口，也就是隧道的入口，连接隧道时要连接这个端口。Destination 这里是目的地，隧道的出口，输入的格式是：  server:port。<br>还要说明的一点是 SSH 隧道是有方向的，这个方向是由下面的单选按钮 Local/Remote/Dynamic  来决定的。如果下面的单选按钮选中的是 Local，那么 Destination  这里填写的目标是相对于远程主机而言，而非你的机器。这样的隧道可以称之为正向隧道，隧道的入口是在你的本地，出口在远程主机那一端。如果单选按钮选中的 是  Remote，那么目标地址就是相对与你的机器而言，而非远程主机。这样的隧道称之为反向隧道，隧道的入口是远程主机那一端，隧道的出口则是你的本地机 器。这与 Local 选项是相反的。而最后一个 Dynamic 则不用指明 Destination  目标地址，也就是说目标地址是动态的了，连入隧道时可以随意指定目标地址，而不像 Local/Remote  指明的固定目标地址，所以这样的隧道就成了变相的加密 socks5 代理服务器了。<br>看明白了么？是不是会有些糊涂？后面我会举个例子来详细说说 的。<br><br>开始演 练，我们现在建立一条到远程主机 guantouping 上端口 7001 的隧道，在 guantouping 上可以用 nc -l -p  7001 localhost 这条命令建立一个监听本地到端口 7001 的连接，这样确保无法从其他机器访问这台主机的端口，只能在  guantouping 这台主机上用 telnet localhost 7001 来连接。现在我的机器 IP 是  192.168.6.25，如果直接用命令 telnet guantouping 7001 访问的话，那么在主机 guantouping  上会看到这样的提示：<br> <br><blockquote>[taylor@guantouping taylor]$ nc -l -p  7001 localhost<br>invalid connection to [192.168.6.200] from (UNKNOWN)  [192.168.6.25] 1926<br></blockquote>在这个配置面板上， <strong>Source port 上填写  8080</strong>，也就是我们要通过本地的 8080 端口来进入 SSH 隧道， <strong>Destination 这里填上  <a href="http://127.0.0.1:7001">127.0.0.1:7001</a></strong>，就表示被登录的主机 guantouping 访问该主机本地的 <a href="http://127.0.0.1:7001">127.0.0.1:7001</a>  这个端口。正常登录到主机 guantouping 以后，SSH 隧道就建立好了。<strong>在我的机器 192.168.6.25 上输入命令  telnet localhost 8080</strong>，输入一些东西，就会在 guantouping 上看到有响应。在这里我用的是  nc，看起来方便一点，telnet 也是一样的。<br><br>这就是正向 SSH  隧道的一个例子，大家实地操作几次也就会明白了。最上面有个复选框是“Local ports accept connections from  other  hosts”，这个选项的作用是允许其他主机连接你机器上的隧道入口，默认情况下建立好隧道以后，只允许本地链接。只有选中这个复选框才允许其他主机连接 你的本地隧道入口。<br> <br><h2>象特洛伊木马一样建立一条 SSH 反向隧道 </h2>下面要说的就是选中单选按钮 Remote  后建立的反向 SSH  隧道，这样的隧道做什么用呢？一般防火墙都是允许从内往外链接，而不允许从外到内的链接，除非在防火墙上做好nat或端口转发。现在，你在防火墙的内部， 但是又想让外面的人链接到你的机器上。防火墙厚厚的城门紧闭，外面的人进不来，只有你能从里面打开这扇防护严密的大门，就像一个特洛伊木马一样，你主动连 接出去建立一个反向的 SSH 隧道，然后外面的人就可以通过这个反向的 SSH 隧道轻松突破防火墙链接到的你的本地机器。看下面这个图：<br> <br>在 Source port 这里填写  8080，也就是隧道的入口是端口8080，Destination 这里填写 localhost:7001，也就是隧道的出口是本地的 7001  端口，下面的单选按钮要选中 Remote，表示建立的隧道是个反向隧道，填写完毕别忘记点 Add 按钮，在上面就可以看到显示的是 R8080  localhost:7001。成功登录远程主机 guantouping 后，反向隧道就建立好了。在远程主机 guantouping 上输入命令  telnet localhost 8080 就可以连接到你的本地端口7001。<br> <br>哈哈，这样一个特洛伊木马般的反向 SSH  隧道就建立完毕了。我们在远程主机上连接 8080 端口，其实就连接到了我们本地机器的7001  端口了。上面共有两个复选框，我们提到了一个，已经说了，选中以后就允许其他机器连接隧道入口了。那第二个“Remote ports do the  same (SSH-2  only)”，则是给反向隧道使用的，也就是说远程主机的那个反响隧道入口也做同样的事情，也就是允许其他机器连接远程主机上的反向隧道入口，不过一般情 况下这个选项都不会起作用的 ^_^。<br> <br><h2>把 PuTTY 作为一个安全的代理服务器来使用 </h2>这个简单，在  Source port 那里填写上 1080，Destination 这里空下不填，选中下面的 Dynamic，最后别忘了点 Add 按钮。<br>  <br>登录远程主机后，一个代理服务器就建立好了，这个代理服务器的地址 就是 localhost:1080，还是加密的哦。据说国外某著名的主机供应商就提供远程的 SSH 链接，通过这个方法我们就建立了一个加密的  socks5 代理，可以轻松绕过万恶的 GFW 去拥抱 Wikipedia，波～～～，来一口。<br> <br><h3>设置 PuTTY  的默认设置 </h3>每次登录主机，无一例外的修改字体，修改字符集，修改窗口的大小，指定私钥文件，允许 X11 转发，……<br>几台 主机还好说，几十个上百个主机这样三天两头的设置也会让唐僧烦了的。<br>选中一个先前配置好的会话，点 Loa             <div>翻墙利器"赛风"（数字时代版）新址：http://ifuwocheng.info。被墙网站收集：http://delicious.com/GFWbookmark，请使用GFWlist为标签，帮助我们收集被墙网站的信息。敬请订阅GFW Blog：http://feeds2.feedburner.com/chinagfwblog，邮件订阅：https://groups.google.com/group/gfw-blog。更多翻墙工具介绍和下载：
推客浏览器（http://twitbrowser.net/blog/，墙内镜像：http://tm005.nl.am/)，Sesawe（http://www.sesawwe.net/）。翻墙互助小组邮件列表: http://groups.google.com/group/bypassgfw。<img width="1" height="1" src="https://blogger.googleusercontent.com/tracker/5500297126185736776-6195247952481051117?l=www.chinagfw.org" alt=""></div><img src="http://feeds.feedburner.com/~r/chinagfwblog/~4/JOmiHNra9jE" height="1" width="1"></p>

</div>


            <div class="footer">
              <div class="contact">
                <p>
                  Your Name<br />
                  What You Are<br />
                  your@email.com
                </p>
              </div>
              <div class="contact">
                <p>
                  <a href="http://github.com/lyuehh/">github.com/lyuehh</a><br />
                  <a href="http://twitter.com/lyuehh/">twitter.com/lyuehh</a><br />
                </p>
              </div>
            </div>
          </div>
        </div> <!-- /container -->

    </body>
</html>
