<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>使用纯XAML标记实现数据验证错误提示</title>
        <meta name="viewport" content="width=device-width">

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/google_reader/css/syntax.css">

        <!-- Custom CSS -->
        <link rel="stylesheet" href="/google_reader/css/main.css">

    </head>
    <body>

        <div class="container">
          <div class="site">
            <div class="header">
              <h1 class="title"><a href="/google_reader/">Google Reader</a></h1>
              <a class="extra" href="/google_reader/">home</a>
            </div>

                <h2>使用纯XAML标记实现数据验证错误提示</h2>
<p class="meta">2010-07-03 02:53</p>

<div class="post">
<h2>使用纯XAML标记实现数据验证错误提示</h2>

<h3>by suyan010203</h3>

<h3>at 2010-07-02 18:53:00</h3>

<h3>original <a href="http://www.cnblogs.com/suyan010203/archive/2010/07/02/1770177.html">http://www.cnblogs.com/suyan010203/archive/2010/07/02/1770177.html</a></h3>

<p><a href="http://www.cnblogs.com/suyan010203/"><img src="http://pic.cnblogs.com/face/u116892.jpg" alt="" border="0"></a><br>作者: <a href="http://www.cnblogs.com/suyan010203/">suyan010203</a> 发表于 2010-07-02 18:53 <a href="http://www.cnblogs.com/suyan010203/archive/2010/07/02/1770177.html">原文链接</a> 阅读: 591 评论: 0</p>


<p>   上一次写了一篇：在WPF中实现数据验证的自定义提示之后，一直觉得这个方案太过勉强，逻辑上也不怎么清晰。苦于前两周要做开题报告，所以一直没来得及做一个好好的研究，这几天终于找到时间来改进那个方案了。考虑到原来的方案将XMAL代码和.net后置代码混合使用，使得验证逻辑很是混乱，所以在这里我用纯XMAL标记来实现验证的呈现，而具体的验证逻辑还是放在了数据类型中。我在这儿提供了两个方案：一个是使用Validation中的ErrorTemplate错误模板来实现一个炫丽的提示框，另一个则是使用了一个Popup提示达到同样的目的。</p>


<p>    <span style="font-size:14pt"><span style="color:#0000ff">预备：</span></span> 仍然先来看看几个比较重要的类型：</p>


<p>   <strong>1、AdornedElementPlaceholder 类</strong>：微软在帮助文档中很描述了这的作用---表示<a href="http://127.0.0.1:47873/ms.help?method=page&amp;id=T%3ASYSTEM.WINDOWS.CONTROLS.CONTROLTEMPLATE&amp;product=VS&amp;productVersion=100&amp;topicVersion=100&amp;locale=ZH-CN&amp;topicLocale=ZH-CN">ControlTemplate</a> 中使用的元素，用于指定修饰控件相对于 <a href="http://127.0.0.1:47873/ms.help?method=page&amp;id=T%3ASYSTEM.WINDOWS.CONTROLS.CONTROLTEMPLATE&amp;product=VS&amp;productVersion=100&amp;topicVersion=100&amp;locale=ZH-CN&amp;topicLocale=ZH-CN">ControlTemplate</a> 中的其他元素所放置的位置。</p>


<p>    这里面我们要用到一个非常重要的属性：</p>


<p>    AdornedElementPlaceholder . AdornedElement 属性：</p>


<p>    获取此 <a href="http://127.0.0.1:47873/ms.help?method=page&amp;id=T%3ASYSTEM.WINDOWS.CONTROLS.ADORNEDELEMENTPLACEHOLDER&amp;product=VS&amp;productVersion=100&amp;topicVersion=90&amp;locale=ZH-CN&amp;topicLocale=ZH-CN">AdornedElementPlaceholder</a> 对象所引用的 <a href="http://127.0.0.1:47873/ms.help?method=page&amp;id=T%3ASYSTEM.WINDOWS.UIELEMENT&amp;product=VS&amp;productVersion=100&amp;topicVersion=90&amp;locale=ZH-CN&amp;topicLocale=ZH-CN">UIElement</a>。 我们要用这个属性来得到Validation附加属性的错误信息。</p>


<p>   <strong>2、Validation 类</strong>：这是一个静态类，用于提供支持数据验证并管理控件的可视状态的方法和附加属性。</p>


<p>    同样我们只关注它的附加属性：</p>


<p>    Validation. Errors 附加属性：获取与绑定目标元素相关联的 <a href="http://127.0.0.1:47873/ms.help?method=page&amp;id=T%3ASYSTEM.WINDOWS.CONTROLS.VALIDATIONERROR&amp;product=VS&amp;productVersion=100&amp;topicVersion=95&amp;locale=ZH-CN&amp;topicLocale=ZH-CN">ValidationError</a> 对象的集合。</p>


<p>    Validation. HasError 附加属性：获取一个值，该值指示目标元素的绑定是否具有验证错误。</p>


<p>   这里有一个前提：那就是我们的数据类是实现了INotifyPropertyChanged,IDataErrorInfo 两个接口。</p>


<p>   <span style="font-size:18pt"><strong><span style="color:#0000ff">方案一：</span>定义ErrorTemplate错误面板提示</strong></span></p>


<p>    <strong>1、首先定义一个提示面板</strong>：其效果如下</p>


<p>    <a href="http://images.cnblogs.com/cnblogs_com/suyan010203/WindowsLiveWriter/XAML_FC54/image_2.png"><img height="63" width="273" src="http://images.cnblogs.com/cnblogs_com/suyan010203/WindowsLiveWriter/XAML_FC54/image_thumb.png" alt="image" border="0" title="image" style="display:inline;border:0px"></a> </p>


<p>   这里我们定义了一个TextBlock来绑定到<a href="http://127.0.0.1:47873/ms.help?method=page&amp;id=T%3ASYSTEM.WINDOWS.CONTROLS.ADORNEDELEMENTPLACEHOLDER&amp;product=VS&amp;productVersion=100&amp;topicVersion=90&amp;locale=ZH-CN&amp;topicLocale=ZH-CN">AdornedElementPlaceholder</a>的引用元素的Validation.Errors[0].ErrorContent属性上：</p>


<p>   </p>


<div><img src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif"><img src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif"><span>绑定ErrorContent</span>
<div>
<pre><div><span style="color:#000000">&lt;</span><span style="color:#000000">TextBlock Foreground</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">Red</span><span style="color:#800000">"</span><span style="color:#000000"> x:Name</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">errorText</span><span style="color:#800000">"</span><span style="color:#000000"> Margin</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">15,0,2,2</span><span style="color:#800000">"</span><span style="color:#000000"> TextWrapping</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">Wrap</span><span style="color:#800000">"</span><span style="color:#000000"> FontSize</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">12</span><span style="color:#800000">"</span><span style="color:#000000"> HorizontalAlignment</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">Left</span><span style="color:#800000">"</span><span style="color:#000000"> VerticalAlignment</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">Center</span><span style="color:#800000">"</span><span style="color:#000000"> Text</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">{Binding ElementName=adorner,Path=AdornedElement.(Validation.Errors)[0].ErrorContent}</span><span style="color:#800000">"</span><span style="color:#000000">/&gt;</span></div></pre>
</div>
</div>


<p>  框架的XAML标记为：</p>


<div><img src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif"><img src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif"><span>自定义的提示框</span>
<div>
<pre><div><span style="color:#000000"> </span><span style="color:#000000">&lt;</span><span style="color:#000000">Grid Height</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">47</span><span style="color:#800000">"</span><span style="color:#000000"> Width</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">175</span><span style="color:#800000">"</span><span style="color:#000000"> DockPanel.Dock</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">Right</span><span style="color:#800000">"</span><span style="color:#000000">&gt;</span><span style="color:#000000"><br>                           </span><span style="color:#000000">&lt;</span><span style="color:#000000">Grid.Style</span><span style="color:#000000">&gt;</span><span style="color:#000000"><br>                               </span><span style="color:#000000">&lt;</span><span style="color:#000000">Style TargetType</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">{x:Type Grid}</span><span style="color:#800000">"</span><span style="color:#000000">/&gt;</span><span style="color:#000000"><br>                           </span><span style="color:#000000">&lt;/</span><span style="color:#000000">Grid.Style</span><span style="color:#000000">&gt;</span><span style="color:#000000"><br>                           </span><span style="color:#000000">&lt;</span><span style="color:#000000">Path Data</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">M12.166999,0.5 L143.167,0.5 C145.92843,0.50000003 148.167,2.7385762 148.167,5.5 L148.167,30.5 C148.167,33.261425 145.92843,35.5 143.167,35.5 L12.166999,35.5 11.81918,35.482437 11.834001,35.5 C10.619751,36.16069 10.9795,36.5625 8.1912529,37.482075 5.4030061,38.401646 3.063751,40.272026 0.5,41.667 2.2780275,39.667053 4.7294998,37 5.8340837,35.66716 6.662521,34.66753 6.9629115,32.753006 7.1582331,31.348595 L7.1991105,31.052473 7.1928148,31.011221 C7.1757442,30.843136 7.1669998,30.672588 7.1669995,30.5 L7.1669995,17.25 7.1669995,5.5 C7.1669998,2.7385762 9.405576,0.50000003 12.166999,0.5 z</span><span style="color:#800000">"</span><span style="color:#000000"> Margin</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">1.333,0,0,1.833</span><span style="color:#800000">"</span><span style="color:#000000"> Stretch</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">Fill</span><span style="color:#800000">"</span><span style="color:#000000"> Stroke</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">#FF32E767</span><span style="color:#800000">"</span><span style="color:#000000"> UseLayoutRounding</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">False</span><span style="color:#800000">"</span><span style="color:#000000">&gt;</span><span style="color:#000000"><br>                            </span><span style="color:#000000">&lt;</span><span style="color:#000000">Path.Fill</span><span style="color:#000000">&gt;</span><span style="color:#000000"><br>                            </span><span style="color:#000000">&lt;</span><span style="color:#000000">LinearGradientBrush EndPoint</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">0.5,1</span><span style="color:#800000">"</span><span style="color:#000000"> StartPoint</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">0.5,0</span><span style="color:#800000">"</span><span style="color:#000000">&gt;</span><span style="color:#000000"><br>                            </span><span style="color:#000000">&lt;</span><span style="color:#000000">GradientStop Color</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">#FF5F5DB6</span><span style="color:#800000">"</span><span style="color:#000000"> Offset</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">1</span><span style="color:#800000">"</span><span style="color:#000000">/&gt;</span><span style="color:#000000"><br>                            </span><span style="color:#000000">&lt;</span><span style="color:#000000">GradientStop Color</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">#FF3F3BCA</span><span style="color:#800000">"</span><span style="color:#000000">/&gt;</span><span style="color:#000000"><br>                            </span><span style="color:#000000">&lt;</span><span style="color:#000000">GradientStop Color</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">#FFACABE9</span><span style="color:#800000">"</span><span style="color:#000000"> Offset</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">0.747</span><span style="color:#800000">"</span><span style="color:#000000">/&gt;</span><span style="color:#000000"><br>                           </span><span style="color:#000000">&lt;/</span><span style="color:#000000">LinearGradientBrush</span><span style="color:#000000">&gt;</span><span style="color:#000000"><br>                         </span><span style="color:#000000">&lt;/</span><span style="color:#000000">Path.Fill</span><span style="color:#000000">&gt;</span><span style="color:#000000"><br>                       </span><span style="color:#000000">&lt;/</span><span style="color:#000000">Path</span><span style="color:#000000">&gt;</span><span style="color:#000000"><br>                </span><span style="color:#000000">&lt;</span><span style="color:#000000">Path Data</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">M67.5,15.25 C70.750538,10.312179 121.33333,14.916667 148.25,14.75 148.41667,11.083333 149,6.0625 148.75,3.75 148.5,1.4375 145.43711,0.0625 144.5,0.25 149.46607,0.22253689 13.874996,-0.062023075 11.75,0.25 9.6250039,0.56202307 8.3747773,3.5006011 8.25,4.75 8.1252227,5.9993989 8.159157,10.23778 8.25,14.5 28,14.75 64.249462,20.187821 67.5,15.25 z</span><span style="color:#800000">"</span><span style="color:#000000"> Margin</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">8,0,0,28.686</span><span style="color:#800000">"</span><span style="color:#000000"> Stretch</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">Fill</span><span style="color:#800000">"</span><span style="color:#000000"> Stroke</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">Black</span><span style="color:#800000">"</span><span style="color:#000000"> UseLayoutRounding</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">False</span><span style="color:#800000">"</span><span style="color:#000000"> StrokeThickness</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">0</span><span style="color:#800000">"</span><span style="color:#000000">&gt;</span><span style="color:#000000"><br>                    </span><span style="color:#000000">&lt;</span><span style="color:#000000">Path.Fill</span><span style="color:#000000">&gt;</span><span style="color:#000000"><br>                        </span><span style="color:#000000">&lt;</span><span style="color:#000000">LinearGradientBrush EndPoint</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">0.5,1</span><span style="color:#800000">"</span><span style="color:#000000"> StartPoint</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">0.5,0</span><span style="color:#800000">"</span><span style="color:#000000">&gt;</span><span style="color:#000000"><br>                            </span><span style="color:#000000">&lt;</span><span style="color:#000000">GradientStop Color</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">#B2FFFFFF</span><span style="color:#800000">"</span><span style="color:#000000">/&gt;</span><span style="color:#000000"><br>                            </span><span style="color:#000000">&lt;</span><span style="color:#000000">GradientStop Color</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">#33FFFFFF</span><span style="color:#800000">"</span><span style="color:#000000"> Offset</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">1</span><span style="color:#800000">"</span><span style="color:#000000">/&gt;</span><span style="color:#000000"><br>                        </span><span style="color:#000000">&lt;/</span><span style="color:#000000">LinearGradientBrush</span><span style="color:#000000">&gt;</span><span style="color:#000000"><br>                    </span><span style="color:#000000">&lt;/</span><span style="color:#000000">Path.Fill</span><span style="color:#000000">&gt;</span><span style="color:#000000"><br>                </span><span style="color:#000000">&lt;/</span><span style="color:#000000">Path</span><span style="color:#000000">&gt;</span><span style="color:#000000"><br>                       </span><span style="color:#000000">&lt;</span><span style="color:#000000">TextBlock Foreground</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">Red</span><span style="color:#800000">"</span><span style="color:#000000"> x:Name</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">errorText</span><span style="color:#800000">"</span><span style="color:#000000"> Margin</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">15,0,2,2</span><span style="color:#800000">"</span><span style="color:#000000"> TextWrapping</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">Wrap</span><span style="color:#800000">"</span><span style="color:#000000"> FontSize</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">12</span><span style="color:#800000">"</span><span style="color:#000000"> HorizontalAlignment</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">Left</span><span style="color:#800000">"</span><span style="color:#000000"> VerticalAlignment</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">Center</span><span style="color:#800000">"</span><span style="color:#000000"> Text</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">{Binding ElementName=adorner,Path=AdornedElement.(Validation.Errors)[0].ErrorContent}</span><span style="color:#800000">"</span><span style="color:#000000">/&gt;</span><span style="color:#000000"><br>                    </span><span style="color:#000000">&lt;/</span><span style="color:#000000">Grid</span><span style="color:#000000">&gt;</span></div></pre>
</div>
</div>


<p><strong>2、实现自定义的TextBox样式：</strong></p>


<div><img src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif"><img src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif"><span>自定义TextBox样式</span>
<div>
<pre><div><span style="color:#000000">&lt;</span><span style="color:#000000">Style x:Key</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">ErrorValidationTextBoxStyle</span><span style="color:#800000">"</span><span style="color:#000000"> BasedOn</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">{x:Null}</span><span style="color:#800000">"</span><span style="color:#000000"> TargetType</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">{x:Type TextBox}</span><span style="color:#800000">"</span><span style="color:#000000">&gt;</span><span style="color:#000000"><br>            </span><span style="color:#000000">&lt;</span><span style="color:#000000">Setter Property</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">Foreground</span><span style="color:#800000">"</span><span style="color:#000000"> Value</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">{DynamicResource {x:Static SystemColors.ControlTextBrushKey}}</span><span style="color:#800000">"</span><span style="color:#000000">/&gt;</span><span style="color:#000000"><br>            </span><span style="color:#000000">&lt;</span><span style="color:#000000">Setter Property</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">Background</span><span style="color:#800000">"</span><span style="color:#000000"> Value</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">{DynamicResource {x:Static SystemColors.WindowBrushKey}}</span><span style="color:#800000">"</span><span style="color:#000000">/&gt;</span><span style="color:#000000"><br>            </span><span style="color:#000000">&lt;</span><span style="color:#000000">Setter Property</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">BorderBrush</span><span style="color:#800000">"</span><span style="color:#000000"> Value</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">{StaticResource TextBoxBorder}</span><span style="color:#800000">"</span><span style="color:#000000">/&gt;</span><span style="color:#000000"><br>            </span><span style="color:#000000">&lt;</span><span style="color:#000000">Setter Property</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">BorderThickness</span><span style="color:#800000">"</span><span style="color:#000000"> Value</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">1</span><span style="color:#800000">"</span><span style="color:#000000">/&gt;</span><span style="color:#000000"><br>            </span><span style="color:#000000">&lt;</span><span style="color:#000000">Setter Property</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">Padding</span><span style="color:#800000">"</span><span style="color:#000000"> Value</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">1</span><span style="color:#800000">"</span><span style="color:#000000">/&gt;</span><span style="color:#000000"><br>            </span><span style="color:#000000">&lt;</span><span style="color:#000000">Setter Property</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">AllowDrop</span><span style="color:#800000">"</span><span style="color:#000000"> Value</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">true</span><span style="color:#800000">"</span><span style="color:#000000">/&gt;</span><span style="color:#000000"><br>            </span><span style="color:#000000">&lt;</span><span style="color:#000000">Setter Property</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">FocusVisualStyle</span><span style="color:#800000">"</span><span style="color:#000000"> Value</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">{x:Null}</span><span style="color:#800000">"</span><span style="color:#000000">/&gt;</span><span style="color:#000000"><br>            </span><span style="color:#000000">&lt;</span><span style="color:#000000">Setter Property</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">ScrollViewer.PanningMode</span><span style="color:#800000">"</span><span style="color:#000000"> Value</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">VerticalFirst</span><span style="color:#800000">"</span><span style="color:#000000">/&gt;</span><span style="color:#000000"><br>            </span><span style="color:#000000">&lt;</span><span style="color:#000000">Setter Property</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">Stylus.IsFlicksEnabled</span><span style="color:#800000">"</span><span style="color:#000000"> Value</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">False</span><span style="color:#800000">"</span><span style="color:#000000">/&gt;</span><span style="color:#000000"><br>            </span><span style="color:#000000">&lt;</span><span style="color:#000000">Setter Property</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">Template</span><span style="color:#800000">"</span><span style="color:#000000">&gt;</span><span style="color:#000000"><br>                </span><span style="color:#000000">&lt;</span><span style="color:#000000">Setter.Value</span><span style="color:#000000">&gt;</span><span style="color:#000000"><br>                    </span><span style="color:#000000">&lt;</span><span style="color:#000000">ControlTemplate TargetType</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">{x:Type TextBox}</span><span style="color:#800000">"</span><span style="color:#000000">&gt;</span><span style="color:#000000"><br>                        </span><span style="color:#000000">&lt;</span><span style="color:#000000">Microsoft_Windows_Themes:ListBoxChrome x:Name</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">Bd</span><span style="color:#800000">"</span><span style="color:#000000"> BorderBrush</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">{TemplateBinding BorderBrush}</span><span style="color:#800000">"</span><span style="color:#000000"> BorderThickness</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">{TemplateBinding BorderThickness}</span><span style="color:#800000">"</span><span style="color:#000000"> Background</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">{TemplateBinding Background}</span><span style="color:#800000">"</span><span style="color:#000000"> RenderMouseOver</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">{TemplateBinding IsMouseOver}</span><span style="color:#800000">"</span><span style="color:#000000"> RenderFocused</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">{TemplateBinding IsKeyboardFocusWithin}</span><span style="color:#800000">"</span><span style="color:#000000"> SnapsToDevicePixels</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">true</span><span style="color:#800000">"</span><span style="color:#000000">&gt;</span><span style="color:#000000"><br>                            </span><span style="color:#000000">&lt;</span><span style="color:#000000">ScrollViewer x:Name</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">PART_ContentHost</span><span style="color:#800000">"</span><span style="color:#000000"> SnapsToDevicePixels</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">{TemplateBinding SnapsToDevicePixels}</span><span style="color:#800000">"</span><span style="color:#000000">/&gt;</span><span style="color:#000000"><br>                        </span><span style="color:#000000">&lt;/</span><span style="color:#000000">Microsoft_Windows_Themes:ListBoxChrome</span><span style="color:#000000">&gt;</span><span style="color:#000000"><br>                        </span><span style="color:#000000">&lt;</span><span style="color:#000000">ControlTemplate.Triggers</span><span style="color:#000000">&gt;</span><span style="color:#000000"><br>                            </span><span style="color:#000000">&lt;</span><span style="color:#000000">Trigger Property</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">IsEnabled</span><span style="color:#800000">"</span><span style="color:#000000"> Value</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">false</span><span style="color:#800000">"</span><span style="color:#000000">&gt;</span><span style="color:#000000"><br>                                </span><span style="color:#000000">&lt;</span><span style="color:#000000">Setter Property</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">Background</span><span style="color:#800000">"</span><span style="color:#000000"> TargetName</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">Bd</span><span style="color:#800000">"</span><span style="color:#000000"> Value</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">{DynamicResource {x:Static SystemColors.ControlBrushKey}}</span><span style="color:#800000">"</span><span style="color:#000000">/&gt;</span><span style="color:#000000"><br>                                </span><span style="color:#000000">&lt;</span><span style="color:#000000">Setter Property</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">Foreground</span><span style="color:#800000">"</span><span style="color:#000000"> Value</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">{DynamicResource {x:Static SystemColors.GrayTextBrushKey}}</span><span style="color:#800000">"</span><span style="color:#000000">/&gt;</span><span style="color:#000000"><br>                            </span><span style="color:#000000">&lt;/</span><span style="color:#000000">Trigger</span><span style="color:#000000">&gt;</span><span style="color:#000000"><br>                        </span><span style="color:#000000">&lt;/</span><span style="color:#000000">ControlTemplate.Triggers</span><span style="color:#000000">&gt;</span><span style="color:#000000"><br>                    </span><span style="color:#000000">&lt;/</span><span style="color:#000000">ControlTemplate</span><span style="color:#000000">&gt;</span><span style="color:#000000"><br>                </span><span style="color:#000000">&lt;/</span><span style="color:#000000">Setter.Value</span><span style="color:#000000">&gt;</span><span style="color:#000000"><br>            </span><span style="color:#000000">&lt;/</span><span style="color:#000000">Setter</span><span style="color:#000000">&gt;</span><span style="color:#000000"><br>    </span><span style="color:#000000">&lt;</span><span style="color:#000000">\Style</span><span style="color:#000000">&gt;</span></div></pre>
</div>
</div>


<p><strong>3、在上面的样式中加入如下的错误模板标记</strong>     </p>


<div><img src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif"><img src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif"><span>ErrorTemplate</span>
<div>
<pre><div><span style="color:#000000">&lt;</span><span style="color:#000000"> Setter Property</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">Validation.ErrorTemplate</span><span style="color:#800000">"</span><span style="color:#000000">&gt;</span><span style="color:#000000"> <br>                </span><span style="color:#000000">&lt;</span><span style="color:#000000">Setter.Value</span><span style="color:#000000">&gt;</span><span style="color:#000000"> <br>                    </span><span style="color:#000000">&lt;</span><span style="color:#000000">ControlTemplate </span><span style="color:#000000">&gt;</span><span style="color:#000000"> <br>                        </span><span style="color:#000000">&lt;</span><span style="color:#000000">DockPanel LastChildFill</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">True</span><span style="color:#800000">"</span><span style="color:#000000">&gt;</span><span style="color:#000000"> <br>                         </span><span style="color:#000000">&lt;!--</span><span style="color:#000000"> ……这里放置上面的视觉树</span><span style="color:#000000">--&gt;</span><span style="color:#000000"> <br>                        </span><span style="color:#000000">&lt;</span><span style="color:#000000">Border BorderBrush</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">DarkOrange</span><span style="color:#800000">"</span><span style="color:#000000"> BorderThickness</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">1</span><span style="color:#800000">"</span><span style="color:#000000">&gt;</span><span style="color:#000000"> <br>                            </span><span style="color:#000000">&lt;</span><span style="color:#000000">AdornedElementPlaceholder  x:Name</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">adorner</span><span style="color:#800000">"</span><span style="color:#000000"> </span><span style="color:#000000">/&gt;</span><span style="color:#000000">         <br>                        </span><span style="color:#000000">&lt;/</span><span style="color:#000000">Border</span><span style="color:#000000">&gt;</span><span style="color:#000000"> <br>                        </span><span style="color:#000000">&lt;/</span><span style="color:#000000">DockPanel</span><span style="color:#000000">&gt;</span><span style="color:#000000"> <br>                    </span><span style="color:#000000">&lt;/</span><span style="color:#000000">ControlTemplate</span><span style="color:#000000">&gt;</span><span style="color:#000000"> <br>                </span><span style="color:#000000">&lt;/</span><span style="color:#000000">Setter.Value</span><span style="color:#000000">&gt;</span><span style="color:#000000"> <br>           </span><span style="color:#000000">&lt;/</span><span style="color:#000000">Setter</span><span style="color:#000000">&gt;</span><span style="color:#000000"> <br>    </span></div></pre>
</div>
</div>


<p><strong>4、将样式附加到主窗体的TextBox中，并实现数据的绑定（这里的数据验证规则定义在相应的数据属性设置中）：</strong></p>


<div><img src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif"><img src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif"><span>数据绑定</span>
<div>
<pre><div><span style="color:#000000">&lt;</span><span style="color:#000000">TextBox x:Name</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">emailTxt</span><span style="color:#800000">"</span><span style="color:#000000">  TextWrapping</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">Wrap</span><span style="color:#800000">"</span><span style="color:#000000"> Text</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">{Binding Mode=TwoWay, NotifyOnValidationError=True, ValidatesOnDataErrors=True, Path=Email}</span><span style="color:#800000">"</span><span style="color:#000000"> VerticalAlignment</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">Top</span><span style="color:#800000">"</span><span style="color:#000000"> FontSize</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">18.667</span><span style="color:#800000">"</span><span style="color:#000000"> Height</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">44</span><span style="color:#800000">"</span><span style="color:#000000"> BorderBrush</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">#FF1A3DA7</span><span style="color:#800000">"</span><span style="color:#000000"> Width</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">198</span><span style="color:#800000">"</span><span style="color:#000000"> <br>                         Style</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">{DynamicResource ErrorValidationTextBoxStyle}</span><span style="color:#800000">"</span><span style="color:#000000">&gt;</span><span style="color:#000000"><br><br>   <br></span></div></pre>
</div>
</div>


<p>   至此，第一方案已经完成：特别要提示的数据类要实现IDataErrorInfo接口定义的逻辑和正则表达式验证逻辑，其完整的代码请参考示例代码。</p>


<p>   <span style="font-size:18pt"><strong><span style="color:#0000ff">方案二：</span>使用Popup控件的IsOpen依赖属性提示：</strong></span></p>


<p>    <strong>1、同样如一中的第一步定义一个提示面板。</strong></p>


<p>   <strong> 2、将Popup的IsOpen绑定到文本框的Validation.HasError上</strong>，这是一个bool型的属性，所以我们可以直接绑定，不用自定义转换器了</p>


<p>     </p>


<div><img src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif"><img src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif"><span>Popup的IsOpen绑定</span>
<div>
<pre><div><span style="color:#000000">&lt;</span><span style="color:#000000">Popup x:Name</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">phoneError</span><span style="color:#800000">"</span><span style="color:#000000"> Placement</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">Right</span><span style="color:#800000">"</span><span style="color:#000000"> PlacementTarget</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">{Binding ElementName=phoneTxt, Mode=OneWay}</span><span style="color:#800000">"</span><span style="color:#000000"> AllowsTransparency</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">True</span><span style="color:#800000">"</span><span style="color:#000000"> <br>                           IsOpen</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">{Binding ElementName=phoneTxt,Path=(Validation.HasError),Mode=OneWay}</span><span style="color:#800000">"</span><span style="color:#000000">&gt;</span><span style="color:#000000"><br><br>    <br></span></div></pre>
</div>
</div>


<p><strong>3、在TextBox中实现与数据类的绑定连接：</strong> </p>


<div><img src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif"><img src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif"><span>数据连接</span>
<div>
<pre><div><span style="color:#000000"> </span><span style="color:#000000">&lt;</span><span style="color:#000000">TextBox x:Name</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">phoneTxt</span><span style="color:#800000">"</span><span style="color:#000000">   TextWrapping</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">Wrap</span><span style="color:#800000">"</span><span style="color:#000000"> Text</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">{Binding Phone, Mode=TwoWay, NotifyOnValidationError=True, ValidatesOnDataErrors=True}</span><span style="color:#800000">"</span><span style="color:#000000"> FontSize</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">18.667</span><span style="color:#800000">"</span><span style="color:#000000"> Margin</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">0,0,-98,0</span><span style="color:#800000">"</span><span style="color:#000000"> Height</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">44</span><span style="color:#800000">"</span><span style="color:#000000"> BorderBrush</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">#FF1A3DA7</span><span style="color:#800000">"</span><span style="color:#000000"> Width</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">198</span><span style="color:#800000">"</span><span style="color:#000000"> HorizontalAlignment</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">Left</span><span style="color:#800000">"</span><span style="color:#000000">&gt;</span><span style="color:#000000"><br></span></div></pre>
</div>
</div>


<p>   最后不要忘记了在Binding在设置ValidatesOnDataErrors为True，这样才能实现数据出现错误的提示。由于Popup控件还定义了一组打开的动画效果，使用它可以得到很动感的提示体验，这是它的一个优势。而对于错误模板使用起来更方便，毕竟内部逻辑我们封装在了Style里，具体那一种方案要好些可就看个人的喜好了，我个人还是建议用错误模板要好些。毕竟有一种开之即可食的感觉。</p>


<p>   点击下载<a href="http://files.cnblogs.com/suyan010203/ErrorNotificationXAML.rar"> 示例代码</a></p>


<p><img src="http://www.cnblogs.com/suyan010203/aggbug/1770177.html?type=1" width="1" height="1" alt=""><p>评论: 0　<a href="http://www.cnblogs.com/suyan010203/archive/2010/07/02/1770177.html#pagedcomment">查看评论</a>　<a href="http://www.cnblogs.com/suyan010203/archive/2010/07/02/1770177.html#commentform">发表评论</a></p><p><a href="http://mpd.cnblogs.com/">软件研发团队管理年会(上海，7.10-7.11)</a></p><hr><p>最新新闻：<br>· <a href="http://news.cnblogs.com/n/67507/">微软发布IIS Express：Visual Studio全新内置的Web服务器</a><span style="color:gray">(2010-07-03 14:08)</span><br>· <a href="http://news.cnblogs.com/n/67506/">Facebook将加入面部识别和照片标签技术</a><span style="color:gray">(2010-07-03 14:05)</span><br>· <a href="http://news.cnblogs.com/n/67505/">盘点IT界大佬专利：乔布斯一马当先 盖茨重技术</a><span style="color:gray">(2010-07-03 13:51)</span><br>· <a href="http://news.cnblogs.com/n/67504/">最昂贵iPhone 4登场</a><span style="color:gray">(2010-07-03 13:01)</span><br>· <a href="http://news.cnblogs.com/n/67503/">Marketwatch：微软移动业务注定以失败收场</a><span style="color:gray">(2010-07-03 12:56)</span><br></p><p>编辑推荐：<a href="http://www.cnblogs.com/noremorse/archive/2010/07/02/1769819.html">现在是Flash的,未来是HTML5的,那么Silverlight呢</a><br></p><p>网站导航：<a href="http://www.cnblogs.com">博客园首页</a>  <a href="http://home.cnblogs.com/">个人主页</a>  <a href="http://news.cnblogs.com">新闻</a>  <a href="http://home.cnblogs.com/ing/">闪存</a>  <a href="http://home.cnblogs.com/group/">小组</a>  <a href="http://space.cnblogs.com/q/">博问</a>  <a href="http://space.cnblogs.com">社区</a>  <a href="http://kb.cnblogs.com">知识库</a></p></p>

</div>


            <div class="footer">
              <div class="contact">
                <p>
                  Your Name<br />
                  What You Are<br />
                  your@email.com
                </p>
              </div>
              <div class="contact">
                <p>
                  <a href="http://github.com/lyuehh/">github.com/lyuehh</a><br />
                  <a href="http://twitter.com/lyuehh/">twitter.com/lyuehh</a><br />
                </p>
              </div>
            </div>
          </div>
        </div> <!-- /container -->

    </body>
</html>
