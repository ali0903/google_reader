<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>asp.net mvc 2 简简单单做开发 实现基本数据操作操作RepositoryController&lt;T&gt;</title>
        <meta name="viewport" content="width=device-width">

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/css/syntax.css">

        <!-- Custom CSS -->
        <link rel="stylesheet" href="/css/main.css">

    </head>
    <body>

        <div class="container">
          <div class="site">
            <div class="header">
              <h1 class="title"><a href="/">Your New Jekyll Site</a></h1>
              <a class="extra" href="/">home</a>
            </div>

                <h2>asp.net mvc 2 简简单单做开发 实现基本数据操作操作RepositoryController&lt;T&gt;</h2>
<p class="meta">05 Jul 2010</p>

<div class="post">
<h2>asp.net mvc 2 简简单单做开发 实现基本数据操作操作RepositoryController&lt;T&gt;</h2>

<h3>by 王继坤</h3>

<h3>at 2010-07-05 15:08:00</h3>

<h3>original <a href="http://www.cnblogs.com/wangjikun3/archive/2010/07/05/1771401.html">http://www.cnblogs.com/wangjikun3/archive/2010/07/05/1771401.html</a></h3>

<p>作者: <a href="http://www.cnblogs.com/wangjikun3/">王继坤</a> 发表于 2010-07-05 15:08 <a href="http://www.cnblogs.com/wangjikun3/archive/2010/07/05/1771401.html">原文链接</a> 阅读: 7 评论: 1</p>


<p>asp.net mvc 2 使用Linq to Sql 来操作数据库，基本实现面向对象编程，同样在操作数据是我们也可以使用面向对象的继承再加上泛型，是操作更加简单。代码简单，不详细说明，里面用到几个简单的扩展方法，以后会详细介绍。如db.find&lt;T&gt;(t),db.findkey&lt;T&gt;(id)。这是对dbcontent做了些扩展。</p>


<p>RepositoryController.cs 代码如下：</p>


<p> </p>


<div>
<div><span style="color:#008080"> 1</span> <span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">class</span><span style="color:#000000"> RepositoryController</span><span style="color:#000000">&lt;</span><span style="color:#000000">T</span><span style="color:#000000">&gt;</span><span style="color:#000000">: BaseController </span><span style="color:#0000ff">where</span><span style="color:#000000"> T : </span><span style="color:#0000ff">class</span><span style="color:#000000">,</span><span style="color:#0000ff">new</span><span style="color:#000000">()<br></span><span style="color:#008080"> 2</span> <span style="color:#000000">    {<br></span><span style="color:#008080"> 3</span> <span style="color:#000000">        </span><span style="color:#0000ff">private</span><span style="color:#000000"> Table</span><span style="color:#000000">&lt;</span><span style="color:#000000">T</span><span style="color:#000000">&gt;</span><span style="color:#000000"> list()<br></span><span style="color:#008080"> 4</span> <span style="color:#000000">        {<br></span><span style="color:#008080"> 5</span> <span style="color:#000000">           </span><span style="color:#0000ff">return</span><span style="color:#000000"> db.GetTable</span><span style="color:#000000">&lt;</span><span style="color:#000000">T</span><span style="color:#000000">&gt;</span><span style="color:#000000">();<br></span><span style="color:#008080"> 6</span> <span style="color:#000000">        }<br></span><span style="color:#008080"> 7</span> <span style="color:#000000"><br></span><span style="color:#008080"> 8</span> <span style="color:#000000">      <br></span><span style="color:#008080"> 9</span> <span style="color:#000000">        </span><span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">string</span><span style="color:#000000"> orderby </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#800000">"</span><span style="color:#800000">Id desc</span><span style="color:#800000">"</span><span style="color:#000000">;<br></span><span style="color:#008080">10</span> <span style="color:#000000">        </span><span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">virtual</span><span style="color:#000000">  ActionResult Index(T art)<br></span><span style="color:#008080">11</span> <span style="color:#000000">        {<br></span><span style="color:#008080">12</span> <span style="color:#000000">            ViewData[</span><span style="color:#800000">"</span><span style="color:#800000">searchModel</span><span style="color:#800000">"</span><span style="color:#000000">] </span><span style="color:#000000">=</span><span style="color:#000000"> art;<br></span><span style="color:#008080">13</span> <span style="color:#000000">            var Model </span><span style="color:#000000">=</span><span style="color:#000000"> db.Find</span><span style="color:#000000">&lt;</span><span style="color:#000000">T</span><span style="color:#000000">&gt;</span><span style="color:#000000">(art);<br></span><span style="color:#008080">14</span> <span style="color:#000000">            RecordCount </span><span style="color:#000000">=</span><span style="color:#000000"> Model.Count();<br></span><span style="color:#008080">15</span> <span style="color:#000000">           Model</span><span style="color:#000000">=</span><span style="color:#000000">Model.OrderBy(orderby);<br></span><span style="color:#008080">16</span> <span style="color:#000000">           <br></span><span style="color:#008080">17</span> <span style="color:#000000">         Model </span><span style="color:#000000">=</span><span style="color:#000000"> Model.Skip((CurPage </span><span style="color:#000000">-</span><span style="color:#000000"> </span><span style="color:#800080">1</span><span style="color:#000000">) </span><span style="color:#000000">*</span><span style="color:#000000"> PageSize).Take(PageSize);<br></span><span style="color:#008080">18</span> <span style="color:#000000">          <br></span><span style="color:#008080">19</span> <span style="color:#000000">            GetPager();<br></span><span style="color:#008080">20</span> <span style="color:#000000">            </span><span style="color:#0000ff">return</span><span style="color:#000000"> View(</span><span style="color:#800000">"</span><span style="color:#800000">index</span><span style="color:#800000">"</span><span style="color:#000000">, Model);<br></span><span style="color:#008080">21</span> <span style="color:#000000">        }<br></span><span style="color:#008080">22</span> <span style="color:#000000">         [ValidateInput(</span><span style="color:#0000ff">false</span><span style="color:#000000">)]<br></span><span style="color:#008080">23</span> <span style="color:#000000">        </span><span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">virtual</span><span style="color:#000000"> ActionResult Add()<br></span><span style="color:#008080">24</span> <span style="color:#000000">        {<br></span><span style="color:#008080">25</span> <span style="color:#000000">            <br></span><span style="color:#008080">26</span> <span style="color:#000000">            </span><span style="color:#0000ff">return</span><span style="color:#000000"> View(</span><span style="color:#0000ff">new</span><span style="color:#000000"> T());<br></span><span style="color:#008080">27</span> <span style="color:#000000">        }<br></span><span style="color:#008080">28</span> <span style="color:#000000">        [HttpPost]<br></span><span style="color:#008080">29</span> <span style="color:#000000">        [ValidateInput(</span><span style="color:#0000ff">false</span><span style="color:#000000">)]<br></span><span style="color:#008080">30</span> <span style="color:#000000">        </span><span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">virtual</span><span style="color:#000000"> ActionResult Add(T Model)<br></span><span style="color:#008080">31</span> <span style="color:#000000">        {<br></span><span style="color:#008080">32</span> <span style="color:#000000">            </span><span style="color:#0000ff">if</span><span style="color:#000000"> (ModelState.IsValid)<br></span><span style="color:#008080">33</span> <span style="color:#000000">            {<br></span><span style="color:#008080">34</span> <span style="color:#000000">                </span><span style="color:#0000ff">try</span><span style="color:#000000"><br></span><span style="color:#008080">35</span> <span style="color:#000000">                {<br></span><span style="color:#008080">36</span> <span style="color:#000000">                   list().InsertOnSubmit(Model);<br></span><span style="color:#008080">37</span> <span style="color:#000000">                    db.SubmitChanges();<br></span><span style="color:#008080">38</span> <span style="color:#000000">                    </span><span style="color:#0000ff">return</span><span style="color:#000000"> RedirectToAction(</span><span style="color:#800000">"</span><span style="color:#800000">index</span><span style="color:#800000">"</span><span style="color:#000000">);<br></span><span style="color:#008080">39</span> <span style="color:#000000">                }<br></span><span style="color:#008080">40</span> <span style="color:#000000">                </span><span style="color:#0000ff">catch</span><span style="color:#000000"><br></span><span style="color:#008080">41</span> <span style="color:#000000">                {<br></span><span style="color:#008080">42</span> <span style="color:#000000">                    </span><span style="color:#0000ff">return</span><span style="color:#000000"> View(Model);<br></span><span style="color:#008080">43</span> <span style="color:#000000">                }<br></span><span style="color:#008080">44</span> <span style="color:#000000">            }<br></span><span style="color:#008080">45</span> <span style="color:#000000">            </span><span style="color:#0000ff">else</span><span style="color:#000000"><br></span><span style="color:#008080">46</span> <span style="color:#000000">                </span><span style="color:#0000ff">return</span><span style="color:#000000"> View(Model);<br></span><span style="color:#008080">47</span> <span style="color:#000000">        }<br></span><span style="color:#008080">48</span> <span style="color:#000000">         [ValidateInput(</span><span style="color:#0000ff">false</span><span style="color:#000000">)]<br></span><span style="color:#008080">49</span> <span style="color:#000000">        </span><span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">virtual</span><span style="color:#000000"> ActionResult Edit(</span><span style="color:#0000ff">int</span><span style="color:#000000"> id)<br></span><span style="color:#008080">50</span> <span style="color:#000000">        {<br></span><span style="color:#008080">51</span> <span style="color:#000000">            </span><span style="color:#0000ff">return</span><span style="color:#000000"> View(db.FindKey</span><span style="color:#000000">&lt;</span><span style="color:#000000">T</span><span style="color:#000000">&gt;</span><span style="color:#000000">(id));<br></span><span style="color:#008080">52</span> <span style="color:#000000">        }<br></span><span style="color:#008080">53</span> <span style="color:#000000">        [HttpPost]<br></span><span style="color:#008080">54</span> <span style="color:#000000">        [ValidateInput(</span><span style="color:#0000ff">false</span><span style="color:#000000">)]<br></span><span style="color:#008080">55</span> <span style="color:#000000">        </span><span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">virtual</span><span style="color:#000000"> ActionResult Edit(</span><span style="color:#0000ff">int</span><span style="color:#000000"> id, T Model)<br></span><span style="color:#008080">56</span> <span style="color:#000000">        {<br></span><span style="color:#008080">57</span> <span style="color:#000000">            </span><span style="color:#0000ff">try</span><span style="color:#000000"><br></span><span style="color:#008080">58</span> <span style="color:#000000">            {<br></span><span style="color:#008080">59</span> <span style="color:#000000">                var cate </span><span style="color:#000000">=</span><span style="color:#000000"> db.FindKey</span><span style="color:#000000">&lt;</span><span style="color:#000000">T</span><span style="color:#000000">&gt;</span><span style="color:#000000">(id);<br></span><span style="color:#008080">60</span> <span style="color:#000000">                UpdateModel(cate);<br></span><span style="color:#008080">61</span> <span style="color:#000000">                db.SubmitChanges();<br></span><span style="color:#008080">62</span> <span style="color:#000000">                </span><span style="color:#0000ff">return</span><span style="color:#000000"> RedirectToAction(</span><span style="color:#800000">"</span><span style="color:#800000">index</span><span style="color:#800000">"</span><span style="color:#000000">);<br></span><span style="color:#008080">63</span> <span style="color:#000000">            }<br></span><span style="color:#008080">64</span> <span style="color:#000000">            </span><span style="color:#0000ff">catch</span><span style="color:#000000"><br></span><span style="color:#008080">65</span> <span style="color:#000000">            {<br></span><span style="color:#008080">66</span> <span style="color:#000000">                </span><span style="color:#0000ff">return</span><span style="color:#000000"> View(Model);<br></span><span style="color:#008080">67</span> <span style="color:#000000">            }<br></span><span style="color:#008080">68</span> <span style="color:#000000">        }<br></span><span style="color:#008080">69</span> <span style="color:#000000">        </span><span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">virtual</span><span style="color:#000000"> ActionResult Delete(</span><span style="color:#0000ff">int</span><span style="color:#000000"> id)<br></span><span style="color:#008080">70</span> <span style="color:#000000">        {<br></span><span style="color:#008080">71</span> <span style="color:#000000">            list().DeleteOnSubmit(db.FindKey</span><span style="color:#000000">&lt;</span><span style="color:#000000">T</span><span style="color:#000000">&gt;</span><span style="color:#000000">(id));<br></span><span style="color:#008080">72</span> <span style="color:#000000">            db.SubmitChanges();<br></span><span style="color:#008080">73</span> <span style="color:#000000">            </span><span style="color:#0000ff">return</span><span style="color:#000000"> RedirectToAction(</span><span style="color:#800000">"</span><span style="color:#800000">index</span><span style="color:#800000">"</span><span style="color:#000000">);<br></span><span style="color:#008080">74</span> <span style="color:#000000">        }<br></span><span style="color:#008080">75</span> <span style="color:#000000"><br></span><span style="color:#008080">76</span> <span style="color:#000000"><br></span><span style="color:#008080">77</span> <span style="color:#000000">    }</span></div></div>


<p> </p>


<p> </p>


<p><img src="http://www.cnblogs.com/wangjikun3/aggbug/1771401.html?type=1" width="1" height="1" alt=""><p>评论: 1　<a href="http://www.cnblogs.com/wangjikun3/archive/2010/07/05/1771401.html#pagedcomment">查看评论</a>　<a href="http://www.cnblogs.com/wangjikun3/archive/2010/07/05/1771401.html#commentform">发表评论</a></p><p><a href="http://mpd.cnblogs.com/">软件研发团队管理年会(上海，7.10-7.11)</a></p><hr><p>最新新闻：<br>· <a href="http://news.cnblogs.com/n/67598/">商业周刊：纽约时报应向谷歌和读者收费</a><span style="color:gray">(2010-07-05 15:10)</span><br>· <a href="http://news.cnblogs.com/n/67597/">维基百科因数据中心断电全球宕机</a><span style="color:gray">(2010-07-05 15:09)</span><br>· <a href="http://news.cnblogs.com/n/67596/">赖霖枫：雨林木风5年时间完成上市</a><span style="color:gray">(2010-07-05 14:55)</span><br>· <a href="http://news.cnblogs.com/n/67595/">门户微博研究报告新浪遥遥领先 搜狐和网易掉队</a><span style="color:gray">(2010-07-05 14:50)</span><br>· <a href="http://news.cnblogs.com/n/67593/">Linux中的特种兵 十八个特别发行版</a><span style="color:gray">(2010-07-05 14:30)</span><br></p><p>编辑推荐：<a href="http://www.cnblogs.com/topic/53/">C#大论战：在讨论中学习</a><br></p><p>网站导航：<a href="http://www.cnblogs.com">博客园首页</a>  <a href="http://home.cnblogs.com/">个人主页</a>  <a href="http://news.cnblogs.com">新闻</a>  <a href="http://home.cnblogs.com/ing/">闪存</a>  <a href="http://home.cnblogs.com/group/">小组</a>  <a href="http://space.cnblogs.com/q/">博问</a>  <a href="http://space.cnblogs.com">社区</a>  <a href="http://kb.cnblogs.com">知识库</a></p></p>

</div>


            <div class="footer">
              <div class="contact">
                <p>
                  Your Name<br />
                  What You Are<br />
                  your@email.com
                </p>
              </div>
              <div class="contact">
                <p>
                  <a href="http://github.com/yourusername/">github.com/yourusername</a><br />
                  <a href="http://twitter.com/yourusername/">twitter.com/yourusername</a><br />
                </p>
              </div>
            </div>
          </div>
        </div> <!-- /container -->

    </body>
</html>
