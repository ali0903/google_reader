<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>一段动态立体展示图片的Js代码</title>
        <meta name="viewport" content="width=device-width">

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/css/syntax.css">

        <!-- Custom CSS -->
        <link rel="stylesheet" href="/css/main.css">

    </head>
    <body>

        <div class="container">
          <div class="site">
            <div class="header">
              <h1 class="title"><a href="/">Your New Jekyll Site</a></h1>
              <a class="extra" href="/">home</a>
            </div>

                <h2>一段动态立体展示图片的Js代码</h2>
<p class="meta">01 Jul 2010</p>

<div class="post">
<h2>一段动态立体展示图片的Js代码</h2>

<h3>by</h3>

<h3>at 2010-07-01 13:41:01</h3>

<h3>original <a href="http://www.javaeye.com/topic/703413">http://www.javaeye.com/topic/703413</a></h3>

<p>分享一段动态立体展示图片的Js代码。。。
<br>注：此代码来自一位js超强好友所传 分享之。。。
<br>
<br><img src="http://dl.javaeye.com/upload/attachment/271328/6933459c-765c-34c1-b449-7be2928c00a3.jpg">
<br>
<br>
<br><pre name="code">&lt;script type=&quot;text/javascript&quot;&gt;
var Library = {};
Library.ease = function () {
    this.target = 0;
    this.position = 0;
    this.move = function (target, speed)
    {
        this.position += (target - this.position) * speed;
    }
}</p>

<p>var tv = {
    /<em> ==== variables ==== </em>/
    O : [],
    screen : {},
    grid : {
        size       : 4,  // 4x4 grid
        borderSize : 6,  // borders size
        zoomed     : false
    },
    angle : {
        x : new Library.ease(),
        y : new Library.ease()
    },
    camera : {
        x    : new Library.ease(),
        y    : new Library.ease(),
        zoom : new Library.ease(),
        focalLength : 750 // camera Focal Length
    },</p>

<pre><code>/* ==== init script ==== */
init : function ()
{
    this.screen.obj = document.getElementById(&amp;#39;screen&amp;#39;);
    var img = document.getElementById(&amp;#39;bankImages&amp;#39;).getElementsByTagName(&amp;#39;img&amp;#39;);
    this.screen.obj.onselectstart = function () { return false; }
    this.screen.obj.ondrag        = function () { return false; }
    /* ==== create images grid ==== */
    var ni = 0;
    var n = (tv.grid.size / 2) - .5;
    for (var y = -n; y &amp;lt;= n; y++)
    {
        for (var x = -n; x &amp;lt;= n; x++)
        {
            /* ==== create HTML image element ==== */
            var o = document.createElement(&amp;#39;img&amp;#39;);
            var i = img[(ni++) % img.length];
            o.className = &amp;#39;tvout&amp;#39;;
            o.src = i.src;
            tv.screen.obj.appendChild(o);
            /* ==== 3D coordinates ==== */
            o.point3D = {
                x  : x,
                y  : y,
                z  : new Library.ease()
            };
            /* ==== push object ==== */
            o.point2D = {};
            o.ratioImage = 1;
            tv.O.push(o);
            /* ==== on mouse over event ==== */
            o.onmouseover = function ()
            {
                if (!tv.grid.zoomed)
                {
                    if (tv.o)
                    {
                        /* ==== mouse out ==== */
                        tv.o.point3D.z.target = 0;
                        tv.o.className = &amp;#39;tvout&amp;#39;;
                    }
                    /* ==== mouse over ==== */
                    this.className = &amp;#39;tvover&amp;#39;;
                    this.point3D.z.target = -.5;
                    tv.o = this;
                }
            }
            /* ==== on click event ==== */
            o.onclick = function ()
            {
                if (!tv.grid.zoomed)
                {
                    /* ==== zoom in ==== */
                    tv.camera.x.target = this.point3D.x;
                    tv.camera.y.target = this.point3D.y;
                    tv.camera.zoom.target = tv.screen.w * 1.25;
                    tv.grid.zoomed = this;
                } else {
                    if (this == tv.grid.zoomed){
                        /* ==== zoom out ==== */
                        tv.camera.x.target = 0;
                        tv.camera.y.target = 0;
                        tv.camera.zoom.target = tv.screen.w / (tv.grid.size + .1);
                        tv.grid.zoomed = false;
                    }
                }
            }
            /* ==== 3D transform function ==== */
            o.calc = function ()
            {
                /* ==== ease mouseover ==== */
                this.point3D.z.move(this.point3D.z.target, .5);
                /* ==== assign 3D coords ==== */
                var x = (this.point3D.x - tv.camera.x.position) * tv.camera.zoom.position;
                var y = (this.point3D.y - tv.camera.y.position) * tv.camera.zoom.position;
                var z = this.point3D.z.position * tv.camera.zoom.position;
                /* ==== perform rotations ==== */
                var xy = tv.angle.cx * y  - tv.angle.sx * z;
                var xz = tv.angle.sx * y  + tv.angle.cx * z;
                var yz = tv.angle.cy * xz - tv.angle.sy * x;
                var yx = tv.angle.sy * xz + tv.angle.cy * x;
                /* ==== 2D transformation ==== */
                this.point2D.scale = tv.camera.focalLength / (tv.camera.focalLength + yz);
                this.point2D.x = yx * this.point2D.scale;
                this.point2D.y = xy * this.point2D.scale;
                this.point2D.w = Math.round(
                                   Math.max(
                                     0,
                                     this.point2D.scale * tv.camera.zoom.position * .8
                                   )
                                 );
                /* ==== image size ratio ==== */
                if (this.ratioImage &amp;gt; 1)
                    this.point2D.h = Math.round(this.point2D.w / this.ratioImage);
                else
                {
                    this.point2D.h = this.point2D.w;
                    this.point2D.w = Math.round(this.point2D.h * this.ratioImage);
                }
            }
            /* ==== rendering ==== */
            o.draw = function ()
            {
                if (this.complete)
                {
                    /* ==== paranoid image load ==== */
                    if (!this.loaded)
                    {
                        if (!this.img)
                        {
                            /* ==== create internal image ==== */
                            this.img = new Image();
                            this.img.src = this.src;
                        }
                        if (this.img.complete)
                        {
                            /* ==== get width / height ratio ==== */
                            this.style.visibility = &amp;#39;visible&amp;#39;;
                            this.ratioImage = this.img.width / this.img.height;
                            this.loaded = true;
                            this.img = false;
                        }
                    }
                    /* ==== HTML rendering ==== */
                    this.style.left = Math.round(
                                        this.point2D.x * this.point2D.scale +
                                        tv.screen.w - this.point2D.w * .5
                                      ) + &amp;#39;px&amp;#39;;
                    this.style.top  = Math.round(
                                        this.point2D.y * this.point2D.scale +
                                        tv.screen.h - this.point2D.h * .5
                                      ) + &amp;#39;px&amp;#39;;
                    this.style.width  = this.point2D.w + &amp;#39;px&amp;#39;;
                    this.style.height = this.point2D.h + &amp;#39;px&amp;#39;;
                    this.style.borderWidth = Math.round(
                                               Math.max(
                                                 this.point2D.w,
                                                 this.point2D.h
                                               ) * tv.grid.borderSize * .01
                                             ) + &amp;#39;px&amp;#39;;
                    this.style.zIndex = Math.floor(this.point2D.scale * 100);
                }
            }
        }
    }
    /* ==== start script ==== */
    tv.resize();
    mouse.y = tv.screen.y + tv.screen.h;
    mouse.x = tv.screen.x + tv.screen.w;
    tv.run();
},

/* ==== resize window ==== */
resize : function ()
{
    var o = tv.screen.obj;
    tv.screen.w = o.offsetWidth / 2;
    tv.screen.h = o.offsetHeight / 2;
    tv.camera.zoom.target = tv.screen.w / (tv.grid.size + .1);
    for (tv.screen.x = 0, tv.screen.y = 0; o != null; o = o.offsetParent)
    {
        tv.screen.x += o.offsetLeft;
        tv.screen.y += o.offsetTop;
    }
},

/* ==== main loop ==== */
run : function ()
{
    /* ==== motion ease ==== */
    tv.angle.x.move(-(mouse.y - tv.screen.h - tv.screen.y) * .0025, .1);
    tv.angle.y.move( (mouse.x - tv.screen.w - tv.screen.x) * .0025, .1);
    tv.camera.x.move(tv.camera.x.target, tv.grid.zoomed ? .25 : .025);
    tv.camera.y.move(tv.camera.y.target, tv.grid.zoomed ? .25 : .025);
    tv.camera.zoom.move(tv.camera.zoom.target, .05);
    /* ==== angles sin and cos ==== */
    tv.angle.cx = Math.cos(tv.angle.x.position);
    tv.angle.sx = Math.sin(tv.angle.x.position);
    tv.angle.cy = Math.cos(tv.angle.y.position);
    tv.angle.sy = Math.sin(tv.angle.y.position);
    /* ==== loop through all images ==== */
    for (var i = 0, o; o = tv.O[i]; i++)
    {
        o.calc();
        o.draw();
    }
    /* ==== loop ==== */
    setTimeout(tv.run, 32);
}
</code></pre>

<p>}</p>

<p>/<em> ==== global mouse position ==== </em>/
var mouse = {
    x : 0,
    y : 0
}
document.onmousemove = function(e)
{
    if (window.event) e = window.event;
    mouse.x = e.clientX;
    mouse.y = e.clientY;
    return false;
}</p>

<p>&lt;/script&gt;</pre></p>

<pre><code>      &lt;br&gt;&lt;br&gt;
      作者: &lt;a href="http://maozj.javaeye.com"&gt;maozj&lt;/a&gt; 
      &lt;br&gt;
      声明: 本文系JavaEye网站发布的原创文章，未经作者书面许可，严禁任何网站转载本文，否则必将追究法律责任！
      &lt;br&gt;&lt;br&gt;
      &lt;span style="color:red"&gt;
        &lt;a href="http://www.javaeye.com/topic/703413" style="color:red"&gt;已有 &lt;strong&gt;0&lt;/strong&gt; 人发表回复，猛击-&amp;gt;&amp;gt;&lt;strong&gt;这里&lt;/strong&gt;&amp;lt;&amp;lt;-参与讨论&lt;/a&gt;
      &lt;/span&gt;
      &lt;br&gt;&lt;br&gt;&lt;br&gt;
</code></pre>

<p><span style="color:#e28822">JavaEye推荐</span>
<br></p>

<ul><li><a href="http://www.iteye.com/clicks/138"><span style="color:red;font-weight:bold">上海：高薪诚聘Python开发人员</span></a></li><li><a href="http://www.iteye.com/clicks/269"><span style="color:red;font-weight:bold">北京：手机之家网站诚聘PHP程序员</span></a></li></ul>


<p><br><br><br></p>

</div>


            <div class="footer">
              <div class="contact">
                <p>
                  Your Name<br />
                  What You Are<br />
                  your@email.com
                </p>
              </div>
              <div class="contact">
                <p>
                  <a href="http://github.com/yourusername/">github.com/yourusername</a><br />
                  <a href="http://twitter.com/yourusername/">twitter.com/yourusername</a><br />
                </p>
              </div>
            </div>
          </div>
        </div> <!-- /container -->

    </body>
</html>
