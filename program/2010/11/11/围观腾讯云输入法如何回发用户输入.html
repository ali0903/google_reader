<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>围观腾讯云输入法如何回发用户输入</title>
        <meta name="viewport" content="width=device-width">

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/google_reader/css/syntax.css">

        <!-- Custom CSS -->
        <link rel="stylesheet" href="/google_reader/css/main.css">

    </head>
    <body>

        <div class="container">
          <div class="site">
            <div class="header">
              <h1 class="title"><a href="/google_reader/">Google Reader</a></h1>
              <a class="extra" href="/google_reader/">home</a>
            </div>

                <h2>围观腾讯云输入法如何回发用户输入</h2>
<p class="meta">2010-11-11 22:44</p>

<div class="post">
<h2>围观腾讯云输入法如何回发用户输入</h2>

<h3>by birdshome</h3>

<h3>at 2010-11-11 14:44:00</h3>

<h3>original <a href="http://www.cnblogs.com/birdshome/archive/2010/11/11/qq_ime.html">http://www.cnblogs.com/birdshome/archive/2010/11/11/qq_ime.html</a></h3>

<p><p>　　太久没有写博客了，这个懒惰的惯性实在是太强大。这两天不说说360和QQ的事情，就显得很out了，但是说来说去却又很鸡毛。另外我怎么没有看到什么弹窗呢，听说好不热闹啊，TM/MSN和MSE用户艰难的表示鸭梨很大。腾讯云输入法回传用户输入数据，在这个节骨眼上被逮到，还真算给力。</p>
<p> </p>
<p>　　大家可以去“腾讯软件中心”试试这个云输入法，<a href="http://py.qq.com/web/">http://py.qq.com/web/</a>。但是注意不要输入什么敏感内容，免的有被跨省的风险。百度也有类似的输入法，只是好像没有咋呼叫作云输入法，而且百度还支持手写。谁有兴趣，可以查一下哪家先出的这种输入法？</p>
<p> </p>
<p>　　说正经的，QQ云输入法是怎么工作的呢？很简单，给任意一个网页导入一个脚本文件就可以了。 </p>
<div>
<div><span style="color:#0000ff">&lt;</span><span style="color:#800000">script </span><span style="color:#ff0000">type</span><span style="color:#0000ff">="text/javascript"</span><span style="color:#ff0000"> language</span><span style="color:#0000ff">="JavaScript"</span><span style="color:#ff0000"> src</span><span style="color:#0000ff">="http://ime.qq.com/fcgi-bin/getjs"</span><span style="color:#0000ff">&gt;&lt;/</span><span style="color:#800000">script</span><span style="color:#0000ff">&gt;</span><span style="color:#000000"><br></span></div></div>
<p> 　　相当简单。然后呢，取回一个大约42k的文件，叫ime.js。文件是压缩过的，版本号：rev.632（这个很重要，待会儿他们一加班，就拿不到了）</p>
<p> </p>
<p>　　脚本启动后，会后先向服务器报告一下客户端环境，这些从浏览器里获取的参数，不是什么隐私，就是user-agent都比这丰富。</p>
<div>
<div><span style="color:#000000">http://ime.qq.com/fcgi-bin/reportfirst?</span><span style="color:#0000ff"><strong>key=d02e5d08310c90ac54d37089fbf3d8ed</strong></span><span style="color:#ff0000">&amp;version</span><span style="color:#000000">=632</span><span style="color:#ff0000">&amp;sp</span><span style="color:#000000">=1</span><span style="color:#ff0000">&amp;sw</span><span style="color:#000000">=1920</span><span style="color:#ff0000">&amp;sh</span><span style="color:#000000">=1080</span><span style="color:#ff0000">&amp;dw</span><span style="color:#000000">=1920</span><span style="color:#ff0000">&amp;dh</span><span style="color:#000000">=512</span><span style="color:#ff0000">&amp;t</span><span style="color:#000000">=1289458673612</span></div></div>
<p> 　　但是惊喜还是有的，这个报告中包含了一个唯一的key，作用就相当于浏览器session_id。接下来的所有和腾讯服务器的交互，都会带着这个key。</p>
<p> </p>
<p>　　在英文输入状态下，任何字符输入会被云输入法脚本截获，然后向服务器回发如下请求：</p>
<div>
<div><span style="color:#000000">http://ime.qq.com/fcgi-bin/getword?key=d02e5d08310c90ac54d37089fbf3d8ed</span><span style="color:#ff0000">&amp;cb</span><span style="color:#000000">=window.QQWebIME.callback612</span><span style="color:#ff0000">&amp;q</span><span style="color:#0000ff">=qq</span></div></div>
<p> 　　注意key！cb是ime.js运行后注册的回调函数，蓝色的<span style="color:#0000ff">qq</span>是我的输入。服务器响因为：</p>
<div>
<div>
<div><span style="color:#000000">window.QQWebIME.callback612({</span><span style="color:#000000">"</span><span style="color:#000000">is_end</span><span style="color:#000000">"</span><span style="color:#000000">:</span><span style="color:#000000">"</span><span style="color:#000000">0</span><span style="color:#000000">"</span><span style="color:#000000">,</span><span style="color:#000000">"</span><span style="color:#000000">p</span><span style="color:#000000">"</span><span style="color:#000000">:</span><span style="color:#000000">"</span><span style="color:#000000">1</span><span style="color:#000000">"</span><span style="color:#000000">,</span><span style="color:#000000">"</span><span style="color:#000000">pg</span><span style="color:#000000">"</span><span style="color:#000000">:</span><span style="color:#000000">"</span><span style="color:#000000">5</span><span style="color:#000000">"</span><span style="color:#000000">,</span><span style="color:#000000">"</span><span style="color:#000000">q</span><span style="color:#000000">"</span><span style="color:#000000">:</span><span style="color:#000000">"</span><span style="color:#000000">qq</span><span style="color:#000000">"</span><span style="color:#000000">,</span><span style="color:#000000">"</span><span style="color:#000000">ret</span><span style="color:#000000">"</span><span style="color:#000000">:</span><span style="color:#000000">"</span><span style="color:#000000">suc</span><span style="color:#000000">"</span><span style="color:#000000">,</span><span style="color:#000000">"</span><span style="color:#000000">rs</span><span style="color:#000000">"</span><span style="color:#000000">:[</span><span style="color:#000000">"</span><span style="color:#000000">QQ</span><span style="color:#000000">"</span><span style="color:#000000">,</span><span style="color:#000000">"</span><span style="color:#000000">亲戚</span><span style="color:#000000">"</span><span style="color:#000000">,</span><span style="color:#000000">"</span><span style="color:#000000">亲亲</span><span style="color:#000000">"</span><span style="color:#000000">,</span><span style="color:#000000">"</span><span style="color:#000000">悄悄</span><span style="color:#000000">"</span><span style="color:#000000">,</span><span style="color:#000000">"</span><span style="color:#000000">轻轻</span><span style="color:#000000">"</span><span style="color:#000000">,</span><span style="color:#000000">"</span><span style="color:#000000">强求</span><span style="color:#000000">"</span><span style="color:#000000">,</span><span style="color:#000000">"</span><span style="color:#000000">求求</span><span style="color:#000000">"</span><span style="color:#000000">,</span><span style="color:#000000">"</span><span style="color:#000000">缺钱</span><span style="color:#000000">"</span><span style="color:#000000">,</span><span style="color:#000000">"</span><span style="color:#000000">请求</span><span style="color:#000000">"</span><span style="color:#000000">,</span><span style="color:#000000">"</span><span style="color:#000000">亲切</span><span style="color:#000000">"</span><span style="color:#000000">,</span><span style="color:#000000">"</span><span style="color:#000000">圈圈</span><span style="color:#000000">"</span><span style="color:#000000">,</span><span style="color:#000000">"</span><span style="color:#000000">前期</span><span style="color:#000000">"</span><span style="color:#000000">,</span><span style="color:#000000">"</span><span style="color:#000000">瞧瞧</span><span style="color:#000000">"</span><span style="color:#000000">,</span><span style="color:#000000">"</span><span style="color:#000000">亲情</span><span style="color:#000000">"</span><span style="color:#000000">,</span><span style="color:#000000">"</span><span style="color:#000000">全球</span><span style="color:#000000">"</span><span style="color:#000000">,</span><span style="color:#000000">"</span><span style="color:#000000">气球</span><span style="color:#000000">"</span><span style="color:#000000">,</span><span style="color:#000000">"</span><span style="color:#000000">齐全</span><span style="color:#000000">"</span><span style="color:#000000">,</span><span style="color:#000000">"</span><span style="color:#000000">取钱</span><span style="color:#000000">"</span><span style="color:#000000">,</span><span style="color:#000000">"</span><span style="color:#000000">情趣</span><span style="color:#000000">"</span><span style="color:#000000">,</span><span style="color:#000000">"</span><span style="color:#000000">千千</span><span style="color:#000000">"</span><span style="color:#000000">],</span><span style="color:#000000">"</span><span style="color:#000000">rscnt</span><span style="color:#000000">"</span><span style="color:#000000">:</span><span style="color:#000000">"</span><span style="color:#000000">20</span><span style="color:#000000">"</span><span style="color:#000000">,</span><span style="color:#000000">"</span><span style="color:#000000">rsn</span><span style="color:#000000">"</span><span style="color:#000000">:[</span><span style="color:#000000">"</span><span style="color:#000000">2</span><span style="color:#000000">"</span><span style="color:#000000">,</span><span style="color:#000000">"</span><span style="color:#000000">2</span><span style="color:#000000">"</span><span style="color:#000000">,</span><span style="color:#000000">"</span><span style="color:#000000">2</span><span style="color:#000000">"</span><span style="color:#000000">,</span><span style="color:#000000">"</span><span style="color:#000000">2</span><span style="color:#000000">"</span><span style="color:#000000">,</span><span style="color:#000000">"</span><span style="color:#000000">2</span><span style="color:#000000">"</span><span style="color:#000000">,</span><span style="color:#000000">"</span><span style="color:#000000">2</span><span style="color:#000000">"</span><span style="color:#000000">,</span><span style="color:#000000">"</span><span style="color:#000000">2</span><span style="color:#000000">"</span><span style="color:#000000">,</span><span style="color:#000000">"</span><span style="color:#000000">2</span><span style="color:#000000">"</span><span style="color:#000000">,</span><span style="color:#000000">"</span><span style="color:#000000">2</span><span style="color:#000000">"</span><span style="color:#000000">,</span><span style="color:#000000">"</span><span style="color:#000000">2</span><span style="color:#000000">"</span><span style="color:#000000">,</span><span style="color:#000000">"</span><span style="color:#000000">2</span><span style="color:#000000">"</span><span style="color:#000000">,</span><span style="color:#000000">"</span><span style="color:#000000">2</span><span style="color:#000000">"</span><span style="color:#000000">,</span><span style="color:#000000">"</span><span style="color:#000000">2</span><span style="color:#000000">"</span><span style="color:#000000">,</span><span style="color:#000000">"</span><span style="color:#000000">2</span><span style="color:#000000">"</span><span style="color:#000000">,</span><span style="color:#000000">"</span><span style="color:#000000">2</span><span style="color:#000000">"</span><span style="color:#000000">,</span><span style="color:#000000">"</span><span style="color:#000000">2</span><span style="color:#000000">"</span><span style="color:#000000">,</span><span style="color:#000000">"</span><span style="color:#000000">2</span><span style="color:#000000">"</span><span style="color:#000000">,</span><span style="color:#000000">"</span><span style="color:#000000">2</span><span style="color:#000000">"</span><span style="color:#000000">,</span><span style="color:#000000">"</span><span style="color:#000000">2</span><span style="color:#000000">"</span><span style="color:#000000">,</span><span style="color:#000000">"</span><span style="color:#000000">2</span><span style="color:#000000">"</span><span style="color:#000000">]})</span></div></div></div>
<p> 　　这时你可以像普通输入法一样进行选词，而且很自然的是，选词后没有服务器请求发生。也就是你的输入内容，都是在浏览器本地完成的，腾讯除了知道你请求了什么候选词列表外，不知道你到底输入了什么。似乎这一切都很美好，也就应该是这么美好才对，是吧？</p>
<p> </p>
<p>　　但是这不是360在隐私问题上掐QQ吗，本来我一直认为腾讯这么大一个上市公司，做事还是该有点底线的。但是360让大家看到了腾讯是没有底线的，真流氓揭露了伪君子。于是我就怀着最大的恶意想，这输入法因该还是有问题的。于是继续使用，突然发现一个异常的服务器请求，如下： </p>
<div>
<div>
<div><span style="color:#000000">http://ime.qq.com/fcgi-bin/reportword?key=d02e5d08310c90ac54d37089fbf3d8ed</span><span style="color:#ff0000">&amp;num</span><span style="color:#000000">=11</span><span style="color:#ff0000">&amp;xl</span><span style="color:#000000">=danshi,%E4%BD%86%E6%98%AF,0,0,1,0|zhe,%E8%BF%99,0,0,1,0|bushi,%E4%B8%8D%E6%98%AF,0,0,1,0|zaihe,%E5%9C%A8%E5%92%8C,0,0,1,0|tengxun,%E8%85%BE%E8%AE%AF,0,0,1,0|zuoweiyige,%E4%BD%9C%E4%B8%BA%E4%B8%80%E4%B8%AA,0,0,1,0|shangshi,%E4%B8%8A%E5%B8%82,0,0,1,0|gongsi,%E5%85%AC%E5%8F%B8,0,0,1,0|zuoshihaishiyinggai,%E5%81%9A%E4%BA%8B%E8%BF%98%E6%98%AF%E5%BA%94%E8%AF%A5,0,0,1,0|you,%E6%9C%89,0,0,1,0|dixian,%E5%BA%95%E7%BA%BF,0,0,1,0</span></div></div></div>
<p> 　　把这堆编码过的字符转回来，是： </p>
<div>
<div>
<div><span style="color:#000000">http://ime.qq.com/fcgi-bin/reportword?key=d02e5d08310c90ac54d37089fbf3d8ed</span><span style="color:#ff0000">&amp;num</span><span style="color:#000000">=11</span><span style="color:#ff0000">&amp;xl</span><span style="color:#000000">=danshi,但是,0,0,1,0|zhe,这,0,0,1,0|bushi,不是,0,0,1,0|zaihe,在和,0,0,1,0|tengxun,腾讯,0,0,1,0|zuoweiyige,作为一个,0,0,1,0|shangshi,上市,0,0,1,0|gongsi,公司,0,0,1,0|zuoshihaishiyinggai,做事还是应该,0,0,1,0|you,有,0,0,1,0|dixian,底线,0,0,1,0</span></div></div></div>
<p>　　你这时是不是只想向狗日的企鹅竖起中指呢？</p>
<p> </p>
<p>　　这是不是我没看清楚了，把ime.js仔细看了一下，tmd居然是混淆过的，看得我好累<img alt="" src="http://www.cnblogs.com/Emoticons/msn/angry_smile.gif">。谜底就在这里了：</p>
<div><span style="color:#000000">ha </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">function</span><span style="color:#000000"> () {<br>    </span><span style="color:#0000ff">var</span><span style="color:#000000"> e </span><span style="color:#000000">=</span><span style="color:#000000"> [], a </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">new</span><span style="color:#000000"> Image(</span><span style="color:#000000">1</span><span style="color:#000000">, </span><span style="color:#000000">1</span><span style="color:#000000">), b </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">false</span><span style="color:#000000">,<br>    j </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">function</span><span style="color:#000000"> () {<br>        a.onload </span><span style="color:#000000">=</span><span style="color:#000000"> a.onerror </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">null</span><span style="color:#000000">;<br>        b </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">false</span><span style="color:#000000">;<br>        J </span><span style="color:#000000">&amp;&amp;</span><span style="color:#000000"> CollectGarbage()<br>    },<br>    r </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">function</span><span style="color:#000000"> (w) {<br>        b </span><span style="color:#000000">&amp;&amp;</span><span style="color:#000000"> j();<br>        a.src </span><span style="color:#000000">=</span><span style="color:#000000"> w;<br>        a.onload </span><span style="color:#000000">=</span><span style="color:#000000"> a.onerror </span><span style="color:#000000">=</span><span style="color:#000000"> j;<br>        a.complete </span><span style="color:#000000">&amp;&amp;</span><span style="color:#000000"> j();<br>        b </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">true</span><span style="color:#000000"><br>    },<br>    s </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#000000">""</span><span style="color:#000000">, n </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#000000">""</span><span style="color:#000000">,<br>    v </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">function</span><span style="color:#000000"> () {<br>        </span><span style="color:#0000ff">return</span><span style="color:#000000"> s </span><span style="color:#000000">+</span><span style="color:#000000"> </span><span style="color:#000000">"</span><span style="color:#000000">&amp;num=</span><span style="color:#000000">"</span><span style="color:#000000"> </span><span style="color:#000000">+</span><span style="color:#000000"> e.length </span><span style="color:#000000">+</span><span style="color:#000000"> </span><span style="color:#000000">"</span><span style="color:#000000">&amp;xl=</span><span style="color:#000000">"</span><span style="color:#000000"> </span><span style="color:#000000">+</span><span style="color:#000000"> e.join(</span><span style="color:#000000">"</span><span style="color:#000000">|</span><span style="color:#000000">"</span><span style="color:#000000">)<br>    };<br>    </span><span style="color:#0000ff">return</span><span style="color:#000000"> {<br>        a:<br>        </span><span style="color:#0000ff">function</span><span style="color:#000000"> () {<br>            </span><span style="color:#0000ff">var</span><span style="color:#000000"> w;<br>            w </span><span style="color:#000000">=</span><span style="color:#000000"> c.c();<br>            w </span><span style="color:#000000">=</span><span style="color:#000000"> o.b(</span><span style="color:#000000">"</span><span style="color:#000000">cgiPrx</span><span style="color:#000000">"</span><span style="color:#000000">) </span><span style="color:#000000">+</span><span style="color:#000000"> </span><span style="color:#000000">"</span><span style="color:#000000">reportfirst?key=</span><span style="color:#000000">"</span><span style="color:#000000"> </span><span style="color:#000000">+</span><span style="color:#000000"> o.b(</span><span style="color:#000000">"</span><span style="color:#000000">prvKey</span><span style="color:#000000">"</span><span style="color:#000000">) </span><span style="color:#000000">+</span><span style="color:#000000"> </span><span style="color:#000000">"</span><span style="color:#000000">&amp;version=632&amp;sp=</span><span style="color:#000000">"</span><span style="color:#000000"> </span><span style="color:#000000">+</span><span style="color:#000000"> o.b(</span><span style="color:#000000">"</span><span style="color:#000000">lnchr</span><span style="color:#000000">"</span><span style="color:#000000">) </span><span style="color:#000000">+</span><span style="color:#000000"> </span><span style="color:#000000">"</span><span style="color:#000000">&amp;sw=</span><span style="color:#000000">"</span><span style="color:#000000"><br>                </span><span style="color:#000000">+</span><span style="color:#000000"> screen.width </span><span style="color:#000000">+</span><span style="color:#000000"> </span><span style="color:#000000">"</span><span style="color:#000000">&amp;sh=</span><span style="color:#000000">"</span><span style="color:#000000"> </span><span style="color:#000000">+</span><span style="color:#000000"> screen.height </span><span style="color:#000000">+</span><span style="color:#000000"> </span><span style="color:#000000">"</span><span style="color:#000000">&amp;dw=</span><span style="color:#000000">"</span><span style="color:#000000"> </span><span style="color:#000000">+</span><span style="color:#000000"> w[</span><span style="color:#000000">0</span><span style="color:#000000">] </span><span style="color:#000000">+</span><span style="color:#000000"> </span><span style="color:#000000">"</span><span style="color:#000000">&amp;dh=</span><span style="color:#000000">"</span><span style="color:#000000"> </span><span style="color:#000000">+</span><span style="color:#000000"> w[</span><span style="color:#000000">1</span><span style="color:#000000">] </span><span style="color:#000000">+</span><span style="color:#000000"> </span><span style="color:#000000">"</span><span style="color:#000000">&amp;t=</span><span style="color:#000000">"</span><span style="color:#000000"> </span><span style="color:#000000">+</span><span style="color:#000000"> Ba;<br>            r(w);<br>            s </span><span style="color:#000000">=</span><span style="color:#000000"> o.b(</span><span style="color:#000000">"</span><span style="color:#000000">cgiPrx</span><span style="color:#000000">"</span><span style="color:#000000">) </span><span style="color:#000000">+</span><span style="color:#000000"> </span><span style="color:#000000">"</span><span style="color:#000000">reportword?key=</span><span style="color:#000000">"</span><span style="color:#000000"> </span><span style="color:#000000">+</span><span style="color:#000000"> o.b(</span><span style="color:#000000">"</span><span style="color:#000000">prvKey</span><span style="color:#000000">"</span><span style="color:#000000">)<br>        },<br>        b:<br>        </span><span style="color:#0000ff">function</span><span style="color:#000000"> (w) {<br>            </span><span style="color:#0000ff">if</span><span style="color:#000000"> (S </span><span style="color:#000000">!==</span><span style="color:#000000"> w) {<br>                </span><span style="color:#0000ff">var</span><span style="color:#000000"> l </span><span style="color:#000000">=</span><span style="color:#000000"> w.length;<br>                </span><span style="color:#0000ff">if</span><span style="color:#000000"> (</span><span style="color:#000000">0</span><span style="color:#000000"> </span><span style="color:#000000">!==</span><span style="color:#000000"> l) {<br>                    </span><span style="color:#0000ff">for</span><span style="color:#000000"> (</span><span style="color:#0000ff">var</span><span style="color:#000000"> h </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#000000">""</span><span style="color:#000000">, m </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#000000">""</span><span style="color:#000000">, g </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#000000">0</span><span style="color:#000000">; g </span><span style="color:#000000">&lt;</span><span style="color:#000000"> l; g</span><span style="color:#000000">++</span><span style="color:#000000">) {<br>                        </span><span style="color:#0000ff">var</span><span style="color:#000000"> x </span><span style="color:#000000">=</span><span style="color:#000000"> w[g],<br>                        k </span><span style="color:#000000">=</span><span style="color:#000000"> encodeURIComponent(x.kanji);<br>                        e.push(x.spell </span><span style="color:#000000">+</span><span style="color:#000000"> </span><span style="color:#000000">"</span><span style="color:#000000">,</span><span style="color:#000000">"</span><span style="color:#000000"> </span><span style="color:#000000">+</span><span style="color:#000000"> k </span><span style="color:#000000">+</span><span style="color:#000000"> </span><span style="color:#000000">"</span><span style="color:#000000">,</span><span style="color:#000000">"</span><span style="color:#000000"> </span><span style="color:#000000">+</span><span style="color:#000000"> n);<br>                        h </span><span style="color:#000000">+=</span><span style="color:#000000"> x.spell;<br>                        m </span><span style="color:#000000">+=</span><span style="color:#000000"> k<br>                    }<br>                    </span><span style="color:#000000">1</span><span style="color:#000000"> </span><span style="color:#000000">&lt;</span><span style="color:#000000"> l </span><span style="color:#000000">&amp;&amp;</span><span style="color:#000000"> e.push(h </span><span style="color:#000000">+</span><span style="color:#000000"> </span><span style="color:#000000">"</span><span style="color:#000000">,</span><span style="color:#000000">"</span><span style="color:#000000"> </span><span style="color:#000000">+</span><span style="color:#000000"> m </span><span style="color:#000000">+</span><span style="color:#000000"> </span><span style="color:#000000">"</span><span style="color:#000000">,</span><span style="color:#000000">"</span><span style="color:#000000"> </span><span style="color:#000000">+</span><span style="color:#000000"> n);<br>                    </span><span style="color:#0000ff">if</span><span style="color:#000000"> (</span><span style="color:#000000">10</span><span style="color:#000000"> </span><span style="color:#000000">&lt;</span><span style="color:#000000"> e.length) {<br>                        r(v()); e </span><span style="color:#000000">=</span><span style="color:#000000"> []<br>                    }<br>                }<br>            }<br>        },<br>        j:<br>        </span><span style="color:#0000ff">function</span><span style="color:#000000"> (w) {<br>            w </span><span style="color:#000000">=</span><span style="color:#000000"> o.b(</span><span style="color:#000000">"</span><span style="color:#000000">cgiPrx</span><span style="color:#000000">"</span><span style="color:#000000">) </span><span style="color:#000000">+</span><span style="color:#000000"> </span><span style="color:#000000">"</span><span style="color:#000000">re?key=</span><span style="color:#000000">"</span><span style="color:#000000"> </span><span style="color:#000000">+</span><span style="color:#000000"> o.b(</span><span style="color:#000000">"</span><span style="color:#000000">prvKey</span><span style="color:#000000">"</span><span style="color:#000000">) </span><span style="color:#000000">+</span><span style="color:#000000"> </span><span style="color:#000000">"</span><span style="color:#000000">&amp;ec=</span><span style="color:#000000">"</span><span style="color:#000000"> </span><span style="color:#000000">+</span><span style="color:#000000"> w </span><span style="color:#000000">+</span><span style="color:#000000"> </span><span style="color:#000000">"</span><span style="color:#000000">&amp;py=</span><span style="color:#000000">"</span><span style="color:#000000"> </span><span style="color:#000000">+</span><span style="color:#000000"> B.o() </span><span style="color:#000000">+</span><span style="color:#000000"> </span><span style="color:#000000">"</span><span style="color:#000000">&amp;t=</span><span style="color:#000000">"</span><span style="color:#000000"><br>                </span><span style="color:#000000">+</span><span style="color:#000000"> (</span><span style="color:#000000">+</span><span style="color:#0000ff">new</span><span style="color:#000000"> Date).toString().slice(</span><span style="color:#000000">0</span><span style="color:#000000">, </span><span style="color:#000000">-</span><span style="color:#000000">3</span><span style="color:#000000">) </span><span style="color:#000000">+</span><span style="color:#000000"> </span><span style="color:#000000">"</span><span style="color:#000000">&amp;v=632</span><span style="color:#000000">"</span><span style="color:#000000">;<br>            r(w)<br>        },<br>        k:<br>        </span><span style="color:#0000ff">function</span><span style="color:#000000"> () {<br>            </span><span style="color:#0000ff">if</span><span style="color:#000000"> (</span><span style="color:#000000">0</span><span style="color:#000000"> </span><span style="color:#000000">!==</span><span style="color:#000000"> e.length) {<br>                r(v());<br>                e </span><span style="color:#000000">=</span><span style="color:#000000"> []<br>            }<br>        },<br>        l:<br>        </span><span style="color:#0000ff">function</span><span style="color:#000000"> () {<br>            </span><span style="color:#0000ff">var</span><span style="color:#000000"> w </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#000000">1</span><span style="color:#000000"> </span><span style="color:#000000">===</span><span style="color:#000000"> o.b(</span><span style="color:#000000">"</span><span style="color:#000000">iptMode</span><span style="color:#000000">"</span><span style="color:#000000">);<br>            n </span><span style="color:#000000">=</span><span style="color:#000000"> [</span><span style="color:#000000">"</span><span style="color:#000000">0</span><span style="color:#000000">"</span><span style="color:#000000">, o.b(</span><span style="color:#000000">"</span><span style="color:#000000">iptMode</span><span style="color:#000000">"</span><span style="color:#000000">) </span><span style="color:#000000">-</span><span style="color:#000000"> </span><span style="color:#000000">1</span><span style="color:#000000">, w </span><span style="color:#000000">?</span><span style="color:#000000"> o.b(</span><span style="color:#000000">"</span><span style="color:#000000">pyMode</span><span style="color:#000000">"</span><span style="color:#000000">) : </span><span style="color:#000000">"</span><span style="color:#000000">0</span><span style="color:#000000">"</span><span style="color:#000000">, w </span><span style="color:#000000">&amp;&amp;</span><span style="color:#000000"> </span><span style="color:#000000">1</span><span style="color:#000000"> </span><span style="color:#000000">!==</span><span style="color:#000000"> o.b(</span><span style="color:#000000">"</span><span style="color:#000000">pyMode</span><span style="color:#000000">"</span><span style="color:#000000">) </span><span style="color:#000000">?</span><span style="color:#000000"> o.b(</span><span style="color:#000000">"</span><span style="color:#000000">spType</span><span style="color:#000000">"</span><span style="color:#000000">) : </span><span style="color:#000000">"</span><span style="color:#000000">0</span><span style="color:#000000">"</span><span style="color:#000000">].join(</span><span style="color:#000000">"</span><span style="color:#000000">,</span><span style="color:#000000">"</span><span style="color:#000000">)<br>        }<br>    }<br>} ()</span></div>
<p>　　多贴点code，表示这是技术贴，不是5毛贴咯（听说涨7毛了，通胀太厉害了）。答案就在这个ha伪类的函数b里，这个b函数是用来记录输入历史的，但是在这个方法最后，做了一个判断：if (10 &lt; e.length) { r(v()); e = [] }。e是存放输入历史的数组，方法r和v是负责组装和回发数据的，发完后清空了e。</p>
<p> </p>
<p>　　难道收集用户输入内容成了中国国情了？微软拼音2010还真的有这个功能，不过它会明确提示用户，并且只是发回那些用户纠正输入推荐，而且回发的内容也是用户可以很容易看到和编辑的。另外同样是web ime的百度输入法，回发服务器的信息是：</p>
<div>
<div><span style="color:#000000">http://olime.baidu.com/py?py=baidu</span><span style="color:#ff0000">&amp;rn</span><span style="color:#000000">=0</span><span style="color:#ff0000">&amp;pn</span><span style="color:#000000">=20</span><span style="color:#ff0000">&amp;t</span><span style="color:#000000">=1289460415974</span></div></div>
<p>　　注意，这里没有key信息，这不是说百度就不能identify你，因为还有浏览器session_id，但是百度的输入法没有回发用户实际选词，所以是无法在服务期上还原用户输入的。</p>
<p> </p>
<p>　　虽然这是篇技术文章，但是肯定掺杂了莫名的立场，那我现在的立场就是：胁迫用户者不得好死！</p><img src="http://www.cnblogs.com/birdshome/aggbug/1874875.html?type=1" width="1" height="1" alt=""><p>作者: <a href="http://www.cnblogs.com/birdshome/">birdshome</a> 发表于 2010-11-11 14:44 <a href="http://www.cnblogs.com/birdshome/archive/2010/11/11/qq_ime.html">原文链接</a></p><p>评论: 69　<a href="http://www.cnblogs.com/birdshome/archive/2010/11/11/qq_ime.html#pagedcomment">查看评论</a>　<a href="http://www.cnblogs.com/birdshome/archive/2010/11/11/qq_ime.html#commentform">发表评论</a></p><hr><p>最新新闻：<br>· <a href="http://news.cnblogs.com/n/80783/">光棍节半价促销：淘宝商城教给我们的四个成功经验</a><span style="color:gray">(2010-11-12 11:26)</span><br>· <a href="http://news.cnblogs.com/n/80782/">游戏与互联网从业者的4大文化差异</a><span style="color:gray">(2010-11-12 11:22)</span><br>· <a href="http://news.cnblogs.com/n/80780/">米农关注3Q大战：koukou域名5万美元成交</a><span style="color:gray">(2010-11-12 11:06)</span><br>· <a href="http://news.cnblogs.com/n/80774/">微软玩“诈尸” KIN系列手机死灰复燃</a><span style="color:gray">(2010-11-12 10:59)</span><br>· <a href="http://news.cnblogs.com/n/80773/">联想乐园推十款首发应用 一亿乐基金支持开发者</a><span style="color:gray">(2010-11-12 10:57)</span><br></p><p>编辑推荐：<a href="http://news.cnblogs.com/n/80732/">大撤退开始了—33名开发人员离开OpenOffice.org</a><br></p><p>网站导航：<a href="http://www.cnblogs.com">博客园首页</a>  <a href="http://home.cnblogs.com/">我的园子</a>  <a href="http://news.cnblogs.com">新闻</a>  <a href="http://home.cnblogs.com/ing/">闪存</a>  <a href="http://home.cnblogs.com/group/">小组</a>  <a href="http://space.cnblogs.com/q/">博问</a>  <a href="http://kb.cnblogs.com">知识库</a></p></p>


</div>


            <div class="footer">
              <div class="contact">
                <p>
                  Your Name<br />
                  What You Are<br />
                  your@email.com
                </p>
              </div>
              <div class="contact">
                <p>
                  <a href="http://github.com/lyuehh/">github.com/lyuehh</a><br />
                  <a href="http://twitter.com/lyuehh/">twitter.com/lyuehh</a><br />
                </p>
              </div>
            </div>
          </div>
        </div> <!-- /container -->

    </body>
</html>
