<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Android 车载的小小指南针【源码】</title>
        <meta name="viewport" content="width=device-width">

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/css/syntax.css">

        <!-- Custom CSS -->
        <link rel="stylesheet" href="/css/main.css">

    </head>
    <body>

        <div class="container">
          <div class="site">
            <div class="header">
              <h1 class="title"><a href="/">Your New Jekyll Site</a></h1>
              <a class="extra" href="/">home</a>
            </div>

                <h2>Android 车载的小小指南针【源码】</h2>
<p class="meta">12 Nov 2010</p>

<div class="post">
<h2>Android 车载的小小指南针【源码】</h2>

<h3>by Terry_龙</h3>

<h3>at 2010-11-12 14:17:00</h3>

<h3>original <a href="http://www.cnblogs.com/TerryBlog/archive/2010/11/12/1875657.html">http://www.cnblogs.com/TerryBlog/archive/2010/11/12/1875657.html</a></h3>

<p><p>在Api Demo 里面有一个指南针的例子，路径为com.example.android.apis.graphics-》Compass.java。源码使用的是SensorListener 做为动力感应为指南针传递角度。基于此原理不断的去画VIEW，目前能搜索出来的代码大致也是根据此DEMO做出修改。代码如下：</p>
<p> </p>
<div>
<div><span style="color:#008000">/*</span><span style="color:#008000"><br> * Copyright (C) 2007 The Android Open Source Project<br> *<br> * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);<br> * you may not use this file except in compliance with the License.<br> * You may obtain a copy of the License at<br> *<br> *      </span><span style="color:#008000;text-decoration:underline">http://www.apache.org/licenses/LICENSE-2.0</span><span style="color:#008000"><br> *<br> * Unless required by applicable law or agreed to in writing, software<br> * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,<br> * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.<br> * See the License for the specific language governing permissions and<br> * limitations under the License.<br> </span><span style="color:#008000">*/</span><span style="color:#000000"><br><br></span><span style="color:#0000ff">package</span><span style="color:#000000"> com.example.android.apis.graphics;<br><br></span><span style="color:#0000ff">import</span><span style="color:#000000"> android.app.Activity;<br></span><span style="color:#0000ff">import</span><span style="color:#000000"> android.content.Context;<br></span><span style="color:#0000ff">import</span><span style="color:#000000"> android.graphics.</span><span style="color:#000000">*</span><span style="color:#000000">;<br></span><span style="color:#0000ff">import</span><span style="color:#000000"> android.hardware.SensorListener;<br></span><span style="color:#0000ff">import</span><span style="color:#000000"> android.hardware.SensorManager;<br></span><span style="color:#0000ff">import</span><span style="color:#000000"> android.os.Bundle;<br></span><span style="color:#0000ff">import</span><span style="color:#000000"> android.os.Handler;<br></span><span style="color:#0000ff">import</span><span style="color:#000000"> android.os.Message;<br></span><span style="color:#0000ff">import</span><span style="color:#000000"> android.os.SystemClock;<br></span><span style="color:#0000ff">import</span><span style="color:#000000"> android.util.Config;<br></span><span style="color:#0000ff">import</span><span style="color:#000000"> android.util.Log;<br></span><span style="color:#0000ff">import</span><span style="color:#000000"> android.view.View;<br><br></span><span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">class</span><span style="color:#000000"> Compass </span><span style="color:#0000ff">extends</span><span style="color:#000000"> GraphicsActivity {<br><br>    </span><span style="color:#0000ff">private</span><span style="color:#000000"> </span><span style="color:#0000ff">static</span><span style="color:#000000"> </span><span style="color:#0000ff">final</span><span style="color:#000000"> String TAG </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#000000">"</span><span style="color:#000000">Compass</span><span style="color:#000000">"</span><span style="color:#000000">;<br><br>    </span><span style="color:#0000ff">private</span><span style="color:#000000"> SensorManager mSensorManager;<br>    </span><span style="color:#0000ff">private</span><span style="color:#000000"> SampleView mView;<br>    </span><span style="color:#0000ff">private</span><span style="color:#000000"> </span><span style="color:#0000ff">float</span><span style="color:#000000">[] mValues;<br>    <br>    </span><span style="color:#0000ff">private</span><span style="color:#000000"> </span><span style="color:#0000ff">final</span><span style="color:#000000"> SensorListener mListener </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">new</span><span style="color:#000000"> SensorListener() {<br>    <br>        </span><span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">void</span><span style="color:#000000"> onSensorChanged(</span><span style="color:#0000ff">int</span><span style="color:#000000"> sensor, </span><span style="color:#0000ff">float</span><span style="color:#000000">[] values) {<br>            </span><span style="color:#0000ff">if</span><span style="color:#000000"> (Config.LOGD) Log.d(TAG, </span><span style="color:#000000">"</span><span style="color:#000000">sensorChanged (</span><span style="color:#000000">"</span><span style="color:#000000"> </span><span style="color:#000000">+</span><span style="color:#000000"> values[</span><span style="color:#000000">0</span><span style="color:#000000">] </span><span style="color:#000000">+</span><span style="color:#000000"> </span><span style="color:#000000">"</span><span style="color:#000000">, </span><span style="color:#000000">"</span><span style="color:#000000"> </span><span style="color:#000000">+</span><span style="color:#000000"> values[</span><span style="color:#000000">1</span><span style="color:#000000">] </span><span style="color:#000000">+</span><span style="color:#000000"> </span><span style="color:#000000">"</span><span style="color:#000000">, </span><span style="color:#000000">"</span><span style="color:#000000"> </span><span style="color:#000000">+</span><span style="color:#000000"> values[</span><span style="color:#000000">2</span><span style="color:#000000">] </span><span style="color:#000000">+</span><span style="color:#000000"> </span><span style="color:#000000">"</span><span style="color:#000000">)</span><span style="color:#000000">"</span><span style="color:#000000">);<br>            mValues </span><span style="color:#000000">=</span><span style="color:#000000"> values;<br>            </span><span style="color:#0000ff">if</span><span style="color:#000000"> (mView </span><span style="color:#000000">!=</span><span style="color:#000000"> </span><span style="color:#0000ff">null</span><span style="color:#000000">) {<br>                mView.invalidate();<br>            }<br>        }<br><br>        </span><span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">void</span><span style="color:#000000"> onAccuracyChanged(</span><span style="color:#0000ff">int</span><span style="color:#000000"> sensor, </span><span style="color:#0000ff">int</span><span style="color:#000000"> accuracy) {<br>            </span><span style="color:#008000">//</span><span style="color:#008000"> TODO Auto-generated method stub</span><span style="color:#008000"><br></span><span style="color:#000000">            <br>        }<br>    };<br><br>    @Override<br>    </span><span style="color:#0000ff">protected</span><span style="color:#000000"> </span><span style="color:#0000ff">void</span><span style="color:#000000"> onCreate(Bundle icicle) {<br>        </span><span style="color:#0000ff">super</span><span style="color:#000000">.onCreate(icicle);<br>        mSensorManager </span><span style="color:#000000">=</span><span style="color:#000000"> (SensorManager)getSystemService(Context.SENSOR_SERVICE);<br>        mView </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">new</span><span style="color:#000000"> SampleView(</span><span style="color:#0000ff">this</span><span style="color:#000000">);<br>        setContentView(mView);<br>    }<br><br>    @Override<br>    </span><span style="color:#0000ff">protected</span><span style="color:#000000"> </span><span style="color:#0000ff">void</span><span style="color:#000000"> onResume()<br>    {<br>        </span><span style="color:#0000ff">if</span><span style="color:#000000"> (Config.LOGD) Log.d(TAG, </span><span style="color:#000000">"</span><span style="color:#000000">onResume</span><span style="color:#000000">"</span><span style="color:#000000">);<br>        </span><span style="color:#0000ff">super</span><span style="color:#000000">.onResume();<br>        mSensorManager.registerListener(mListener, <br>                SensorManager.SENSOR_ORIENTATION,<br>                SensorManager.SENSOR_DELAY_GAME);<br>    }<br>    <br>    @Override<br>    </span><span style="color:#0000ff">protected</span><span style="color:#000000"> </span><span style="color:#0000ff">void</span><span style="color:#000000"> onStop()<br>    {<br>        </span><span style="color:#0000ff">if</span><span style="color:#000000"> (Config.LOGD) Log.d(TAG, </span><span style="color:#000000">"</span><span style="color:#000000">onStop</span><span style="color:#000000">"</span><span style="color:#000000">);<br>        mSensorManager.unregisterListener(mListener);<br>        </span><span style="color:#0000ff">super</span><span style="color:#000000">.onStop();<br>    }<br><br>    </span><span style="color:#0000ff">private</span><span style="color:#000000"> </span><span style="color:#0000ff">class</span><span style="color:#000000"> SampleView </span><span style="color:#0000ff">extends</span><span style="color:#000000"> View {<br>        </span><span style="color:#0000ff">private</span><span style="color:#000000"> Paint   mPaint </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">new</span><span style="color:#000000"> Paint();<br>        </span><span style="color:#0000ff">private</span><span style="color:#000000"> Path    mPath </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">new</span><span style="color:#000000"> Path();<br>        </span><span style="color:#0000ff">private</span><span style="color:#000000"> </span><span style="color:#0000ff">boolean</span><span style="color:#000000"> mAnimate;<br>        </span><span style="color:#0000ff">private</span><span style="color:#000000"> </span><span style="color:#0000ff">long</span><span style="color:#000000">    mNextTime;<br><br>        </span><span style="color:#0000ff">public</span><span style="color:#000000"> SampleView(Context context) {<br>            </span><span style="color:#0000ff">super</span><span style="color:#000000">(context);<br><br>            </span><span style="color:#008000">//</span><span style="color:#008000"> Construct a wedge-shaped path</span><span style="color:#008000"><br></span><span style="color:#000000">            mPath.moveTo(</span><span style="color:#000000">0</span><span style="color:#000000">, </span><span style="color:#000000">-</span><span style="color:#000000">50</span><span style="color:#000000">);<br>            mPath.lineTo(</span><span style="color:#000000">-</span><span style="color:#000000">20</span><span style="color:#000000">, </span><span style="color:#000000">60</span><span style="color:#000000">);<br>            mPath.lineTo(</span><span style="color:#000000">0</span><span style="color:#000000">, </span><span style="color:#000000">50</span><span style="color:#000000">);<br>            mPath.lineTo(</span><span style="color:#000000">20</span><span style="color:#000000">, </span><span style="color:#000000">60</span><span style="color:#000000">);<br>            mPath.close();<br>        }<br>    <br>        @Override </span><span style="color:#0000ff">protected</span><span style="color:#000000"> </span><span style="color:#0000ff">void</span><span style="color:#000000"> onDraw(Canvas canvas) {<br>            Paint paint </span><span style="color:#000000">=</span><span style="color:#000000"> mPaint;<br><br>            canvas.drawColor(Color.WHITE);<br>            <br>            paint.setAntiAlias(</span><span style="color:#0000ff">true</span><span style="color:#000000">);<br>            paint.setColor(Color.BLACK);<br>            paint.setStyle(Paint.Style.FILL);<br><br>            </span><span style="color:#0000ff">int</span><span style="color:#000000"> w </span><span style="color:#000000">=</span><span style="color:#000000"> canvas.getWidth();<br>            </span><span style="color:#0000ff">int</span><span style="color:#000000"> h </span><span style="color:#000000">=</span><span style="color:#000000"> canvas.getHeight();<br>            </span><span style="color:#0000ff">int</span><span style="color:#000000"> cx </span><span style="color:#000000">=</span><span style="color:#000000"> w </span><span style="color:#000000">/</span><span style="color:#000000"> </span><span style="color:#000000">2</span><span style="color:#000000">;<br>            </span><span style="color:#0000ff">int</span><span style="color:#000000"> cy </span><span style="color:#000000">=</span><span style="color:#000000"> h </span><span style="color:#000000">/</span><span style="color:#000000"> </span><span style="color:#000000">2</span><span style="color:#000000">;<br><br>            canvas.translate(cx, cy);<br>            </span><span style="color:#0000ff">if</span><span style="color:#000000"> (mValues </span><span style="color:#000000">!=</span><span style="color:#000000"> </span><span style="color:#0000ff">null</span><span style="color:#000000">) {            <br>                canvas.rotate(</span><span style="color:#000000">-</span><span style="color:#000000">mValues[</span><span style="color:#000000">0</span><span style="color:#000000">]);<br>            }<br>            canvas.drawPath(mPath, mPaint);<br>        }<br>    <br>        @Override<br>        </span><span style="color:#0000ff">protected</span><span style="color:#000000"> </span><span style="color:#0000ff">void</span><span style="color:#000000"> onAttachedToWindow() {<br>            mAnimate </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">true</span><span style="color:#000000">;<br>            </span><span style="color:#0000ff">super</span><span style="color:#000000">.onAttachedToWindow();<br>        }<br>        <br>        @Override<br>        </span><span style="color:#0000ff">protected</span><span style="color:#000000"> </span><span style="color:#0000ff">void</span><span style="color:#000000"> onDetachedFromWindow() {<br>            mAnimate </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">false</span><span style="color:#000000">;<br>            </span><span style="color:#0000ff">super</span><span style="color:#000000">.onDetachedFromWindow();<br>        }<br>    }<br>}<br><br></span></div></div>
<p> </p>
<p> </p>
<p>运行结果：</p>
<p><img style="width:652px;height:395px" border="0" alt="" src="http://images.cnblogs.com/cnblogs_com/terryblog/compass.jpg" width="652" height="395"></p>
<p> </p>
<p>根据Api Demo的例子，我们就可以方便的实现自己想要的指南针效果了。下面是根据Api Demo给出的实现思路自己完成的一个小小指南针，要实现的效果为如下所示：</p>
<p><img style="width:463px;height:280px" border="0" alt="" src="http://images.cnblogs.com/cnblogs_com/terryblog/carcompass.jpg" width="463" height="280"></p>
<p>首先，项目启动时，设置屏幕为横屏显示：</p>
<p>在配置文件下对应的Activity 加入如下代码：</p>
<p>android:screenOrientation="landscape"</p>
<p>接着画View 将指南针的view 参照api Demo 画出来，由于我个人喜欢View 保存相对的独立性，所以都是将View 尽量的标准化，即可以以编程方式引用也可以在Layout 文件中使用XML引用。下面是我指南针View 代码：</p>
<p> </p>
<div>
<div><span style="color:#0000ff">package</span><span style="color:#000000"> com.yaomei.view;<br><br></span><span style="color:#0000ff">import</span><span style="color:#000000"> java.io.InputStream;<br><br></span><span style="color:#0000ff">import</span><span style="color:#000000"> android.content.Context;<br></span><span style="color:#0000ff">import</span><span style="color:#000000"> android.graphics.Bitmap;<br></span><span style="color:#0000ff">import</span><span style="color:#000000"> android.graphics.BitmapFactory;<br></span><span style="color:#0000ff">import</span><span style="color:#000000"> android.graphics.Canvas;<br></span><span style="color:#0000ff">import</span><span style="color:#000000"> android.graphics.Paint;<br></span><span style="color:#0000ff">import</span><span style="color:#000000"> android.graphics.BitmapFactory.Options;<br></span><span style="color:#0000ff">import</span><span style="color:#000000"> android.util.AttributeSet;<br></span><span style="color:#0000ff">import</span><span style="color:#000000"> android.view.View;<br><br></span><span style="color:#0000ff">import</span><span style="color:#000000"> com.yaomei.compass.R;<br><br></span><span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">class</span><span style="color:#000000"> CompassView </span><span style="color:#0000ff">extends</span><span style="color:#000000"> View {<br><br>    </span><span style="color:#0000ff">private</span><span style="color:#000000"> Bitmap[] mBitmapArray </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">new</span><span style="color:#000000"> Bitmap[</span><span style="color:#000000">4</span><span style="color:#000000">];<br>    InputStream is;<br>    </span><span style="color:#0000ff">private</span><span style="color:#000000"> </span><span style="color:#0000ff">float</span><span style="color:#000000">[] mValues;<br>    </span><span style="color:#0000ff">int</span><span style="color:#000000">[] mBitmapWidth </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">new</span><span style="color:#000000"> </span><span style="color:#0000ff">int</span><span style="color:#000000">[</span><span style="color:#000000">4</span><span style="color:#000000">];<br>    </span><span style="color:#0000ff">int</span><span style="color:#000000">[] mBitmapHeight </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">new</span><span style="color:#000000"> </span><span style="color:#0000ff">int</span><span style="color:#000000">[</span><span style="color:#000000">4</span><span style="color:#000000">];<br><br>    </span><span style="color:#0000ff">public</span><span style="color:#000000"> CompassView(Context context) {<br>        </span><span style="color:#0000ff">this</span><span style="color:#000000">(context, </span><span style="color:#0000ff">null</span><span style="color:#000000">);<br>        </span><span style="color:#008000">//</span><span style="color:#008000"> TODO Auto-generated constructor stub</span><span style="color:#008000"><br></span><span style="color:#000000">    }<br><br>    </span><span style="color:#0000ff">public</span><span style="color:#000000"> CompassView(Context context, AttributeSet attrs) {<br>        </span><span style="color:#0000ff">super</span><span style="color:#000000">(context, attrs);<br><br>        BitmapFactory.Options opts </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">new</span><span style="color:#000000"> Options();<br>        opts.inJustDecodeBounds </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">false</span><span style="color:#000000">;<br>        setBitMapArray(context, </span><span style="color:#000000">0</span><span style="color:#000000">, opts, R.drawable.panel);<br>        setBitMapArray(context, </span><span style="color:#000000">1</span><span style="color:#000000">, opts, R.drawable.compass_digree);<br><br>    }<br><br>    </span><span style="color:#008000">/**</span><span style="color:#008000"><br>     * 设置bitmap数组个下标的值<br>     * <br>     * </span><span style="color:#808080">@param</span><span style="color:#008000"> index<br>     * </span><span style="color:#808080">@param</span><span style="color:#008000"> opts<br>     * </span><span style="color:#808080">@param</span><span style="color:#008000"> resid<br>     </span><span style="color:#008000">*/</span><span style="color:#000000"><br>    </span><span style="color:#0000ff">private</span><span style="color:#000000"> </span><span style="color:#0000ff">void</span><span style="color:#000000"> setBitMapArray(Context context, </span><span style="color:#0000ff">int</span><span style="color:#000000"> index,<br>            BitmapFactory.Options opts, </span><span style="color:#0000ff">int</span><span style="color:#000000"> resid) {<br>        is </span><span style="color:#000000">=</span><span style="color:#000000"> context.getResources().openRawResource(resid);<br>        mBitmapArray[index] </span><span style="color:#000000">=</span><span style="color:#000000"> BitmapFactory.decodeStream(is);<br>        mBitmapWidth[index] </span><span style="color:#000000">=</span><span style="color:#000000"> mBitmapArray[index].getWidth();<br>        mBitmapHeight[index] </span><span style="color:#000000">=</span><span style="color:#000000"> mBitmapArray[index].getHeight();<br>        mBitmapArray[index </span><span style="color:#000000">+</span><span style="color:#000000"> </span><span style="color:#000000">2</span><span style="color:#000000">] </span><span style="color:#000000">=</span><span style="color:#000000"> BitmapFactory.decodeStream(is, </span><span style="color:#0000ff">null</span><span style="color:#000000">, opts);<br>        mBitmapHeight[index </span><span style="color:#000000">+</span><span style="color:#000000"> </span><span style="color:#000000">2</span><span style="color:#000000">] </span><span style="color:#000000">=</span><span style="color:#000000"> mBitmapArray[index </span><span style="color:#000000">+</span><span style="color:#000000"> </span><span style="color:#000000">2</span><span style="color:#000000">].getHeight();<br>        mBitmapWidth[index </span><span style="color:#000000">+</span><span style="color:#000000"> </span><span style="color:#000000">2</span><span style="color:#000000">] </span><span style="color:#000000">=</span><span style="color:#000000"> mBitmapArray[index </span><span style="color:#000000">+</span><span style="color:#000000"> </span><span style="color:#000000">2</span><span style="color:#000000">].getWidth();<br>    }<br><br>    @Override<br>    </span><span style="color:#0000ff">protected</span><span style="color:#000000"> </span><span style="color:#0000ff">void</span><span style="color:#000000"> onDraw(Canvas canvas) {<br>        </span><span style="color:#008000">//</span><span style="color:#008000"> TODO Auto-generated method stub</span><span style="color:#008000"><br></span><span style="color:#000000">        </span><span style="color:#0000ff">super</span><span style="color:#000000">.onDraw(canvas);<br>        Paint paint </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">new</span><span style="color:#000000"> Paint();<br>        paint.setAntiAlias(</span><span style="color:#0000ff">true</span><span style="color:#000000">);<br><br>        </span><span style="color:#0000ff">int</span><span style="color:#000000"> w </span><span style="color:#000000">=</span><span style="color:#000000"> canvas.getWidth();<br>        </span><span style="color:#0000ff">int</span><span style="color:#000000"> h </span><span style="color:#000000">=</span><span style="color:#000000"> canvas.getHeight();<br><br>        </span><span style="color:#0000ff">int</span><span style="color:#000000"> cx </span><span style="color:#000000">=</span><span style="color:#000000"> w </span><span style="color:#000000">/</span><span style="color:#000000"> </span><span style="color:#000000">2</span><span style="color:#000000">;<br>        </span><span style="color:#0000ff">int</span><span style="color:#000000"> cy </span><span style="color:#000000">=</span><span style="color:#000000"> h </span><span style="color:#000000">/</span><span style="color:#000000"> </span><span style="color:#000000">2</span><span style="color:#000000">;<br><br>        canvas.translate(cx, cy);<br>        drawPictures(canvas, </span><span style="color:#000000">0</span><span style="color:#000000">);<br><br>    }<br><br>    </span><span style="color:#0000ff">private</span><span style="color:#000000"> </span><span style="color:#0000ff">void</span><span style="color:#000000"> drawPictures(Canvas canvas, </span><span style="color:#0000ff">int</span><span style="color:#000000"> idDelta) {<br>        </span><span style="color:#0000ff">if</span><span style="color:#000000"> (mValues </span><span style="color:#000000">!=</span><span style="color:#000000"> </span><span style="color:#0000ff">null</span><span style="color:#000000">) {<br>            </span><span style="color:#008000">//</span><span style="color:#008000"> Log.d(TAG, &quot;mValues[0] = &quot;+ mValues[0]);</span><span style="color:#008000"><br></span><span style="color:#000000">            canvas.rotate(</span><span style="color:#000000">-</span><span style="color:#000000">mValues[</span><span style="color:#000000">0</span><span style="color:#000000">]);<br>            canvas.drawBitmap(mBitmapArray[</span><span style="color:#000000">0</span><span style="color:#000000"> </span><span style="color:#000000">+</span><span style="color:#000000"> idDelta],<br>                    </span><span style="color:#000000">-</span><span style="color:#000000">mBitmapWidth[</span><span style="color:#000000">0</span><span style="color:#000000"> </span><span style="color:#000000">+</span><span style="color:#000000"> idDelta] </span><span style="color:#000000">/</span><span style="color:#000000"> </span><span style="color:#000000">2</span><span style="color:#000000">,<br>                    </span><span style="color:#000000">-</span><span style="color:#000000">mBitmapHeight[</span><span style="color:#000000">0</span><span style="color:#000000"> </span><span style="color:#000000">+</span><span style="color:#000000"> idDelta] </span><span style="color:#000000">/</span><span style="color:#000000"> </span><span style="color:#000000">2</span><span style="color:#000000">, </span><span style="color:#0000ff">null</span><span style="color:#000000">);<br>            canvas.rotate(</span><span style="color:#000000">360</span><span style="color:#000000"> </span><span style="color:#000000">+</span><span style="color:#000000"> mValues[</span><span style="color:#000000">0</span><span style="color:#000000">]);<br>            canvas.drawBitmap(mBitmapArray[</span><span style="color:#000000">1</span><span style="color:#000000"> </span><span style="color:#000000">+</span><span style="color:#000000"> idDelta],<br>                    </span><span style="color:#000000">-</span><span style="color:#000000">mBitmapWidth[</span><span style="color:#000000">1</span><span style="color:#000000"> </span><span style="color:#000000">+</span><span style="color:#000000"> idDelta] </span><span style="color:#000000">/</span><span style="color:#000000"> </span><span style="color:#000000">2</span><span style="color:#000000">,<br>                    </span><span style="color:#000000">-</span><span style="color:#000000">mBitmapHeight[</span><span style="color:#000000">1</span><span style="color:#000000"> </span><span style="color:#000000">+</span><span style="color:#000000"> idDelta] </span><span style="color:#000000">/</span><span style="color:#000000"> </span><span style="color:#000000">2</span><span style="color:#000000">, </span><span style="color:#0000ff">null</span><span style="color:#000000">);<br><br>        } </span><span style="color:#0000ff">else</span><span style="color:#000000"> {<br>            canvas.drawBitmap(mBitmapArray[</span><span style="color:#000000">0</span><span style="color:#000000"> </span><span style="color:#000000">+</span><span style="color:#000000"> idDelta],<br>                    </span><span style="color:#000000">-</span><span style="color:#000000">mBitmapWidth[</span><span style="color:#000000">0</span><span style="color:#000000"> </span><span style="color:#000000">+</span><span style="color:#000000"> idDelta] </span><span style="color:#000000">/</span><span style="color:#000000"> </span><span style="color:#000000">2</span><span style="color:#000000">,<br>                    </span><span style="color:#000000">-</span><span style="color:#000000">mBitmapHeight[</span><span style="color:#000000">0</span><span style="color:#000000"> </span><span style="color:#000000">+</span><span style="color:#000000"> idDelta] </span><span style="color:#000000">/</span><span style="color:#000000"> </span><span style="color:#000000">2</span><span style="color:#000000">, </span><span style="color:#0000ff">null</span><span style="color:#000000">);<br><br>            canvas.drawBitmap(mBitmapArray[</span><span style="color:#000000">1</span><span style="color:#000000"> </span><span style="color:#000000">+</span><span style="color:#000000"> idDelta],<br>                    </span><span style="color:#000000">-</span><span style="color:#000000">mBitmapWidth[</span><span style="color:#000000">1</span><span style="color:#000000"> </span><span style="color:#000000">+</span><span style="color:#000000"> idDelta] </span><span style="color:#000000">/</span><span style="color:#000000"> </span><span style="color:#000000">2</span><span style="color:#000000">,<br>                    </span><span style="color:#000000">-</span><span style="color:#000000">mBitmapHeight[</span><span style="color:#000000">1</span><span style="color:#000000"> </span><span style="color:#000000">+</span><span style="color:#000000"> idDelta] </span><span style="color:#000000">/</span><span style="color:#000000"> </span><span style="color:#000000">2</span><span style="color:#000000">, </span><span style="color:#0000ff">null</span><span style="color:#000000">);<br>        }<br>    }<br>　　//角度值<br>    </span><span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">void</span><span style="color:#000000"> setValue(</span><span style="color:#0000ff">float</span><span style="color:#000000">[] value) {<br>        </span><span style="color:#0000ff">this</span><span style="color:#000000">.mValues </span><span style="color:#000000">=</span><span style="color:#000000"> value;<br>    }<br> <br><br>}</span></div></div>
<p> </p>
<p>通过上面的绘制VIEW就可以在布局中使用：</p>
<p> </p>
<div>
<div><span style="color:#0000ff">&lt;?</span><span style="color:#ff00ff">xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;</span><span style="color:#0000ff">?&gt;</span><span style="color:#000000"><br></span><span style="color:#0000ff">&lt;</span><span style="color:#800000">LinearLayout </span><span style="color:#ff0000">xmlns:android</span><span style="color:#0000ff">="http://schemas.android.com/apk/res/android"</span><span style="color:#ff0000"><br>    android:orientation</span><span style="color:#0000ff">="vertical"</span><span style="color:#ff0000"> android:layout_width</span><span style="color:#0000ff">="fill_parent"</span><span style="color:#ff0000"><br>    android:layout_height</span><span style="color:#0000ff">="fill_parent"</span><span style="color:#ff0000"> android:gravity</span><span style="color:#0000ff">="center"</span><span style="color:#0000ff">&gt;</span><span style="color:#000000"><br>    </span><span style="color:#0000ff">&lt;</span><span style="color:#800000">TextView </span><span style="color:#ff0000">android:id</span><span style="color:#0000ff">="@+id/title"</span><span style="color:#ff0000"> android:textColor</span><span style="color:#0000ff">="@drawable/white"</span><span style="color:#ff0000"><br>        android:textAppearance</span><span style="color:#0000ff">="?android:attr/textAppearanceLarge"</span><span style="color:#ff0000"><br>        android:layout_width</span><span style="color:#0000ff">="wrap_content"</span><span style="color:#ff0000"> android:layout_height</span><span style="color:#0000ff">="wrap_content"</span><span style="color:#0000ff">&gt;</span><span style="color:#000000"><br>    </span><span style="color:#0000ff">&lt;/</span><span style="color:#800000">TextView</span><span style="color:#0000ff">&gt;</span><span style="color:#000000"><br><br>    </span><span style="color:#0000ff">&lt;</span><span style="color:#800000">com.yaomei.view.CompassView </span><span style="color:#ff0000">android:id</span><span style="color:#0000ff">="@+id/compass"</span><span style="color:#ff0000"><br>        android:layout_width</span><span style="color:#0000ff">="wrap_content"</span><span style="color:#ff0000"> android:layout_height</span><span style="color:#0000ff">="wrap_content"</span><span style="color:#0000ff">&gt;</span><span style="color:#000000"><br>    </span><span style="color:#0000ff">&lt;/</span><span style="color:#800000">com.yaomei.view.CompassView</span><span style="color:#0000ff">&gt;</span><span style="color:#000000"><br><br></span><span style="color:#0000ff">&lt;/</span><span style="color:#800000">LinearLayout</span><span style="color:#0000ff">&gt;</span><span style="color:#000000"><br></span></div></div>
<p> </p>
<p> </p>
<p>对应Activity使用SensorListener为view 传递角度，当然如果是在车载上面可能不是用SensorListener而是使用GPS等另外其他传过来的参数，这个是后话。</p>
<p> </p>
<div>
<div><span style="color:#0000ff">package</span><span style="color:#000000"> com.yaomei.compass;<br><br></span><span style="color:#0000ff">import</span><span style="color:#000000"> android.app.Activity;<br></span><span style="color:#0000ff">import</span><span style="color:#000000"> android.content.Context;<br></span><span style="color:#0000ff">import</span><span style="color:#000000"> android.content.res.Resources;<br></span><span style="color:#0000ff">import</span><span style="color:#000000"> android.hardware.SensorListener;<br></span><span style="color:#0000ff">import</span><span style="color:#000000"> android.hardware.SensorManager;<br></span><span style="color:#0000ff">import</span><span style="color:#000000"> android.os.Bundle;<br></span><span style="color:#0000ff">import</span><span style="color:#000000"> android.view.WindowManager;<br></span><span style="color:#0000ff">import</span><span style="color:#000000"> android.widget.TextView;<br><br></span><span style="color:#0000ff">import</span><span style="color:#000000"> com.yaomei.view.CompassView;<br><br>@SuppressWarnings(</span><span style="color:#000000">"</span><span style="color:#000000">deprecation</span><span style="color:#000000">"</span><span style="color:#000000">)<br></span><span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">class</span><span style="color:#000000"> CompassActivity </span><span style="color:#0000ff">extends</span><span style="color:#000000"> Activity {<br><br>    </span><span style="color:#0000ff">private</span><span style="color:#000000"> SensorManager mSensorManager;<br>    </span><span style="color:#0000ff">private</span><span style="color:#000000"> CompassView mView;<br>    </span><span style="color:#0000ff">private</span><span style="color:#000000"> String text </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#000000">""</span><span style="color:#000000">;<br>    </span><span style="color:#0000ff">private</span><span style="color:#000000"> Resources mRes;<br><br>    </span><span style="color:#0000ff">private</span><span style="color:#000000"> TextView tv;<br>    </span><span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">final</span><span style="color:#000000"> SensorListener mListtenr </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">new</span><span style="color:#000000"> SensorListener() {<br><br>        @Override<br>        </span><span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">void</span><span style="color:#000000"> onSensorChanged(</span><span style="color:#0000ff">int</span><span style="color:#000000"> sensor, </span><span style="color:#0000ff">float</span><span style="color:#000000">[] values) {<br>            </span><span style="color:#008000">//</span><span style="color:#008000"> TODO Auto-generated method stub</span><span style="color:#008000"><br></span><span style="color:#000000">            </span><span style="color:#0000ff">synchronized</span><span style="color:#000000"> (</span><span style="color:#0000ff">this</span><span style="color:#000000">) {<br>                mView.setValue(values);<br>                </span><span style="color:#0000ff">if</span><span style="color:#000000"> (Math.abs(values[</span><span style="color:#000000">0</span><span style="color:#000000">] </span><span style="color:#000000">-</span><span style="color:#000000"> </span><span style="color:#000000">0.0f</span><span style="color:#000000">) </span><span style="color:#000000">&lt;</span><span style="color:#000000"> </span><span style="color:#000000">1</span><span style="color:#000000">)<br>                    </span><span style="color:#0000ff">return</span><span style="color:#000000">;<br>                </span><span style="color:#0000ff">switch</span><span style="color:#000000"> ((</span><span style="color:#0000ff">int</span><span style="color:#000000">) values[</span><span style="color:#000000">0</span><span style="color:#000000">]) {<br>                </span><span style="color:#0000ff">case</span><span style="color:#000000"> </span><span style="color:#000000">0</span><span style="color:#000000">:<br>                    text </span><span style="color:#000000">=</span><span style="color:#000000"> mRes.getText(R.string.North).toString();<br>                    </span><span style="color:#0000ff">break</span><span style="color:#000000">;<br>                </span><span style="color:#0000ff">case</span><span style="color:#000000"> </span><span style="color:#000000">90</span><span style="color:#000000">:<br>                    text </span><span style="color:#000000">=</span><span style="color:#000000"> mRes.getText(R.string.West).toString();<br>                    </span><span style="color:#0000ff">break</span><span style="color:#000000">;<br>                </span><span style="color:#0000ff">case</span><span style="color:#000000"> </span><span style="color:#000000">180</span><span style="color:#000000">:<br>                    text </span><span style="color:#000000">=</span><span style="color:#000000"> mRes.getText(R.string.South).toString();<br>                    </span><span style="color:#0000ff">break</span><span style="color:#000000">;<br><br>                </span><span style="color:#0000ff">case</span><span style="color:#000000"> </span><span style="color:#000000">270</span><span style="color:#000000">:<br>                    text </span><span style="color:#000000">=</span><span style="color:#000000"> mRes.getText(R.string.East).toString();<br>                    </span><span style="color:#0000ff">break</span><span style="color:#000000">;<br><br>                </span><span style="color:#0000ff">default</span><span style="color:#000000">:<br>                    </span><span style="color:#0000ff">int</span><span style="color:#000000"> v </span><span style="color:#000000">=</span><span style="color:#000000"> (</span><span style="color:#0000ff">int</span><span style="color:#000000">) values[</span><span style="color:#000000">0</span><span style="color:#000000">];<br>                    </span><span style="color:#0000ff">if</span><span style="color:#000000"> (v </span><span style="color:#000000">&gt;</span><span style="color:#000000"> </span><span style="color:#000000">0</span><span style="color:#000000"> </span><span style="color:#000000">&amp;&amp;</span><span style="color:#000000"> v </span><span style="color:#000000">&lt;</span><span style="color:#000000"> </span><span style="color:#000000">90</span><span style="color:#000000">) {<br>                        text </span><span style="color:#000000">=</span><span style="color:#000000"> mRes.getText(R.string.North_west).toString()<br>                                </span><span style="color:#000000">+</span><span style="color:#000000"> </span><span style="color:#000000">"</span><span style="color:#000000"> </span><span style="color:#000000">"</span><span style="color:#000000"> </span><span style="color:#000000">+</span><span style="color:#000000"> v </span><span style="color:#000000">+</span><span style="color:#000000"> </span><span style="color:#000000">"</span><span style="color:#000000"> 度</span><span style="color:#000000">"</span><span style="color:#000000">;<br>                    }<br>                    </span><span style="color:#0000ff">if</span><span style="color:#000000"> (v </span><span style="color:#000000">&gt;</span><span style="color:#000000"> </span><span style="color:#000000">90</span><span style="color:#000000"> </span><span style="color:#000000">&amp;&amp;</span><span style="color:#000000"> v </span><span style="color:#000000">&lt;</span><span style="color:#000000"> </span><span style="color:#000000">180</span><span style="color:#000000">) {<br>                        text </span><span style="color:#000000">=</span><span style="color:#000000"> mRes.getText(R.string.South_west).toString()<br>                                </span><span style="color:#000000">+</span><span style="color:#000000"> </span><span style="color:#000000">"</span><span style="color:#000000"> </span><span style="color:#000000">"</span><span style="color:#000000"> </span><span style="color:#000000">+</span><span style="color:#000000"> (</span><span style="color:#000000">180</span><span style="color:#000000"> </span><span style="color:#000000">-</span><span style="color:#000000"> v) </span><span style="color:#000000">+</span><span style="color:#000000"> </span><span style="color:#000000">"</span><span style="color:#000000"> 度</span><span style="color:#000000">"</span><span style="color:#000000">;<br>                    }<br>                    </span><span style="color:#0000ff">if</span><span style="color:#000000"> (v </span><span style="color:#000000">&gt;</span><span style="color:#000000"> </span><span style="color:#000000">180</span><span style="color:#000000"> </span><span style="color:#000000">&amp;&amp;</span><span style="color:#000000"> v </span><span style="color:#000000">&lt;</span><span style="color:#000000"> </span><span style="color:#000000">270</span><span style="color:#000000">) {<br><br>                        text </span><span style="color:#000000">=</span><span style="color:#000000"> mRes.getText(R.string.South_east).toString()<br>                                </span><span style="color:#000000">+</span><span style="color:#000000"> </span><span style="color:#000000">"</span><span style="color:#000000"> </span><span style="color:#000000">"</span><span style="color:#000000"> </span><span style="color:#000000">+</span><span style="color:#000000"> (v </span><span style="color:#000000">-</span><span style="color:#000000"> </span><span style="color:#000000">180</span><span style="color:#000000">) </span><span style="color:#000000">+</span><span style="color:#000000"> </span><span style="color:#000000">"</span><span style="color:#000000"> 度</span><span style="color:#000000">"</span><span style="color:#000000">;<br>                    }<br>                    </span><span style="color:#0000ff">if</span><span style="color:#000000"> (v </span><span style="color:#000000">&gt;</span><span style="color:#000000"> </span><span style="color:#000000">270</span><span style="color:#000000"> </span><span style="color:#000000">&amp;&amp;</span><span style="color:#000000"> v </span><span style="color:#000000">&lt;</span><span style="color:#000000"> </span><span style="color:#000000">360</span><span style="color:#000000">) {<br><br>                        text </span><span style="color:#000000">=</span><span style="color:#000000"> mRes.getText(R.string.North_east).toString()<br>                                </span><span style="color:#000000">+</span><span style="color:#000000"> </span><span style="color:#000000">"</span><span style="color:#000000"> </span><span style="color:#000000">"</span><span style="color:#000000"> </span><span style="color:#000000">+</span><span style="color:#000000"> (</span><span style="color:#000000">360</span><span style="color:#000000"> </span><span style="color:#000000">-</span><span style="color:#000000"> v) </span><span style="color:#000000">+</span><span style="color:#000000"> </span><span style="color:#000000">"</span><span style="color:#000000"> 度</span><span style="color:#000000">"</span><span style="color:#000000">;<br>                    }<br>                    </span><span style="color:#0000ff">break</span><span style="color:#000000">;<br>                }<br>                tv.setText(text);<br><br>                </span><span style="color:#0000ff">if</span><span style="color:#000000"> (mView </span><span style="color:#000000">!=</span><span style="color:#000000"> </span><span style="color:#0000ff">null</span><span style="color:#000000">) {<br>                    mView.invalidate();<br>                }<br>            }<br>        }<br><br>        @Override<br>        </span><span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">void</span><span style="color:#000000"> onAccuracyChanged(</span><span style="color:#0000ff">int</span><span style="color:#000000"> sensor, </span><span style="color:#0000ff">int</span><span style="color:#000000"> accuracy) {<br>            </span><span style="color:#008000">//</span><span style="color:#008000"> TODO Auto-generated method stub</span><span style="color:#008000"><br></span><span style="color:#000000"><br>        }<br>    };<br><br>    </span><span style="color:#008000">/**</span><span style="color:#008000"> Called when the activity is first created. </span><span style="color:#008000">*/</span><span style="color:#000000"><br>    @Override<br>    </span><span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">void</span><span style="color:#000000"> onCreate(Bundle savedInstanceState) {<br>        </span><span style="color:#0000ff">super</span><span style="color:#000000">.onCreate(savedInstanceState);<br><br>        mSensorManager </span><span style="color:#000000">=</span><span style="color:#000000"> (SensorManager) getSystemService(Context.SENSOR_SERVICE);<br>        mRes </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">this</span><span style="color:#000000">.getResources();<br>        getWindow().setFlags(WindowManager.LayoutParams.FLAG_KEEP_SCREEN_ON,<br>                WindowManager.LayoutParams.FLAG_KEEP_SCREEN_ON);<br>        setContentView(R.layout.main);<br>        findView();<br><br>    }<br><br>    </span><span style="color:#0000ff">void</span><span style="color:#000000"> findView() {<br>        tv </span><span style="color:#000000">=</span><span style="color:#000000"> (TextView) findViewById(R.id.title);<br>        mView </span><span style="color:#000000">=</span><span style="color:#000000"> (CompassView) findViewById(R.id.compass);<br>    }<br><br>    @Override<br>    </span><span style="color:#0000ff">protected</span><span style="color:#000000"> </span><span style="color:#0000ff">void</span><span style="color:#000000"> onResume() {<br>        </span><span style="color:#008000">//</span><span style="color:#008000"> TODO Auto-generated method stub</span><span style="color:#008000"><br></span><span style="color:#000000">        </span><span style="color:#0000ff">super</span><span style="color:#000000">.onResume();<br><br>        mSensorManager.registerListener(mListtenr,<br>                SensorManager.SENSOR_ORIENTATION,<br>                SensorManager.SENSOR_DELAY_GAME);<br>    }<br><br>    @Override<br>    </span><span style="color:#0000ff">protected</span><span style="color:#000000"> </span><span style="color:#0000ff">void</span><span style="color:#000000"> onStop() {<br>        </span><span style="color:#008000">//</span><span style="color:#008000"> TODO Auto-generated method stub</span><span style="color:#008000"><br></span><span style="color:#000000">        mSensorManager.unregisterListener(mListtenr);<br>        </span><span style="color:#0000ff">super</span><span style="color:#000000">.onStop();<br>    }<br><br>}</span></div></div>
<p> </p>
<p>apk下载：</p>
<p><a href="http://files.cnblogs.com/TerryBlog/CarCompass.7z">/Files/TerryBlog/CarCompass.7z</a>  改成apk，可能不能打开加密了。</p><img src="http://www.cnblogs.com/TerryBlog/aggbug/1875657.html?type=1" width="1" height="1" alt=""><p>作者: <a href="http://www.cnblogs.com/TerryBlog/">Terry_龙</a> 发表于 2010-11-12 14:17 <a href="http://www.cnblogs.com/TerryBlog/archive/2010/11/12/1875657.html">原文链接</a></p><p>评论: 2　<a href="http://www.cnblogs.com/TerryBlog/archive/2010/11/12/1875657.html#pagedcomment">查看评论</a>　<a href="http://www.cnblogs.com/TerryBlog/archive/2010/11/12/1875657.html#commentform">发表评论</a></p><hr><p>最新新闻：<br>· <a href="http://news.cnblogs.com/n/80872/">开源播放器MPlayer十周年</a><span style="color:gray">(2010-11-12 23:45)</span><br>· <a href="http://news.cnblogs.com/n/80871/">IBM与北工大建成中国首个科教云 基于刀片集群</a><span style="color:gray">(2010-11-12 23:39)</span><br>· <a href="http://news.cnblogs.com/n/80870/">新应用按地理位置展示全球Twitter消息</a><span style="color:gray">(2010-11-12 22:55)</span><br>· <a href="http://news.cnblogs.com/n/80869/">苹果甲骨文联合发布Mac版OpenJDK项目</a><span style="color:gray">(2010-11-12 22:50)</span><br>· <a href="http://news.cnblogs.com/n/80868/">10款相似图片搜索引擎</a><span style="color:gray">(2010-11-12 22:30)</span><br></p><p>编辑推荐：<a href="http://news.cnblogs.com/n/80865/">Sina App Engine架构：云计算时代的分布式Web服务解决方案</a><br></p><p>网站导航：<a href="http://www.cnblogs.com">博客园首页</a>  <a href="http://home.cnblogs.com/">我的园子</a>  <a href="http://news.cnblogs.com">新闻</a>  <a href="http://home.cnblogs.com/ing/">闪存</a>  <a href="http://home.cnblogs.com/group/">小组</a>  <a href="http://space.cnblogs.com/q/">博问</a>  <a href="http://kb.cnblogs.com">知识库</a></p></p>


</div>


            <div class="footer">
              <div class="contact">
                <p>
                  Your Name<br />
                  What You Are<br />
                  your@email.com
                </p>
              </div>
              <div class="contact">
                <p>
                  <a href="http://github.com/yourusername/">github.com/yourusername</a><br />
                  <a href="http://twitter.com/yourusername/">twitter.com/yourusername</a><br />
                </p>
              </div>
            </div>
          </div>
        </div> <!-- /container -->

    </body>
</html>
