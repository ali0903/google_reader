<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>我的js模板引擎reMarker第一版(循环遍历算法，非正则)</title>
        <meta name="viewport" content="width=device-width">

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/css/syntax.css">

        <!-- Custom CSS -->
        <link rel="stylesheet" href="/css/main.css">

    </head>
    <body>

        <div class="container">
          <div class="site">
            <div class="header">
              <h1 class="title"><a href="/">Your New Jekyll Site</a></h1>
              <a class="extra" href="/">home</a>
            </div>

                <h2>我的js模板引擎reMarker第一版(循环遍历算法，非正则)</h2>
<p class="meta">15 Dec 2010</p>

<div class="post">
<h2>我的js模板引擎reMarker第一版(循环遍历算法，非正则)</h2>

<h3>by simon4545</h3>

<h3>at 2010-12-14 17:03:00</h3>

<h3>original <a href="http://www.cnblogs.com/simon4545/archive/2010/12/14/1905855.html">http://www.cnblogs.com/simon4545/archive/2010/12/14/1905855.html</a></h3>

<p><div> <span style="font-family:monospace;white-space:pre">首先介绍一下reMarker出现的原因：</span></div><div><pre>1.公司里新做了一个公网项目，使用的是java+json+javscript+html的前后台结合的机制，后端生成json代码，前端所有的页面渲染基本使用js的模板引擎，引擎生成了html后</pre><pre>和Json数据集成，渲染成最后的页面。<br></pre><pre>2.因为Java开发人员都比较熟悉freemark模板的语法，为了减少学习成本，我们使用js的模板引擎用的也是freemark的语法。而我所在的公司有一个风格，几乎不用公网的代码，</pre><pre>所有的代码基本上从前到后都是员工自已开发的。</pre><pre>3.而且后来经过我的实际测试，互联网上的一些模板引擎，jTemplate/jst/sweetTemplate/ext template也的确在效率上并不能高过我所开发的这个模板引擎。</pre><pre>下面列出的这个算法，也并不是什么高明的东西。其创意来自于一个ooCSS的面向对象CSS处理机制。</pre><pre>4.我们可以看到目前公网上的js模板引擎用的都是正则来处理特征，进行选择匹配，最后动态生成function，返回替换后的字符串。而我们知道javascript/java/c#等语言用的都</pre><pre>是NFA(非确定型有穷自动机)正则引擎，它的优点是longest-leftmost匹配，回溯，组捕获等，但同时他相对于DFA(确定型有穷自动机)正则引擎的缺点也就出现了，速度相对慢</pre><pre>一点，虽然是native code,但是我并不是很信任他的效率。后来做过一过不成熟的测试，发现它的确会比一般的字符串遍历寻找要慢（事实证明，我的这个测试代码并不科学，</pre><pre>下次会分析）。</pre><pre>所以我就在这里写下了这样一个模板引擎，支持freemark语法，可以拓展?html/?html/？default等扩展方法在util对象中。</pre><pre>就像上面所说的，他是有bug的，但我并没有打算修复，毕竟我只是为了测试效率才写的。当然这个bug并不复杂，如果你喜欢，可以去修正一下，估计十几分钟就Ok了，谁的代</pre><pre>码能没有bug呢？残念。。。</pre><pre>经过测试，实现我的demo page中相同的功能，主流的引擎没有发现比这个更快的（除了我马上要出的下一版，呵呵）.谢谢</pre></div><p> <span style="font-family:&#39;Courier New&#39;;font-size:13px;color:#008000">/*</span></p><div><div><font color="#008000">    这个版本是有bug的,如果freemark语法不是模板的最后一段，会出现bug</font><br><font color="#008000">    但是它是使用数组循环的方法，为了和以后的正则比较效率，会保持这个版本不删除！</font><br><span style="color:#008000">*/</span><span style="color:#000000"><br>(</span><span style="color:#0000ff">function</span><span style="color:#000000">(){<br><br>    </span><span style="color:#0000ff">if</span><span style="color:#000000"> (window.reMarker </span><span style="color:#000000">||</span><span style="color:#000000"> window.r) {<br>        </span><span style="color:#0000ff">throw</span><span style="color:#000000"> </span><span style="color:#000000">"</span><span style="color:#000000">reMarker is exist</span><span style="color:#000000">"</span><span style="color:#000000"><br>    };<br>    window.reMarker </span><span style="color:#000000">=</span><span style="color:#000000"> window.r </span><span style="color:#000000">=</span><span style="color:#000000"> m </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">function</span><span style="color:#000000">(tpl, data){<br>        </span><span style="color:#0000ff">this</span><span style="color:#000000">.tpl </span><span style="color:#000000">=</span><span style="color:#000000"> tpl;<br>        </span><span style="color:#0000ff">this</span><span style="color:#000000">.data </span><span style="color:#000000">=</span><span style="color:#000000"> data;<br>        </span><span style="color:#0000ff">this</span><span style="color:#000000">.scope </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">null</span><span style="color:#000000">;<br>        </span><span style="color:#0000ff">this</span><span style="color:#000000">.vars </span><span style="color:#000000">=</span><span style="color:#000000"> [];<br>    }<br>    window.r.regRuler </span><span style="color:#000000">=</span><span style="color:#000000"> {<br>        ruler: </span><span style="color:#0000ff">function</span><span style="color:#000000">(str){<br>            </span><span style="color:#0000ff">var</span><span style="color:#000000"> listArr </span><span style="color:#000000">=</span><span style="color:#000000"> r.util.removeEmpty(str.split(</span><span style="color:#000000">'</span><span style="color:#000000"> </span><span style="color:#000000">'</span><span style="color:#000000">));<br>            </span><span style="color:#008000">/*</span><span style="color:#008000">这里如果不用function而直接return回替换值的话，千次执行会快出5毫秒，和机器有关             switch(listArr[0]){<br>             case &quot;list&quot;: return this.rulerList(listArr);break;<br>             case &quot;if&quot;:  return &#39;if(&#39; + listArr.slice(1).join(&#39;&#39;) + &#39;){&#39;;break;<br>             case &quot;break&quot;: return &#39;break;&#39;;break;<br>             case &#39;/#list&#39;: return &#39;}})();&#39;;break;<br>             case &#39;else&#39;: return &#39;}else{&#39;;break;<br>             case &quot;/#if&quot;: return &#39;}&#39;;break;<br>             case &#39;elseif&#39;:return &#39;}else if(&#39; + listArr.slice(1).join(&#39;&#39;) + &#39;){&#39;;break;<br>             case &#39;switch&#39;:return &#39;switch(&#39; + listArr.join(&#39;&#39;).replace(&#39;switch&#39;,&#39;&#39;) + &#39;){&#39;;break;<br>             case &#39;case&#39;: return (&#39;case &#39; + listArr[1] + &#39;:&#39;);break;<br>             case &#39;default&#39;:return &#39;default:&#39;;break;<br>             case &#39;/#switch&#39;: return &#39;}&#39;;<br>             }<br>             </span><span style="color:#008000">*/</span><span style="color:#000000"><br>            </span><span style="color:#0000ff">var</span><span style="color:#000000"> ruler </span><span style="color:#000000">=</span><span style="color:#000000"> {<br>                </span><span style="color:#000000">"</span><span style="color:#000000">list</span><span style="color:#000000">"</span><span style="color:#000000">: </span><span style="color:#0000ff">this</span><span style="color:#000000">.rulerList,<br>                </span><span style="color:#000000">"</span><span style="color:#000000">if</span><span style="color:#000000">"</span><span style="color:#000000">: </span><span style="color:#0000ff">this</span><span style="color:#000000">.rulerIf,<br>                </span><span style="color:#000000">"</span><span style="color:#000000">break</span><span style="color:#000000">"</span><span style="color:#000000">: </span><span style="color:#0000ff">this</span><span style="color:#000000">.rulerBreak,<br>                </span><span style="color:#000000">'</span><span style="color:#000000">/#list</span><span style="color:#000000">'</span><span style="color:#000000">: </span><span style="color:#0000ff">this</span><span style="color:#000000">.rulerEndList,<br>                </span><span style="color:#000000">'</span><span style="color:#000000">else</span><span style="color:#000000">'</span><span style="color:#000000">: </span><span style="color:#0000ff">this</span><span style="color:#000000">.rulerElse,<br>                </span><span style="color:#000000">"</span><span style="color:#000000">/#if</span><span style="color:#000000">"</span><span style="color:#000000">: </span><span style="color:#0000ff">this</span><span style="color:#000000">.rulerEndIf,<br>                </span><span style="color:#000000">'</span><span style="color:#000000">elseif</span><span style="color:#000000">'</span><span style="color:#000000">: </span><span style="color:#0000ff">this</span><span style="color:#000000">.rulerElseIf,<br>                </span><span style="color:#000000">'</span><span style="color:#000000">switch</span><span style="color:#000000">'</span><span style="color:#000000">: </span><span style="color:#0000ff">this</span><span style="color:#000000">.rulerSwitch,<br>                </span><span style="color:#000000">'</span><span style="color:#000000">case</span><span style="color:#000000">'</span><span style="color:#000000">: </span><span style="color:#0000ff">this</span><span style="color:#000000">.rulerCase,<br>                </span><span style="color:#000000">'</span><span style="color:#000000">default</span><span style="color:#000000">'</span><span style="color:#000000">: </span><span style="color:#0000ff">this</span><span style="color:#000000">.rulerDefault,<br>                </span><span style="color:#000000">'</span><span style="color:#000000">/#switch</span><span style="color:#000000">'</span><span style="color:#000000">: </span><span style="color:#0000ff">this</span><span style="color:#000000">.rulerEndSwitch<br>            };<br>            </span><span style="color:#0000ff">return</span><span style="color:#000000"> (ruler[listArr[</span><span style="color:#000000">0</span><span style="color:#000000">]]).call(</span><span style="color:#0000ff">this</span><span style="color:#000000">, listArr);<br>            <br>        },<br>        rulerEndSwitch:</span><span style="color:#0000ff">function</span><span style="color:#000000">(arr){<br>            </span><span style="color:#0000ff">return</span><span style="color:#000000"> </span><span style="color:#000000">'</span><span style="color:#000000">}</span><span style="color:#000000">'</span><span style="color:#000000">;<br>        },<br>        rulerCase:</span><span style="color:#0000ff">function</span><span style="color:#000000">(arr){<br>            </span><span style="color:#0000ff">return</span><span style="color:#000000"> (</span><span style="color:#000000">'</span><span style="color:#000000">case </span><span style="color:#000000">'</span><span style="color:#000000"> </span><span style="color:#000000">+</span><span style="color:#000000"> arr[</span><span style="color:#000000">1</span><span style="color:#000000">] </span><span style="color:#000000">+</span><span style="color:#000000"> </span><span style="color:#000000">'</span><span style="color:#000000">:</span><span style="color:#000000">'</span><span style="color:#000000">);<br>        },<br>        rulerDefault:</span><span style="color:#0000ff">function</span><span style="color:#000000">(){<br>            </span><span style="color:#0000ff">return</span><span style="color:#000000"> </span><span style="color:#000000">'</span><span style="color:#000000">default:</span><span style="color:#000000">'</span><span style="color:#000000"><br>        },<br>        rulerSwitch:</span><span style="color:#0000ff">function</span><span style="color:#000000">(arr){<br>            </span><span style="color:#0000ff">return</span><span style="color:#000000"> </span><span style="color:#000000">'</span><span style="color:#000000">switch(</span><span style="color:#000000">'</span><span style="color:#000000"> </span><span style="color:#000000">+</span><span style="color:#000000"> arr.join(</span><span style="color:#000000">''</span><span style="color:#000000">).replace(</span><span style="color:#000000">'</span><span style="color:#000000">switch</span><span style="color:#000000">'</span><span style="color:#000000">,</span><span style="color:#000000">''</span><span style="color:#000000">) </span><span style="color:#000000">+</span><span style="color:#000000"> </span><span style="color:#000000">'</span><span style="color:#000000">){</span><span style="color:#000000">'</span><span style="color:#000000"><br>        },<br>        rulerElseIf:</span><span style="color:#0000ff">function</span><span style="color:#000000">(){<br>            </span><span style="color:#0000ff">if</span><span style="color:#000000">(arr.length</span><span style="color:#000000">&lt;</span><span style="color:#000000">2</span><span style="color:#000000">){</span><span style="color:#0000ff">return</span><span style="color:#000000"> </span><span style="color:#0000ff">false</span><span style="color:#000000">;}<br>            </span><span style="color:#0000ff">return</span><span style="color:#000000"> </span><span style="color:#000000">'</span><span style="color:#000000">}else if(</span><span style="color:#000000">'</span><span style="color:#000000"> </span><span style="color:#000000">+</span><span style="color:#000000"> arr.slice(</span><span style="color:#000000">1</span><span style="color:#000000">).join(</span><span style="color:#000000">''</span><span style="color:#000000">) </span><span style="color:#000000">+</span><span style="color:#000000"> </span><span style="color:#000000">'</span><span style="color:#000000">){</span><span style="color:#000000">'</span><span style="color:#000000">;<br>        },<br>        rulerBreak:</span><span style="color:#0000ff">function</span><span style="color:#000000">(){<br>            </span><span style="color:#0000ff">return</span><span style="color:#000000"> </span><span style="color:#000000">'</span><span style="color:#000000">break;</span><span style="color:#000000">'</span><span style="color:#000000"><br>        },<br>        rulerElse:</span><span style="color:#0000ff">function</span><span style="color:#000000">(arr){<br>            </span><span style="color:#0000ff">return</span><span style="color:#000000"> </span><span style="color:#000000">'</span><span style="color:#000000">}else{</span><span style="color:#000000">'</span><span style="color:#000000">;<br>        },<br>        rulerEndIf:</span><span style="color:#0000ff">function</span><span style="color:#000000">(arr){<br>            </span><span style="color:#0000ff">return</span><span style="color:#000000"> </span><span style="color:#000000">'</span><span style="color:#000000">}</span><span style="color:#000000">'</span><span style="color:#000000">;<br>        },<br>        rulerIf: </span><span style="color:#0000ff">function</span><span style="color:#000000">(arr){<br>            </span><span style="color:#0000ff">if</span><span style="color:#000000">(arr.length</span><span style="color:#000000">&lt;</span><span style="color:#000000">2</span><span style="color:#000000">){</span><span style="color:#0000ff">return</span><span style="color:#000000"> </span><span style="color:#0000ff">false</span><span style="color:#000000">;}<br>             </span><span style="color:#0000ff">return</span><span style="color:#000000"> </span><span style="color:#000000">'</span><span style="color:#000000">if(</span><span style="color:#000000">'</span><span style="color:#000000"> </span><span style="color:#000000">+</span><span style="color:#000000"> arr.slice(</span><span style="color:#000000">1</span><span style="color:#000000">).join(</span><span style="color:#000000">''</span><span style="color:#000000">) </span><span style="color:#000000">+</span><span style="color:#000000"> </span><span style="color:#000000">'</span><span style="color:#000000">){</span><span style="color:#000000">'</span><span style="color:#000000"><br>        },<br>        rulerEndList:</span><span style="color:#0000ff">function</span><span style="color:#000000">(arr){<br>            </span><span style="color:#0000ff">return</span><span style="color:#000000"> </span><span style="color:#000000">'</span><span style="color:#000000">}})();</span><span style="color:#000000">'</span><span style="color:#000000">;<br>        },<br>        rulerList:</span><span style="color:#0000ff">function</span><span style="color:#000000">(arr){<br>            </span><span style="color:#0000ff">var</span><span style="color:#000000"> listName, loopName, loopIndexName, loopHasNextName, result </span><span style="color:#000000">=</span><span style="color:#000000"> [];<br>             </span><span style="color:#0000ff">if</span><span style="color:#000000">(arr.length</span><span style="color:#000000">!=</span><span style="color:#000000">4</span><span style="color:#000000">){</span><span style="color:#0000ff">return</span><span style="color:#000000">;}<br>             loopName</span><span style="color:#000000">=</span><span style="color:#000000">arr[</span><span style="color:#000000">3</span><span style="color:#000000">];<br>             listName</span><span style="color:#000000">=</span><span style="color:#000000">arr[</span><span style="color:#000000">1</span><span style="color:#000000">];<br>             loopIndexName </span><span style="color:#000000">=</span><span style="color:#000000"> loopName </span><span style="color:#000000">+</span><span style="color:#000000"> </span><span style="color:#000000">'</span><span style="color:#000000">_index</span><span style="color:#000000">'</span><span style="color:#000000">;<br>             loopHasNextName </span><span style="color:#000000">=</span><span style="color:#000000"> loopName </span><span style="color:#000000">+</span><span style="color:#000000"> </span><span style="color:#000000">'</span><span style="color:#000000">_has_next</span><span style="color:#000000">'</span><span style="color:#000000">;<br>             <br>             result.push(</span><span style="color:#000000">'</span><span style="color:#000000">(function(){</span><span style="color:#000000">'</span><span style="color:#000000">);<br>            </span><span style="color:#0000ff">if</span><span style="color:#000000"> (</span><span style="color:#000000">!</span><span style="color:#000000">/</span><span style="color:#000000">^\w+$</span><span style="color:#000000">/</span><span style="color:#000000">.test(listName)) {<br>                result.push(</span><span style="color:#000000">'</span><span style="color:#000000">var _list=</span><span style="color:#000000">'</span><span style="color:#000000"> </span><span style="color:#000000">+</span><span style="color:#000000"> listName </span><span style="color:#000000">+</span><span style="color:#000000"> </span><span style="color:#000000">'</span><span style="color:#000000">;</span><span style="color:#000000">'</span><span style="color:#000000">);<br>                listName </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#000000">'</span><span style="color:#000000">_list</span><span style="color:#000000">'</span><span style="color:#000000">;<br>            }<br>            result.push([</span><span style="color:#000000">'</span><span style="color:#000000">var _i=0</span><span style="color:#000000">'</span><span style="color:#000000">, </span><span style="color:#000000">'</span><span style="color:#000000">_count=</span><span style="color:#000000">'</span><span style="color:#000000"> </span><span style="color:#000000">+</span><span style="color:#000000"> listName </span><span style="color:#000000">+</span><span style="color:#000000"> </span><span style="color:#000000">'</span><span style="color:#000000">.length</span><span style="color:#000000">'</span><span style="color:#000000">, loopName, loopIndexName, loopHasNextName </span><span style="color:#000000">+</span><span style="color:#000000"> </span><span style="color:#000000">'</span><span style="color:#000000">;</span><span style="color:#000000">'</span><span style="color:#000000">].join(</span><span style="color:#000000">'</span><span style="color:#000000">,</span><span style="color:#000000">'</span><span style="color:#000000">));<br>            result.push(</span><span style="color:#000000">'</span><span style="color:#000000">for(;_i&lt;_count;_i++){</span><span style="color:#000000">'</span><span style="color:#000000">);<br>            result.push(loopName </span><span style="color:#000000">+</span><span style="color:#000000"> </span><span style="color:#000000">'</span><span style="color:#000000">=</span><span style="color:#000000">'</span><span style="color:#000000"> </span><span style="color:#000000">+</span><span style="color:#000000"> listName </span><span style="color:#000000">+</span><span style="color:#000000"> </span><span style="color:#000000">'</span><span style="color:#000000">[_i];</span><span style="color:#000000">'</span><span style="color:#000000">);<br>            result.push(loopIndexName </span><span style="color:#000000">+</span><span style="color:#000000"> </span><span style="color:#000000">'</span><span style="color:#000000">=_i;</span><span style="color:#000000">'</span><span style="color:#000000">);<br>            result.push(loopHasNextName </span><span style="color:#000000">+</span><span style="color:#000000"> </span><span style="color:#000000">'</span><span style="color:#000000">=_i!==_count-1;</span><span style="color:#000000">'</span><span style="color:#000000">);<br>            </span><span style="color:#0000ff">return</span><span style="color:#000000"> result.join(</span><span style="color:#000000">''</span><span style="color:#000000">);<br>        }<br>    }<br>    window.r.util </span><span style="color:#000000">=</span><span style="color:#000000"> {<br>        trim: </span><span style="color:#0000ff">function</span><span style="color:#000000">(str){<br>            </span><span style="color:#0000ff">return</span><span style="color:#000000"> </span><span style="color:#0000ff">this</span><span style="color:#000000">.replace(</span><span style="color:#000000">/</span><span style="color:#000000">(^\s*)|(\s*$)</span><span style="color:#000000">/</span><span style="color:#000000">g, </span><span style="color:#000000">""</span><span style="color:#000000">);<br>        },<br>        lTrim: </span><span style="color:#0000ff">function</span><span style="color:#000000">(str){<br>            </span><span style="color:#0000ff">return</span><span style="color:#000000"> </span><span style="color:#0000ff">this</span><span style="color:#000000">.replace(</span><span style="color:#000000">/</span><span style="color:#000000">(^\s*)</span><span style="color:#000000">/</span><span style="color:#000000">g, </span><span style="color:#000000">""</span><span style="color:#000000">);<br>        },<br>        rTrim: </span><span style="color:#0000ff">function</span><span style="color:#000000">(str){<br>            </span><span style="color:#0000ff">return</span><span style="color:#000000"> </span><span style="color:#0000ff">this</span><span style="color:#000000">.replace(</span><span style="color:#000000">/</span><span style="color:#000000">(\s*$)</span><span style="color:#000000">/</span><span style="color:#000000">g, </span><span style="color:#000000">""</span><span style="color:#000000">);<br>        },<br>        removeEmpty: </span><span style="color:#0000ff">function</span><span style="color:#000000">(arr){<br>            </span><span style="color:#0000ff">return</span><span style="color:#000000"> arr.join(</span><span style="color:#000000">'</span><span style="color:#000000">,</span><span style="color:#000000">'</span><span style="color:#000000">).replace(</span><span style="color:#000000">'</span><span style="color:#000000">,,</span><span style="color:#000000">'</span><span style="color:#000000">, </span><span style="color:#000000">'</span><span style="color:#000000">,</span><span style="color:#000000">'</span><span style="color:#000000">).split(</span><span style="color:#000000">'</span><span style="color:#000000">,</span><span style="color:#000000">'</span><span style="color:#000000">);<br>        }<br>    }<br>    m.prototype.process </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">function</span><span style="color:#000000">(data, scope){<br>        </span><span style="color:#0000ff">return</span><span style="color:#000000"> </span><span style="color:#0000ff">this</span><span style="color:#000000">.splitVar(</span><span style="color:#0000ff">this</span><span style="color:#000000">.tpl);<br>        <br>    };<br>    <br>    m.prototype.splitVar </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">function</span><span style="color:#000000">(tpl){<br>        </span><span style="color:#0000ff">var</span><span style="color:#000000"> chunks </span><span style="color:#000000">=</span><span style="color:#000000"> [], idx </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#000000">0</span><span style="color:#000000">, lastIndex </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#000000">0</span><span style="color:#000000">, le </span><span style="color:#000000">=</span><span style="color:#000000"> tpl.length;<br>        </span><span style="color:#0000ff">var</span><span style="color:#000000"> self </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">this</span><span style="color:#000000">;<br>        </span><span style="color:#0000ff">var</span><span style="color:#000000"> printPrefix </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#000000">"</span><span style="color:#000000">__buf__.push(</span><span style="color:#000000">"</span><span style="color:#000000">;<br>        </span><span style="color:#0000ff">var</span><span style="color:#000000"> replaced </span><span style="color:#000000">=</span><span style="color:#000000"> [];<br>        tpl</span><span style="color:#000000">=</span><span style="color:#000000">tpl.replace(</span><span style="color:#000000">"</span><span style="color:#000000">\r\n</span><span style="color:#000000">"</span><span style="color:#000000">,</span><span style="color:#000000">''</span><span style="color:#000000">).replace(</span><span style="color:#000000">"</span><span style="color:#000000">\t</span><span style="color:#000000">"</span><span style="color:#000000">,</span><span style="color:#000000">''</span><span style="color:#000000">);<br>        </span><span style="color:#0000ff">function</span><span style="color:#000000"> pushStr(str){<br>            str </span><span style="color:#000000">=</span><span style="color:#000000"> str.replace(</span><span style="color:#000000">/</span><span style="color:#000000">'</span><span style="color:#000000">/</span><span style="color:#000000">g, </span><span style="color:#000000">"</span><span style="color:#000000">\\'</span><span style="color:#000000">"</span><span style="color:#000000">);<br>            </span><span style="color:#0000ff">if</span><span style="color:#000000"> (str </span><span style="color:#000000">!==</span><span style="color:#000000"> </span><span style="color:#000000">''</span><span style="color:#000000">) {<br>                replaced.push(printPrefix </span><span style="color:#000000">+</span><span style="color:#000000"> </span><span style="color:#000000">'</span><span style="color:#000000">\</span><span style="color:#000000">''</span><span style="color:#000000"> + str + </span><span style="color:#000000">'</span><span style="color:#000000">\</span><span style="color:#000000">'</span><span style="color:#000000">);</span><span style="color:#000000">'</span><span style="color:#000000">);<br>            }<br>        }<br>        </span><span style="color:#0000ff">var</span><span style="color:#000000"> peek </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">function</span><span style="color:#000000">(tok){<br>                </span><span style="color:#0000ff">if</span><span style="color:#000000"> (tok </span><span style="color:#000000">==</span><span style="color:#000000"> </span><span style="color:#000000">"</span><span style="color:#000000">&lt;</span><span style="color:#000000">"</span><span style="color:#000000">) {<br>                    </span><span style="color:#0000ff">if</span><span style="color:#000000"> (tpl[idx </span><span style="color:#000000">+</span><span style="color:#000000"> </span><span style="color:#000000">1</span><span style="color:#000000">] </span><span style="color:#000000">==</span><span style="color:#000000"> </span><span style="color:#000000">"</span><span style="color:#000000">#</span><span style="color:#000000">"</span><span style="color:#000000"> </span><span style="color:#000000">&amp;&amp;</span><span style="color:#000000"> tpl[idx </span><span style="color:#000000">+</span><span style="color:#000000"> </span><span style="color:#000000">2</span><span style="color:#000000">] </span><span style="color:#000000">==</span><span style="color:#000000"> </span><span style="color:#000000">"</span><span style="color:#000000">-</span><span style="color:#000000">"</span><span style="color:#000000"> </span><span style="color:#000000">&amp;&amp;</span><span style="color:#000000"> tpl[idx </span><span style="color:#000000">+</span><span style="color:#000000"> </span><span style="color:#000000">2</span><span style="color:#000000">] </span><span style="color:#000000">==</span><span style="color:#000000"> </span><span style="color:#000000">"</span><span style="color:#000000">-</span><span style="color:#000000">"</span><span style="color:#000000">) {<br>                        findEnd(</span><span style="color:#000000">"</span><span style="color:#000000">&gt;</span><span style="color:#000000">"</span><span style="color:#000000">);<br>                        chunks.push(tpl.substring(lastIndex, idx));<br>                        pushStr(chunks[chunks.length</span><span style="color:#000000">-</span><span style="color:#000000">1</span><span style="color:#000000">].replace(</span><span style="color:#000000">"</span><span style="color:#000000">#</span><span style="color:#000000">"</span><span style="color:#000000">,</span><span style="color:#000000">'</span><span style="color:#000000">!</span><span style="color:#000000">'</span><span style="color:#000000">));<br>                        </span><span style="color:#0000ff">return</span><span style="color:#000000"> </span><span style="color:#0000ff">true</span><span style="color:#000000">;<br>                    }<br>                    </span><span style="color:#0000ff">else</span><span style="color:#000000"> <br>                        </span><span style="color:#0000ff">if</span><span style="color:#000000"> (tpl[idx </span><span style="color:#000000">+</span><span style="color:#000000"> </span><span style="color:#000000">1</span><span style="color:#000000">] </span><span style="color:#000000">==</span><span style="color:#000000"> </span><span style="color:#000000">"</span><span style="color:#000000">#</span><span style="color:#000000">"</span><span style="color:#000000">) {<br>                            findEnd(</span><span style="color:#000000">"</span><span style="color:#000000">&gt;</span><span style="color:#000000">"</span><span style="color:#000000">);<br>                            chunks.push(tpl.substring(lastIndex, idx));<br>                            replaced.push(r.regRuler.ruler(chunks[chunks.length</span><span style="color:#000000">-</span><span style="color:#000000">1</span><span style="color:#000000">].slice(</span><span style="color:#000000">2</span><span style="color:#000000">, </span><span style="color:#000000">-</span><span style="color:#000000">1</span><span style="color:#000000">)));<br>                            </span><span style="color:#0000ff">return</span><span style="color:#000000"> </span><span style="color:#0000ff">true</span><span style="color:#000000">;<br>                        }<br>                        </span><span style="color:#0000ff">else</span><span style="color:#000000"> <br>                            </span><span style="color:#0000ff">if</span><span style="color:#000000"> (tpl[idx </span><span style="color:#000000">+</span><span style="color:#000000"> </span><span style="color:#000000">1</span><span style="color:#000000">] </span><span style="color:#000000">==</span><span style="color:#000000"> </span><span style="color:#000000">"</span><span style="color:#000000">/</span><span style="color:#000000">"</span><span style="color:#000000"> </span><span style="color:#000000">&amp;&amp;</span><span style="color:#000000"> tpl[idx </span><span style="color:#000000">+</span><span style="color:#000000"> </span><span style="color:#000000">2</span><span style="color:#000000">] </span><span style="color:#000000">==</span><span style="color:#000000"> </span><span style="color:#000000">"</span><span style="color:#000000">#</span><span style="color:#000000">"</span><span style="color:#000000">) {<br>                                findEnd(</span><span style="color:#000000">"</span><span style="color:#000000">&gt;</span><span style="color:#000000">"</span><span style="color:#000000">);<br>                                chunks.push(tpl.substring(lastIndex, idx));<br>                                replaced.push(r.regRuler.ruler(chunks[chunks.length</span><span style="color:#000000">-</span><span style="color:#000000">1</span><span style="color:#000000">].slice(</span><span style="color:#000000">1</span><span style="color:#000000">, </span><span style="color:#000000">-</span><span style="color:#000000">1</span><span style="color:#000000">)))<br>                                </span><span style="color:#0000ff">return</span><span style="color:#000000"> </span><span style="color:#0000ff">true</span><span style="color:#000000">;<br>                            }<br>                }<br>                </span><span style="color:#0000ff">else</span><span style="color:#000000"> </span><span style="color:#0000ff">if</span><span style="color:#000000">(tok</span><span style="color:#000000">==</span><span style="color:#000000">"</span><span style="color:#000000">$</span><span style="color:#000000">"</span><span style="color:#000000">) {<br>                    </span><span style="color:#0000ff">if</span><span style="color:#000000"> (tpl[idx </span><span style="color:#000000">+</span><span style="color:#000000"> </span><span style="color:#000000">1</span><span style="color:#000000">] </span><span style="color:#000000">==</span><span style="color:#000000"> </span><span style="color:#000000">"</span><span style="color:#000000">{</span><span style="color:#000000">"</span><span style="color:#000000">) {<br>                        findEnd(</span><span style="color:#000000">"</span><span style="color:#000000">}</span><span style="color:#000000">"</span><span style="color:#000000">);<br>                        chunks.push(tpl.substring(lastIndex, idx));<br>                        replaced.push(printPrefix </span><span style="color:#000000">+</span><span style="color:#000000"> chunks[chunks.length</span><span style="color:#000000">-</span><span style="color:#000000">1</span><span style="color:#000000">].slice(</span><span style="color:#000000">2</span><span style="color:#000000">, </span><span style="color:#000000">-</span><span style="color:#000000">1</span><span style="color:#000000">) </span><span style="color:#000000">+</span><span style="color:#000000"> </span><span style="color:#000000">'</span><span style="color:#000000">);</span><span style="color:#000000">'</span><span style="color:#000000">);<br>                        </span><span style="color:#0000ff">return</span><span style="color:#000000"> </span><span style="color:#0000ff">true</span><span style="color:#000000">;<br>                    }<br>                }</span><span style="color:#0000ff">else</span><span style="color:#000000">{<br>                    <br>            </span><span style="color:#0000ff">return</span><span style="color:#000000"> </span><span style="color:#0000ff">false</span><span style="color:#000000">;<br>                    <br>                }<br><br>        }<br>        </span><span style="color:#0000ff">var</span><span style="color:#000000"> findEnd </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">function</span><span style="color:#000000">(tok){<br>            </span><span style="color:#0000ff">for</span><span style="color:#000000"> (</span><span style="color:#0000ff">var</span><span style="color:#000000"> i </span><span style="color:#000000">=</span><span style="color:#000000"> idx</span><span style="color:#000000">+</span><span style="color:#000000">2</span><span style="color:#000000"> ; i </span><span style="color:#000000">&lt;</span><span style="color:#000000"> le; i</span><span style="color:#000000">++</span><span style="color:#000000">) {<br>                    </span><span style="color:#0000ff">if</span><span style="color:#000000"> (tpl[i] </span><span style="color:#000000">==</span><span style="color:#000000"> tok) {<br>                        </span><span style="color:#008000">//</span><span style="color:#008000">增加非语法句</span><span style="color:#008000"><br></span><span style="color:#000000">                        </span><span style="color:#0000ff">if</span><span style="color:#000000"> (tpl[lastIndex] </span><span style="color:#000000">!=</span><span style="color:#000000"> </span><span style="color:#000000">'</span><span style="color:#000000">&lt;</span><span style="color:#000000">'</span><span style="color:#000000">) {<br>                            chunks.push(tpl.substring(lastIndex, idx))<br>                            pushStr(chunks[chunks.length</span><span style="color:#000000">-</span><span style="color:#000000">1</span><span style="color:#000000">]);<br>                        }<br>                        lastIndex </span><span style="color:#000000">=</span><span style="color:#000000"> idx;<br>                        idx </span><span style="color:#000000">=</span><span style="color:#000000"> i </span><span style="color:#000000">+</span><span style="color:#000000"> </span><span style="color:#000000">1</span><span style="color:#000000">;<br>                        </span><span style="color:#0000ff">break</span><span style="color:#000000">;<br>                    }<br>            }<br>        }<br>        <br>        </span><span style="color:#0000ff">while</span><span style="color:#000000"> (idx </span><span style="color:#000000">&lt;</span><span style="color:#000000"> le) {<br>            </span><span style="color:#0000ff">if</span><span style="color:#000000"> (peek(tpl[idx])) {<br>                </span><span style="color:#008000">//</span><span style="color:#008000">增加语法句</span><span style="color:#008000"><br></span><span style="color:#000000">                lastIndex </span><span style="color:#000000">=</span><span style="color:#000000"> idx;<br>            }<br>            </span><span style="color:#0000ff">else</span><span style="color:#000000"> {<br>                idx</span><span style="color:#000000">++</span><span style="color:#000000">;<br>            }<br>        }<br>        <br>        <br>        chunks.push(tpl.substring(lastIndex));<br>        replaced.push(tpl.substring(lastIndex))<br>        <br>        replaced </span><span style="color:#000000">=</span><span style="color:#000000"> [</span><span style="color:#000000">"</span><span style="color:#000000">var __buf__=[],$index=null;$util.print=function(str){__buf__.push(str);};with($data){</span><span style="color:#000000">"</span><span style="color:#000000">, replaced.join(</span><span style="color:#000000">''</span><span style="color:#000000">), </span><span style="color:#000000">"</span><span style="color:#000000">} return __buf__.join(&#39;&#39;);</span><span style="color:#000000">"</span><span style="color:#000000">].join(</span><span style="color:#000000">''</span><span style="color:#000000">);<br>        </span><span style="color:#008000">//</span><span style="color:#008000">need 4ms when the function is null</span><span style="color:#008000"><br></span><span style="color:#000000">        </span><span style="color:#0000ff">this</span><span style="color:#000000">.compiled </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">new</span><span style="color:#000000"> Function(</span><span style="color:#000000">"</span><span style="color:#000000">$data</span><span style="color:#000000">"</span><span style="color:#000000">, </span><span style="color:#000000">"</span><span style="color:#000000">$util</span><span style="color:#000000">"</span><span style="color:#000000">, replaced);<br>        </span><span style="color:#0000ff">var</span><span style="color:#000000"> util </span><span style="color:#000000">=</span><span style="color:#000000"> {};<br>        </span><span style="color:#0000ff">if</span><span style="color:#000000"> (m.util) {<br>            </span><span style="color:#0000ff">var</span><span style="color:#000000"> _util </span><span style="color:#000000">=</span><span style="color:#000000"> m.util;<br>            </span><span style="color:#0000ff">for</span><span style="color:#000000"> (</span><span style="color:#0000ff">var</span><span style="color:#000000"> key </span><span style="color:#0000ff">in</span><span style="color:#000000"> _util) {<br>                util[key] </span><span style="color:#000000">=</span><span style="color:#000000"> _util[key];<br>            }<br>        }<br>        </span><span style="color:#0000ff">return</span><span style="color:#000000"> </span><span style="color:#0000ff">this</span><span style="color:#000000">.compiled.call(</span><span style="color:#0000ff">this</span><span style="color:#000000">.scope </span><span style="color:#000000">||</span><span style="color:#000000"> window, </span><span style="color:#0000ff">this</span><span style="color:#000000">.data, util);<br>    };<br>    <br>    m.prototype.log </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">function</span><span style="color:#000000">(){<br>        </span><span style="color:#0000ff">if</span><span style="color:#000000"> (</span><span style="color:#0000ff">typeof</span><span style="color:#000000">(console) </span><span style="color:#000000">!==</span><span style="color:#000000"> </span><span style="color:#000000">"</span><span style="color:#000000">undefined</span><span style="color:#000000">"</span><span style="color:#000000">) {<br>            </span><span style="color:#0000ff">for</span><span style="color:#000000"> (</span><span style="color:#0000ff">var</span><span style="color:#000000"> i </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#000000">0</span><span style="color:#000000">; i </span><span style="color:#000000">&lt;</span><span style="color:#000000"> arguments.length; i</span><span style="color:#000000">++</span><span style="color:#000000">) {<br>                console.log(arguments[i]);<br>            }<br>        }<br>    };<br>    <br>})();</span></div></div><p> </p><p> </p><p> </p><p>测试代码在这里，只要把上面的js另存为remarker2.js放在demo page同一目录下就Ok了。用firefox调试</p><p> </p><div><div><span style="color:#0000ff">&lt;!</span><span style="color:#ff00ff">DOCTYPE HTML PUBLIC &quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot;<br>        &quot;http://www.w3.org/TR/html4/loose.dtd&quot;</span><span style="color:#0000ff">&gt;</span><span style="color:#000000"><br></span><span style="color:#0000ff">&lt;</span><span style="color:#800000">html</span><span style="color:#0000ff">&gt;</span><span style="color:#000000"><br></span><span style="color:#0000ff">&lt;</span><span style="color:#800000">head</span><span style="color:#0000ff">&gt;</span><span style="color:#000000"><br>    </span><span style="color:#0000ff">&lt;</span><span style="color:#800000">meta </span><span style="color:#ff0000">content</span><span style="color:#0000ff">="text/html;charset=utf-8"</span><span style="color:#ff0000"> http-equiv</span><span style="color:#0000ff">="Content-Type"</span><span style="color:#0000ff">&gt;</span><span style="color:#000000"><br>    </span><span style="color:#0000ff">&lt;</span><span style="color:#800000">title</span><span style="color:#0000ff">&gt;</span><span style="color:#000000">template engine -reMarker </span><span style="color:#0000ff">&lt;/</span><span style="color:#800000">title</span><span style="color:#0000ff">&gt;</span><span style="color:#000000"><br>    </span><span style="color:#0000ff">&lt;</span><span style="color:#800000">script </span><span style="color:#ff0000">type</span><span style="color:#0000ff">="text/javascript"</span><span style="color:#ff0000"> src</span><span style="color:#0000ff">="reMarker2.js"</span><span style="color:#0000ff">&gt;&lt;/</span><span style="color:#800000">script</span><span style="color:#0000ff">&gt;</span><span style="color:#000000"><br></span><span style="color:#0000ff">&lt;/</span><span style="color:#800000">head</span><span style="color:#0000ff">&gt;</span><span style="color:#000000"><br></span><span style="color:#0000ff">&lt;</span><span style="color:#800000">body</span><span style="color:#0000ff">&gt;</span><span style="color:#000000"><br>    </span><span style="color:#0000ff">&lt;</span><span style="color:#800000">div </span><span style="color:#ff0000">id</span><span style="color:#0000ff">="tpl"</span><span style="color:#0000ff">&gt;</span><span style="color:#000000"><br>        </span><span style="color:#0000ff">&lt;</span><span style="color:#800000">pre </span><span style="color:#ff0000">id</span><span style="color:#0000ff">="tpl_pre"</span><span style="color:#0000ff">&gt;&lt;/</span><span style="color:#800000">pre</span><span style="color:#0000ff">&gt;</span><span style="color:#000000"><br>    </span><span style="color:#0000ff">&lt;/</span><span style="color:#800000">div</span><span style="color:#0000ff">&gt;</span><span style="color:#000000"><br>    </span><span style="color:#0000ff">&lt;</span><span style="color:#800000">div </span><span style="color:#ff0000">id</span><span style="color:#0000ff">="text"</span><span style="color:#0000ff">&gt;&lt;/</span><span style="color:#800000">div</span><span style="color:#0000ff">&gt;</span><span style="color:#000000"><br></span><span style="color:#0000ff">&lt;/</span><span style="color:#800000">body</span><span style="color:#0000ff">&gt;</span><span style="color:#000000"><br></span><span style="color:#0000ff">&lt;</span><span style="color:#800000">script </span><span style="color:#ff0000">type</span><span style="color:#0000ff">="text/javascript"</span><span style="color:#0000ff">&gt;</span><span style="background-color:#f5f5f5;color:#000000"><br>    </span><span style="background-color:#f5f5f5;color:#0000ff">var</span><span style="background-color:#f5f5f5;color:#000000"> html</span><span style="background-color:#f5f5f5;color:#000000">=</span><span style="background-color:#f5f5f5;color:#000000">[</span><span style="background-color:#f5f5f5;color:#000000">'</span><span style="background-color:#f5f5f5;color:#000000">&lt;p&gt;name: ${name}&lt;/p&gt;</span><span style="background-color:#f5f5f5;color:#000000">'</span><span style="background-color:#f5f5f5;color:#000000">,<br>                </span><span style="background-color:#f5f5f5;color:#000000">'</span><span style="background-color:#f5f5f5;color:#000000">&lt;p&gt;age: ${age}&lt;/p&gt;</span><span style="background-color:#f5f5f5;color:#000000">'</span><span style="background-color:#f5f5f5;color:#000000">,<br>                </span><span style="background-color:#f5f5f5;color:#000000">'</span><span style="background-color:#f5f5f5;color:#000000">&lt;p&gt;sex: ${sex}&lt;/p&gt;</span><span style="background-color:#f5f5f5;color:#000000">'</span><span style="background-color:#f5f5f5;color:#000000">,<br>                </span><span style="background-color:#f5f5f5;color:#000000">'</span><span style="background-color:#f5f5f5;color:#000000">&lt;p&gt;fav:&lt;/p&gt;&lt;ul&gt;</span><span style="background-color:#f5f5f5;color:#000000">'</span><span style="background-color:#f5f5f5;color:#000000">,<br>                </span><span style="background-color:#f5f5f5;color:#000000">'</span><span style="background-color:#f5f5f5;color:#000000">&lt;#list fav as f&gt;</span><span style="background-color:#f5f5f5;color:#000000">'</span><span style="background-color:#f5f5f5;color:#000000">,<br>                    </span><span style="background-color:#f5f5f5;color:#000000">'</span><span style="background-color:#f5f5f5;color:#000000">&lt;li&gt;${f}&lt;/li&gt;</span><span style="background-color:#f5f5f5;color:#000000">'</span><span style="background-color:#f5f5f5;color:#000000">,<br>                </span><span style="background-color:#f5f5f5;color:#000000">'</span><span style="background-color:#f5f5f5;color:#000000">&lt;/#list&gt;</span><span style="background-color:#f5f5f5;color:#000000">'</span><span style="background-color:#f5f5f5;color:#000000">,<br>                </span><span style="background-color:#f5f5f5;color:#000000">'</span><span style="background-color:#f5f5f5;color:#000000">&lt;/ul&gt;</span><span style="background-color:#f5f5f5;color:#000000">'</span><span style="background-color:#f5f5f5;color:#000000">,<br>                </span><span style="background-color:#f5f5f5;color:#000000">'</span><span style="background-color:#f5f5f5;color:#000000">&lt;#--list language as being--&gt;</span><span style="background-color:#f5f5f5;color:#000000">'</span><span style="background-color:#f5f5f5;color:#000000">,<br>                </span><span style="background-color:#f5f5f5;color:#000000">'</span><span style="background-color:#f5f5f5;color:#000000">&lt;p&gt;language:&lt;/p&gt;&lt;ul&gt;</span><span style="background-color:#f5f5f5;color:#000000">'</span><span style="background-color:#f5f5f5;color:#000000">,<br>                </span><span style="background-color:#f5f5f5;color:#000000">'</span><span style="background-color:#f5f5f5;color:#000000">&lt;#list language as being&gt;</span><span style="background-color:#f5f5f5;color:#000000">'</span><span style="background-color:#f5f5f5;color:#000000">,<br>                    </span><span style="background-color:#f5f5f5;color:#000000">'</span><span style="background-color:#f5f5f5;color:#000000">&lt;li&gt;${being_index + 1} - </span><span style="background-color:#f5f5f5;color:#000000">'</span><span style="background-color:#f5f5f5;color:#000000">,<br>                    </span><span style="background-color:#f5f5f5;color:#000000">'</span><span style="background-color:#f5f5f5;color:#000000">&lt;span style=&quot;color:&lt;#if being.level &lt; 1 &gt;red&lt;#else&gt;black&lt;/#if&gt;&quot;&gt;</span><span style="background-color:#f5f5f5;color:#000000">'</span><span style="background-color:#f5f5f5;color:#000000">,<br>                    </span><span style="background-color:#f5f5f5;color:#000000">'</span><span style="background-color:#f5f5f5;color:#000000">${being.name}: ${being.level}&lt;/span&gt;</span><span style="background-color:#f5f5f5;color:#000000">'</span><span style="background-color:#f5f5f5;color:#000000">,<br>                    </span><span style="background-color:#f5f5f5;color:#000000">'</span><span style="background-color:#f5f5f5;color:#000000">&lt;/li&gt;</span><span style="background-color:#f5f5f5;color:#000000">'</span><span style="background-color:#f5f5f5;color:#000000">,<br>                </span><span style="background-color:#f5f5f5;color:#000000">'</span><span style="background-color:#f5f5f5;color:#000000">&lt;/#list&gt;</span><span style="background-color:#f5f5f5;color:#000000">'</span><span style="background-color:#f5f5f5;color:#000000">,<br>                </span><span style="background-color:#f5f5f5;color:#000000">'</span><span style="background-color:#f5f5f5;color:#000000">&lt;/ul&gt;</span><span style="background-color:#f5f5f5;color:#000000">'</span><span style="background-color:#f5f5f5;color:#000000">,<br>                </span><span style="background-color:#f5f5f5;color:#000000">'</span><span style="background-color:#f5f5f5;color:#000000">&lt;#if like&gt;&lt;span style=&quot;color: red&quot;&gt;Yes, we like it!&lt;/span&gt;</span><span style="background-color:#f5f5f5;color:#000000">'</span><span style="background-color:#f5f5f5;color:#000000">,<br>                </span><span style="background-color:#f5f5f5;color:#000000">'</span><span style="background-color:#f5f5f5;color:#000000">&lt;#else&gt;&lt;span style=&quot;color: green&quot;&gt;No, we don\</span><span style="background-color:#f5f5f5;color:#000000">'</span><span style="background-color:#f5f5f5;color:#000000">t like it</span><span style="background-color:#f5f5f5;color:#000000">!&lt;</span><span style="background-color:#f5f5f5;color:#000000">/</span><span style="background-color:#f5f5f5;color:#000000">span&gt;&lt;</span><span style="background-color:#f5f5f5;color:#000000">/</span><span style="background-color:#f5f5f5;color:#000000">#</span><span style="background-color:#f5f5f5;color:#0000ff">if</span><span style="background-color:#f5f5f5;color:#000000">&gt;</span><span style="background-color:#f5f5f5;color:#000000">'</span><span style="background-color:#f5f5f5;color:#000000">].join(</span><span style="background-color:#f5f5f5;color:#000000">''</span><span style="background-color:#f5f5f5;color:#000000">);<br>        var data ={<br>            name: &quot;mark one&quot;,<br>            age: 28,<br>            sex: &quot;male&quot;,<br>            fav: [&quot;game&quot;, &quot;swim&quot;, &quot;programming&quot;],<br>            language: [{<br>                name: &quot;C#&quot;,<br>                level: 2<br>            }, {<br>                name: &quot;javascript&quot;,<br>                level: 3<br>            }, {<br>                name: &quot;java&quot;,<br>                level: 2<br>            }, {<br>                name: &quot;python&quot;,<br>                level: 1<br>            }],<br>            like: true<br>        };<br><br>        var te;<br><br>        console.profile();<br>        var marker=new reMarker(html,data);<br>        te=marker.process()<br>        console.profileEnd();<br><br>        document.write(te)<br>        //marker.process();<br><br>&lt;/script&gt;<br>&lt;/html&gt;</span></div></div><p> </p><p> </p><p> </p><p> </p><img src="http://www.cnblogs.com/simon4545/aggbug/1905855.html?type=1" width="1" height="1" alt=""><p>作者: <a href="http://www.cnblogs.com/simon4545/">simon4545</a> 发表于 2010-12-14 17:03 <a href="http://www.cnblogs.com/simon4545/archive/2010/12/14/1905855.html">原文链接</a></p><p>评论: 5　<a href="http://www.cnblogs.com/simon4545/archive/2010/12/14/1905855.html#pagedcomment">查看评论</a>　<a href="http://www.cnblogs.com/simon4545/archive/2010/12/14/1905855.html#commentform">发表评论</a></p><hr><p>最新新闻：<br>· <a href="http://news.cnblogs.com/n/84612/">专访甲骨文高管：Java虚拟机将支持更多动态语言 公布移动版路线图</a><span style="color:gray">(2010-12-14 22:57)</span><br>· <a href="http://news.cnblogs.com/n/84611/">甲骨文宣布成立北京云计算解决方案中心</a><span style="color:gray">(2010-12-14 22:49)</span><br>· <a href="http://news.cnblogs.com/n/84610/">我们的宇宙不是唯一的</a><span style="color:gray">(2010-12-14 22:22)</span><br>· <a href="http://news.cnblogs.com/n/84609/">法国竞争局警告谷歌不要滥用市场主导地位</a><span style="color:gray">(2010-12-14 22:21)</span><br>· <a href="http://news.cnblogs.com/n/84608/">旅行者1号即将飞离太阳系</a><span style="color:gray">(2010-12-14 22:20)</span><br></p><p>编辑推荐：<a href="http://www.cnblogs.com/allenlooplee/archive/2010/12/14/1905184.html">WP7有约（二）：课后作业</a><br></p><p>网站导航：<a href="http://www.cnblogs.com">博客园首页</a>  <a href="http://home.cnblogs.com/">我的园子</a>  <a href="http://news.cnblogs.com">新闻</a>  <a href="http://home.cnblogs.com/ing/">闪存</a>  <a href="http://home.cnblogs.com/group/">小组</a>  <a href="http://space.cnblogs.com/q/">博问</a>  <a href="http://kb.cnblogs.com">知识库</a></p></p>


</div>


            <div class="footer">
              <div class="contact">
                <p>
                  Your Name<br />
                  What You Are<br />
                  your@email.com
                </p>
              </div>
              <div class="contact">
                <p>
                  <a href="http://github.com/yourusername/">github.com/yourusername</a><br />
                  <a href="http://twitter.com/yourusername/">twitter.com/yourusername</a><br />
                </p>
              </div>
            </div>
          </div>
        </div> <!-- /container -->

    </body>
</html>
