<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>关于QQ一些功能的实现</title>
        <meta name="viewport" content="width=device-width">

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/google_reader/css/syntax.css">

        <!-- Custom CSS -->
        <link rel="stylesheet" href="/google_reader/css/main.css">

    </head>
    <body>

        <div class="container">
          <div class="site">
            <div class="header">
              <h1 class="title"><a href="/google_reader/">Google Reader</a></h1>
              <a class="extra" href="/google_reader/">home</a>
            </div>

                <h2>关于QQ一些功能的实现</h2>
<p class="meta">2010-12-22 22:08</p>

<div class="post">
<h2>关于QQ一些功能的实现</h2>

<h3>by Create Chen</h3>

<h3>at 2010-12-22 14:08:00</h3>

<h3>original <a href="http://www.cnblogs.com/technology/archive/2010/12/22/1913821.html">http://www.cnblogs.com/technology/archive/2010/12/22/1913821.html</a></h3>

<p><p>　　在网上搜了很久关于腾讯的接口, 但资料很有限, 绝大部分都是重复的, 由于想实现一些比较好玩的应用, 我只好根</p>
<p>据手头能搜到的资料进行实现了. 现在可以实现QQ登陆, 发消息, 接受消息, 加好友, 查询好友资料, 更改QQ状态, 查询</p>
<p>已添加的好友(只能按QQ号排序, 获取到前120名名单, 原因不明), 查看某QQ用户个人资料等功能, 可以给有兴趣的同学</p>
<p>们参考一下. 也请有这方面经验的前辈们补充补充你们知道的其它功能:)</p>
<p>　　原理是向腾讯<a href="http://tqq.tencent.com:8000">http://tqq.tencent.com:8000</a> 进行POST一个UTF8编码的Byte[], 这个数组是根据各个功能的协</p>
<p>议进行编码的, 成功后返回一个UTF8编码的Byte[]数组, 因此我把这个方法抽取出来:</p>
<div style="width:709px;height:212px">
<pre><div><span style="color:#000000">        </span><span style="color:#0000ff">private</span><span style="color:#000000"> </span><span style="color:#0000ff">void</span><span style="color:#000000"> UploadData()<br>        {<br>            </span><span style="color:#0000ff">try</span><span style="color:#000000"><br>            {<br>                pageData </span><span style="color:#000000">=</span><span style="color:#000000"> _client.UploadData(</span><span style="color:#800000">"</span><span style="color:#800000">http://tqq.tencent.com:8000</span><span style="color:#800000">"</span><span style="color:#000000">, </span><span style="color:#800000">"</span><span style="color:#800000">POST</span><span style="color:#800000">"</span><span style="color:#000000">, byteArray);<br>            }<br>            </span><span style="color:#0000ff">catch</span><span style="color:#000000"> { }<br>        }</span></div></pre>
</div>
<h2><span>类中定义的变量:</span></h2>
<div style="width:650px;height:359px">
<pre><div><span style="color:#000000">       </span><span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">string</span><span style="color:#000000"> num;  </span><span style="color:#008000">//</span><span style="color:#008000">构造函数的QQ号码</span><span style="color:#008000"><br></span><span style="color:#000000">        </span><span style="color:#0000ff">private</span><span style="color:#000000"> </span><span style="color:#0000ff">string</span><span style="color:#000000"> pwd; </span><span style="color:#008000">//</span><span style="color:#008000">构造函数的QQ密码</span><span style="color:#008000"><br></span><span style="color:#000000"><br>        </span><span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">string</span><span style="color:#000000">[] online_Face</span><span style="color:#000000">=</span><span style="color:#000000">{</span><span style="color:#800000">""</span><span style="color:#000000">};   </span><span style="color:#008000">//</span><span style="color:#008000">在线的头像号码</span><span style="color:#008000"><br></span><span style="color:#000000">        </span><span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">string</span><span style="color:#000000">[] online_Station</span><span style="color:#000000">=</span><span style="color:#000000">{</span><span style="color:#800000">""</span><span style="color:#000000">};    </span><span style="color:#008000">//</span><span style="color:#008000">在线的状态</span><span style="color:#008000"><br></span><span style="color:#000000">        </span><span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">string</span><span style="color:#000000">[] online_Number</span><span style="color:#000000">=</span><span style="color:#000000">{</span><span style="color:#800000">""</span><span style="color:#000000">}; </span><span style="color:#008000">//</span><span style="color:#008000">在线的号码</span><span style="color:#008000"><br></span><span style="color:#000000">        </span><span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">string</span><span style="color:#000000">[] online_NameK</span><span style="color:#000000">=</span><span style="color:#000000">{</span><span style="color:#800000">""</span><span style="color:#000000">};  </span><span style="color:#008000">//</span><span style="color:#008000">在线的昵称</span><span style="color:#008000"><br></span><span style="color:#000000"><br>        </span><span style="color:#0000ff">private</span><span style="color:#000000"> WebClient _client </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">new</span><span style="color:#000000"> WebClient();    </span><span style="color:#008000">//</span><span style="color:#008000">用来给服务器发送消息的</span><span style="color:#008000"><br></span><span style="color:#000000"><br>        </span><span style="color:#0000ff">private</span><span style="color:#000000"> </span><span style="color:#0000ff">string</span><span style="color:#000000"> postValues;  </span><span style="color:#008000">//</span><span style="color:#008000">发送给服务器的字符串</span><span style="color:#008000"><br></span><span style="color:#000000">        </span><span style="color:#0000ff">private</span><span style="color:#000000"> </span><span style="color:#0000ff">byte</span><span style="color:#000000">[] byteArray;   </span><span style="color:#008000">//</span><span style="color:#008000">把要发送的字符串变成字符数组</span><span style="color:#008000"><br></span><span style="color:#000000">        </span><span style="color:#0000ff">private</span><span style="color:#000000"> </span><span style="color:#0000ff">byte</span><span style="color:#000000">[] pageData;    </span><span style="color:#008000">//</span><span style="color:#008000">接受服务器返回的字符数组</span><span style="color:#008000"><br></span><span style="color:#000000">        </span><span style="color:#0000ff">private</span><span style="color:#000000"> </span><span style="color:#0000ff">string</span><span style="color:#000000"> s;   </span><span style="color:#008000">//</span><span style="color:#008000">把返回的字符数组变成字符串</span><span style="color:#008000"><br></span><span style="color:#000000"><br>        </span><span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">string</span><span style="color:#000000">[] MT;    </span><span style="color:#008000">//</span><span style="color:#008000">储存信息类型</span><span style="color:#008000"><br></span><span style="color:#000000">        </span><span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">string</span><span style="color:#000000">[] UN;    </span><span style="color:#008000">//</span><span style="color:#008000">储存信息来源号码</span><span style="color:#008000"><br></span><span style="color:#000000">        </span><span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">string</span><span style="color:#000000">[] MG;    </span><span style="color:#008000">//</span><span style="color:#008000">储存信息内容</span><span style="color:#008000"><br></span><span style="color:#000000"><br>        </span><span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">bool</span><span style="color:#000000"> is_RightLogin;  </span><span style="color:#008000">//</span><span style="color:#008000">判断当前用户是否正确登录</span></div></pre>
</div>
<h2>构造一个QQ类实例的构造函数:</h2>
<div style="width:676px;height:263px">
<pre><div><span style="color:#808080">        ///</span><span style="color:#008000"> </span><span style="color:#808080">&lt;summary&gt;</span><span style="color:#008000"><br>        </span><span style="color:#808080">///</span><span style="color:#008000"> QQ类的构造函数<br>        </span><span style="color:#808080">///</span><span style="color:#008000"> </span><span style="color:#808080">&lt;/summary&gt;</span><span style="color:#008000"><br>        </span><span style="color:#808080">///</span><span style="color:#008000"> </span><span style="color:#808080">&lt;param name=&quot;QQ_Num&quot;&gt;</span><span style="color:#008000">QQ号码</span><span style="color:#808080">&lt;/param&gt;</span><span style="color:#008000"><br>        </span><span style="color:#808080">///</span><span style="color:#008000"> </span><span style="color:#808080">&lt;param name=&quot;QQ_Pwd&quot;&gt;</span><span style="color:#008000">QQ密码</span><span style="color:#808080">&lt;/param&gt;</span><span style="color:#808080"><br></span><span style="color:#000000">        </span><span style="color:#0000ff">public</span><span style="color:#000000"> QQ (</span><span style="color:#0000ff">string</span><span style="color:#000000"> QQ_Num, </span><span style="color:#0000ff">string</span><span style="color:#000000"> QQ_Pwd)<br>        {<br>            </span><span style="color:#0000ff">this</span><span style="color:#000000">.num </span><span style="color:#000000">=</span><span style="color:#000000"> QQ_Num;<br>            </span><span style="color:#0000ff">this</span><span style="color:#000000">.pwd </span><span style="color:#000000">=</span><span style="color:#000000"> QQ_Pwd;<br>        }</span></div></pre>
</div>
<h2>实现QQ登陆的功能:</h2>
<p>　　协议: VER=1.1&amp;CMD=Login&amp;SEQ=&amp;UIN=&amp;PS=&amp;M5=1&amp;LC=9326B87B234E7235</p>
<p>　　解释: VER是用来说明QQ协议的版本,CMD是说明协议的命令,Login就是指QQ的登录了, SEQ是他的为了防止</p>
<p>重复发送而设定的一个标记,可以取时间得毫秒值, 一个随机数也可以, UIN是说明你当前要登录的用户QQ号, PS是M</p>
<p>D5加密过后的密码的值.</p>
<div style="width:690px;height:439px">
<pre><div><span style="color:#000000">        </span><span style="color:#808080">///</span><span style="color:#008000"> </span><span style="color:#808080">&lt;summary&gt;</span><span style="color:#008000"><br>        </span><span style="color:#808080">///</span><span style="color:#008000"> 登陆QQ<br>        </span><span style="color:#808080">///</span><span style="color:#008000"> </span><span style="color:#808080">&lt;/summary&gt;</span><span style="color:#008000"><br>        </span><span style="color:#808080">///</span><span style="color:#008000"> </span><span style="color:#808080">&lt;returns&gt;</span><span style="color:#008000">登陆成功就返回True</span><span style="color:#808080">&lt;/returns&gt;</span><span style="color:#808080"><br></span><span style="color:#000000">        </span><span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">bool</span><span style="color:#000000"> QQ_Login()<br>        {<br>              postValues </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#800000">"</span><span style="color:#800000">VER=1.1&amp;CMD=Login&amp;SEQ=</span><span style="color:#800000">"</span><span style="color:#000000"> </span><span style="color:#000000">+</span><span style="color:#000000"> DateTime.Now.Ticks.ToString().Substring(</span><span style="color:#800080">7</span><span style="color:#000000">, </span><span style="color:#800080">7</span><span style="color:#000000">)<br>                    </span><span style="color:#000000">+</span><span style="color:#000000"> </span><span style="color:#800000">"</span><span style="color:#800000">&amp;UIN=</span><span style="color:#800000">"</span><span style="color:#000000"> </span><span style="color:#000000">+</span><span style="color:#000000"> num </span><span style="color:#000000">+</span><span style="color:#000000"> </span><span style="color:#800000">"</span><span style="color:#800000">&amp;PS=</span><span style="color:#800000">"</span><span style="color:#000000"> </span><span style="color:#000000">+</span><span style="color:#000000"> MD5(pwd) </span><span style="color:#000000">+</span><span style="color:#000000"> </span><span style="color:#800000">"</span><span style="color:#800000"> &amp;M5=1&amp;LC=9326B87B234E7235</span><span style="color:#800000">"</span><span style="color:#000000">;<br>                byteArray </span><span style="color:#000000">=</span><span style="color:#000000"> System.Text.Encoding.UTF8.GetBytes(postValues);<br>                </span><span style="color:#008000">//</span><span style="color:#008000">向服务器POST数据</span><span style="color:#008000"><br></span><span style="color:#000000">                UploadData();<br>                </span><span style="color:#0000ff">if</span><span style="color:#000000"> (Encoding.UTF8.GetString(pageData).Contains(</span><span style="color:#800000">"</span><span style="color:#800000">RES=0&amp;RS=0</span><span style="color:#800000">"</span><span style="color:#000000">))<br>                {<br>                    is_RightLogin </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">true</span><span style="color:#000000">;<br>                    </span><span style="color:#0000ff">return</span><span style="color:#000000"> </span><span style="color:#0000ff">true</span><span style="color:#000000">;<br>                }<br>                </span><span style="color:#0000ff">else</span><span style="color:#000000"><br>                    </span><span style="color:#0000ff">return</span><span style="color:#000000"> </span><span style="color:#0000ff">false</span><span style="color:#000000">;<br>        }</span></div></pre>
</div>
<p>　　QQ的MD5加密方法:</p>
<div style="width:694px;height:179px">
<pre><div><span style="color:#000000">        </span><span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">static</span><span style="color:#000000"> </span><span style="color:#0000ff">string</span><span style="color:#000000"> MD5(</span><span style="color:#0000ff">string</span><span style="color:#000000"> toCryString)<br>        {<br>            MD5CryptoServiceProvider hashmd5;   </span><span style="color:#008000">//</span><span style="color:#008000">using System.Security.Cryptography安全.密码系统</span><span style="color:#008000"><br></span><span style="color:#000000">            hashmd5 </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">new</span><span style="color:#000000"> MD5CryptoServiceProvider();<br></span><span style="color:#000000">            </span><span style="color:#0000ff">return</span><span style="color:#000000"> BitConverter.ToString(hashmd5.ComputeHash(Encoding.UTF8.GetBytes(toCryString))).Replace(</span><span style="color:#800000">"</span><span style="color:#800000">-</span><span style="color:#800000">"</span><span style="color:#000000">, </span><span style="color:#800000">""</span><span style="color:#000000">).ToLower();<br>        }</span></div></pre>
</div>
<p>　　QQ登陆的返回协议: VER=1.1&amp;CMD=Login&amp;SEQ=&amp;UIN=&amp;RES=0&amp;RS=0&amp;HI=60&amp;LI=300(这是登陆成功的一个例子)</p>
<p>　　解释: RES为0表示成功返回,RS为0表示登录成功, VER=1.1&amp;CMD=Login&amp;SEQ=&amp;UIN=&amp;RES=0&amp;RS=1&amp;RA=登录失败</p>
<p>　　　　　　RS为1表示登录失败,那么就会出现提示信息RA说明原因.</p>
<h2>获取QQ好友列表:</h2>
<p> 　　协议: VER=1.1&amp;CMD=List&amp;SEQ=&amp;UIN=&amp;TN=160&amp;UN=0</p>
<div style="width:691px;height:399px">
<pre><div><span style="color:#000000">        </span><span style="color:#808080">///</span><span style="color:#008000"> </span><span style="color:#808080">&lt;summary&gt;</span><span style="color:#008000"><br>        </span><span style="color:#808080">///</span><span style="color:#008000"> 获取QQ好友列表<br>        </span><span style="color:#808080">///</span><span style="color:#008000"> </span><span style="color:#808080">&lt;/summary&gt;</span><span style="color:#008000"><br>        </span><span style="color:#808080">///</span><span style="color:#008000"> </span><span style="color:#808080">&lt;returns&gt;</span><span style="color:#008000">返回一个字符串数组,数组最后一个元素是空格</span><span style="color:#808080">&lt;/returns&gt;</span><span style="color:#808080"><br></span><span style="color:#000000">        </span><span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">string</span><span style="color:#000000">[] QQ_List()<br>        {<br>            postValues </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#800000">"</span><span style="color:#800000">VER=1.1&amp;CMD=List&amp;SEQ=</span><span style="color:#800000">"</span><span style="color:#000000"> </span><span style="color:#000000">+</span><span style="color:#000000"> DateTime.Now.Ticks.ToString().Substring(</span><span style="color:#800080">7</span><span style="color:#000000">, </span><span style="color:#800080">7</span><span style="color:#000000">) </span><span style="color:#000000">+</span><span style="color:#000000"> </span><span style="color:#800000">"</span><span style="color:#800000">&amp;UIN=</span><span style="color:#800000">"</span><span style="color:#000000"> </span><span style="color:#000000">+</span><span style="color:#000000"> num </span><span style="color:#000000">+</span><span style="color:#000000"> </span><span style="color:#800000">"</span><span style="color:#800000">&amp;TN=160&amp;UN=0</span><span style="color:#800000">"</span><span style="color:#000000">;<br>            byteArray </span><span style="color:#000000">=</span><span style="color:#000000"> System.Text.Encoding.UTF8.GetBytes(postValues);<br>            </span><span style="color:#008000">//</span><span style="color:#008000">向服务器POST数据</span><span style="color:#008000"><br></span><span style="color:#000000">            UploadData();<br>            s </span><span style="color:#000000">=</span><span style="color:#000000"> Encoding.UTF8.GetString(pageData);<br>            </span><span style="color:#0000ff">if</span><span style="color:#000000"> (</span><span style="color:#000000">!</span><span style="color:#000000">s.Contains(</span><span style="color:#800000">"</span><span style="color:#800000">&amp;RES=0</span><span style="color:#800000">"</span><span style="color:#000000">))<br>                is_RightLogin </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">false</span><span style="color:#000000">;<br>            </span><span style="color:#0000ff">string</span><span style="color:#000000"> s2 </span><span style="color:#000000">=</span><span style="color:#000000"> s.Remove(</span><span style="color:#800080">0</span><span style="color:#000000">, s.IndexOf(</span><span style="color:#800000">"</span><span style="color:#800000">&amp;UN=</span><span style="color:#800000">"</span><span style="color:#000000">)</span><span style="color:#000000">+</span><span style="color:#800080">4</span><span style="color:#000000">);<br>            </span><span style="color:#0000ff">string</span><span style="color:#000000">[] QQ_Friend_List </span><span style="color:#000000">=</span><span style="color:#000000"> s.Split(</span><span style="color:#800000">'</span><span style="color:#800000">,</span><span style="color:#800000">'</span><span style="color:#000000">);<br>            </span><span style="color:#0000ff">return</span><span style="color:#000000"> QQ_Friend_List;<br>        }</span></div></pre>
</div>
<p>　　返回协议: VER=1.1&amp;CMD=LIST&amp;SEQ=&amp;UIN=&amp;RES=0&amp;FN=1&amp;SN=&amp;UN=</p>
<p>　　解释: UN后面则是您好友的QQ号码,每个号码都由,进行分开, 我用string.Split(&#39;,&#39;)把值放入字符串数组中返回了.</p>
<h2>更新目前在线online_四个字符串数组中好友信息的值:</h2>
<p> 　  协议: VER=1.1&amp;CMD=Query_Stat&amp;SEQ=&amp;UIN=&amp;TN=50&amp;UN=0</p>
<p>　　解释: 获得QQ好友在线名单跟获得好友名单差不多,不同的是用的命令不同用的是Query_Stat</p>
<div style="width:672px;height:599px">
<pre><div><span style="color:#000000">        </span><span style="color:#808080">///</span><span style="color:#008000"> </span><span style="color:#808080">&lt;summary&gt;</span><span style="color:#008000"><br>        </span><span style="color:#808080">///</span><span style="color:#008000"> 更新QQ类中目前在线online_四个字符串数组的值<br>        </span><span style="color:#808080">///</span><span style="color:#008000"> </span><span style="color:#808080">&lt;/summary&gt;</span><span style="color:#808080"><br></span><span style="color:#000000">        </span><span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">void</span><span style="color:#000000"> QQ_Query_Stat()<br>        {<br>            postValues </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#800000">"</span><span style="color:#800000">VER=1.1&amp;CMD=Query_Stat&amp;SEQ=</span><span style="color:#800000">"</span><span style="color:#000000"> </span><span style="color:#000000">+</span><span style="color:#000000"> DateTime.Now.Ticks.ToString().Substring(</span><span style="color:#800080">7</span><span style="color:#000000">, </span><span style="color:#800080">7</span><span style="color:#000000">) </span><span style="color:#000000">+</span><span style="color:#000000"> </span><span style="color:#800000">"</span><span style="color:#800000">&amp;UIN=</span><span style="color:#800000">"</span><span style="color:#000000"> </span><span style="color:#000000">+</span><span style="color:#000000"> num </span><span style="color:#000000">+</span><span style="color:#000000"> </span><span style="color:#800000">"</span><span style="color:#800000">&amp;TN=50&amp;UN=0</span><span style="color:#800000">"</span><span style="color:#000000">;<br>            byteArray </span><span style="color:#000000">=</span><span style="color:#000000"> System.Text.Encoding.UTF8.GetBytes(postValues);<br>            </span><span style="color:#008000">//</span><span style="color:#008000">向服务器POST数据</span><span style="color:#008000"><br></span><span style="color:#000000">              UploadData();<br></span><span style="color:#000000">            s </span><span style="color:#000000">=</span><span style="color:#000000"> Encoding.UTF8.GetString(pageData);<br>            </span><span style="color:#0000ff">if</span><span style="color:#000000"> (</span><span style="color:#000000">!</span><span style="color:#000000">s.Contains(</span><span style="color:#800000">"</span><span style="color:#800000">&amp;RES=0</span><span style="color:#800000">"</span><span style="color:#000000">))<br>                is_RightLogin </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">false</span><span style="color:#000000">;<br>            StringBuilder sb </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">new</span><span style="color:#000000"> StringBuilder(s);<br>            sb.Remove(s.IndexOf(</span><span style="color:#800000">"</span><span style="color:#800000">&amp;FN=</span><span style="color:#800000">"</span><span style="color:#000000">), s.Length </span><span style="color:#000000">-</span><span style="color:#000000"> s.IndexOf(</span><span style="color:#800000">"</span><span style="color:#800000">&amp;FN=</span><span style="color:#800000">"</span><span style="color:#000000">));<br>            sb.Remove(</span><span style="color:#800080">0</span><span style="color:#000000">,s.IndexOf(</span><span style="color:#800000">"</span><span style="color:#800000">&amp;FC=</span><span style="color:#800000">"</span><span style="color:#000000">)</span><span style="color:#000000">+</span><span style="color:#800080">4</span><span style="color:#000000">);<br>            online_Face </span><span style="color:#000000">=</span><span style="color:#000000"> sb.ToString().Split(</span><span style="color:#800000">'</span><span style="color:#800000">,</span><span style="color:#800000">'</span><span style="color:#000000">);<br><br>            sb </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">new</span><span style="color:#000000"> StringBuilder(s);<br>            sb.Remove(s.IndexOf(</span><span style="color:#800000">"</span><span style="color:#800000">&amp;UN=</span><span style="color:#800000">"</span><span style="color:#000000">), s.Length </span><span style="color:#000000">-</span><span style="color:#000000"> s.IndexOf(</span><span style="color:#800000">"</span><span style="color:#800000">&amp;UN=</span><span style="color:#800000">"</span><span style="color:#000000">));<br>            sb.Remove(</span><span style="color:#800080">0</span><span style="color:#000000">, s.IndexOf(</span><span style="color:#800000">"</span><span style="color:#800000">&amp;ST=</span><span style="color:#800000">"</span><span style="color:#000000">) </span><span style="color:#000000">+</span><span style="color:#000000"> </span><span style="color:#800080">4</span><span style="color:#000000">);<br>            online_Station </span><span style="color:#000000">=</span><span style="color:#000000"> sb.ToString().Split(</span><span style="color:#800000">'</span><span style="color:#800000">,</span><span style="color:#800000">'</span><span style="color:#000000">);<br><br>            sb </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">new</span><span style="color:#000000"> StringBuilder(s);<br>            sb.Remove(s.IndexOf(</span><span style="color:#800000">"</span><span style="color:#800000">&amp;NK=</span><span style="color:#800000">"</span><span style="color:#000000">), s.Length </span><span style="color:#000000">-</span><span style="color:#000000"> s.IndexOf(</span><span style="color:#800000">"</span><span style="color:#800000">&amp;NK=</span><span style="color:#800000">"</span><span style="color:#000000">));<br>            sb.Remove(</span><span style="color:#800080">0</span><span style="color:#000000">, s.IndexOf(</span><span style="color:#800000">"</span><span style="color:#800000">&amp;UN=</span><span style="color:#800000">"</span><span style="color:#000000">) </span><span style="color:#000000">+</span><span style="color:#000000"> </span><span style="color:#800080">4</span><span style="color:#000000">);<br>            online_Number </span><span style="color:#000000">=</span><span style="color:#000000"> sb.ToString().Split(</span><span style="color:#800000">'</span><span style="color:#800000">,</span><span style="color:#800000">'</span><span style="color:#000000">);<br><br>            </span><span style="color:#0000ff">string</span><span style="color:#000000"> ss </span><span style="color:#000000">=</span><span style="color:#000000"> s.Remove(</span><span style="color:#800080">0</span><span style="color:#000000">, s.IndexOf(</span><span style="color:#800000">"</span><span style="color:#800000">&amp;NK=</span><span style="color:#800000">"</span><span style="color:#000000">) </span><span style="color:#000000">+</span><span style="color:#000000"> </span><span style="color:#800080">4</span><span style="color:#000000">);<br>            online_NameK </span><span style="color:#000000">=</span><span style="color:#000000"> ss.Split(</span><span style="color:#800000">'</span><span style="color:#800000">,</span><span style="color:#800000">'</span><span style="color:#000000">);<br>        }</span></div></pre>
</div>
<p>　　返回协议: VER=1.1&amp;CMD=QUERY_STAT&amp;SEQ=9118265&amp;UIN=634882287&amp;RES=0&amp;FC=12,&amp;FN=1&amp;SN=1</p>
<p>&amp;ST=10,&amp;UN=635478153,&amp;NK=,</p>
<p>　　解释: FC为QQ头像的的ID,如的头像ID为270,那么其头使用的图片为91.bmp,其算法为ID/3+1, ST为QQ用户的状态,</p>
<p>10为上线,20为离线,30为忙碌, UN为在线用户的QQ号,NK为在线用户的QQ昵称.ST,UN,NK,每个逗号隔开的数据相互对应.</p>
<h2>输入一个QQ号,查询这个QQ号用户的信息:</h2>
<p> 　　协议: VER=1.1&amp;CMD=GetInfo&amp;SEQ=&amp;UIN=&amp;LV=2&amp;UN=</p>
<p>　　 解释: UN为要查看用户信息的QQ号.</p>
<div style="width:698px;height:579px">
<pre><div><span style="color:#000000">        </span><span style="color:#808080">///</span><span style="color:#008000"> </span><span style="color:#808080">&lt;summary&gt;</span><span style="color:#008000"><br>        </span><span style="color:#808080">///</span><span style="color:#008000"> 输入一个QQ号,查询这个QQ号用户的信息<br>        </span><span style="color:#808080">///</span><span style="color:#008000"> </span><span style="color:#808080">&lt;/summary&gt;</span><span style="color:#008000"><br>        </span><span style="color:#808080">///</span><span style="color:#008000"> </span><span style="color:#808080">&lt;param name=&quot;search_num&quot;&gt;</span><span style="color:#008000">输入一个QQ号,查询该QQ信息</span><span style="color:#808080">&lt;/param&gt;</span><span style="color:#008000"><br>        </span><span style="color:#808080">///</span><span style="color:#008000"> </span><span style="color:#808080">&lt;returns&gt;</span><span style="color:#008000">字符串数组(联系地址,用户年龄,用户邮箱,头像,个人网站,职业,邮箱,联系电话,简介,省份,真实姓名,毕业院校,性别,QQ号,昵称)</span><span style="color:#808080">&lt;/returns&gt;</span><span style="color:#808080"><br></span><span style="color:#000000">        </span><span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">string</span><span style="color:#000000">[] QQ_GetInfo(</span><span style="color:#0000ff">string</span><span style="color:#000000"> search_num)<br>        {<br>            postValues </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#800000">"</span><span style="color:#800000">VER=1.1&amp;CMD=GetInfo&amp;SEQ=</span><span style="color:#800000">"</span><span style="color:#000000"> </span><span style="color:#000000">+</span><span style="color:#000000"> DateTime.Now.Ticks.ToString().Substring(</span><span style="color:#800080">7</span><span style="color:#000000">, </span><span style="color:#800080">7</span><span style="color:#000000">) </span><span style="color:#000000">+</span><span style="color:#000000"> </span><span style="color:#800000">"</span><span style="color:#800000">&amp;UIN=</span><span style="color:#800000">"</span><span style="color:#000000"> </span><span style="color:#000000">+</span><span style="color:#000000"> num </span><span style="color:#000000">+</span><span style="color:#000000"> </span><span style="color:#800000">"</span><span style="color:#800000">&amp;LV=2&amp;UN=</span><span style="color:#800000">"</span><span style="color:#000000"> </span><span style="color:#000000">+</span><span style="color:#000000"> search_num;<br>            byteArray </span><span style="color:#000000">=</span><span style="color:#000000"> System.Text.Encoding.UTF8.GetBytes(postValues);<br>            </span><span style="color:#008000">//</span><span style="color:#008000">向服务器POST数据</span><span style="color:#008000"><br></span><span style="color:#000000">            UploadData();<br>            s </span><span style="color:#000000">=</span><span style="color:#000000"> Encoding.UTF8.GetString(pageData);<br>            </span><span style="color:#0000ff">if</span><span style="color:#000000"> (</span><span style="color:#000000">!</span><span style="color:#000000">s.Contains(</span><span style="color:#800000">"</span><span style="color:#800000">&amp;RES=0</span><span style="color:#800000">"</span><span style="color:#000000">))<br>                is_RightLogin </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">false</span><span style="color:#000000">;<br>            MatchCollection matches </span><span style="color:#000000">=</span><span style="color:#000000"> Regex.Matches(s, </span><span style="color:#800000">"</span><span style="color:#800000">&amp;([^=][^=])=([^&amp;]*)</span><span style="color:#800000">"</span><span style="color:#000000">);<br>            List</span><span style="color:#000000">&lt;</span><span style="color:#0000ff">string</span><span style="color:#000000">&gt;</span><span style="color:#000000"> Info </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">new</span><span style="color:#000000"> List</span><span style="color:#000000">&lt;</span><span style="color:#0000ff">string</span><span style="color:#000000">&gt;</span><span style="color:#000000">();<br>            </span><span style="color:#0000ff">for</span><span style="color:#000000"> (</span><span style="color:#0000ff">int</span><span style="color:#000000"> i </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#800080">0</span><span style="color:#000000">; i </span><span style="color:#000000">&lt;</span><span style="color:#000000"> matches.Count; i</span><span style="color:#000000">++</span><span style="color:#000000">)<br>                Info.Add(matches[i].Groups[</span><span style="color:#800080">2</span><span style="color:#000000">].ToString());<br>            Info.RemoveAt(</span><span style="color:#800080">6</span><span style="color:#000000">);   </span><span style="color:#008000">//</span><span style="color:#008000">去除LV=多少, 这表示查询方式,默然就是普通查询</span><span style="color:#008000"><br></span><span style="color:#000000">            </span><span style="color:#0000ff">if</span><span style="color:#000000"> (Info[</span><span style="color:#800080">12</span><span style="color:#000000">].ToString() </span><span style="color:#000000">==</span><span style="color:#000000"> </span><span style="color:#800000">"</span><span style="color:#800000">0</span><span style="color:#800000">"</span><span style="color:#000000">)<br>                Info[</span><span style="color:#800080">12</span><span style="color:#000000">] </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#800000">"</span><span style="color:#800000">男</span><span style="color:#800000">"</span><span style="color:#000000">;<br>            </span><span style="color:#0000ff">else</span><span style="color:#000000"><br>                Info[</span><span style="color:#800080">12</span><span style="color:#000000">] </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#800000">"</span><span style="color:#800000">女</span><span style="color:#800000">"</span><span style="color:#000000">;<br>            </span><span style="color:#0000ff">string</span><span style="color:#000000">[] Inf </span><span style="color:#000000">=</span><span style="color:#000000"> Info.ToArray();<br>            </span><span style="color:#0000ff">return</span><span style="color:#000000"> Inf;<br>        }</span></div></pre>
</div>
<p>　　返回协议: VER=1.1&amp;CMD=GETINFO&amp;SEQ=41707&amp;UIN=&amp;RES=0&amp;AD=&amp;AG=&amp;EM=&amp;FC=&amp;HP=&amp;JB=&amp;LV=&amp;PC=&amp;PH=&amp;</p>
<p>PR=PV=&amp;RN=&amp;SC=&amp;SX=&amp;UN=&amp;NK=</p>
<p>　　解释: AD用户的联系地址, AG为用户年龄, EM为用户MAIL, FC为用户头像, HP为用户网站, JB为用户职业, PC为用户邮编, PH为用户</p>
<p>联系电话, PR为用户简介, PV为用户所以的省, RN为用户真实名称, SC为用户毕业院校, SX为用户性别, UN为用户QQ号, NK为用户QQ昵称</p>
<h2>添加好友功能:</h2>
<p> 　　协议: VER=1.1&amp;CMD=AddToList&amp;SEQ=&amp;UIN=&amp;UN=</p>
<p>　　 解释: UN为我们要增加用户的QQ号</p>
<div style="width:695px;height:399px">
<pre><div><span style="color:#000000">        </span><span style="color:#808080">///</span><span style="color:#008000"> </span><span style="color:#808080">&lt;summary&gt;</span><span style="color:#008000"><br>        </span><span style="color:#808080">///</span><span style="color:#008000"> 添加好友功能<br>        </span><span style="color:#808080">///</span><span style="color:#008000"> </span><span style="color:#808080">&lt;/summary&gt;</span><span style="color:#008000"><br>        </span><span style="color:#808080">///</span><span style="color:#008000"> </span><span style="color:#808080">&lt;param name=&quot;fir_num&quot;&gt;</span><span style="color:#008000">输入一个QQ号,请求加为好友</span><span style="color:#808080">&lt;/param&gt;</span><span style="color:#008000"><br>        </span><span style="color:#808080">///</span><span style="color:#008000"> </span><span style="color:#808080">&lt;returns&gt;</span><span style="color:#008000">0表示已经加为好友,1表示需要验证请求,2表示拒绝</span><span style="color:#808080">&lt;/returns&gt;</span><span style="color:#808080"><br></span><span style="color:#000000">        </span><span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">string</span><span style="color:#000000"> AddToList(</span><span style="color:#0000ff">string</span><span style="color:#000000"> fir_num)<br>        {<br>            postValues </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#800000">"</span><span style="color:#800000">VER=1.1&amp;CMD=AddToList&amp;SEQ=</span><span style="color:#800000">"</span><span style="color:#000000"> </span><span style="color:#000000">+</span><span style="color:#000000"> DateTime.Now.Ticks.ToString().Substring(</span><span style="color:#800080">7</span><span style="color:#000000">, </span><span style="color:#800080">7</span><span style="color:#000000">) </span><span style="color:#000000">+</span><span style="color:#000000"> </span><span style="color:#800000">"</span><span style="color:#800000">&amp;UIN=</span><span style="color:#800000">"</span><span style="color:#000000"> </span><span style="color:#000000">+</span><span style="color:#000000"> num </span><span style="color:#000000">+</span><span style="color:#000000"> </span><span style="color:#800000">"</span><span style="color:#800000">&amp;UN=</span><span style="color:#800000">"</span><span style="color:#000000"> </span><span style="color:#000000">+</span><span style="color:#000000"> fir_num;<br>            byteArray </span><span style="color:#000000">=</span><span style="color:#000000"> System.Text.Encoding.UTF8.GetBytes(postValues);<br>            </span><span style="color:#008000">//</span><span style="color:#008000">向服务器POST数据</span><span style="color:#008000"><br></span><span style="color:#000000">               UploadData();<br>            s </span><span style="color:#000000">=</span><span style="color:#000000"> Encoding.UTF8.GetString(pageData);<br>            </span><span style="color:#0000ff">if</span><span style="color:#000000"> (</span><span style="color:#000000">!</span><span style="color:#000000">s.Contains(</span><span style="color:#800000">"</span><span style="color:#800000">&amp;RES=0</span><span style="color:#800000">"</span><span style="color:#000000">))<br>                is_RightLogin </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">false</span><span style="color:#000000">;<br>            MatchCollection matchs </span><span style="color:#000000">=</span><span style="color:#000000"> Regex.Matches(s,</span><span style="color:#800000">"</span><span style="color:#800000">&amp;CD=(.)</span><span style="color:#800000">"</span><span style="color:#000000">);<br>            </span><span style="color:#0000ff">return</span><span style="color:#000000"> matchs[</span><span style="color:#800080">0</span><span style="color:#000000">].Groups[</span><span style="color:#800080">1</span><span style="color:#000000">].ToString();<br>        }</span></div></pre>
</div>
<p>　　返回协议: VER=1.1&amp;CMD=AddToList&amp;SEQ=&amp;UIN=&amp;RES=0&amp;CD=0&amp;UN=</p>
<p>　　解释: CD为被加QQ的身份验证状态,CD为0表示"允许任何人把我列为好友"<br>　　　　  CD为1表示&quot;需要身份证认才能把我列为好友&quot;,CD为2表示&quot;不允许任何人把我列为好友&quot;<br>             如果CD为0那么信息回馈后,用户就直接加为好友了,如果CD为1,那么还要发送一次回应加为好友的响应</p>
<h2>回应添加好友的请求:</h2>
<p> 　  协议: VER=1.1&amp;CMD=Ack_AddToList&amp;SEQ=&amp;UIN=&amp;UN=&amp;CD=&amp;RS=</p>
<p>　　解释: CD为响应状态, CD为0表示"通过验证", CD为1表示"拒决加为对方为好友"</p>
<div style="width:667px;height:379px">
<pre><div><span style="color:#000000">        </span><span style="color:#808080">///</span><span style="color:#008000"> </span><span style="color:#808080">&lt;summary&gt;</span><span style="color:#008000"><br>        </span><span style="color:#808080">///</span><span style="color:#008000"> 回应加为好友的响应<br>        </span><span style="color:#808080">///</span><span style="color:#008000"> </span><span style="color:#808080">&lt;/summary&gt;</span><span style="color:#008000"><br>        </span><span style="color:#808080">///</span><span style="color:#008000"> </span><span style="color:#808080">&lt;param name=&quot;fri_Num&quot;&gt;</span><span style="color:#008000">请求的QQ号码</span><span style="color:#808080">&lt;/param&gt;</span><span style="color:#008000"><br>        </span><span style="color:#808080">///</span><span style="color:#008000"> </span><span style="color:#808080">&lt;param name=&quot;agree_Type&quot;&gt;</span><span style="color:#008000">0表示通过验证,1表示拒绝对方,2表示请求加对方为好友</span><span style="color:#808080">&lt;/param&gt;</span><span style="color:#808080"><br></span><span style="color:#000000">        </span><span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">void</span><span style="color:#000000"> Ack_AddToList(</span><span style="color:#0000ff">string</span><span style="color:#000000"> fri_Num,</span><span style="color:#0000ff">string</span><span style="color:#000000"> agree_Type)<br>        {<br>            </span><span style="color:#008000">//</span><span style="color:#008000">WebClient _client = new WebClient();</span><span style="color:#008000"><br></span><span style="color:#000000">            postValues </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#800000">"</span><span style="color:#800000">VER=1.1&amp;CMD=Ack_AddToList&amp;SEQ=</span><span style="color:#800000">"</span><span style="color:#000000"> </span><span style="color:#000000">+</span><span style="color:#000000"> DateTime.Now.Ticks.ToString().Substring(</span><span style="color:#800080">7</span><span style="color:#000000">, </span><span style="color:#800080">7</span><span style="color:#000000">) </span><span style="color:#000000">+</span><span style="color:#000000"> </span><span style="color:#800000">"</span><span style="color:#800000">&amp;UIN=</span><span style="color:#800000">"</span><span style="color:#000000"> </span><span style="color:#000000">+</span><span style="color:#000000"> num </span><span style="color:#000000">+</span><span style="color:#000000"> </span><span style="color:#800000">"</span><span style="color:#800000">&amp;UN=</span><span style="color:#800000">"</span><span style="color:#000000"> </span><span style="color:#000000">+</span><span style="color:#000000"> fri_Num </span><span style="color:#000000">+</span><span style="color:#000000"> </span><span style="color:#800000">"</span><span style="color:#800000">&amp;CD=</span><span style="color:#800000">"</span><span style="color:#000000">+</span><span style="color:#000000">agree_Type</span><span style="color:#000000">+</span><span style="color:#800000">"</span><span style="color:#800000">&amp;RS=</span><span style="color:#800000">"</span><span style="color:#000000">;<br>            byteArray </span><span style="color:#000000">=</span><span style="color:#000000"> System.Text.Encoding.UTF8.GetBytes(postValues);<br>            </span><span style="color:#008000">//</span><span style="color:#008000">向服务器POST数据</span><span style="color:#008000"><br></span><span style="color:#000000">            UploadData();<br>            s</span><span style="color:#000000">=</span><span style="color:#000000">Encoding.UTF8.GetString(pageData);<br>            </span><span style="color:#0000ff">if</span><span style="color:#000000"> (</span><span style="color:#000000">!</span><span style="color:#000000">s.Contains(</span><span style="color:#800000">"</span><span style="color:#800000">&amp;RES=0</span><span style="color:#800000">"</span><span style="color:#000000">))<br>                is_RightLogin </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">false</span><span style="color:#000000">;<br>        }</span></div></pre>
</div>
<p>　　成功操作后返回协议: VER=1.1&amp;CMD=Ack_AddToList&amp;SEQ=&amp;UIN=&amp;RES=0&amp;</p>
<h2>删除好友:</h2>
<p>　　协议: VER=1.1&amp;CMD=DelFromList&amp;SEQ=&amp;UIN=&amp;UN=</p>
<p>　　解释: UN为你要删除的QQ号</p>
<div style="width:665px;height:399px">
<pre><div><span style="color:#000000">        </span><span style="color:#808080">///</span><span style="color:#008000"> </span><span style="color:#808080">&lt;summary&gt;</span><span style="color:#008000"><br>        </span><span style="color:#808080">///</span><span style="color:#008000"> 删除好友,成功返回True<br>        </span><span style="color:#808080">///</span><span style="color:#008000"> </span><span style="color:#808080">&lt;/summary&gt;</span><span style="color:#008000"><br>        </span><span style="color:#808080">///</span><span style="color:#008000"> </span><span style="color:#808080">&lt;param name=&quot;del_num&quot;&gt;</span><span style="color:#008000">输入一个QQ号,删除这个QQ好友</span><span style="color:#808080">&lt;/param&gt;</span><span style="color:#008000"><br>        </span><span style="color:#808080">///</span><span style="color:#008000"> </span><span style="color:#808080">&lt;returns&gt;&lt;/returns&gt;</span><span style="color:#808080"><br></span><span style="color:#000000">        </span><span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">bool</span><span style="color:#000000"> DelFromList(</span><span style="color:#0000ff">string</span><span style="color:#000000"> del_num)<br>        {<br>            postValues </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#800000">"</span><span style="color:#800000">VER=1.1&amp;CMD=DelFromList&amp;SEQ=</span><span style="color:#800000">"</span><span style="color:#000000"> </span><span style="color:#000000">+</span><span style="color:#000000"> DateTime.Now.Ticks.ToString().Substring(</span><span style="color:#800080">7</span><span style="color:#000000">, </span><span style="color:#800080">7</span><span style="color:#000000">) </span><span style="color:#000000">+</span><span style="color:#000000"> </span><span style="color:#800000">"</span><span style="color:#800000">&amp;UIN=</span><span style="color:#800000">"</span><span style="color:#000000"> </span><span style="color:#000000">+</span><span style="color:#000000"> num </span><span style="color:#000000">+</span><span style="color:#000000"> </span><span style="color:#800000">"</span><span style="color:#800000">&amp;UN=</span><span style="color:#800000">"</span><span style="color:#000000"> </span><span style="color:#000000">+</span><span style="color:#000000"> del_num;<br>            byteArray </span><span style="color:#000000">=</span><span style="color:#000000"> System.Text.Encoding.UTF8.GetBytes(postValues);<br>            </span><span style="color:#008000">//</span><span style="color:#008000">向服务器POST数据</span><span style="color:#008000"><br></span><span style="color:#000000">            UploadData();<br>            s </span><span style="color:#000000">=</span><span style="color:#000000"> Encoding.UTF8.GetString(pageData);<br>            </span><span style="color:#0000ff">if</span><span style="color:#000000"> (s.Contains(</span><span style="color:#800000">"</span><span style="color:#800000">&amp;RES=0</span><span style="color:#800000">"</span><span style="color:#000000">))<br>                </span><span style="color:#0000ff">return</span><span style="color:#000000"> </span><span style="color:#0000ff">true</span><span style="color:#000000">;<br>            </span><span style="color:#0000ff">else</span><span style="color:#000000"><br>                </span><span style="color:#0000ff">return</span><span style="color:#000000"> </span><span style="color:#0000ff">false</span><span style="color:#000000">;<br>        }</span></div></pre>
</div>
<p>　　操作成功返回协议: VER=1.1&amp;CMD=DelFromList&amp;SEQ=&amp;UIN=&amp;RES=0&amp;</p>
<h2>改变QQ当前状态(在线,离线,忙碌):</h2>
<p>　　协议: VER=1.1&amp;CMD=Change_Stat&amp;SEQ=&amp;UIN=&amp;ST=</p>
<p>　　解释: ST为要改变的状态,10为上线,20为离线,30为忙碌.</p>
<div style="width:675px;height:299px">
<pre><div><span style="color:#000000">        </span><span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">bool</span><span style="color:#000000"> Change_Stat(</span><span style="color:#0000ff">string</span><span style="color:#000000"> stat)<br>        {<br>            postValues </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#800000">"</span><span style="color:#800000">VER=1.1&amp;CMD=Change_Stat&amp;SEQ=</span><span style="color:#800000">"</span><span style="color:#000000"> </span><span style="color:#000000">+</span><span style="color:#000000"> DateTime.Now.Ticks.ToString().Substring(</span><span style="color:#800080">7</span><span style="color:#000000">, </span><span style="color:#800080">7</span><span style="color:#000000">) </span><span style="color:#000000">+</span><span style="color:#000000"> </span><span style="color:#800000">"</span><span style="color:#800000">&amp;UIN=</span><span style="color:#800000">"</span><span style="color:#000000"> </span><span style="color:#000000">+</span><span style="color:#000000"> num </span><span style="color:#000000">+</span><span style="color:#000000"> </span><span style="color:#800000">"</span><span style="color:#800000">&amp;ST=</span><span style="color:#800000">"</span><span style="color:#000000"> </span><span style="color:#000000">+</span><span style="color:#000000"> stat;<br>            byteArray </span><span style="color:#000000">=</span><span style="color:#000000"> System.Text.Encoding.UTF8.GetBytes(postValues);<br>            </span><span style="color:#008000">//</span><span style="color:#008000">向服务器POST数据</span><span style="color:#008000"><br></span><span style="color:#000000">            UploadData();<br>            s </span><span style="color:#000000">=</span><span style="color:#000000"> Encoding.UTF8.GetString(pageData);<br>            </span><span style="color:#0000ff">if</span><span style="color:#000000">(s.Contains(</span><span style="color:#800000">"</span><span style="color:#800000">&amp;RES=0</span><span style="color:#800000">"</span><span style="color:#000000">))<br>                </span><span style="color:#0000ff">return</span><span style="color:#000000"> </span><span style="color:#0000ff">true</span><span style="color:#000000">;<br>            </span><span style="color:#0000ff">else</span><span style="color:#000000"><br>                </span><span style="color:#0000ff">return</span><span style="color:#000000"> </span><span style="color:#0000ff">false</span><span style="color:#000000">;<br>        }</span></div></pre>
</div>
<p> </p>
<p>　　成功操作后返回协议: VER=1.1&amp;CMD=Change_Stat&amp;SEQ=&amp;UIN=&amp;RES=0&amp;</p>
<h2>给QQ好友发送消息:</h2>
<p> 　　协议: VER=1.1&amp;CMD=CLTMSG&amp;SEQ=&amp;UIN=&amp;UN=&amp;MG=</p>
<p>　　 解释: UN是你的QQ好友, MG就是消息内容</p>
<div style="width:675px;height:519px">
<pre><div><span style="color:#000000">        </span><span style="color:#808080">///</span><span style="color:#008000"> </span><span style="color:#808080">&lt;summary&gt;</span><span style="color:#008000"><br>        </span><span style="color:#808080">///</span><span style="color:#008000"> 向一个QQ号码发送消息<br>        </span><span style="color:#808080">///</span><span style="color:#008000"> </span><span style="color:#808080">&lt;/summary&gt;</span><span style="color:#008000"><br>        </span><span style="color:#808080">///</span><span style="color:#008000"> </span><span style="color:#808080">&lt;param name=&quot;msgTo&quot;&gt;</span><span style="color:#008000">输入一个QQ号,向他发送消息</span><span style="color:#808080">&lt;/param&gt;</span><span style="color:#008000"><br>        </span><span style="color:#808080">///</span><span style="color:#008000"> </span><span style="color:#808080">&lt;param name=&quot;msg&quot;&gt;</span><span style="color:#008000">输入消息内容</span><span style="color:#808080">&lt;/param&gt;</span><span style="color:#008000"><br>        </span><span style="color:#808080">///</span><span style="color:#008000"> </span><span style="color:#808080">&lt;returns&gt;</span><span style="color:#008000">成功返回True</span><span style="color:#808080">&lt;/returns&gt;</span><span style="color:#808080"><br></span><span style="color:#000000">        </span><span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">bool</span><span style="color:#000000"> QQ_SendMsg(</span><span style="color:#0000ff">string</span><span style="color:#000000"> msgTo, </span><span style="color:#0000ff">string</span><span style="color:#000000"> msg)<br>        {<br>            postValues </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#800000">"</span><span style="color:#800000">VER=1.2&amp;CMD=CLTMSG&amp;SEQ=</span><span style="color:#800000">"</span><span style="color:#000000"> </span><span style="color:#000000">+</span><span style="color:#000000"> DateTime.Now.Ticks.ToString().Substring(</span><span style="color:#800080">7</span><span style="color:#000000">, </span><span style="color:#800080">7</span><span style="color:#000000">) </span><span style="color:#000000">+</span><span style="color:#000000"> </span><span style="color:#800000">"</span><span style="color:#800000">&amp;UIN=</span><span style="color:#800000">"</span><span style="color:#000000"> </span><span style="color:#000000">+</span><span style="color:#000000"> num </span><span style="color:#000000">+</span><span style="color:#000000"> </span><span style="color:#800000">"</span><span style="color:#800000">&amp;UN=</span><span style="color:#800000">"</span><span style="color:#000000"> </span><span style="color:#000000">+</span><span style="color:#000000"> msgTo </span><span style="color:#000000">+</span><span style="color:#000000"> </span><span style="color:#800000">"</span><span style="color:#800000">&amp;MG=</span><span style="color:#800000">"</span><span style="color:#000000"> </span><span style="color:#000000">+</span><span style="color:#000000"> msg;<br>            byteArray </span><span style="color:#000000">=</span><span style="color:#000000"> System.Text.Encoding.UTF8.GetBytes(postValues);<br>            </span><span style="color:#008000">//</span><span style="color:#008000">向服务器POST数据</span><span style="color:#008000"><br></span><span style="color:#000000">            UploadData();<br>            s </span><span style="color:#000000">=</span><span style="color:#000000"> Encoding.UTF8.GetString(pageData);<br>            </span><span style="color:#0000ff">if</span><span style="color:#000000"> (s.Contains(</span><span style="color:#800000">"</span><span style="color:#800000">&amp;RES=20</span><span style="color:#800000">"</span><span style="color:#000000">))<br>            {<br>                is_RightLogin </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">false</span><span style="color:#000000">;<br>                </span><span style="color:#0000ff">return</span><span style="color:#000000"> </span><span style="color:#0000ff">false</span><span style="color:#000000">;<br>            }<br>            </span><span style="color:#0000ff">if</span><span style="color:#000000"> (s.Contains(</span><span style="color:#800000">"</span><span style="color:#800000">&amp;RES=0</span><span style="color:#800000">"</span><span style="color:#000000">))<br>                </span><span style="color:#0000ff">return</span><span style="color:#000000"> </span><span style="color:#0000ff">true</span><span style="color:#000000">;<br>            </span><span style="color:#0000ff">else</span><span style="color:#000000"><br>                </span><span style="color:#0000ff">return</span><span style="color:#000000"> </span><span style="color:#0000ff">false</span><span style="color:#000000">;<br>        }</span></div></pre>
</div>
<p> </p>
<p>　　返回协议: VER=1.1&amp;CMD=CLTMSG&amp;SEQ=标记&amp;UIN=QQ号&amp;RES=0&amp;(成功发送,对方不一定能收到哦)<br>           　　   VER=1.1&amp;CMD=CLTMSG&amp;SEQ=标记&amp;UIN=QQ号&amp;RES=3(发送过快)<br>　　　　　　　VER=1.1&amp;CMD=CLTMSG&amp;SEQ=标记&amp;UIN=QQ号&amp;RES=20(没有正确登陆)<br>　　解释: 1. 当你发消息时,以下情形对方可能看不到(其实是收到了,QQ不提示)你发送的消息:<br>　　　　　　　　你俩互为陌生人,且对方没有和你说过话<br>　　　　　　　　你在他的陌生人列表里,并且他没有和你说过话(没有验证)</p>
<p>　　　　　2. 当你过快发送消息时,系统会给你一个惩罚,RES=3,相应时间20s</p>
<h2>接收QQ消息:</h2>
<p>　　协议: VER=1.1&amp;CMD=GetMsgEx&amp;SEQ=&amp;UIN=</p>
<p>　　解释: 这个不需要解释了, 看懂前面的协议, 这个肯定能看懂的, 呵呵</p>
<div style="width:681px;height:779px">
<pre><div><span style="color:#000000">        </span><span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">void</span><span style="color:#000000"> GetMsgEx()<br>        {<br>            postValues </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#800000">"</span><span style="color:#800000">VER=1.1&amp;CMD=GetMsgEx&amp;SEQ=</span><span style="color:#800000">"</span><span style="color:#000000"> </span><span style="color:#000000">+</span><span style="color:#000000"> DateTime.Now.Ticks.ToString().Substring(</span><span style="color:#800080">7</span><span style="color:#000000">, </span><span style="color:#800080">7</span><span style="color:#000000">) </span><span style="color:#000000">+</span><span style="color:#000000"> </span><span style="color:#800000">"</span><span style="color:#800000">&amp;UIN=</span><span style="color:#800000">"</span><span style="color:#000000"> </span><span style="color:#000000">+</span><span style="color:#000000"> num;<br>            byteArray </span><span style="color:#000000">=</span><span style="color:#000000"> System.Text.Encoding.UTF8.GetBytes(postValues);<br>            </span><span style="color:#008000">//</span><span style="color:#008000">向服务器POST数据</span><span style="color:#008000"><br></span><span style="color:#000000">            UploadData();<br>            s </span><span style="color:#000000">=</span><span style="color:#000000"> Encoding.UTF8.GetString(pageData);<br>            </span><span style="color:#0000ff">if</span><span style="color:#000000"> (s.Contains(</span><span style="color:#800000">"</span><span style="color:#800000">\r</span><span style="color:#800000">"</span><span style="color:#000000">))<br>               s </span><span style="color:#000000">=</span><span style="color:#000000">  s.Replace(</span><span style="color:#800000">"</span><span style="color:#800000">\r</span><span style="color:#800000">"</span><span style="color:#000000">, </span><span style="color:#800000">"</span><span style="color:#800000">\n</span><span style="color:#800000">"</span><span style="color:#000000">);<br>            </span><span style="color:#0000ff">if</span><span style="color:#000000"> (s.Contains(</span><span style="color:#800000">"</span><span style="color:#800000">&amp;RES=0</span><span style="color:#800000">"</span><span style="color:#000000">))<br>            {<br>                is_RightLogin </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">true</span><span style="color:#000000">;<br>                MatchCollection matches </span><span style="color:#000000">=</span><span style="color:#000000"> Regex.Matches(s, </span><span style="color:#800000">"</span><span style="color:#800000">&amp;MN=([^&amp;]*)</span><span style="color:#800000">"</span><span style="color:#000000">);<br>                </span><span style="color:#0000ff">if</span><span style="color:#000000"> (matches[</span><span style="color:#800080">0</span><span style="color:#000000">].Groups[</span><span style="color:#800080">1</span><span style="color:#000000">].ToString() </span><span style="color:#000000">!=</span><span style="color:#000000"> </span><span style="color:#800000">"</span><span style="color:#800000">0</span><span style="color:#800000">"</span><span style="color:#000000">) </span><span style="color:#008000">//</span><span style="color:#008000">判断返回的信息数量是否为0条</span><span style="color:#008000"><br></span><span style="color:#000000">                {<br>                    matches </span><span style="color:#000000">=</span><span style="color:#000000"> Regex.Matches(s, </span><span style="color:#800000">"</span><span style="color:#800000">&amp;MT=([^&amp;]*)&amp;UN=([^&amp;]*)&amp;MG=([^&amp;]*)</span><span style="color:#800000">"</span><span style="color:#000000">);<br>                    MT </span><span style="color:#000000">=</span><span style="color:#000000"> matches[</span><span style="color:#800080">0</span><span style="color:#000000">].Groups[</span><span style="color:#800080">1</span><span style="color:#000000">].ToString().Split(</span><span style="color:#800000">'</span><span style="color:#800000">,</span><span style="color:#800000">'</span><span style="color:#000000">);   </span><span style="color:#008000">//</span><span style="color:#008000">信息类型</span><span style="color:#008000"><br></span><span style="color:#000000">                    UN </span><span style="color:#000000">=</span><span style="color:#000000"> matches[</span><span style="color:#800080">0</span><span style="color:#000000">].Groups[</span><span style="color:#800080">2</span><span style="color:#000000">].ToString().Split(</span><span style="color:#800000">'</span><span style="color:#800000">,</span><span style="color:#800000">'</span><span style="color:#000000">);   </span><span style="color:#008000">//</span><span style="color:#008000">信息来源号码</span><span style="color:#008000"><br></span><span style="color:#000000">                    s </span><span style="color:#000000">=</span><span style="color:#000000"> s.Remove(</span><span style="color:#800080">0</span><span style="color:#000000">, s.IndexOf(</span><span style="color:#800000">"</span><span style="color:#800000">&amp;MG=</span><span style="color:#800000">"</span><span style="color:#000000">) </span><span style="color:#000000">+</span><span style="color:#000000"> </span><span style="color:#800080">4</span><span style="color:#000000">);<br>                    MG </span><span style="color:#000000">=</span><span style="color:#000000"> s.Split(</span><span style="color:#800000">'</span><span style="color:#800000">,</span><span style="color:#800000">'</span><span style="color:#000000">);   </span><span style="color:#008000">//</span><span style="color:#008000">信息内容<br>                    </span><span style="color:#008000">//</span><span style="color:#008000">将消息内容进行转码</span><span style="color:#008000"><br></span><span style="color:#000000">                    </span><span style="color:#0000ff">for</span><span style="color:#000000">(</span><span style="color:#0000ff">int</span><span style="color:#000000"> i </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#800080">0</span><span style="color:#000000">; i</span><span style="color:#000000">&lt;</span><span style="color:#000000">MG.Length</span><span style="color:#000000">-</span><span style="color:#800080">1</span><span style="color:#000000">;i</span><span style="color:#000000">++</span><span style="color:#000000">)<br>                    {<br>                        MG[i] </span><span style="color:#000000">=</span><span style="color:#000000"> MG[i].Replace(</span><span style="color:#800000">"</span><span style="color:#800000">%25</span><span style="color:#800000">"</span><span style="color:#000000">, </span><span style="color:#800000">"</span><span style="color:#800000">%</span><span style="color:#800000">"</span><span style="color:#000000">);<br>                        MG[i] </span><span style="color:#000000">=</span><span style="color:#000000"> MG[i].Replace(</span><span style="color:#800000">"</span><span style="color:#800000">%26</span><span style="color:#800000">"</span><span style="color:#000000">, </span><span style="color:#800000">"</span><span style="color:#800000">&amp;</span><span style="color:#800000">"</span><span style="color:#000000">);<br>                        MG[i] </span><span style="color:#000000">=</span><span style="color:#000000"> MG[i].Replace(</span><span style="color:#800000">"</span><span style="color:#800000">%2c</span><span style="color:#800000">"</span><span style="color:#000000">, </span><span style="color:#800000">"</span><span style="color:#800000">,</span><span style="color:#800000">"</span><span style="color:#000000">);<br>                    }<br>                }<br>                </span><span style="color:#0000ff">else</span><span style="color:#000000"><br>                {<br>                    MT </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">null</span><span style="color:#000000">;<br>                    UN </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">null</span><span style="color:#000000">;<br>                    MG </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">null</span><span style="color:#000000">;<br>                    is_RightLogin </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">false</span><span style="color:#000000">;<br>                }<br>            }</span></div></pre>
</div>
<p>　　返回协议: VER=1.1&amp;CMD=GETMSGEX&amp;SEQ=&amp;UIN=&amp;RES=0&amp;MN=&amp;MT=,&amp;UN=,&amp;MG=,(正确返回的)</p>
<p>　　　　　　　VER=1.1&amp;CMD=GETMSGEX&amp;SEQ=标记&amp;UIN=QQ号&amp;RES=0&amp;MN=0&amp;MT=&amp;UN=&amp;MG=(表示没有信息)</p>
<p>　　　　　　　VER=1.1&amp;CMD=GETMSGEX&amp;SEQ=标记&amp;UIN=QQ号&amp;RES=20(没有正确登陆)</p>
<p>　　解释: 关于MT:<br>　　　　　　　　9为用户消息,99为系统消息,2为请求信息,3为通过验证,4为拒绝被加好友</p>
<p>　　　　　　当MT=2时,MG为对方请求你验证的信息<br>　　　　　　当MT=3时,表示对方通过你的验证<br>　　　　　　当MT=4时,MG为对方拒绝你理由<br>　　　　　关于MG:<br>　　　　　　　　当MT=9时,MG为用户发送的消息内容<br>　　　　　　　　当MT=99时,<br>　　　　　　　　MG=10(QQ_STATUS_ONLINE)表示对方上线<br>　　　　　　　　MG=20(QQ_STATUS_OFFLINE)表示对方下线<br>　　　　　　　　MG=30(QQ_STATUS_BUSY)表示对方进入忙碌状态</p>
<h2>退出QQ:</h2>
<p>　　协议: VER=1.1&amp;CMD=Logout&amp;SEQ=&amp;UIN=</p>
<p>　　解释: 这个也不解释, 非常简单</p>
<div style="width:660px;height:319px">
<pre><div><span style="color:#000000">        </span><span style="color:#808080">///</span><span style="color:#008000"> </span><span style="color:#808080">&lt;summary&gt;</span><span style="color:#008000"><br>        </span><span style="color:#808080">///</span><span style="color:#008000"> QQ退出登陆,并改变is_RightLogin为False<br>        </span><span style="color:#808080">///</span><span style="color:#008000"> </span><span style="color:#808080">&lt;/summary&gt;</span><span style="color:#808080"><br></span><span style="color:#000000">        </span><span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">void</span><span style="color:#000000"> QQ_Logout()<br>        {<br>            postValues </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#800000">"</span><span style="color:#800000">VER=1.1&amp;CMD=Logout&amp;SEQ=</span><span style="color:#800000">"</span><span style="color:#000000"> </span><span style="color:#000000">+</span><span style="color:#000000"> DateTime.Now.Ticks.ToString().Substring(</span><span style="color:#800080">7</span><span style="color:#000000">, </span><span style="color:#800080">7</span><span style="color:#000000">) </span><span style="color:#000000">+</span><span style="color:#000000"> </span><span style="color:#800000">"</span><span style="color:#800000">&amp;UIN=</span><span style="color:#800000">"</span><span style="color:#000000"> </span><span style="color:#000000">+</span><span style="color:#000000"> num;<br>            byteArray </span><span style="color:#000000">=</span><span style="color:#000000"> System.Text.Encoding.UTF8.GetBytes(postValues);<br>            </span><span style="color:#008000">//</span><span style="color:#008000">向服务器POST数据</span><span style="color:#008000"><br></span><span style="color:#000000">            UploadData();<br>            s </span><span style="color:#000000">=</span><span style="color:#000000"> Encoding.UTF8.GetString(pageData);<br>            </span><span style="color:#0000ff">if</span><span style="color:#000000"> (s.Contains(</span><span style="color:#800000">"</span><span style="color:#800000">&amp;RES=0</span><span style="color:#800000">"</span><span style="color:#000000">))<br>                is_RightLogin </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">false</span><span style="color:#000000">;<br>        }</span></div></pre>
</div>
<p>　　成功返回协议: VER=1.1&amp;CMD=LOGOUT&amp;SEQ=&amp;UIN=&amp;RES=0　</p>
<h2>结尾</h2>
<p> 　　这些功能研究了两三天, 代码写的不好的地方请各位大牛们指点指点. 本篇最主要的目的还是抛砖引玉, 希望关于QQ其</p>
<p>它一些有意思的功能, 自己可以实现的, 欢迎各位高手前辈补充补充:)</p>
<p>　　点击下载 : <a href="http://cid-07452800dc0167da.office.live.com/browse.aspx/.Public/Contact?uc=1">点击</a></p>
<p>　　下载地址: <a href="http://cid-07452800dc0167da.office.live.com/browse.aspx/.Public/Contact?uc=1">http://cid-07452800dc0167da.office.live.com/browse.aspx/.Public/Contact?uc=1</a></p>
<p>　　 转载请注明: <a href="http://www.cnblogs.com/technology/">http://www.cnblogs.com/technology/</a> Create Chen</p><img src="http://www.cnblogs.com/technology/aggbug/1913821.html?type=1" width="1" height="1" alt=""><p>作者: <a href="http://www.cnblogs.com/technology/">Create Chen</a> 发表于 2010-12-22 14:08 <a href="http://www.cnblogs.com/technology/archive/2010/12/22/1913821.html">原文链接</a></p><p>评论: 58　<a href="http://www.cnblogs.com/technology/archive/2010/12/22/1913821.html#pagedcomment">查看评论</a>　<a href="http://www.cnblogs.com/technology/archive/2010/12/22/1913821.html#commentform">发表评论</a></p><hr><p>最新新闻：<br>· <a href="http://news.cnblogs.com/n/85504/">摩托罗拉移动确认收购云存储创业公司Zecter</a><span style="color:gray">(2010-12-22 23:03)</span><br>· <a href="http://news.cnblogs.com/n/85503/">微博称Facebook中国区招聘即将展开</a><span style="color:gray">(2010-12-22 22:57)</span><br>· <a href="http://news.cnblogs.com/n/85502/">外媒列10大理由建议消费者不购买iPad</a><span style="color:gray">(2010-12-22 22:42)</span><br>· <a href="http://news.cnblogs.com/n/85501/">阿尔卡特朗讯子公司起诉苹果佳能LG等侵权</a><span style="color:gray">(2010-12-22 22:28)</span><br>· <a href="http://news.cnblogs.com/n/85500/">2010年Google十大错误 “街景”丑闻居首</a><span style="color:gray">(2010-12-22 22:17)</span><br></p><p>编辑推荐：<a href="http://zt.cnblogs.com/blogswarriors/">“博客无双“活动：写博客、攒园豆、赢大奖</a><br></p><p>网站导航：<a href="http://www.cnblogs.com">博客园首页</a>  <a href="http://home.cnblogs.com/">我的园子</a>  <a href="http://news.cnblogs.com">新闻</a>  <a href="http://home.cnblogs.com/ing/">闪存</a>  <a href="http://home.cnblogs.com/group/">小组</a>  <a href="http://space.cnblogs.com/q/">博问</a>  <a href="http://kb.cnblogs.com">知识库</a></p></p>


</div>


            <div class="footer">
              <div class="contact">
                <p>
                  Your Name<br />
                  What You Are<br />
                  your@email.com
                </p>
              </div>
              <div class="contact">
                <p>
                  <a href="http://github.com/lyuehh/">github.com/lyuehh</a><br />
                  <a href="http://twitter.com/lyuehh/">twitter.com/lyuehh</a><br />
                </p>
              </div>
            </div>
          </div>
        </div> <!-- /container -->

    </body>
</html>
