<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>MongoDB的应用</title>
        <meta name="viewport" content="width=device-width">

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/google_reader/css/syntax.css">

        <!-- Custom CSS -->
        <link rel="stylesheet" href="/google_reader/css/main.css">

    </head>
    <body>

        <div class="container">
          <div class="site">
            <div class="header">
              <h1 class="title"><a href="/google_reader/">Google Reader</a></h1>
              <a class="extra" href="/google_reader/">home</a>
            </div>

                <h2>MongoDB的应用</h2>
<p class="meta">2010-06-29 07:00</p>

<div class="post">
<h2>MongoDB的应用</h2>

<h3>by xvhfeng</h3>

<h3>at 2010-06-28 23:00:00</h3>

<h3>original <a href="http://www.cnblogs.com/Seapeak/archive/2010/06/28/1767091.html">http://www.cnblogs.com/Seapeak/archive/2010/06/28/1767091.html</a></h3>

<p><a href="http://www.cnblogs.com/Seapeak/"><img src="http://pic.cnblogs.com/face/u28300.jpg" alt="" border="0"></a><br>作者: <a href="http://www.cnblogs.com/Seapeak/">xvhfeng</a> 发表于 2010-06-28 23:00 <a href="http://www.cnblogs.com/Seapeak/archive/2010/06/28/1767091.html">原文链接</a> 阅读: 1156 评论: 6</p>


<p>      最近，因为工作的原因，我们正在使用MongoDB做一些大数据量存储的尝试。对于MongoDB的复制功能部署问题，有一些无奈！</p>


<p>  <p>      首先说明一下我们的情况，我们需要使用的项目情况，对于MongoDB的期望，MongoDB的无奈和解决方案。</p>  <p>      我们的站点是一个7×24h提供服务的电子商务网站。海量数据存储，高并发，实时是我们最大的特点，也是我们的需要解决的难点。我们目前的业务量一直在增长，所以从架构角度出发，可伸缩性，可替代性是我们追求目标。</p>  <p>      目前需要使用到MongoDB的项目有3个：</p>  <p>      一个是应用信息中心（AIC），该项目是作用是监控线上项目出现异常的情况，该项目的特点在于瞬间并发无法估计，数据量恐怖，读写遵循“二八原则”，稳定性要求高，实时性一般；</p>  <p>      另一个是业务日志系统（BLS），该项目主要用来存放站点业务操作的日志，目前的做法是将日志存放在DB中，我们认为这不是最好的解决方案，所以我们准备把该部分日志移植到MongoDB环境中。该项目的特点是数据增量大，每天增量大概有7g左右，数据无法删除，高并发，稳定性，实时性要求高，99%写，1%读取；</p>  <p>      最后一个是搜索用户行为分析系统（UBA），该项目主要是记录一些我们需要分析的用户使用搜索行为的日志，该项目的特点是数据量大，并发要求高，稳定性，实时性要求一般，但是要求读写尽量分开。三个方案都要考虑成本的问题，否则硬件的投入将是最大的软肋。</p>  <p>      仔细了解MongoDB后，先说一下能满足我们需求的点。</p>  <p>           第一：可以存放海量数据；</p>  <p>           第二：能承受高并发；</p>  <p>           第三：可以使用廉价存储；</p>  <p>           第四：单服务器稳定性可以满足要求；</p>  <p>      不能满足我们的点：</p>  <p>           第一：net的客户端除了完成了协议外，别的实在够差劲，</p>  <p>           第二：MongoDB的集群功能实在无语。如果选择pair模式，对于slave只能等待master down机，不能读；选择M-M-S模式，不能保证实时性，只能保证最后一致性，并且可能存在数据重叠问题；选择M-S模式，slave倒是可以读了，但是当master down机时无法自动切换到slave。实在很无语！</p>  <p>       解决办法：</p>  <p>           第一：net客户端比较容易解决，自己开发一个就基本上没问题；</p>  <p>           第二：对于AIC，我们选择存储使用M-M-S模式，我们保证海量数据的存储和并发性，实时性在这个系统中并不是重点，稳定性要去也一般，所以选择M-M-S应该问题不大；对于BLS，稳定性是我们的第一要求，并发，海量，快速是我们的第二需求，所以我们选择了pair模式，宁愿浪费一点硬件设备，也要保证稳定性；UBA系统我们选用M-S模式，原因是保证高并发，海量存储的基础上，我们还要保证读写分离，最大的原因就是slave需要对BI提供原始数据源。</p>  <p>      对于MongoDB的应用，目前我们只使用了那么多，从测试的情况看，应该问题不大。最大的问题就是在于复制的功能上，如果pair模式能支持slave可读，那可将无敌了。看过源码后，也没觉得在pair上加入读的功能对于MongoDB会有多大的影响啊！也可能在设计的时候有不得已的苦衷吧？不知道MongoDB的架构师怎么想的？！</p><img src="http://www.cnblogs.com/Seapeak/aggbug/1767091.html?type=1" width="1" height="1" alt=""><p>评论: 6　<a href="http://www.cnblogs.com/Seapeak/archive/2010/06/28/1767091.html#pagedcomment">查看评论</a>　<a href="http://www.cnblogs.com/Seapeak/archive/2010/06/28/1767091.html#commentform">发表评论</a></p><p><a href="http://mpd.cnblogs.com/">软件研发团队管理年会(上海，7.10-7.11)</a></p><hr><p>最新新闻：<br>· <a href="http://news.cnblogs.com/n/67199/">谷歌中国至今没拿到新 ICP 证，G.cn 最糟明天就要关门大吉</a><span style="color:gray">(2010-06-29 15:07)</span><br>· <a href="http://news.cnblogs.com/n/67201/">IE9将于8月进行公开测试</a><span style="color:gray">(2010-06-29 15:03)</span><br>· <a href="http://news.cnblogs.com/n/67200/">首支iPhone 4摄制短片</a><span style="color:gray">(2010-06-29 14:58)</span><br>· <a href="http://news.cnblogs.com/n/67197/">戒备森严 拉斯维加斯赌场数据中心揭秘</a><span style="color:gray">(2010-06-29 14:11)</span><br>· <a href="http://news.cnblogs.com/n/67196/">恶意程序也有“指纹” 或可揪出幕后作者</a><span style="color:gray">(2010-06-29 13:50)</span><br></p><p>编辑推荐：<a href="http://www.cnblogs.com/zc22/archive/2010/06/27/1766007.html">再次回首 TCP Socket 服务器编程</a><br></p><p>网站导航：<a href="http://www.cnblogs.com">博客园首页</a>  <a href="http://home.cnblogs.com/">个人主页</a>  <a href="http://news.cnblogs.com">新闻</a>  <a href="http://home.cnblogs.com/ing/">闪存</a>  <a href="http://home.cnblogs.com/group/">小组</a>  <a href="http://space.cnblogs.com/q/">博问</a>  <a href="http://space.cnblogs.com">社区</a>  <a href="http://kb.cnblogs.com">知识库</a></p></p>

</div>


            <div class="footer">
              <div class="contact">
                <p>
                  Your Name<br />
                  What You Are<br />
                  your@email.com
                </p>
              </div>
              <div class="contact">
                <p>
                  <a href="http://github.com/lyuehh/">github.com/lyuehh</a><br />
                  <a href="http://twitter.com/lyuehh/">twitter.com/lyuehh</a><br />
                </p>
              </div>
            </div>
          </div>
        </div> <!-- /container -->

    </body>
</html>
