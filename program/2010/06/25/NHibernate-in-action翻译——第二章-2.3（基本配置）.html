<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>NHibernate in action翻译——第二章 2.3（基本配置）</title>
        <meta name="viewport" content="width=device-width">

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/css/syntax.css">

        <!-- Custom CSS -->
        <link rel="stylesheet" href="/css/main.css">

    </head>
    <body>

        <div class="container">
          <div class="site">
            <div class="header">
              <h1 class="title"><a href="/">Your New Jekyll Site</a></h1>
              <a class="extra" href="/">home</a>
            </div>

                <h2>NHibernate in action翻译——第二章 2.3（基本配置）</h2>
<p class="meta">25 Jun 2010</p>

<div class="post">
<h2>NHibernate in action翻译——第二章 2.3（基本配置）</h2>

<h3>by 苦-咖啡</h3>

<h3>at 2010-06-25 12:06:00</h3>

<h3>original <a href="http://www.cnblogs.com/kukafeiso/archive/2010/06/25/1765045.html">http://www.cnblogs.com/kukafeiso/archive/2010/06/25/1765045.html</a></h3>

<p>作者: <a href="http://www.cnblogs.com/kukafeiso/">苦-咖啡</a> 发表于 2010-06-25 12:06 <a href="http://www.cnblogs.com/kukafeiso/archive/2010/06/25/1765045.html">原文链接</a> 阅读: 787 评论: 2</p>


<p><strong><span style="color:green">2.3 </span></strong><strong><span style="font-family:宋体;color:green">基本配置</span><span style="color:green"></span></strong></p>


<p style="text-indent:21.75pt">NHibernate<span style="font-family:宋体">可以配置到几乎在所有的</span>.NET<span style="font-family:宋体">应用程序中运行。一般来说，</span>NHibernate<span style="font-family:宋体">使用两到三层的服务器客户端。客户端通常是一个网站，但是也可以是一个桌面式应用程序。虽然我们在这本书只关注网站，但我们也会覆盖桌面程序。</span></p>


<p style="text-indent:21.75pt"><span style="font-family:宋体">首先从</span>Configuration<span style="font-family:宋体">实例中创建一个</span>ISessionFactory<span style="font-family:宋体">实例。</span></p>


<p> </p>


<p><strong><span style="color:green">2.3.1 </span></strong><strong><span style="font-family:宋体;color:green">创建</span><span style="color:green">SessionFactory</span></strong></p>


<p><span>     </span><span style="font-family:宋体">为了去创建一个</span>ISessionFactory<span style="font-family:宋体">实例，你首先要在程序初始化时创建一个</span>Configuration<span style="font-family:宋体">实例，然后使用它去设置数据库和映射的信息。一旦配置完成，</span>Configuration<span style="font-family:宋体">实例就可以用来创建</span>SessionFactory<span style="font-family:宋体">。之后，你就可丢弃</span>Configuration<span style="font-family:宋体">实例。</span></p>


<p><span>     </span><span style="font-family:宋体">在之前的例子中，我们使用了一个</span>MySessionFactory<span style="font-family:宋体">的静态属性去创建</span>ISession<span style="font-family:宋体">实例，下面是它的定义：</span></p>


<p><span style="font-family:宋体"><img border="0" alt="" src="http://images.cnblogs.com/cnblogs_com/kukafeiso/nC2.3.1.png" width="631" height="293"></span></p>


<p> </p>


<p><span>   </span><span style="font-family:宋体">映射文件</span>Employee.hbm.xml<span style="font-family:宋体">的位置跟应用程序的当前目录有关。在这个例子中，你也可以使用</span>XML<span style="font-family:宋体">文件区设置所有的配置。</span></p>


<p> </p>


<p><strong><span style="font-family:宋体;color:green">方法链</span></strong></p>


<p style="text-indent:21.75pt"><span style="font-family:宋体">方法链是一种编程风格，它被很多的</span>NHibernate<span style="font-family:宋体">接口支持。这种风格在</span>Smalltalk<span style="font-family:宋体">中要比在</span>.NET<span style="font-family:宋体">中流行，它被认为是可读性低、更难去理解，但是它在很多情况下非常方便。</span></p>


<p style="text-indent:21.75pt"><span style="font-family:宋体">很多的</span>.NET<span style="font-family:宋体">开发者定义没有返回值的方法。在</span>Smalltalk<span style="font-family:宋体">中，是没有</span>void<span style="font-family:宋体">类型的，它通常返回它接收的对象。这可以让你去重写上面的代码：</span></p>


<p style="text-indent:21.75pt"> </p>


<p style="text-indent:21.75pt"><strong><span style="color:#0099ff">ISessionFactory sessionFactory =new Configuration()</span></strong></p>


<p style="text-indent:21.75pt"><strong><span style="color:#0099ff">      .Configure()</span></strong></p>


<p style="text-indent:21.75pt"><strong><span style="color:#0099ff">      .AddXmlFile(“Employee.hbm.xml”)</span></strong></p>


<p style="text-indent:21.75pt"><strong><span style="color:#0099ff">      .BuildSessionFactory();</span></strong></p>


<p style="text-indent:21.75pt"> </p>


<p style="text-indent:21.75pt"><span style="font-family:宋体">注意到你不需要定义一个</span>Configuration<span style="font-family:宋体">的变量。</span></p>


<p style="text-indent:21.75pt"><span style="font-family:宋体">我们会在一些示例中使用这种风格；但是如果你不喜欢它，你可以不使用。</span></p>


<p style="text-indent:21.75pt"> </p>


<p style="text-indent:21.75pt"><span style="font-family:宋体">为了方便，</span>NHibernate<span style="font-family:宋体">的</span>XML<span style="font-family:宋体">映射文件以</span>.hbm.xml<span style="font-family:宋体">扩展名为后缀，每一个类配备一个映射文件，而不是把所有的映射放在一个文件中（这被认为是一种坏的设计）。“</span>Hello World<span style="font-family:宋体">”示例只有一个持久化类，因此只有一个映射文件。但是如果你有多个持久化类，你应该为每个持久化类配置一个映射文件。那么在哪里放置映射文件呢？</span></p>


<p style="text-indent:21.75pt"><strong><span style="font-family:宋体;color:green">映射文件</span></strong></p>


<p style="text-indent:21.75pt"><span style="font-family:宋体">映射文件最好跟持久化类放置在同一个目录下。例如</span>Employee<span style="font-family:宋体">类的映射文件应该命名为</span>Employee.hbm.xml<span style="font-family:宋体">，放置在与</span>Employee.cs<span style="font-family:宋体">同一目录下。我建议你跟着练习使用</span>AddXmlFile()<span style="font-family:宋体">去加载多个映射文件。</span></p>


<p style="text-indent:21.75pt"><span style="font-family:宋体">你也可以把</span>XML<span style="font-family:宋体">映射文件嵌入到</span>.NET<span style="font-family:宋体">中。那么你就必须告诉编译器每一个文件是嵌入文件；</span>Visual Studio<span style="font-family:宋体">可以很容易的完成这个任务。然后使用</span>AddClass()<span style="font-family:宋体">方法，使用如下：</span></p>


<p style="text-indent:21.75pt"> </p>


<p style="text-indent:21.75pt"><strong><span style="color:#0099ff">ISessionFactory sessionFactory = new Configuration()</span></strong></p>


<p style="text-indent:21.75pt"><strong><span style="color:#0099ff"><span>   .Configure()</span></span></strong></p>


<p style="text-indent:21.75pt"><strong><span style="color:#0099ff"><span>   .AddClass(typeof(Model.Item))</span></span></strong></p>


<p style="text-indent:21.75pt"><strong><span style="color:#0099ff"><span>   .AddClass(Typeof(Model.User))</span></span></strong></p>


<p style="text-indent:21.75pt"><strong><span style="color:#0099ff"><span>   .AddClass(Typeof(Model.Bid))</span></span></strong></p>


<p style="text-indent:21.75pt"><strong><span style="color:#0099ff"><span>   .BuildSessionFactory();</span></span></strong></p>


<p style="text-indent:21.75pt"> </p>


<p style="text-indent:21.75pt">AddClass()<span style="font-family:宋体">方法假设映射文件的后缀名为</span>.hbm.xml<span style="font-family:宋体">而且内嵌在跟类文件同一个引用下。</span></p>


<p style="text-indent:21.75pt"><span style="font-family:宋体">如果你想添加所有的内嵌映射文件，你可以使用方法</span>AddAssembly()<span style="font-family:宋体">：</span></p>


<p style="text-indent:21.75pt"> </p>


<p style="text-indent:21.75pt"><strong><span style="color:#0099ff">ISessionFactory sessionFactory = new Configuration()</span></strong></p>


<p style="text-indent:21.75pt"><strong><span style="color:#0099ff">   .Configure()</span></strong></p>


<p style="text-indent:21.75pt"><strong><span style="color:#0099ff">   .AddInputStream(// .NET Attributes</span></strong></p>


<p style="text-indent:21.75pt"><strong><span style="color:#0099ff">         HbmSerializer.Default.Serialize(typeof(Model.Item).Assembly))</span></strong></p>


<p style="text-indent:21.75pt"><strong><span style="color:#0099ff">   .AddAssembly(typeof(Model.Item).Assembly)//XML</span></strong></p>


<p style="text-indent:21.75pt"><strong><span style="color:#0099ff">   .BuildSessionFactory();</span></strong></p>


<p style="text-indent:21.75pt"> </p>


<p style="text-indent:21.75pt"><span style="font-family:宋体">提示：不要使用应用程序名作为参数（如“</span>NHibernate.Auction<span style="font-family:宋体">”）。你要直接使用一个类的类型直接检索包含映射文件的引用。</span></p>


<p style="text-indent:21.75pt"> </p>


<p style="text-indent:21.75pt"><strong><span style="font-family:宋体;color:green">为什么</span><span style="color:green">NHibernate</span></strong><strong><span style="font-family:宋体;color:green">会提示不知道你的类？</span></strong></p>


<p style="text-indent:21.75pt"><span style="font-family:宋体">当你开始使用</span>NHibernate<span style="font-family:宋体">时，你必须确定所有的映射文件都让</span>NHibernate<span style="font-family:宋体">知道了，如果你漏了一个，你将会得到一个异常。当创建</span>session Factory<span style="font-family:宋体">时，他会报一个异常：</span><span style="color:red">refers to an unmapped class:YourClass</span><span style="font-family:宋体">。当你执行一个查询的时候，他会报一个异常：</span><span style="color:red">possible an invalid or unmapped class name was used in the query</span><span style="font-family:宋体">。</span></p>


<p style="text-indent:21.75pt"><span style="font-family:宋体">为了去解决这个问题，第一步是在</span>INFO<span style="font-family:宋体">层设置日志（将在</span>3.3.2<span style="font-family:宋体">节介绍）。然后阅读日志；你应该找到一条信息如：</span>Mapping class: Namespace. YourClass -&gt;YourClass<span style="font-family:宋体">。然后检查你的初始化代码，确认是否包含所有的映射文件。</span></p>


<p style="text-indent:21.75pt"><span style="font-family:宋体">如果你使用</span>AddAssembly()<span style="font-family:宋体">，去确定</span>hbm.xml<span style="font-family:宋体">文件为嵌入文件。</span></p>


<p style="text-indent:21.75pt"> </p>


<p style="text-indent:21.75pt"><strong><span style="font-family:宋体;color:green">多数据库和</span><span style="color:green">SESSION FACTORIES</span></strong></p>


<p style="text-indent:21.75pt"><span style="font-family:宋体">我们已经演示过单</span>SessionFactory<span style="font-family:宋体">的程序了，这已经可以适用于大多数的程序需要。如果你需要多个</span>ISessionFactory<span style="font-family:宋体">实例，以便去管理多个数据库。每一个</span>SessionFactory<span style="font-family:宋体">被一个数据库使用，然后创建</span>ISession<span style="font-family:宋体">实例去为特定的数据库工作。一旦你拥有了</span>SessionFactory<span style="font-family:宋体">，你就可以去创建</span>session<span style="font-family:宋体">，然后开始加载和保存对象。</span></p>


<p style="text-indent:21.75pt"><strong><span style="font-family:宋体;color:green">配置技巧</span></strong></p>


<p style="text-indent:21.75pt"><span style="font-family:宋体">你需要指定数据库连接，和各种能在运行时影响</span>NHibernate<span style="font-family:宋体">行为的设置。配置文件的属性非常多，但是不要担心，大多数有默认值。只有少数需要修改的。</span></p>


<p style="text-indent:21.75pt"><span style="font-family:宋体">为了去指定配置选项，你需要使用以下技巧：</span></p>


<p style="margin:0cm 0cm 0pt 57.75pt"><span>1、<span style="font:7pt &#39;Times New Roman&#39;">              </span></span><span style="font-family:宋体">传递一个</span>System.Collections.IDictionary<span style="font-family:宋体">的实例给</span>Configuration.SetProperties()<span style="font-family:宋体">，或者使用</span>Configuration.SetProperty<span style="font-family:宋体">为每一个属性设置（或者直接使用</span>Configuration.Properties<span style="font-family:宋体">）。</span></p>


<p style="margin:0cm 0cm 0pt 57.75pt"><span>2、<span style="font:7pt &#39;Times New Roman&#39;">              </span></span><span style="font-family:宋体">在应用程序配置文件中设置所有的属性（</span>App.config<span style="font-family:宋体">或者</span>Web.config<span style="font-family:宋体">）。</span></p>


<p style="margin:0cm 0cm 0pt 57.75pt"><span>3、<span style="font:7pt &#39;Times New Roman&#39;">              </span></span><span style="font-family:宋体">包含</span>&lt;property&gt;<span style="font-family:宋体">元素在名为</span>hibernate.cfg.xml<span style="font-family:宋体">的</span>xml<span style="font-family:宋体">文件中，把这个文件放在当前目录下。</span></p>


<p style="margin:0cm 0cm 0pt 21.75pt"> </p>


<p style="text-indent:21pt"><span style="font-family:宋体">第一种选择是很少使用到的，除了一些快速测试，大多数的应用程序需要一个灵活的配置文件。应用程序配置文件和</span>hibernate.cfg.xml<span style="font-family:宋体">文件都提供相同的功能：配置</span>NHibernate<span style="font-family:宋体">。你选择哪种方式只是你个人喜好。</span>Hibernate.cfg.xml<span style="font-family:宋体">的取名只是一个惯例。你可以使用任何的文件名（例如</span>NHibernate.config<span style="font-family:宋体">，</span>.config<span style="font-family:宋体">文件当</span>ASP.NET<span style="font-family:宋体">部署是会被自动保护），然后提供文件名给</span>Configure()<span style="font-family:宋体">方法。你可以同时使用这两种文件，一种为开发，一种为部署。</span></p>


<p style="text-indent:21pt"><span style="font-family:宋体">我们很少使用非正统的方法去在打开</span>NHibernate<span style="font-family:宋体">的</span>ISession<span style="font-family:宋体">的时候让应用程序提供</span>ADO.NET IDbConnection<span style="font-family:宋体">（例如，通过调用</span>SessionFactory.OpenSession<span style="font-family:宋体">（</span>myConnection<span style="font-family:宋体">））。使用这种选择，代表你不必指定任何数据库连接的属性（其他属性还是要指定的）。我们不推荐这种做法。</span></p>


<p style="text-indent:21pt"><span style="font-family:宋体">对于所有的配置选项，</span>dagtabase-connection<span style="font-family:宋体">是最重要的，因为如果没有它，</span>NHibernate<span style="font-family:宋体">将会不知道怎样跟数据库打交道。</span></p>


<p> </p>


<p><strong><span style="color:green">2.3.2 </span></strong><strong><span style="font-family:宋体;color:green">配置</span><span style="color:green">ADO.NET</span></strong><strong><span style="font-family:宋体;color:green">数据库访问</span></strong></p>


<p style="text-indent:21.75pt"><span style="font-family:宋体">大多数时候，应用程序有责任去获取</span>ADO.NET<span style="font-family:宋体">的连接。</span>NHibernate<span style="font-family:宋体">是应用程序的一部分，因此他有责任去获取这些连接。你需要告诉</span>NHibernate<span style="font-family:宋体">怎样去获取（创建）一个</span>ADO.NET<span style="font-family:宋体">数据库连接。</span></p>


<p style="text-indent:21.75pt">Figure2.2<span style="font-family:宋体">显示了</span>.NET <span style="font-family:宋体">应用程序是怎么跟</span>ADO.NET<span style="font-family:宋体">互相作用。没有</span>NHibernate<span style="font-family:宋体">的时候，应用程序通常从连接池中获取一个</span>ADO.NET<span style="font-family:宋体">连接，然后使用这个连接去执行</span>SQL<span style="font-family:宋体">语句。</span></p>


<p style="text-indent:21.75pt"><span style="font-family:宋体"><img border="0" alt="" src="http://images.cnblogs.com/cnblogs_com/kukafeiso/n2.2.png" width="679" height="166"></span></p>


<p style="text-indent:21.75pt"></p>


<p style="text-indent:21.75pt"></p>


<p style="text-indent:21.75pt"><span style="font-family:宋体">当使用</span>NHibernate<span style="font-family:宋体">的时候，示图改变了：</span>NHibernate<span style="font-family:宋体">作为</span>ADO.NET<span style="font-family:宋体">的客户端和他的连接池，如图</span>Figure2.3<span style="font-family:宋体">所示。应用程序使用</span>NHibernate<span style="font-family:宋体">的</span>ISession<span style="font-family:宋体">和</span>IQuery<span style="font-family:宋体">等</span>API<span style="font-family:宋体">来操作持久化和使用</span>NHibernate<span style="font-family:宋体">的</span>ITransactionAPI<span style="font-family:宋体">来控制数据库的事务。</span></p>


<p style="text-indent:21.75pt"><span style="font-family:宋体"><img border="0" alt="" src="http://images.cnblogs.com/cnblogs_com/kukafeiso/n2.3.png" width="699" height="200"></span></p>


<p style="text-indent:21.75pt"><strong><span style="font-family:宋体;color:green">使用</span><span style="color:green">hibernate.cfg.xml</span></strong><strong><span style="font-family:宋体;color:green">配置</span><span style="color:green">NHibernate</span></strong></p>


<p style="text-indent:21.75pt"><span style="font-family:宋体">以下是</span>hibernate.cfg.xml<span style="font-family:宋体">文件的代码列表，它是用来配置</span>NHibernate<span style="font-family:宋体">去访问</span>Microsoft SQL Server 2000<span style="font-family:宋体">数据库的。</span></p>


<p align="left"><span style="font-family:新宋体;color:blue;font-size:9pt">&lt;?</span><span style="font-family:新宋体;color:#a31515;font-size:9pt">xml</span> <span style="font-family:新宋体;color:red;font-size:9pt">version</span><span style="font-family:新宋体;color:blue;font-size:9pt">=</span><span style="font-family:新宋体;font-size:9pt">"<span style="color:blue">1.0</span>"<span style="color:blue"> ?&gt;</span></span></p>


<p align="left"><span style="font-family:新宋体;color:blue;font-size:9pt">&lt;</span><span style="font-family:新宋体;color:#a31515;font-size:9pt">hibernate-configuration</span> <span style="font-family:新宋体;color:red;font-size:9pt">xmlns</span><span style="font-family:新宋体;color:blue;font-size:9pt">=</span><span style="font-family:新宋体;font-size:9pt">"<span style="color:blue">urn:nhibernate-configuration-2.2</span>"<span style="color:blue">&gt;</span></span></p>


<p align="left"><span style="font-family:新宋体;color:blue;font-size:9pt"> &lt;</span><span style="font-family:新宋体;color:#a31515;font-size:9pt">session-factory</span><span style="font-family:新宋体;color:blue;font-size:9pt">&gt;</span></p>


<p align="left"><span style="font-family:新宋体;color:blue;font-size:9pt">    &lt;</span><span style="font-family:新宋体;color:#a31515;font-size:9pt">property</span> <span style="font-family:新宋体;color:red;font-size:9pt">name</span><span style="font-family:新宋体;color:blue;font-size:9pt">=</span><span style="font-family:新宋体;font-size:9pt">"<span style="color:blue">connection.provider</span>"<span style="color:blue">&gt;</span></span></p>


<p align="left"><span style="font-family:新宋体;font-size:9pt">      NHibernate.Connection.DriverConnectionProvider</span></p>


<p align="left"><span style="font-family:新宋体;color:blue;font-size:9pt">    &lt;/</span><span style="font-family:新宋体;color:#a31515;font-size:9pt">property</span><span style="font-family:新宋体;color:blue;font-size:9pt">&gt;</span></p>


<p align="left"><span style="font-family:新宋体;color:blue;font-size:9pt">    &lt;</span><span style="font-family:新宋体;color:#a31515;font-size:9pt">property</span> <span style="font-family:新宋体;color:red;font-size:9pt">name</span><span style="font-family:新宋体;color:blue;font-size:9pt">=</span><span style="font-family:新宋体;font-size:9pt">"<span style="color:blue">dialect</span>"<span style="color:blue">&gt;</span></span></p>


<p align="left"><span style="font-family:新宋体;font-size:9pt">      NHibernate.Dialect.MsSql2000Dialect</span></p>


<p align="left"><span style="font-family:新宋体;color:blue;font-size:9pt">    &lt;/</span><span style="font-family:新宋体;color:#a31515;font-size:9pt">property</span><span style="font-family:新宋体;color:blue;font-size:9pt">&gt;</span></p>


<p align="left"><span style="font-family:新宋体;color:blue;font-size:9pt">    &lt;</span><span style="font-family:新宋体;color:#a31515;font-size:9pt">property</span> <span style="font-family:新宋体;color:red;font-size:9pt">name</span><span style="font-family:新宋体;color:blue;font-size:9pt">=</span><span style="font-family:新宋体;font-size:9pt">"<span style="color:blue">connection.driver_class</span>"<span style="color:blue">&gt;</span></span></p>


<p align="left"><span style="font-family:新宋体;font-size:9pt">      NHibernate.Driver.SqlClientDriver</span></p>


<p align="left"><span style="font-family:新宋体;color:blue;font-size:9pt">    &lt;/</span><span style="font-family:新宋体;color:#a31515;font-size:9pt">property</span><span style="font-family:新宋体;color:blue;font-size:9pt">&gt;</span></p>


<p align="left"><span style="font-family:新宋体;color:blue;font-size:9pt">    &lt;</span><span style="font-family:新宋体;color:#a31515;font-size:9pt">property</span> <span style="font-family:新宋体;color:red;font-size:9pt">name</span><span style="font-family:新宋体;color:blue;font-size:9pt">=</span><span style="font-family:新宋体;font-size:9pt">"<span style="color:blue">connection.connection_string</span>"<span style="color:blue">&gt;</span></span></p>


<p align="left"><span style="font-family:新宋体;font-size:9pt">      Data Source=(local); Initial Catalog=nhibernate;</span></p>


<p align="left"><span style="font-family:新宋体;font-size:9pt">      Integrated Security=SSPI</span></p>


<p align="left"><span style="font-family:新宋体;color:blue;font-size:9pt">    &lt;/</span><span style="font-family:新宋体;color:#a31515;font-size:9pt">property</span><span style="font-family:新宋体;color:blue;font-size:9pt">&gt;</span></p>


<p align="left"><span style="font-family:新宋体;color:blue;font-size:9pt"> &lt;/</span><span style="font-family:新宋体;color:#a31515;font-size:9pt">session-factory</span><span style="font-family:新宋体;color:blue;font-size:9pt">&gt;</span></p>


<p><span style="font-family:新宋体;color:blue;font-size:9pt">&lt;/</span><span style="font-family:新宋体;color:#a31515;font-size:9pt">hibernate-configuration</span><span style="font-family:新宋体;color:blue;font-size:9pt">&gt;</span></p>


<p style="text-indent:21pt"><span style="font-family:宋体">代码指出了一下信息：</span></p>


<p style="margin:0cm 0cm 0pt 57pt"><span>1、<span style="font:7pt &#39;Times New Roman&#39;">              </span></span>connection.provider<span style="font-family:宋体">指出了应用了</span>IConnectionProvider<span style="font-family:宋体">接口的类名；这里我们使用默认的。</span></p>


<p style="margin:0cm 0cm 0pt 57pt"><span>2、<span style="font:7pt &#39;Times New Roman&#39;">              </span></span>dialect<span style="font-family:宋体">指定了应用了数据库方言的名称。方言是</span>NHibernate<span style="font-family:宋体">用来指定数据库的特性的。尽管有</span>ANSI<span style="font-family:宋体">标准化的作用，但是</span>SQL<span style="font-family:宋体">依然在不同的数据库中有不同的形式。你必须指定一种方言，</span>NHibernate<span style="font-family:宋体">包含了对大多数</span>SQL<span style="font-family:宋体">数据库的支持，和添加一种新的方言也是非常容易的。</span></p>


<p style="margin:0cm 0cm 0pt 57pt"><span>3、<span style="font:7pt &#39;Times New Roman&#39;">              </span></span>connection.driver_class<span style="font-family:宋体">指定了应用的</span>ADO.NET<span style="font-family:宋体">驱动。注意，当使用不完整的驱动名时，你必须添加一个</span>&lt;qualifyAssembly&gt;<span style="font-family:宋体">元素在配置文件中指定符合的名字，以便</span>NHibernate<span style="font-family:宋体">可以成功地加载它。</span></p>


<p style="margin:0cm 0cm 0pt 57pt"><span>4、<span style="font:7pt &#39;Times New Roman&#39;">              </span></span>connection.connection_string<span style="font-family:宋体">指定了一个标准的</span>ADO.NET<span style="font-family:宋体">连接字符串，是用来创建数据库连接的。</span></p>


<p style="margin:0cm 0cm 0pt 21pt"><strong><span style="font-family:宋体;color:#118126">开始</span><span style="color:#118126">NHibernate</span></strong></p>


<p style="text-indent:21pt"><span style="font-family:宋体">怎么样利用这些属性去开始创建</span>NHibernate<span style="font-family:宋体">应用程序？你定义了这些属性在</span>hibernate.cfg.xml<span style="font-family:宋体">文件中，你需要把这个文件放在应用程序目录下。当你创建一个</span>Configuration<span style="font-family:宋体">对象和调用</span>Configure()<span style="font-family:宋体">方法时，他会被自动地识别和读取。</span></p>


<p style="text-indent:21pt"><span style="font-family:宋体">让我总结一下配置的步骤吧：</span></p>


<p style="margin:0cm 0cm 0pt 57.75pt"><span>1、<span style="font:7pt &#39;Times New Roman&#39;">    </span></span><span style="font-family:宋体">如果你的数据库</span>ADO.NET<span style="font-family:宋体">数据驱动还没有安装，去下载和安装它；如果你正在使用</span>SQL Server<span style="font-family:宋体">，那么你可以跳过这一步。</span></p>


<p style="margin:0cm 0cm 0pt 57.75pt"><span>2、<span style="font:7pt &#39;Times New Roman&#39;">    </span></span><span style="font-family:宋体">添加引用</span>log4net.dll<span style="font-family:宋体">到你的项目中。这是可选的，但是推荐这样做。</span></p>


<p style="margin:0cm 0cm 0pt 57.75pt"><span>3、<span style="font:7pt &#39;Times New Roman&#39;">    </span></span><span style="font-family:宋体">决定</span>NHibernate<span style="font-family:宋体">需要的数据库访问属性。</span></p>


<p style="margin:0cm 0cm 0pt 57.75pt"><span>4、<span style="font:7pt &#39;Times New Roman&#39;">    </span></span><span style="font-family:宋体">放置</span>hibernate.cfg.xml<span style="font-family:宋体">文件在当前目录以便</span>Configuration<span style="font-family:宋体">读取这些属性。</span></p>


<p style="margin:0cm 0cm 0pt 57.75pt"><span>5、<span style="font:7pt &#39;Times New Roman&#39;">    </span></span><span style="font-family:宋体">在你的应用程序中创建一个</span>Configuration<span style="font-family:宋体">实例，调用</span>Configure()<span style="font-family:宋体">方法；使用</span>HbmSerializer.Default.Serialize()<span style="font-family:宋体">和</span>AddInputStream()<span style="font-family:宋体">加载映射类；使用</span>AddAssembly()<span style="font-family:宋体">或</span>AddClass()<span style="font-family:宋体">或</span>AddXmlFile()<span style="font-family:宋体">加载映射文件。从</span>Configuration<span style="font-family:宋体">调用</span>BuildSessionFactory()<span style="font-family:宋体">创建一个</span>ISessionFactory<span style="font-family:宋体">实例。</span></p>


<p style="margin:0cm 0cm 0pt 57.75pt"><span>6、<span style="font:7pt &#39;Times New Roman&#39;">    </span></span><span style="font-family:宋体">当你用完</span>NHibernate<span style="font-family:宋体">时，记得关闭</span>ISessionFactory<span style="font-family:宋体">（使用</span>MySessionFactory.Close()<span style="font-family:宋体">）。大多数情况，当你关闭你的应用程序时你才会关闭</span>ISessionFactory<span style="font-family:宋体">。</span></p>


<p> </p>


<p style="text-indent:10.5pt"> <span style="font-family:宋体">当你使用</span>COM+<span style="font-family:宋体">服务时还需要一些步骤，将会在第六章介绍。</span>NHibernate<span style="font-family:宋体">代码只需要添加一些东西就可以整合到</span>COM+<span style="font-family:宋体">中。你现在可以运行</span>NHibernate<span style="font-family:宋体">程序了。</span></p>


<p style="text-indent:10.5pt"><span style="font-family:宋体">下一节将讲述</span>NHibernate<span style="font-family:宋体">配置的高级选项，部分选项是推荐使用的，例如执行</span>SQL<span style="font-family:宋体">的日志，可以方便调试。使用方便的</span>XML<span style="font-family:宋体">配置文件而不是使用令人痛苦的属性。但是如果你想，你可以跳过这一节，当你在第三章看到更多关于持久化类的时候，你可以再跳回来看。</span></p>


<p><img src="http://www.cnblogs.com/kukafeiso/aggbug/1765045.html?type=1" width="1" height="1" alt=""><p>评论: 2　<a href="http://www.cnblogs.com/kukafeiso/archive/2010/06/25/1765045.html#pagedcomment">查看评论</a>　<a href="http://www.cnblogs.com/kukafeiso/archive/2010/06/25/1765045.html#commentform">发表评论</a></p><p><a href="http://a4.yeshj.com/rd/35451/">软件研发团队管理年会(上海，7.10-7.11)</a></p><hr><p>最新新闻：<br>· <a href="http://news.cnblogs.com/n/67010/">Facebook追赶谷歌进军网络搜索市场</a><span style="color:gray">(2010-06-26 08:32)</span><br>· <a href="http://news.cnblogs.com/n/67009/">两个新的 Google 搜索故事视频：毕业和进球</a><span style="color:gray">(2010-06-26 08:29)</span><br>· <a href="http://news.cnblogs.com/n/67008/">微软证实IE9将支持Canvas绘图音视频标签技术</a><span style="color:gray">(2010-06-25 23:53)</span><br>· <a href="http://news.cnblogs.com/n/67007/">Symbian前CTO出走诺基亚 加盟导航公司TomTom</a><span style="color:gray">(2010-06-25 22:25)</span><br>· <a href="http://news.cnblogs.com/n/67006/">亚马逊三大举措或促eBooks今年赢利10亿美元</a><span style="color:gray">(2010-06-25 22:06)</span><br></p><p>编辑推荐：<a href="http://www.cnblogs.com/sumtec/archive/2010/06/25/1764838.html">C#确实是很“慢”——最后的疯狂</a><br></p><p>网站导航：<a href="http://www.cnblogs.com">博客园首页</a>  <a href="http://home.cnblogs.com/">个人主页</a>  <a href="http://news.cnblogs.com">新闻</a>  <a href="http://home.cnblogs.com/ing/">闪存</a>  <a href="http://home.cnblogs.com/group/">小组</a>  <a href="http://space.cnblogs.com/q/">博问</a>  <a href="http://space.cnblogs.com">社区</a>  <a href="http://kb.cnblogs.com">知识库</a></p></p>

</div>


            <div class="footer">
              <div class="contact">
                <p>
                  Your Name<br />
                  What You Are<br />
                  your@email.com
                </p>
              </div>
              <div class="contact">
                <p>
                  <a href="http://github.com/yourusername/">github.com/yourusername</a><br />
                  <a href="http://twitter.com/yourusername/">twitter.com/yourusername</a><br />
                </p>
              </div>
            </div>
          </div>
        </div> <!-- /container -->

    </body>
</html>
