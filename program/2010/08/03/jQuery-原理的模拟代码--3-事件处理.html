<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>jQuery 原理的模拟代码 -3 事件处理</title>
        <meta name="viewport" content="width=device-width">

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/google_reader/css/syntax.css">

        <!-- Custom CSS -->
        <link rel="stylesheet" href="/google_reader/css/main.css">

    </head>
    <body>

        <div class="container">
          <div class="site">
            <div class="header">
              <h1 class="title"><a href="/google_reader/">Google Reader</a></h1>
              <a class="extra" href="/google_reader/">home</a>
            </div>

                <h2>jQuery 原理的模拟代码 -3 事件处理</h2>
<p class="meta">2010-08-03 06:47</p>

<div class="post">
<h2>jQuery 原理的模拟代码 -3 事件处理</h2>

<h3>by haogj</h3>

<h3>at 2010-08-02 22:47:00</h3>

<h3>original <a href="http://www.cnblogs.com/haogj/archive/2010/08/02/1789759.html">http://www.cnblogs.com/haogj/archive/2010/08/02/1789759.html</a></h3>

<p>作者: <a href="http://www.cnblogs.com/haogj/">haogj</a> 发表于 2010-08-02 22:47 <a href="http://www.cnblogs.com/haogj/archive/2010/08/02/1789759.html">原文链接</a> 阅读: 741 评论: 1</p>


<p>在 jQuery 中，实际注册的事件处理函数是一个匿名的闭包函数，这个函数最终都是通过调用 jQuery.event.handle 进行处理的。</p>


<p> </p>


<p>在对象的私有扩展对象上，专门增加了一个名为 events 的事件管理对象，在这个对象上每种事件分别对应一个同名的属性，这个属性的值是一个数组，针对这个事件的处理程序依次压入这个数组中，构成一个事件处理的列表。自定义的事件处理函数即被压入这个列表中。</p>


<p> </p>


<p>在事件触发的时候，通过注册的匿名函数来执行 jQuery.event.handle ，由于使用了闭包，所以在这个函数中的 this 就是事件源对象，通过这个事件源对象找到对象的私有扩展数据，然后在 events 中找到对应的事件处理程序列表，最后，依次执行。</p>


<p> </p>


<div></div>


<p> </p>


<div>
<div><span style="color:#008080">  1</span> <span style="color:#008000">//</span><span style="color:#008000">/ &lt;reference path=&quot;jQuery-core.js&quot; /&gt;</span><span style="color:#008000"><br></span><span style="color:#008080">  2</span> <span style="color:#008000">//</span><span style="color:#008000"> #2076</span><span style="color:#008000"><br></span><span style="color:#008080">  3</span> <span style="color:#008000"></span><span style="color:#000000"><br></span><span style="color:#008080">  4</span> <span style="color:#000000"></span><span style="color:#008000">//</span><span style="color:#008000"> 用于生成事件处理函数的 id</span><span style="color:#008000"><br></span><span style="color:#008080">  5</span> <span style="color:#008000"></span><span style="color:#000000">jQuery.guid </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#000000">1</span><span style="color:#000000">;<br></span><span style="color:#008080">  6</span> <span style="color:#000000"><br></span><span style="color:#008080">  7</span> <span style="color:#000000"></span><span style="color:#008000">//</span><span style="color:#008000"> jQuery 的事件对象</span><span style="color:#008000"><br></span><span style="color:#008080">  8</span> <span style="color:#008000"></span><span style="color:#000000">jQuery.event </span><span style="color:#000000">=</span><span style="color:#000000"> {    </span><span style="color:#008000">//</span><span style="color:#008000"> # 1555</span><span style="color:#008000"><br></span><span style="color:#008080">  9</span> <span style="color:#008000"></span><span style="color:#000000"><br></span><span style="color:#008080"> 10</span> <span style="color:#000000">    </span><span style="color:#008000">//</span><span style="color:#008000"> 为对象增加事件</span><span style="color:#008000"><br></span><span style="color:#008080"> 11</span> <span style="color:#008000"></span><span style="color:#000000">    </span><span style="color:#008000">//</span><span style="color:#008000"> elem 增加事件的元素， type 事件的名称, handler 事件处理程序, data 事件相关的数据</span><span style="color:#008000"><br></span><span style="color:#008080"> 12</span> <span style="color:#008000"></span><span style="color:#000000">    add: </span><span style="color:#0000ff">function</span><span style="color:#000000"> (elem, type, handler, data) {<br></span><span style="color:#008080"> 13</span> <span style="color:#000000"><br></span><span style="color:#008080"> 14</span> <span style="color:#000000">        </span><span style="color:#0000ff">var</span><span style="color:#000000"> handleObjIn, handleObj;<br></span><span style="color:#008080"> 15</span> <span style="color:#000000"><br></span><span style="color:#008080"> 16</span> <span style="color:#000000">        </span><span style="color:#008000">//</span><span style="color:#008000"> 确认函数有一个唯一的 ID</span><span style="color:#008000"><br></span><span style="color:#008080"> 17</span> <span style="color:#008000"></span><span style="color:#000000">        </span><span style="color:#0000ff">if</span><span style="color:#000000"> (</span><span style="color:#000000">!</span><span style="color:#000000">handler.guid) {<br></span><span style="color:#008080"> 18</span> <span style="color:#000000">            handler.guid </span><span style="color:#000000">=</span><span style="color:#000000"> jQuery.guid</span><span style="color:#000000">++</span><span style="color:#000000">;<br></span><span style="color:#008080"> 19</span> <span style="color:#000000">        }<br></span><span style="color:#008080"> 20</span> <span style="color:#000000"><br></span><span style="color:#008080"> 21</span> <span style="color:#000000">        </span><span style="color:#008000">//</span><span style="color:#008000"> 取得这个元素所对应的缓存数据对象</span><span style="color:#008000"><br></span><span style="color:#008080"> 22</span> <span style="color:#008000"></span><span style="color:#000000">        </span><span style="color:#0000ff">var</span><span style="color:#000000"> elemData </span><span style="color:#000000">=</span><span style="color:#000000"> jQuery.data(elem);<br></span><span style="color:#008080"> 23</span> <span style="color:#000000"><br></span><span style="color:#008080"> 24</span> <span style="color:#000000">        </span><span style="color:#008000">//</span><span style="color:#008000"> 取得元素对应的缓存对象上的事件对象和所有事件共用的处理程序</span><span style="color:#008000"><br></span><span style="color:#008080"> 25</span> <span style="color:#008000"></span><span style="color:#000000">        </span><span style="color:#0000ff">var</span><span style="color:#000000"> events </span><span style="color:#000000">=</span><span style="color:#000000"> elemData.events </span><span style="color:#000000">=</span><span style="color:#000000"> elemData.events </span><span style="color:#000000">||</span><span style="color:#000000"> {};<br></span><span style="color:#008080"> 26</span> <span style="color:#000000">        </span><span style="color:#0000ff">var</span><span style="color:#000000"> eventHandle </span><span style="color:#000000">=</span><span style="color:#000000"> elemData.handle;<br></span><span style="color:#008080"> 27</span> <span style="color:#000000"><br></span><span style="color:#008080"> 28</span> <span style="color:#000000">        </span><span style="color:#008000">//</span><span style="color:#008000"> 是否已经有事件处理函数 handle 只有一个，都是使用 jQuery.event.handle</span><span style="color:#008000"><br></span><span style="color:#008080"> 29</span> <span style="color:#008000"></span><span style="color:#000000">        </span><span style="color:#008000">//</span><span style="color:#008000"> 通过使用闭包，使得这个函数引用当前的事件对象，参数。</span><span style="color:#008000"><br></span><span style="color:#008080"> 30</span> <span style="color:#008000"></span><span style="color:#000000">        </span><span style="color:#0000ff">if</span><span style="color:#000000"> (</span><span style="color:#000000">!</span><span style="color:#000000">eventHandle) {<br></span><span style="color:#008080"> 31</span> <span style="color:#000000">            elemData.handle </span><span style="color:#000000">=</span><span style="color:#000000"> eventHandle </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">function</span><span style="color:#000000"> () {<br></span><span style="color:#008080"> 32</span> <span style="color:#000000">                </span><span style="color:#0000ff">return</span><span style="color:#000000"> jQuery.event.handle.apply(eventHandle.elem, arguments);<br></span><span style="color:#008080"> 33</span> <span style="color:#000000">            };<br></span><span style="color:#008080"> 34</span> <span style="color:#000000">        }<br></span><span style="color:#008080"> 35</span> <span style="color:#000000">                <br></span><span style="color:#008080"> 36</span> <span style="color:#000000">        </span><span style="color:#008000">//</span><span style="color:#008000"> 使得闭包处理程序可以找到事件源对象</span><span style="color:#008000"><br></span><span style="color:#008080"> 37</span> <span style="color:#008000"></span><span style="color:#000000">        eventHandle.elem </span><span style="color:#000000">=</span><span style="color:#000000"> elem;<br></span><span style="color:#008080"> 38</span> <span style="color:#000000"><br></span><span style="color:#008080"> 39</span> <span style="color:#000000">        </span><span style="color:#008000">//</span><span style="color:#008000"> </span><span style="color:#008000"><br></span><span style="color:#008080"> 40</span> <span style="color:#008000"></span><span style="color:#000000">        handleObj </span><span style="color:#000000">=</span><span style="color:#000000"> { handler: handler, data: data};<br></span><span style="color:#008080"> 41</span> <span style="color:#000000">        handleObj.namespace </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#000000">""</span><span style="color:#000000">;<br></span><span style="color:#008080"> 42</span> <span style="color:#000000"><br></span><span style="color:#008080"> 43</span> <span style="color:#000000"><br></span><span style="color:#008080"> 44</span> <span style="color:#000000">        handleObj.type </span><span style="color:#000000">=</span><span style="color:#000000"> type;<br></span><span style="color:#008080"> 45</span> <span style="color:#000000">        handleObj.guid </span><span style="color:#000000">=</span><span style="color:#000000"> handler.guid;<br></span><span style="color:#008080"> 46</span> <span style="color:#000000"><br></span><span style="color:#008080"> 47</span> <span style="color:#000000">        </span><span style="color:#008000">//</span><span style="color:#008000"> 每种事件可以有一系列的处理程序，数组形式</span><span style="color:#008000"><br></span><span style="color:#008080"> 48</span> <span style="color:#008000"></span><span style="color:#000000">        </span><span style="color:#0000ff">var</span><span style="color:#000000"> handlers </span><span style="color:#000000">=</span><span style="color:#000000"> events[type],<br></span><span style="color:#008080"> 49</span> <span style="color:#000000">        special </span><span style="color:#000000">=</span><span style="color:#000000"> jQuery.event.special[type] </span><span style="color:#000000">||</span><span style="color:#000000"> {};<br></span><span style="color:#008080"> 50</span> <span style="color:#000000"><br></span><span style="color:#008080"> 51</span> <span style="color:#000000">        </span><span style="color:#008000">//</span><span style="color:#008000"> Init the event handler queue</span><span style="color:#008000"><br></span><span style="color:#008080"> 52</span> <span style="color:#008000"></span><span style="color:#000000">        </span><span style="color:#0000ff">if</span><span style="color:#000000"> (</span><span style="color:#000000">!</span><span style="color:#000000">handlers) {<br></span><span style="color:#008080"> 53</span> <span style="color:#000000">            handlers </span><span style="color:#000000">=</span><span style="color:#000000"> events[type] </span><span style="color:#000000">=</span><span style="color:#000000"> [];<br></span><span style="color:#008080"> 54</span> <span style="color:#000000"><br></span><span style="color:#008080"> 55</span> <span style="color:#000000">            </span><span style="color:#008000">//</span><span style="color:#008000"> Check for a special event handler</span><span style="color:#008000"><br></span><span style="color:#008080"> 56</span> <span style="color:#008000"></span><span style="color:#000000">            </span><span style="color:#008000">//</span><span style="color:#008000"> Only use addEventListener/attachEvent if the special</span><span style="color:#008000"><br></span><span style="color:#008080"> 57</span> <span style="color:#008000"></span><span style="color:#000000">            </span><span style="color:#008000">//</span><span style="color:#008000"> events handler returns false</span><span style="color:#008000"><br></span><span style="color:#008080"> 58</span> <span style="color:#008000"></span><span style="color:#000000">            </span><span style="color:#008000">//</span><span style="color:#008000"> 完成实际的事件注册</span><span style="color:#008000"><br></span><span style="color:#008080"> 59</span> <span style="color:#008000"></span><span style="color:#000000">            </span><span style="color:#008000">//</span><span style="color:#008000"> 实际的事件处理函数是 eventHandle</span><span style="color:#008000"><br></span><span style="color:#008080"> 60</span> <span style="color:#008000"></span><span style="color:#000000">            </span><span style="color:#0000ff">if</span><span style="color:#000000"> (</span><span style="color:#000000">!</span><span style="color:#000000">special.setup </span><span style="color:#000000">||</span><span style="color:#000000"> special.setup.call(elem, data, namespaces, eventHandle) </span><span style="color:#000000">===</span><span style="color:#000000"> </span><span style="color:#0000ff">false</span><span style="color:#000000">) {<br></span><span style="color:#008080"> 61</span> <span style="color:#000000">                </span><span style="color:#008000">//</span><span style="color:#008000"> Bind the global event handler to the element</span><span style="color:#008000"><br></span><span style="color:#008080"> 62</span> <span style="color:#008000"></span><span style="color:#000000">                </span><span style="color:#0000ff">if</span><span style="color:#000000"> (elem.addEventListener) {<br></span><span style="color:#008080"> 63</span> <span style="color:#000000">                    elem.addEventListener(type, eventHandle, </span><span style="color:#0000ff">false</span><span style="color:#000000">);<br></span><span style="color:#008080"> 64</span> <span style="color:#000000"><br></span><span style="color:#008080"> 65</span> <span style="color:#000000">                } </span><span style="color:#0000ff">else</span><span style="color:#000000"> </span><span style="color:#0000ff">if</span><span style="color:#000000"> (elem.attachEvent) {<br></span><span style="color:#008080"> 66</span> <span style="color:#000000">                    elem.attachEvent(</span><span style="color:#000000">"</span><span style="color:#000000">on</span><span style="color:#000000">"</span><span style="color:#000000"> </span><span style="color:#000000">+</span><span style="color:#000000"> type, eventHandle);<br></span><span style="color:#008080"> 67</span> <span style="color:#000000">                }<br></span><span style="color:#008080"> 68</span> <span style="color:#000000">            }<br></span><span style="color:#008080"> 69</span> <span style="color:#000000">        }<br></span><span style="color:#008080"> 70</span> <span style="color:#000000"><br></span><span style="color:#008080"> 71</span> <span style="color:#000000">        </span><span style="color:#008000">//</span><span style="color:#008000"> 自定义的处理函数在一个堆栈中，以后 jQuery.event.handle 到这里找到实际的处理程序</span><span style="color:#008000"><br></span><span style="color:#008080"> 72</span> <span style="color:#008000"></span><span style="color:#000000">        handlers.push(handleObj);<br></span><span style="color:#008080"> 73</span> <span style="color:#000000">               <br></span><span style="color:#008080"> 74</span> <span style="color:#000000">        </span><span style="color:#008000">//</span><span style="color:#008000"> Nullify elem to prevent memory leaks in IE</span><span style="color:#008000"><br></span><span style="color:#008080"> 75</span> <span style="color:#008000"></span><span style="color:#000000">        elem </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">null</span><span style="color:#000000">;<br></span><span style="color:#008080"> 76</span> <span style="color:#000000">    },<br></span><span style="color:#008080"> 77</span> <span style="color:#000000"><br></span><span style="color:#008080"> 78</span> <span style="color:#000000">    global: {},<br></span><span style="color:#008080"> 79</span> <span style="color:#000000"><br></span><span style="color:#008080"> 80</span> <span style="color:#000000">    </span><span style="color:#008000">//</span><span style="color:#008000"> 真正的事件处理函数, </span><span style="color:#008000"><br></span><span style="color:#008080"> 81</span> <span style="color:#008000"></span><span style="color:#000000">    </span><span style="color:#008000">//</span><span style="color:#008000"> 由于是通过  return jQuery.event.handle.apply(eventHandle.elem, arguments) 调用的</span><span style="color:#008000"><br></span><span style="color:#008080"> 82</span> <span style="color:#008000"></span><span style="color:#000000">    </span><span style="color:#008000">//</span><span style="color:#008000"> 所以，此时的 this 就是事件源对象，event 是事件参数</span><span style="color:#008000"><br></span><span style="color:#008080"> 83</span> <span style="color:#008000"></span><span style="color:#000000">    handle: </span><span style="color:#0000ff">function</span><span style="color:#000000"> (event) {  </span><span style="color:#008000">//</span><span style="color:#008000"> 1904</span><span style="color:#008000"><br></span><span style="color:#008080"> 84</span> <span style="color:#008000"></span><span style="color:#000000">        </span><span style="color:#0000ff">var</span><span style="color:#000000"> all, handlers, namespaces, namespace, events;<br></span><span style="color:#008080"> 85</span> <span style="color:#000000"><br></span><span style="color:#008080"> 86</span> <span style="color:#000000">        event </span><span style="color:#000000">=</span><span style="color:#000000"> window.event;<br></span><span style="color:#008080"> 87</span> <span style="color:#000000">        event.currentTarget </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">this</span><span style="color:#000000">;<br></span><span style="color:#008080"> 88</span> <span style="color:#000000"><br></span><span style="color:#008080"> 89</span> <span style="color:#000000">        </span><span style="color:#008000">//</span><span style="color:#008000"> 在当前的事件对象上找到事件处理列表</span><span style="color:#008000"><br></span><span style="color:#008080"> 90</span> <span style="color:#008000"></span><span style="color:#000000">        </span><span style="color:#0000ff">var</span><span style="color:#000000"> events </span><span style="color:#000000">=</span><span style="color:#000000"> jQuery.data(</span><span style="color:#0000ff">this</span><span style="color:#000000">, </span><span style="color:#000000">"</span><span style="color:#000000">events</span><span style="color:#000000">"</span><span style="color:#000000">), handlers </span><span style="color:#000000">=</span><span style="color:#000000"> events[event.type];<br></span><span style="color:#008080"> 91</span> <span style="color:#000000"><br></span><span style="color:#008080"> 92</span> <span style="color:#000000">        </span><span style="color:#0000ff">if</span><span style="color:#000000"> (events </span><span style="color:#000000">&amp;&amp;</span><span style="color:#000000"> handlers) {<br></span><span style="color:#008080"> 93</span> <span style="color:#000000">            </span><span style="color:#008000">//</span><span style="color:#008000"> Clone the handlers to prevent manipulation</span><span style="color:#008000"><br></span><span style="color:#008080"> 94</span> <span style="color:#008000"></span><span style="color:#000000">            handlers </span><span style="color:#000000">=</span><span style="color:#000000"> handlers.slice(</span><span style="color:#000000">0</span><span style="color:#000000">);<br></span><span style="color:#008080"> 95</span> <span style="color:#000000"><br></span><span style="color:#008080"> 96</span> <span style="color:#000000">            </span><span style="color:#0000ff">for</span><span style="color:#000000"> (</span><span style="color:#0000ff">var</span><span style="color:#000000"> j </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#000000">0</span><span style="color:#000000">, l </span><span style="color:#000000">=</span><span style="color:#000000"> handlers.length; j </span><span style="color:#000000">&lt;</span><span style="color:#000000"> l; j</span><span style="color:#000000">++</span><span style="color:#000000">) {<br></span><span style="color:#008080"> 97</span> <span style="color:#000000">                </span><span style="color:#0000ff">var</span><span style="color:#000000"> handleObj </span><span style="color:#000000">=</span><span style="color:#000000"> handlers[j];<br></span><span style="color:#008080"> 98</span> <span style="color:#000000"><br></span><span style="color:#008080"> 99</span> <span style="color:#000000"><br></span><span style="color:#008080">100</span> <span style="color:#000000">                </span><span style="color:#008000">//</span><span style="color:#008000"> 取得注册事件时保存的参数</span><span style="color:#008000"><br></span><span style="color:#008080">101</span> <span style="color:#008000"></span><span style="color:#000000">                event.handler </span><span style="color:#000000">=</span><span style="color:#000000"> handleObj.handler;<br></span><span style="color:#008080">102</span> <span style="color:#000000">                event.data </span><span style="color:#000000">=</span><span style="color:#000000"> handleObj.data;<br></span><span style="color:#008080">103</span> <span style="color:#000000">                event.handleObj </span><span style="color:#000000">=</span><span style="color:#000000"> handleObj;<br></span><span style="color:#008080">104</span> <span style="color:#000000"><br></span><span style="color:#008080">105</span> <span style="color:#000000">                </span><span style="color:#0000ff">var</span><span style="color:#000000"> ret </span><span style="color:#000000">=</span><span style="color:#000000"> handleObj.handler.apply(</span><span style="color:#0000ff">this</span><span style="color:#000000">, arguments);<br></span><span style="color:#008080">106</span> <span style="color:#000000">            }<br></span><span style="color:#008080">107</span> <span style="color:#000000">        }<br></span><span style="color:#008080">108</span> <span style="color:#000000"><br></span><span style="color:#008080">109</span> <span style="color:#000000">        </span><span style="color:#0000ff">return</span><span style="color:#000000"> event.result;<br></span><span style="color:#008080">110</span> <span style="color:#000000">    },<br></span><span style="color:#008080">111</span> <span style="color:#000000"><br></span><span style="color:#008080">112</span> <span style="color:#000000">    </span><span style="color:#008000">//</span><span style="color:#008000"> #2020</span><span style="color:#008000"><br></span><span style="color:#008080">113</span> <span style="color:#008000"></span><span style="color:#000000">    special: {}<br></span><span style="color:#008080">114</span> <span style="color:#000000"><br></span><span style="color:#008080">115</span> <span style="color:#000000">}<br></span><span style="color:#008080">116</span> <span style="color:#000000"><br></span><span style="color:#008080">117</span> <span style="color:#000000"></span><span style="color:#008000">//</span><span style="color:#008000"> bind 函数定义</span><span style="color:#008000"><br></span><span style="color:#008080">118</span> <span style="color:#008000"></span><span style="color:#000000">jQuery.fn.bind </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">function</span><span style="color:#000000">( type, fn)<br></span><span style="color:#008080">119</span> <span style="color:#000000">{<br></span><span style="color:#008080">120</span> <span style="color:#000000">    </span><span style="color:#0000ff">var</span><span style="color:#000000"> handler </span><span style="color:#000000">=</span><span style="color:#000000"> fn;<br></span><span style="color:#008080">121</span> <span style="color:#000000"><br></span><span style="color:#008080">122</span> <span style="color:#000000">    </span><span style="color:#008000">//</span><span style="color:#008000"> 调用 jQuery.event.add 添加事件</span><span style="color:#008000"><br></span><span style="color:#008080">123</span> <span style="color:#008000"></span><span style="color:#000000">    </span><span style="color:#0000ff">for</span><span style="color:#000000"> (</span><span style="color:#0000ff">var</span><span style="color:#000000"> i </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#000000">0</span><span style="color:#000000">, l </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">this</span><span style="color:#000000">.length; i </span><span style="color:#000000">&lt;</span><span style="color:#000000"> l; i</span><span style="color:#000000">++</span><span style="color:#000000">) {<br></span><span style="color:#008080">124</span> <span style="color:#000000">            jQuery.event.add(</span><span style="color:#0000ff">this</span><span style="color:#000000">[i], type, handler);<br></span><span style="color:#008080">125</span> <span style="color:#000000">        }<br></span><span style="color:#008080">126</span> <span style="color:#000000">    </span><span style="color:#0000ff">return</span><span style="color:#000000"> </span><span style="color:#0000ff">this</span><span style="color:#000000">;<br></span><span style="color:#008080">127</span> <span style="color:#000000">}<br></span><span style="color:#008080">128</span> <span style="color:#000000"><br></span><span style="color:#008080">129</span> <span style="color:#000000">jQuery.fn.unbind </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">function</span><span style="color:#000000"> (type, fn) {<br></span><span style="color:#008080">130</span> <span style="color:#000000">    </span><span style="color:#008000">//</span><span style="color:#008000"> Handle object literals</span><span style="color:#008000"><br></span><span style="color:#008080">131</span> <span style="color:#008000"></span><span style="color:#000000">    </span><span style="color:#0000ff">if</span><span style="color:#000000"> (</span><span style="color:#0000ff">typeof</span><span style="color:#000000"> type </span><span style="color:#000000">===</span><span style="color:#000000"> </span><span style="color:#000000">"</span><span style="color:#000000">object</span><span style="color:#000000">"</span><span style="color:#000000"> </span><span style="color:#000000">&amp;&amp;</span><span style="color:#000000"> </span><span style="color:#000000">!</span><span style="color:#000000">type.preventDefault) {<br></span><span style="color:#008080">132</span> <span style="color:#000000">        </span><span style="color:#0000ff">for</span><span style="color:#000000"> (</span><span style="color:#0000ff">var</span><span style="color:#000000"> key </span><span style="color:#0000ff">in</span><span style="color:#000000"> type) {<br></span><span style="color:#008080">133</span> <span style="color:#000000">            </span><span style="color:#0000ff">this</span><span style="color:#000000">.unbind(key, type[key]);<br></span><span style="color:#008080">134</span> <span style="color:#000000">        }<br></span><span style="color:#008080">135</span> <span style="color:#000000"><br></span><span style="color:#008080">136</span> <span style="color:#000000">    } </span><span style="color:#0000ff">else</span><span style="color:#000000"> {<br></span><span style="color:#008080">137</span> <span style="color:#000000">        </span><span style="color:#0000ff">for</span><span style="color:#000000"> (</span><span style="color:#0000ff">var</span><span style="color:#000000"> i </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#000000">0</span><span style="color:#000000">, l </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">this</span><span style="color:#000000">.length; i </span><span style="color:#000000">&lt;</span><span style="color:#000000"> l; i</span><span style="color:#000000">++</span><span style="color:#000000">) {<br></span><span style="color:#008080">138</span> <span style="color:#000000">            jQuery.event.remove(</span><span style="color:#0000ff">this</span><span style="color:#000000">[i], type, fn);<br></span><span style="color:#008080">139</span> <span style="color:#000000">        }<br></span><span style="color:#008080">140</span> <span style="color:#000000">    }<br></span><span style="color:#008080">141</span> <span style="color:#000000"><br></span><span style="color:#008080">142</span> <span style="color:#000000">    </span><span style="color:#0000ff">return</span><span style="color:#000000"> </span><span style="color:#0000ff">this</span><span style="color:#000000">;<br></span><span style="color:#008080">143</span> <span style="color:#000000">}<br></span><span style="color:#008080">144</span> // click 事件的注册方法<span style="color:#000000"><br></span><span style="color:#008080">145</span> <span style="color:#000000">jQuery.fn.click </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">function</span><span style="color:#000000"> (fn) {<br></span><span style="color:#008080">146</span> <span style="color:#000000">    </span><span style="color:#0000ff">this</span><span style="color:#000000">.bind(</span><span style="color:#000000">"</span><span style="color:#000000">click</span><span style="color:#000000">"</span><span style="color:#000000">, fn);<br></span><span style="color:#008080">147</span> <span style="color:#000000">    </span><span style="color:#0000ff">return</span><span style="color:#000000"> </span><span style="color:#0000ff">this</span><span style="color:#000000">;<br></span><span style="color:#008080">148</span> <span style="color:#000000">}</span></div></div>


<p> </p>


<p> </p>


<p>这样，对于页面上的 id 为 msg 的元素，就可以通过下面的代码注册一个 click 事件处理函数。</p>


<p> </p>


<div>
<div><span style="color:#008080">1</span> <span style="color:#008000">//</span><span style="color:#008000"> 事件操作</span><span style="color:#008000"><br></span><span style="color:#008080">2</span> <span style="color:#008000"></span><span style="color:#000000">$(</span><span style="color:#000000">"</span><span style="color:#000000">#msg</span><span style="color:#000000">"</span><span style="color:#000000">).click(<br></span><span style="color:#008080">3</span> <span style="color:#000000">    </span><span style="color:#0000ff">function</span><span style="color:#000000"> () {<br></span><span style="color:#008080">4</span> <span style="color:#000000">        alert(</span><span style="color:#0000ff">this</span><span style="color:#000000">.innerHTML);<br></span><span style="color:#008080">5</span> <span style="color:#000000">    }<br></span><span style="color:#008080">6</span> <span style="color:#000000">    );</span></div></div>


<p> </p>


<p> </p>


<p><img src="http://www.cnblogs.com/haogj/aggbug/1789759.html?type=1" width="1" height="1" alt=""><p>评论: 1　<a href="http://www.cnblogs.com/haogj/archive/2010/08/02/1789759.html#pagedcomment">查看评论</a>　<a href="http://www.cnblogs.com/haogj/archive/2010/08/02/1789759.html#commentform">发表评论</a></p><p><a href="http://job.cnblogs.com/">程序员找工作，就在博客园</a></p><hr><p>最新新闻：<br>· <a href="http://news.cnblogs.com/n/69927/">过气明星有人爱 英国政府坚守IE6</a><span style="color:gray">(2010-08-03 14:44)</span><br>· <a href="http://news.cnblogs.com/n/69926/">RIM发声明称黑莓数据绝对安全</a><span style="color:gray">(2010-08-03 14:44)</span><br>· <a href="http://news.cnblogs.com/n/69925/">于扬侃网</a><span style="color:gray">(2010-08-03 14:22)</span><br>· <a href="http://news.cnblogs.com/n/69924/">Facebook称：“我们手上有Google的社交产品策略文档”</a><span style="color:gray">(2010-08-03 14:13)</span><br>· <a href="http://news.cnblogs.com/n/69923/">美黑客组织公开扩招</a><span style="color:gray">(2010-08-03 14:09)</span><br></p><p>编辑推荐：<a href="http://news.cnblogs.com/n/69894/">8月编程语言排行榜：微软锋利的刀C#</a><br></p><p>网站导航：<a href="http://www.cnblogs.com">博客园首页</a>  <a href="http://home.cnblogs.com/">个人主页</a>  <a href="http://news.cnblogs.com">新闻</a>  <a href="http://home.cnblogs.com/ing/">闪存</a>  <a href="http://home.cnblogs.com/group/">小组</a>  <a href="http://space.cnblogs.com/q/">博问</a>  <a href="http://space.cnblogs.com">社区</a>  <a href="http://kb.cnblogs.com">知识库</a></p></p>

</div>


            <div class="footer">
              <div class="contact">
                <p>
                  Your Name<br />
                  What You Are<br />
                  your@email.com
                </p>
              </div>
              <div class="contact">
                <p>
                  <a href="http://github.com/lyuehh/">github.com/lyuehh</a><br />
                  <a href="http://twitter.com/lyuehh/">twitter.com/lyuehh</a><br />
                </p>
              </div>
            </div>
          </div>
        </div> <!-- /container -->

    </body>
</html>
