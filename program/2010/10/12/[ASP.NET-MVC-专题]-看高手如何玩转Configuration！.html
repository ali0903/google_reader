<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>[ASP.NET MVC 专题] 看高手如何玩转Configuration！</title>
        <meta name="viewport" content="width=device-width">

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/google_reader/css/syntax.css">

        <!-- Custom CSS -->
        <link rel="stylesheet" href="/google_reader/css/main.css">

    </head>
    <body>

        <div class="container">
          <div class="site">
            <div class="header">
              <h1 class="title"><a href="/google_reader/">Google Reader</a></h1>
              <a class="extra" href="/google_reader/">home</a>
            </div>

                <h2>[ASP.NET MVC 专题] 看高手如何玩转Configuration！</h2>
<p class="meta">2010-10-12 00:05</p>

<div class="post">
<h2>[ASP.NET MVC 专题] 看高手如何玩转Configuration！</h2>

<h3>by JasenKin</h3>

<h3>at 2010-10-11 16:05:00</h3>

<h3>original <a href="http://www.cnblogs.com/jasenkin/archive/2010/10/11/asp_net_mvc_configuration.html">http://www.cnblogs.com/jasenkin/archive/2010/10/11/asp_net_mvc_configuration.html</a></h3>

<p><a href="http://www.cnblogs.com/jasenkin/"><img src="http://pic.cnblogs.com/face/u102079.jpg" alt="" border="0"></a><br>作者: <a href="http://www.cnblogs.com/jasenkin/">JasenKin</a> 发表于 2010-10-11 16:05 <a href="http://www.cnblogs.com/jasenkin/archive/2010/10/11/asp_net_mvc_configuration.html">原文链接</a> 阅读: 2542 评论: 43</p>


<p><strong style="font-size:14pt">背景</strong></p>


<p>大家对配置文件都是非常的熟悉，至于怎么个玩法就各有千秋。本人偶然在一个开源项目中看到牛人写的代码，其中就有关于配置文件的操作的方面。惊叹于代码的艺术的时候，更多的是感叹，唉！高手真多，本人什么时候才能达到这个水平，一步一步来，说不定，3，5几年后哥也成了高手了，哈哈。低调，一定要低调！</p>


<p> </p>


<p><strong style="font-size:14pt">Configuration自定义操作基础</strong></p>


<p>先来看本人总结出来的比较肤浅的代码，熟悉下基本操作，然后在看牛人在ASP.NET MVC中如何玩转Configuration。如下图所示，我们先仅仅拿几个类和比较简单的配置文件（下图标红色框的）入手：</p>


<p><img border="0" alt="" src="http://images.cnblogs.com/cnblogs_com/jasenkin/configuration01.jpg" width="801" height="552"></p>


<p> </p>


<p>Web.config如下：</p>


<div>
<div><span style="color:#008080"> 1</span> <span style="color:#000000">&lt;?</span><span style="color:#000000">xml version</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">1.0</span><span style="color:#800000">"</span><span style="color:#000000">?&gt;</span><span style="color:#000000"><br></span><span style="color:#008080"> 2</span> <span style="color:#000000"></span><span style="color:#000000">&lt;</span><span style="color:#000000">configuration</span><span style="color:#000000">&gt;</span><span style="color:#000000"><br></span><span style="color:#008080"> 3</span> <span style="color:#000000">    </span><span style="color:#000000">&lt;</span><span style="color:#000000">configSections</span><span style="color:#000000">&gt;</span><span style="color:#000000"><br></span><span style="color:#008080"> 4</span> <span style="color:#000000">        </span><span style="color:#000000">&lt;</span><span style="color:#000000">section name</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">demoConfiguration</span><span style="color:#800000">"</span><span style="color:#000000"> type</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">Core.Configuration.Operation.DemoConfigurationSection,Core.Configuration</span><span style="color:#800000">"</span><span style="color:#000000">/&gt;</span><span style="color:#000000"><br></span><span style="color:#008080"> 5</span> <span style="color:#000000">    </span><span style="color:#000000">&lt;/</span><span style="color:#000000">configSections</span><span style="color:#000000">&gt;</span><span style="color:#000000"><br></span><span style="color:#008080"> 6</span> <span style="color:#000000">    </span><span style="color:#000000">&lt;</span><span style="color:#000000">demoConfiguration configSource</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">config\demo.config</span><span style="color:#800000">"</span><span style="color:#000000">/&gt;</span><span style="color:#000000"><br></span><span style="color:#008080"> 7</span> <span style="color:#000000">    </span><span style="color:#000000">&lt;</span><span style="color:#000000">system.web</span><span style="color:#000000">&gt;</span><span style="color:#000000"><br></span><span style="color:#008080"> 8</span> <span style="color:#000000">        </span><span style="color:#000000">&lt;</span><span style="color:#000000">compilation debug</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">true</span><span style="color:#800000">"</span><span style="color:#000000"> targetFramework</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">4.0</span><span style="color:#800000">"</span><span style="color:#000000">/&gt;</span><span style="color:#000000"><br></span><span style="color:#008080"> 9</span> <span style="color:#000000">    </span><span style="color:#000000">&lt;/</span><span style="color:#000000">system.web</span><span style="color:#000000">&gt;</span><span style="color:#000000"><br></span><span style="color:#008080">10</span> <span style="color:#000000"></span><span style="color:#000000">&lt;/</span><span style="color:#000000">configuration</span><span style="color:#000000">&gt;</span></div></div>


<p> </p>


<p>从上面我们看出，增加了一个ConfigurationSection部分，类名为<span style="color:#800000">Core.Configuration.Operation.DemoConfigurationSection</span>，程序集为<font color="#800000">Core.Configuration</font>。<span style="color:#000000">&lt;</span><span style="color:#000000">demoConfiguration configSource</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">config\demo.config</span><span style="color:#800000">"</span><span style="color:#000000">/&gt;中configSource标识了我们的这部分配置内容在<span style="color:#800000">config\demo.config的文件中。</span></span><span style="color:#000000"><br></span></p>


<p>demo.config如下：</p>


<div>
<div><span style="color:#008080">1</span> <span style="color:#000000">&lt;?</span><span style="color:#000000">xml version</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">1.0</span><span style="color:#800000">"</span><span style="color:#000000">?&gt;</span><span style="color:#000000"><br></span><span style="color:#008080">2</span> <span style="color:#000000"></span><span style="color:#000000">&lt;</span><span style="color:#000000">demoConfiguration value</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">123</span><span style="color:#800000">"</span><span style="color:#000000">&gt;</span><span style="color:#000000"><br></span><span style="color:#008080">3</span> <span style="color:#000000">  </span><span style="color:#000000">&lt;</span><span style="color:#000000">items  </span><span style="color:#0000ff">default</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">default</span><span style="color:#800000">"</span><span style="color:#000000"> enable</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">false</span><span style="color:#800000">"</span><span style="color:#000000">&gt;</span><span style="color:#000000"><br></span><span style="color:#008080">4</span> <span style="color:#000000">    </span><span style="color:#000000">&lt;</span><span style="color:#000000">add  url</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">www.google.com</span><span style="color:#800000">"</span><span style="color:#000000">  name</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">jasen</span><span style="color:#800000">"</span><span style="color:#000000">&gt;&lt;/</span><span style="color:#000000">add</span><span style="color:#000000">&gt;</span><span style="color:#000000"><br></span><span style="color:#008080">5</span> <span style="color:#000000">    </span><span style="color:#000000">&lt;</span><span style="color:#000000">add  url</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">www.google2.com</span><span style="color:#800000">"</span><span style="color:#000000">  name</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">jasen2</span><span style="color:#800000">"</span><span style="color:#000000">&gt;&lt;/</span><span style="color:#000000">add</span><span style="color:#000000">&gt;</span><span style="color:#000000"><br></span><span style="color:#008080">6</span> <span style="color:#000000">    </span><span style="color:#000000">&lt;</span><span style="color:#000000">add  url</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">www.google3.com</span><span style="color:#800000">"</span><span style="color:#000000">  name</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">jasen3</span><span style="color:#800000">"</span><span style="color:#000000">&gt;&lt;/</span><span style="color:#000000">add</span><span style="color:#000000">&gt;</span><span style="color:#000000"><br></span><span style="color:#008080">7</span> <span style="color:#000000">  </span><span style="color:#000000">&lt;/</span><span style="color:#000000">items</span><span style="color:#000000">&gt;</span><span style="color:#000000"><br></span><span style="color:#008080">8</span> <span style="color:#000000"></span><span style="color:#000000">&lt;/</span><span style="color:#000000">demoConfiguration</span><span style="color:#000000">&gt;</span></div></div>


<p> </p>


<p> </p>


<p>现在，我们增加的configurationSection这部分如何在代码中运用？</p>


<div>
<div><span style="color:#000000">  Core.Configuration.Operation.DemoConfigurationSection section </span><span style="color:#000000">=</span><span style="color:#000000"> (Core.Configuration.Operation.DemoConfigurationSection)System.Configuration.ConfigurationManager.GetSection(</span><span style="color:#800000">"</span><span style="color:#800000">demoConfiguration</span><span style="color:#800000">"</span><span style="color:#000000">);<br>              </span></div></div>


<p> </p>


<p>         //     检索当前应用程序默认配置的指定配置节。<br>        //     参数: sectionName:                 配置节的路径和名称。<br>        //     返回结果:              指定的 System.Configuration.ConfigurationSection 对象，或者，如果该节不存在，则为 null。<br>        public static object System.Configuration.ConfigurationSection.GetSection(string sectionName); <span style="color:#000000">显然返回的是一个object对象，我们接下来需要做的就是该</span><span style="color:red">如何定义我们的这部分相关类。</span></p>


<p><span style="color:#000000"></span> </p>


<p><span style="color:#000000">先看下<strong>ConfigurationSection</strong></span><span style="color:#000000"></span></p>


<div>
<div><span style="color:#008080"> 1</span> <span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">class</span><span style="color:#000000"> DemoConfigurationSection : ConfigurationSection<br></span><span style="color:#008080"> 2</span> <span style="color:#000000">    {<br></span><span style="color:#008080"> 3</span> <span style="color:#000000">        </span><span style="color:#0000ff">public</span><span style="color:#000000"> DemoConfigurationSection()<br></span><span style="color:#008080"> 4</span> <span style="color:#000000">        {<br></span><span style="color:#008080"> 5</span> <span style="color:#000000">        }<br></span><span style="color:#008080"> 6</span> <span style="color:#000000"><br></span><span style="color:#008080"> 7</span> <span style="color:#000000">        [ConfigurationProperty(</span><span style="color:#800000">"</span><span style="color:#800000">items</span><span style="color:#800000">"</span><span style="color:#000000">, IsRequired </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">false</span><span style="color:#000000">)]<br></span><span style="color:#008080"> 8</span> <span style="color:#000000">        </span><span style="color:#0000ff">public</span><span style="color:#000000"> ItemCollection Items     <br></span><span style="color:#008080"> 9</span> <span style="color:#000000">        {<br></span><span style="color:#008080">10</span> <span style="color:#000000">            </span><span style="color:#0000ff">get</span><span style="color:#000000"> { </span><span style="color:#0000ff">return</span><span style="color:#000000"> (ItemCollection)(</span><span style="color:#0000ff">this</span><span style="color:#000000">[</span><span style="color:#800000">"</span><span style="color:#800000">items</span><span style="color:#800000">"</span><span style="color:#000000">]); }<br></span><span style="color:#008080">11</span> <span style="color:#000000">            </span><span style="color:#0000ff">set</span><span style="color:#000000"> { </span><span style="color:#0000ff">this</span><span style="color:#000000">[</span><span style="color:#800000">"</span><span style="color:#800000">items</span><span style="color:#800000">"</span><span style="color:#000000">] </span><span style="color:#000000">=</span><span style="color:#000000"> value; }<br></span><span style="color:#008080">12</span> <span style="color:#000000">        }<br></span><span style="color:#008080">13</span> <span style="color:#000000"><br></span><span style="color:#008080">14</span> <span style="color:#000000">        [ConfigurationProperty(</span><span style="color:#800000">"</span><span style="color:#800000">value</span><span style="color:#800000">"</span><span style="color:#000000">, IsRequired </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">false</span><span style="color:#000000">)]<br></span><span style="color:#008080">15</span> <span style="color:#000000">        </span><span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">string</span><span style="color:#000000"> Value<br></span><span style="color:#008080">16</span> <span style="color:#000000">        {<br></span><span style="color:#008080">17</span> <span style="color:#000000">            </span><span style="color:#0000ff">get</span><span style="color:#000000"> { </span><span style="color:#0000ff">return</span><span style="color:#000000"> </span><span style="color:#0000ff">this</span><span style="color:#000000">[</span><span style="color:#800000">"</span><span style="color:#800000">value</span><span style="color:#800000">"</span><span style="color:#000000">].ToString(); }<br></span><span style="color:#008080">18</span> <span style="color:#000000">            </span><span style="color:#0000ff">set</span><span style="color:#000000"> { </span><span style="color:#0000ff">this</span><span style="color:#000000">[</span><span style="color:#800000">"</span><span style="color:#800000">value</span><span style="color:#800000">"</span><span style="color:#000000">] </span><span style="color:#000000">=</span><span style="color:#000000"> value; }<br></span><span style="color:#008080">19</span> <span style="color:#000000">        }<br></span><span style="color:#008080">20</span> <span style="color:#000000">    }</span></div></div>


<p> </p>


<p> </p>


<p><strong>ConfigurationElementCollection</strong></p>


<div>
<div><span style="color:#008080"> 1</span> <span style="color:#000000"> </span><span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">class</span><span style="color:#000000"> ItemCollection:ConfigurationElementCollection <br></span><span style="color:#008080"> 2</span> <span style="color:#000000">    {<br></span><span style="color:#008080"> 3</span> <span style="color:#000000">        </span><span style="color:#0000ff">public</span><span style="color:#000000"> Item </span><span style="color:#0000ff">this</span><span style="color:#000000">[</span><span style="color:#0000ff">int</span><span style="color:#000000"> index]<br></span><span style="color:#008080"> 4</span> <span style="color:#000000">        {<br></span><span style="color:#008080"> 5</span> <span style="color:#000000">            </span><span style="color:#0000ff">get</span><span style="color:#000000"><br></span><span style="color:#008080"> 6</span> <span style="color:#000000">            {<br></span><span style="color:#008080"> 7</span> <span style="color:#000000">                </span><span style="color:#0000ff">return</span><span style="color:#000000"> </span><span style="color:#0000ff">base</span><span style="color:#000000">.BaseGet(index) </span><span style="color:#0000ff">as</span><span style="color:#000000"> Item;<br></span><span style="color:#008080"> 8</span> <span style="color:#000000">            }<br></span><span style="color:#008080"> 9</span> <span style="color:#000000">            </span><span style="color:#0000ff">set</span><span style="color:#000000"><br></span><span style="color:#008080">10</span> <span style="color:#000000">            {<br></span><span style="color:#008080">11</span> <span style="color:#000000">                </span><span style="color:#0000ff">if</span><span style="color:#000000"> (</span><span style="color:#0000ff">base</span><span style="color:#000000">.BaseGet(index) </span><span style="color:#000000">!=</span><span style="color:#000000"> </span><span style="color:#0000ff">null</span><span style="color:#000000">)<br></span><span style="color:#008080">12</span> <span style="color:#000000">                {<br></span><span style="color:#008080">13</span> <span style="color:#000000">                    </span><span style="color:#0000ff">base</span><span style="color:#000000">.BaseRemoveAt(index);<br></span><span style="color:#008080">14</span> <span style="color:#000000">                }</span><span style="color:#000000"><br></span><span style="color:#008080">16</span> <span style="color:#000000">                </span><span style="color:#0000ff">this</span><span style="color:#000000">.BaseAdd(index, value);<br></span><span style="color:#008080">17</span> <span style="color:#000000">            }<br></span><span style="color:#008080">18</span> <span style="color:#000000">        }<br></span><span style="color:#008080">19</span> <span style="color:#000000"><br></span><span style="color:#008080">20</span> <span style="color:#000000">        </span><span style="color:#0000ff">protected</span><span style="color:#000000"> </span><span style="color:#0000ff">override</span><span style="color:#000000"> ConfigurationElement CreateNewElement()<br></span><span style="color:#008080">21</span> <span style="color:#000000">        {<br></span><span style="color:#008080">22</span> <span style="color:#000000">            </span><span style="color:#0000ff">return</span><span style="color:#000000"> </span><span style="color:#0000ff">new</span><span style="color:#000000"> Item();<br></span><span style="color:#008080">23</span> <span style="color:#000000">        }<br></span><span style="color:#008080">24</span> <span style="color:#000000"><br></span><span style="color:#008080">25</span> <span style="color:#000000">        </span><span style="color:#0000ff">protected</span><span style="color:#000000"> </span><span style="color:#0000ff">override</span><span style="color:#000000"> </span><span style="color:#0000ff">object</span><span style="color:#000000"> GetElementKey(ConfigurationElement element)<br></span><span style="color:#008080">26</span> <span style="color:#000000">        {<br></span><span style="color:#008080">27</span> <span style="color:#000000">            </span><span style="color:#0000ff">return</span><span style="color:#000000"> ((Item)element).Name;<br></span><span style="color:#008080">28</span> <span style="color:#000000">        }<br></span><span style="color:#008080">29</span> <span style="color:#000000"><br></span><span style="color:#008080">30</span> <span style="color:#000000">        [ConfigurationProperty(</span><span style="color:#800000">"</span><span style="color:#800000">default</span><span style="color:#800000">"</span><span style="color:#000000">, IsRequired </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">true</span><span style="color:#000000">)]<br></span><span style="color:#008080">31</span> <span style="color:#000000">        </span><span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">string</span><span style="color:#000000"> Default<br></span><span style="color:#008080">32</span> <span style="color:#000000">        {<br></span><span style="color:#008080">33</span> <span style="color:#000000">            </span><span style="color:#0000ff">get</span><span style="color:#000000"> { </span><span style="color:#0000ff">return</span><span style="color:#000000"> Convert.ToString(</span><span style="color:#0000ff">this</span><span style="color:#000000">[</span><span style="color:#800000">"</span><span style="color:#800000">default</span><span style="color:#800000">"</span><span style="color:#000000">]); }<br></span><span style="color:#008080">34</span> <span style="color:#000000">            </span><span style="color:#0000ff">set</span><span style="color:#000000"> { </span><span style="color:#0000ff">this</span><span style="color:#000000">[</span><span style="color:#800000">"</span><span style="color:#800000">default</span><span style="color:#800000">"</span><span style="color:#000000">] </span><span style="color:#000000">=</span><span style="color:#000000"> value; }<br></span><span style="color:#008080">35</span> <span style="color:#000000">        }<br></span><span style="color:#008080">36</span> <span style="color:#000000"><br></span><span style="color:#008080">37</span> <span style="color:#000000">        [ConfigurationProperty(</span><span style="color:#800000">"</span><span style="color:#800000">enable</span><span style="color:#800000">"</span><span style="color:#000000">, IsRequired </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">true</span><span style="color:#000000">, DefaultValue </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">true</span><span style="color:#000000">)]<br></span><span style="color:#008080">38</span> <span style="color:#000000">        </span><span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">bool</span><span style="color:#000000"> Enable<br></span><span style="color:#008080">39</span> <span style="color:#000000">        {<br></span><span style="color:#008080">40</span> <span style="color:#000000">            </span><span style="color:#0000ff">get</span><span style="color:#000000"> { </span><span style="color:#0000ff">return</span><span style="color:#000000"> Boolean.Parse(</span><span style="color:#0000ff">this</span><span style="color:#000000">[</span><span style="color:#800000">"</span><span style="color:#800000">enable</span><span style="color:#800000">"</span><span style="color:#000000">].ToString()); }<br></span><span style="color:#008080">41</span> <span style="color:#000000">            </span><span style="color:#0000ff">set</span><span style="color:#000000"> { </span><span style="color:#0000ff">this</span><span style="color:#000000">[</span><span style="color:#800000">"</span><span style="color:#800000">enable</span><span style="color:#800000">"</span><span style="color:#000000">] </span><span style="color:#000000">=</span><span style="color:#000000"> value; }<br></span><span style="color:#008080">42</span> <span style="color:#000000">        }</span><span style="color:#000000"><br></span><span style="color:#008080">43</span> <span style="color:#000000">    }</span></div></div>


<p> </p>


<p>集合中提供对ConfigurationElement的索引（base.BaseGet()与base.BaseAdd()）,重写了父类的CreateNewElement()，GetElementKey(ConfigurationElement element)方法。<br></p>


<p><strong>ConfigurationElement</strong></p>


<div>
<div><span style="color:#008080"> 1</span> <span style="color:#000000"> </span><span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">class</span><span style="color:#000000"> Item:ConfigurationElement<br></span><span style="color:#008080"> 2</span> <span style="color:#000000">    {<br></span><span style="color:#008080"> 3</span> <span style="color:#000000">        [ConfigurationProperty(</span><span style="color:#800000">"</span><span style="color:#800000">name</span><span style="color:#800000">"</span><span style="color:#000000">, IsRequired </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">true</span><span style="color:#000000">, IsKey </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">true</span><span style="color:#000000">)]<br></span><span style="color:#008080"> 4</span> <span style="color:#000000">        </span><span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">string</span><span style="color:#000000"> Name<br></span><span style="color:#008080"> 5</span> <span style="color:#000000">        {<br></span><span style="color:#008080"> 6</span> <span style="color:#000000">            </span><span style="color:#0000ff">get</span><span style="color:#000000"> { </span><span style="color:#0000ff">return</span><span style="color:#000000"> </span><span style="color:#0000ff">this</span><span style="color:#000000">[</span><span style="color:#800000">"</span><span style="color:#800000">name</span><span style="color:#800000">"</span><span style="color:#000000">].ToString(); }<br></span><span style="color:#008080"> 7</span> <span style="color:#000000">            </span><span style="color:#0000ff">set</span><span style="color:#000000"> { </span><span style="color:#0000ff">this</span><span style="color:#000000">[</span><span style="color:#800000">"</span><span style="color:#800000">name</span><span style="color:#800000">"</span><span style="color:#000000">] </span><span style="color:#000000">=</span><span style="color:#000000"> value; }<br></span><span style="color:#008080"> 8</span> <span style="color:#000000">        }<br></span><span style="color:#008080"> 9</span> <span style="color:#000000"><br></span><span style="color:#008080">10</span> <span style="color:#000000">        [ConfigurationProperty(</span><span style="color:#800000">"</span><span style="color:#800000">url</span><span style="color:#800000">"</span><span style="color:#000000">, IsRequired </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">true</span><span style="color:#000000">, IsKey </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">true</span><span style="color:#000000">)]<br></span><span style="color:#008080">11</span> <span style="color:#000000">        </span><span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">string</span><span style="color:#000000"> Url<br></span><span style="color:#008080">12</span> <span style="color:#000000">        {<br></span><span style="color:#008080">13</span> <span style="color:#000000">            </span><span style="color:#0000ff">get</span><span style="color:#000000"> { </span><span style="color:#0000ff">return</span><span style="color:#000000"> </span><span style="color:#0000ff">this</span><span style="color:#000000">[</span><span style="color:#800000">"</span><span style="color:#800000">url</span><span style="color:#800000">"</span><span style="color:#000000">].ToString(); }<br></span><span style="color:#008080">14</span> <span style="color:#000000">            </span><span style="color:#0000ff">set</span><span style="color:#000000"> { </span><span style="color:#0000ff">this</span><span style="color:#000000">[</span><span style="color:#800000">"</span><span style="color:#800000">url</span><span style="color:#800000">"</span><span style="color:#000000">] </span><span style="color:#000000">=</span><span style="color:#000000"> value; }<br></span><span style="color:#008080">15</span> <span style="color:#000000">        }<br></span><span style="color:#008080">16</span> <span style="color:#000000">    }</span></div></div>


<p> </p>


<p> </p>


<p><img style="border-bottom-color:#000080;border-top-color:#000080;width:726px;height:309px;border-right-color:#000080;border-left-color:#000080" border="1" alt="" src="http://images.cnblogs.com/cnblogs_com/jasenkin/configuration02.jpg" width="726" height="309"></p>


<p> </p>


<p>从上往下看的话，整体就是一个树形结构，想必大家都很熟悉。如果我们需要扩展上述的ConfigurationSection,我们仅仅需要多增加ConfigurationEelementCollection以及ConfigurationElement类，看情况而定（可能还有其他属性什么的）。</p>


<p> </p>


<p>这样我们就可以将<span style="color:#000000">System.Configuration.ConfigurationManager.GetSection(</span><span style="color:#800000">"</span><span style="color:#800000">demoConfiguration</span><span style="color:#800000">"</span><span style="color:#000000">);强制转换成我们自定义的Core.Configuration.Operation.DemoConfigurationSection 了，进而进行你自己的编码操作。</span><span style="color:#000000">我们可以核查一下我们的操作，是否与我们开始设定的情况一致。我们编写如下方法进行检测。</span><span style="color:#000000"></span></p>


<div>
<div><span style="color:#008080"> 1</span> <span style="color:#000000">   </span><span style="color:#0000ff">private</span><span style="color:#000000"> </span><span style="color:#0000ff">void</span><span style="color:#000000"> DisplaySectionData(Core.Configuration.Operation.DemoConfigurationSection section) <br></span><span style="color:#008080"> 2</span> <span style="color:#000000">        {<br></span><span style="color:#008080"> 3</span> <span style="color:#000000">            System.Text.StringBuilder sb </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">new</span><span style="color:#000000"> System.Text.StringBuilder();<br></span><span style="color:#008080"> 4</span> <span style="color:#000000">            sb.Append(</span><span style="color:#800000">"</span><span style="color:#800000">?xml version=\</span><span style="color:#800000">"</span><span style="color:#800080">1.0</span><span style="color:#000000">\</span><span style="color:#800000">"</span><span style="color:#800000">?&lt;br/&gt;</span><span style="color:#800000">"</span><span style="color:#000000">);<br></span><span style="color:#008080"> 5</span> <span style="color:#000000">            sb.Append(</span><span style="color:#0000ff">string</span><span style="color:#000000">.Format(</span><span style="color:#800000">"</span><span style="color:#800000">demoConfiguration value=\</span><span style="color:#800000">"</span><span style="color:#000000">{</span><span style="color:#800080">0</span><span style="color:#000000">}\</span><span style="color:#800000">"</span><span style="color:#800000">&lt;br/&gt;</span><span style="color:#800000">"</span><span style="color:#000000">, section.Value));<br></span><span style="color:#008080"> 6</span> <span style="color:#000000">            sb.Append(</span><span style="color:#0000ff">string</span><span style="color:#000000">.Format(</span><span style="color:#800000">"</span><span style="color:#800000">  items  default=\</span><span style="color:#800000">"</span><span style="color:#000000">{</span><span style="color:#800080">0</span><span style="color:#000000">}\</span><span style="color:#800000">"</span><span style="color:#800000"> enable=\</span><span style="color:#800000">"</span><span style="color:#000000">{</span><span style="color:#800080">1</span><span style="color:#000000">}\</span><span style="color:#800000">"</span><span style="color:#800000">&lt;br/&gt;</span><span style="color:#800000">"</span><span style="color:#000000">, section.Items.Default, section.Items.Enable));<br></span><span style="color:#008080"> 7</span> <span style="color:#000000">            </span><span style="color:#0000ff">foreach</span><span style="color:#000000"> (Core.Configuration.Operation.Item item </span><span style="color:#0000ff">in</span><span style="color:#000000"> section.Items){<br></span><span style="color:#008080"> 8</span> <span style="color:#000000">                sb.Append(</span><span style="color:#0000ff">string</span><span style="color:#000000">.Format(</span><span style="color:#800000">"</span><span style="color:#800000">    add  url=\</span><span style="color:#800000">"</span><span style="color:#000000">{</span><span style="color:#800080">0</span><span style="color:#000000">}\</span><span style="color:#800000">"</span><span style="color:#800000">  name=\</span><span style="color:#800000">"</span><span style="color:#000000">{</span><span style="color:#800080">1</span><span style="color:#000000">}\</span><span style="color:#800000">"</span><span style="color:#800000"> /add&lt;br/&gt;</span><span style="color:#800000">"</span><span style="color:#000000">, item.Url, item.Name));<br></span><span style="color:#008080"> 9</span> <span style="color:#000000">            }<br></span><span style="color:#008080">10</span> <span style="color:#000000">            sb.Append(</span><span style="color:#800000">"</span><span style="color:#800000">   /items&lt;br/&gt;</span><span style="color:#800000">"</span><span style="color:#000000">);<br></span><span style="color:#008080">11</span> <span style="color:#000000">            sb.Append(</span><span style="color:#800000">"</span><span style="color:#800000">/demoConfiguration&lt;br/&gt;</span><span style="color:#800000">"</span><span style="color:#000000">);<br></span><span style="color:#008080">12</span> <span style="color:#000000">            <br></span><span style="color:#008080">13</span> <span style="color:#000000">            Response.Write(sb.ToString());<br></span><span style="color:#008080">14</span> <span style="color:#000000">        }</span></div></div>


<p> </p>


<p>编译下项目，显示如下：</p>


<p><img border="0" alt="" src="http://images.cnblogs.com/cnblogs_com/jasenkin/configuration03.jpg" width="407" height="235"></p>


<p> </p>


<p>是不是和我们预想的结果一样？ 肯定一样的，不需要多想。现在基础的应该大家都懂的差不多了。下面看那些高人写的，哈哈，哥也很崇拜！</p>


<p> </p>


<p><strong><font size="5">Configuration自定义操作进阶（ASP.NET MVC）</font></strong></p>


<p><img border="0" alt="" src="http://images.cnblogs.com/cnblogs_com/jasenkin/configuration04.jpg" width="324" height="552"></p>


<p>上面是本人将所有代码分离出来重新构建的（下次我需要运用的），截图中可以基本看出我们的文件和目录情况。（我们把大概的配置文件写好了，这些类什么的都不是问题，依样画葫芦就行！）</p>


<p>其中最重要的就是下面的扩展类（本人稍微重构了一下方法），如下：</p>


<div>
<div><span style="color:#000000"> </span><span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">static</span><span style="color:#000000"> </span><span style="color:#0000ff">class</span><span style="color:#000000"> RouteCollectionExtensions {<br>        </span><span style="color:#0000ff">private</span><span style="color:#000000"> </span><span style="color:#0000ff">static</span><span style="color:#000000"> </span><span style="color:#0000ff">string</span><span style="color:#000000"> defaultpage;<br>        </span><span style="color:#0000ff">private</span><span style="color:#000000"> </span><span style="color:#0000ff">static</span><span style="color:#000000"> </span><span style="color:#0000ff">string</span><span style="color:#000000"> extendName;<br>        </span><span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">static</span><span style="color:#000000"> </span><span style="color:#0000ff">string</span><span style="color:#000000"> GetDefaultPage(</span><span style="color:#0000ff">this</span><span style="color:#000000"> System.Web.Routing.RouteCollection routes) {<br>            </span><span style="color:#0000ff">return</span><span style="color:#000000"> defaultpage;<br>        }<br><br>        </span><span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">static</span><span style="color:#000000"> </span><span style="color:#0000ff">string</span><span style="color:#000000"> GetExtendName(</span><span style="color:#0000ff">this</span><span style="color:#000000"> System.Web.Routing.RouteCollection routes) {<br>            </span><span style="color:#0000ff">return</span><span style="color:#000000"> extendName;<br>        }<br>        </span><span style="color:#808080">///</span><span style="color:#008000"> </span><span style="color:#808080">&lt;summary&gt;</span><span style="color:#008000"><br>        </span><span style="color:#808080">///</span><span style="color:#008000"> 根据配置的Routing规则来加载Routing规则<br>        </span><span style="color:#808080">///</span><span style="color:#008000"> </span><span style="color:#808080">&lt;/summary&gt;</span><span style="color:#808080"><br></span><span style="color:#000000">        </span><span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">static</span><span style="color:#000000"> </span><span style="color:#0000ff">void</span><span style="color:#000000"> RegisterRoutes(</span><span style="color:#0000ff">this</span><span style="color:#000000"> System.Web.Routing.RouteCollection routes, RouteConfigurationSection section) {<br>            </span><span style="color:#0000ff">if</span><span style="color:#000000"> (</span><span style="color:#000000">!</span><span style="color:#000000">section.Short.Enable </span><span style="color:#000000">&amp;&amp;</span><span style="color:#000000"> </span><span style="color:#000000">!</span><span style="color:#000000">section.Map.Enable)  </span><span style="color:#0000ff">throw</span><span style="color:#000000"> </span><span style="color:#0000ff">new</span><span style="color:#000000"> ConfigurationErrorsException(</span><span style="color:#800000">"</span><span style="color:#800000">Short与Map必须至少有一个开启.</span><span style="color:#800000">"</span><span style="color:#000000">);<br>            extendName </span><span style="color:#000000">=</span><span style="color:#000000"> section.Extend;<br>            defaultpage </span><span style="color:#000000">=</span><span style="color:#000000"> (section.Short </span><span style="color:#000000">!=</span><span style="color:#000000"> </span><span style="color:#0000ff">null</span><span style="color:#000000"> </span><span style="color:#000000">&amp;&amp;</span><span style="color:#000000"> section.Short.Enable) </span><span style="color:#000000">?</span><span style="color:#000000"> section.Short.Default.Replace(</span><span style="color:#800000">"</span><span style="color:#800000">$0</span><span style="color:#800000">"</span><span style="color:#000000">, extendName) : section.Map.Default.Replace(</span><span style="color:#800000">"</span><span style="color:#800000">$0</span><span style="color:#800000">"</span><span style="color:#000000">, extendName);<br>            HandleIgnoreItemCollection(routes, section);<br>            HandleShortRoutingCollection(routes, section);<br>            HandleMapRoutingCollection(routes, section);<br>        }<br><br>        </span><span style="color:#0000ff">private</span><span style="color:#000000"> </span><span style="color:#0000ff">static</span><span style="color:#000000"> </span><span style="color:#0000ff">void</span><span style="color:#000000"> HandleMapRoutingCollection(System.Web.Routing.RouteCollection routes, RouteConfigurationSection section)<br>        {<br>            </span><span style="color:#008000">//</span><span style="color:#008000"> Manipluate the Routing Table</span><span style="color:#008000"><br></span><span style="color:#000000">            </span><span style="color:#0000ff">foreach</span><span style="color:#000000"> (RoutingItem routingItem </span><span style="color:#0000ff">in</span><span style="color:#000000"> section.Map)<br>            {<br>                RouteValueDictionary defaults </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">new</span><span style="color:#000000"> RouteValueDictionary();<br>                RouteValueDictionary constraints </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">new</span><span style="color:#000000"> RouteValueDictionary();<br>                </span><span style="color:#0000ff">if</span><span style="color:#000000"> (routingItem.Controller </span><span style="color:#000000">!=</span><span style="color:#000000"> </span><span style="color:#0000ff">string</span><span style="color:#000000">.Empty)<br>                    defaults.Add(</span><span style="color:#800000">"</span><span style="color:#800000">controller</span><span style="color:#800000">"</span><span style="color:#000000">, routingItem.Controller);<br>                </span><span style="color:#0000ff">if</span><span style="color:#000000"> (routingItem.Action </span><span style="color:#000000">!=</span><span style="color:#000000"> </span><span style="color:#0000ff">string</span><span style="color:#000000">.Empty)<br>                    defaults.Add(</span><span style="color:#800000">"</span><span style="color:#800000">action</span><span style="color:#800000">"</span><span style="color:#000000">, routingItem.Action);<br>                </span><span style="color:#0000ff">foreach</span><span style="color:#000000"> (Parameter param </span><span style="color:#0000ff">in</span><span style="color:#000000"> routingItem.Paramaters)<br>                {<br>                    defaults.Add(param.Name, param.Value);<br>                    </span><span style="color:#0000ff">if</span><span style="color:#000000"> (</span><span style="color:#000000">!</span><span style="color:#0000ff">string</span><span style="color:#000000">.IsNullOrEmpty(param.Constraint))<br>                    {<br>                        constraints.Add(param.Name, param.Constraint);<br>                    }<br>                }<br>                routes.MapRoute(routingItem.Name, routingItem.Url.Replace(</span><span style="color:#800000">"</span><span style="color:#800000">$0</span><span style="color:#800000">"</span><span style="color:#000000">, section.Extend), defaults, constraints);<br>            }<br>        }<br><br>        </span><span style="color:#0000ff">private</span><span style="color:#000000"> </span><span style="color:#0000ff">static</span><span style="color:#000000"> </span><span style="color:#0000ff">void</span><span style="color:#000000"> HandleShortRoutingCollection(System.Web.Routing.RouteCollection routes, RouteConfigurationSection section)<br>        {<br>            </span><span style="color:#008000">//</span><span style="color:#008000"> Maniplute the short Routing Table</span><span style="color:#008000"><br></span><span style="color:#000000">            </span><span style="color:#0000ff">if</span><span style="color:#000000"> (section.Short </span><span style="color:#000000">!=</span><span style="color:#000000"> </span><span style="color:#0000ff">null</span><span style="color:#000000"> </span><span style="color:#000000">&amp;&amp;</span><span style="color:#000000"> section.Short.Enable)<br>            {<br>                </span><span style="color:#0000ff">foreach</span><span style="color:#000000"> (RoutingItem item </span><span style="color:#0000ff">in</span><span style="color:#000000"> section.Short)<br>                {<br>                    RouteValueDictionary defaults </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">new</span><span style="color:#000000"> RouteValueDictionary();<br>                    RouteValueDictionary constraints </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">new</span><span style="color:#000000"> RouteValueDictionary();<br>                    </span><span style="color:#0000ff">if</span><span style="color:#000000"> (item.Controller </span><span style="color:#000000">!=</span><span style="color:#000000"> </span><span style="color:#0000ff">string</span><span style="color:#000000">.Empty)<br>                        defaults.Add(</span><span style="color:#800000">"</span><span style="color:#800000">controller</span><span style="color:#800000">"</span><span style="color:#000000">, item.Controller);<br>                    </span><span style="color:#0000ff">if</span><span style="color:#000000"> (item.Action </span><span style="color:#000000">!=</span><span style="color:#000000"> </span><span style="color:#0000ff">string</span><span style="color:#000000">.Empty)<br>                        defaults.Add(</span><span style="color:#800000">"</span><span style="color:#800000">action</span><span style="color:#800000">"</span><span style="color:#000000">, item.Action);<br>                    </span><span style="color:#0000ff">foreach</span><span style="color:#000000"> (Parameter param </span><span style="color:#0000ff">in</span><span style="color:#000000"> item.Paramaters)<br>                    {<br>                        defaults.Add(param.Name, param.Value);<br>                        </span><span style="color:#0000ff">if</span><span style="color:#000000"> (</span><span style="color:#000000">!</span><span style="color:#0000ff">string</span><span style="color:#000000">.IsNullOrEmpty(param.Constraint))<br>                        {<br>                            constraints.Add(param.Name, param.Constraint);<br>                        }<br>                    }<br>                    routes.MapRoute(item.Name, item.Url.Replace(</span><span style="color:#800000">"</span><span style="color:#800000">$0</span><span style="color:#800000">"</span><span style="color:#000000">, extendName), defaults, constraints);<br>                }<br>            }<br>        }<br><br>        </span><span style="color:#0000ff">private</span><span style="color:#000000"> </span><span style="color:#0000ff">static</span><span style="color:#000000"> </span><span style="color:#0000ff">void</span><span style="color:#000000"> HandleIgnoreItemCollection(System.Web.Routing.RouteCollection routes, RouteConfigurationSection section)<br>        {<br>            </span><span style="color:#008000">//</span><span style="color:#008000"> Manipulate the Ignore List</span><span style="color:#008000"><br></span><span style="color:#000000">            </span><span style="color:#0000ff">foreach</span><span style="color:#000000"> (IgnoreItem ignoreItem </span><span style="color:#0000ff">in</span><span style="color:#000000"> section.Ignore)<br>            {<br>                RouteValueDictionary ignoreConstraints </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">new</span><span style="color:#000000"> RouteValueDictionary();<br>                </span><span style="color:#0000ff">foreach</span><span style="color:#000000"> (Constraint constraint </span><span style="color:#0000ff">in</span><span style="color:#000000"> ignoreItem.Constraints)<br>                    ignoreConstraints.Add(constraint.Name, constraint.Value);<br>                routes.IgnoreRoute(ignoreItem.Url, ignoreConstraints);<br>            }<br>        }<br><br>        </span><span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">static</span><span style="color:#000000"> </span><span style="color:#0000ff">void</span><span style="color:#000000"> IgnoreRoute(</span><span style="color:#0000ff">this</span><span style="color:#000000"> RouteCollection routes, </span><span style="color:#0000ff">string</span><span style="color:#000000"> url, RouteValueDictionary constraints) {<br>            </span><span style="color:#0000ff">if</span><span style="color:#000000"> (routes </span><span style="color:#000000">==</span><span style="color:#000000"> </span><span style="color:#0000ff">null</span><span style="color:#000000">)  </span><span style="color:#0000ff">throw</span><span style="color:#000000"> </span><span style="color:#0000ff">new</span><span style="color:#000000"> ArgumentNullException(</span><span style="color:#800000">"</span><span style="color:#800000">routes</span><span style="color:#800000">"</span><span style="color:#000000">);<br>            </span><span style="color:#0000ff">if</span><span style="color:#000000"> (url </span><span style="color:#000000">==</span><span style="color:#000000"> </span><span style="color:#0000ff">null</span><span style="color:#000000">)     </span><span style="color:#0000ff">throw</span><span style="color:#000000"> </span><span style="color:#0000ff">new</span><span style="color:#000000"> ArgumentNullException(</span><span style="color:#800000">"</span><span style="color:#800000">url</span><span style="color:#800000">"</span><span style="color:#000000">);<br>            IgnoreRoute ignore </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">new</span><span style="color:#000000"> IgnoreRoute(url);<br>            ignore.Constraints </span><span style="color:#000000">=</span><span style="color:#000000"> constraints;<br>            routes.Add(ignore);<br>        }<br><br>        </span><span style="color:#808080">///</span><span style="color:#008000"> </span><span style="color:#808080">&lt;summary&gt;</span><span style="color:#008000"><br>        </span><span style="color:#808080">///</span><span style="color:#008000"> 框架的这个方法的defaults、constraints参数都是Object类型的，只好重写<br>        </span><span style="color:#808080">///</span><span style="color:#008000"> </span><span style="color:#808080">&lt;/summary&gt;</span><span style="color:#808080"><br></span><span style="color:#000000">        </span><span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">static</span><span style="color:#000000"> </span><span style="color:#0000ff">void</span><span style="color:#000000"> MapRoute( </span><span style="color:#0000ff">this</span><span style="color:#000000"> RouteCollection routes, </span><span style="color:#0000ff">string</span><span style="color:#000000"> name, </span><span style="color:#0000ff">string</span><span style="color:#000000"> url,  RouteValueDictionary defaults, RouteValueDictionary constraints) {<br>            </span><span style="color:#0000ff">if</span><span style="color:#000000"> (routes </span><span style="color:#000000">==</span><span style="color:#000000"> </span><span style="color:#0000ff">null</span><span style="color:#000000">)  </span><span style="color:#0000ff">throw</span><span style="color:#000000"> </span><span style="color:#0000ff">new</span><span style="color:#000000"> ArgumentNullException(</span><span style="color:#800000">"</span><span style="color:#800000">routes</span><span style="color:#800000">"</span><span style="color:#000000">);<br>            </span><span style="color:#0000ff">if</span><span style="color:#000000"> (url </span><span style="color:#000000">==</span><span style="color:#000000"> </span><span style="color:#0000ff">null</span><span style="color:#000000">)     </span><span style="color:#0000ff">throw</span><span style="color:#000000"> </span><span style="color:#0000ff">new</span><span style="color:#000000"> ArgumentNullException(</span><span style="color:#800000">"</span><span style="color:#800000">url</span><span style="color:#800000">"</span><span style="color:#000000">);        <br>            System.Web.Routing.Route route </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">new</span><span style="color:#000000"> System.Web.Routing.Route(url, </span><span style="color:#0000ff">new</span><span style="color:#000000"> MvcRouteHandler());<br>            route.Defaults </span><span style="color:#000000">=</span><span style="color:#000000"> defaults;<br>            route.Constraints </span><span style="color:#000000">=</span><span style="color:#000000"> constraints;<br>            routes.Add(name, route);<br>        }<br><br>        </span><span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">static</span><span style="color:#000000"> RouteConfigurationSection GetSection() {<br>            RouteConfigurationSection section </span><span style="color:#000000">=</span><span style="color:#000000"> (RouteConfigurationSection)ConfigurationManager.GetSection(</span><span style="color:#800000">"</span><span style="color:#800000">routeConfiguration</span><span style="color:#800000">"</span><span style="color:#000000">);<br>            </span><span style="color:#0000ff">return</span><span style="color:#000000"> section;<br>        }<br>    }<br><br><br>    </span><span style="color:#0000ff">sealed</span><span style="color:#000000"> </span><span style="color:#0000ff">class</span><span style="color:#000000"> IgnoreRoute : System.Web.Routing.Route {<br>        </span><span style="color:#0000ff">public</span><span style="color:#000000"> IgnoreRoute(</span><span style="color:#0000ff">string</span><span style="color:#000000"> url)<br>            : </span><span style="color:#0000ff">base</span><span style="color:#000000">(url, </span><span style="color:#0000ff">new</span><span style="color:#000000"> StopRoutingHandler()) {<br>        }<br><br>        </span><span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">override</span><span style="color:#000000"> VirtualPathData GetVirtualPath(RequestContext requestContext, RouteValueDictionary values) {<br>            </span><span style="color:#0000ff">return</span><span style="color:#000000"> </span><span style="color:#0000ff">null</span><span style="color:#000000">;<br>        }<br>    }</span></div></div>


<p> </p>


<p>上面采用了2种处理route的方案，其中包括 public class StopRoutingHandler（）这种方式的，它提供一种方式，来指定 ASP.NET 路由不应处理 URL 模式的请求。另外一种就是我们常规的操作。这些扩展方法基本都是实现RouteCollection.Add();</p>


<p>其他的相关类本人就不概述了，因为都是纯粹的机械运动。基本运用代码如下：</p>


<div>
<div><span style="color:#008080"> 1</span> <span style="color:#000000"> </span><span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">static</span><span style="color:#000000"> </span><span style="color:#0000ff">void</span><span style="color:#000000"> RegisterRoutes(RouteCollection routes)<br></span><span style="color:#008080"> 2</span> <span style="color:#000000">        {<br></span><span style="color:#008080"> 3</span> <span style="color:#000000">            </span><span style="color:#008000">//</span><span style="color:#008000">routes.IgnoreRoute("{resource}.axd/{*pathInfo}");<br></span><span style="color:#008080"> 4</span> <span style="color:#008000">            </span><span style="color:#008000">//</span><span style="color:#008000">routes.MapRoute(<br></span><span style="color:#008080"> 5</span> <span style="color:#008000">            </span><span style="color:#008000">//</span><span style="color:#008000">    &quot;Default&quot;, </span><span style="color:#008000">//</span><span style="color:#008000"> Route name<br></span><span style="color:#008080"> 6</span> <span style="color:#008000">            </span><span style="color:#008000">//</span><span style="color:#008000">    &quot;{controller}/{action}/{id}&quot;, </span><span style="color:#008000">//</span><span style="color:#008000"> URL with parameters<br></span><span style="color:#008080"> 7</span> <span style="color:#008000">            </span><span style="color:#008000">//</span><span style="color:#008000">    new { controller = &quot;Home&quot;, action = &quot;Index&quot;, id = UrlParameter.Optional } </span><span style="color:#008000">//</span><span style="color:#008000"> Parameter defaults<br></span><span style="color:#008080"> 8</span> <span style="color:#008000">            </span><span style="color:#008000">//</span><span style="color:#008000">);</span><span style="color:#008000"><br></span><span style="color:#008080"> 9</span> <span style="color:#008000"></span><span style="color:#000000">            Jasen.Core.Mvc.Route.Configuretion.RouteConfigurationSection section </span><span style="color:#000000">=</span><span style="color:#000000"><br></span><span style="color:#008080">10</span> <span style="color:#000000">               (Jasen.Core.Mvc.Route.Configuretion.RouteConfigurationSection)System.Configuration.ConfigurationManager.GetSection(</span><span style="color:#800000">"</span><span style="color:#800000">routeConfiguration</span><span style="color:#800000">"</span><span style="color:#000000">);<br></span><span style="color:#008080">11</span> <span style="color:#000000">            </span><span style="color:#0000ff">if</span><span style="color:#000000"> (section</span><span style="color:#000000">==</span><span style="color:#0000ff">null</span><span style="color:#000000">) </span><span style="color:#0000ff">throw</span><span style="color:#000000"> </span><span style="color:#0000ff">new</span><span style="color:#000000"> Exception(</span><span style="color:#800000">"</span><span style="color:#800000">还没有配置你的Route规则,请配置你的Route规则</span><span style="color:#800000">"</span><span style="color:#000000">);<br></span><span style="color:#008080">12</span> <span style="color:#000000">            RouteTable.Routes.RegisterRoutes(section);<br></span><span style="color:#008080">13</span> <span style="color:#000000">        }</span></div></div>


<p> </p>


<p><br>明显，你仅仅只要配置好你的路由文件就可以了，再也不需要在这个方法里面写好大一片的<span style="color:#008000">routes.MapRoute（）</span>代码了。</p>


<p> </p>


<p>当然，这里仅仅介绍的是ASP.NET MVC的路由映射配置文件运用，你也可以举一反三进行其他运用。本人刚开始看到开源项目的这段代码，哥知道，高手太TM的恐怖，哈哈，基础的东西被用得TM的神了。神马都是浮云！我们需要做的不是浮云，而是沉石！</p>


<p> </p>


<p>为了读者更好的了解，本人将代码进行了分离，以使各位能够更加清晰，更加清楚，更加容易地学到该种方法-------&gt;下载地址如下</p>


<p>分离的源代码下载地址：<a title="ASP.NET MVC Configuration Perfect Using下载" href="http://files.cnblogs.com/jasenkin/JASENMVC/Jasen.rar">ASP.NET MVC Configuration Perfect Using下载</a></p>


<p> </p>


<p> 后续：</p>


<p>     ASP.NET MVC  ViewEngine</p>


<p> </p>


<p>作者：<a href="http://www.cnblogs.com/jasenkin/">JasenKin</a><br>出处：<a href="http://www.cnblogs.com/jasenkin/">http://www.cnblogs.com/jasenkin/</a> <br>本文版权归作者和博客园共有，欢迎转载，但未经作者同意必须保留此段声明，且在文章页面明显位置给出原文连接，否则保留追究法律责任的权利。 </p>


<div>
<div>
快速评论通道：        </div></div>


<p><img src="http://www.cnblogs.com/jasenkin/aggbug/1848000.html?type=1" width="1" height="1" alt=""><p>评论: 43　<a href="http://www.cnblogs.com/jasenkin/archive/2010/10/11/asp_net_mvc_configuration.html#pagedcomment">查看评论</a>　<a href="http://www.cnblogs.com/jasenkin/archive/2010/10/11/asp_net_mvc_configuration.html#commentform">发表评论</a></p><p><a href="http://job.cnblogs.com/">程序员找工作，就在博客园</a></p><hr><p>最新新闻：<br>· <a href="http://news.cnblogs.com/n/77017/">马云：外资不会控制阿里巴巴 自己掌控未来</a><span style="color:gray">(2010-10-12 14:25)</span><br>· <a href="http://news.cnblogs.com/n/77016/">微软推wp7收复智能手机失地 欧洲为首批市场</a><span style="color:gray">(2010-10-12 14:18)</span><br>· <a href="http://news.cnblogs.com/n/77015/">iPhone和思维软件能否替代纸和笔？</a><span style="color:gray">(2010-10-12 14:15)</span><br>· <a href="http://news.cnblogs.com/n/77014/">Design at Facebook</a><span style="color:gray">(2010-10-12 14:13)</span><br>· <a href="http://news.cnblogs.com/n/77013/">消息称谷歌将联手日本公司铺设海底电缆</a><span style="color:gray">(2010-10-12 14:08)</span><br></p><p>编辑推荐：<a href="http://news.cnblogs.com/n/76942/">从为IBM招聘实习生中学到的经验</a><br></p><p>网站导航：<a href="http://www.cnblogs.com">博客园首页</a>  <a href="http://home.cnblogs.com/">个人主页</a>  <a href="http://news.cnblogs.com">新闻</a>  <a href="http://home.cnblogs.com/ing/">闪存</a>  <a href="http://home.cnblogs.com/group/">小组</a>  <a href="http://space.cnblogs.com/q/">博问</a>  <a href="http://space.cnblogs.com">社区</a>  <a href="http://kb.cnblogs.com">知识库</a></p></p>

</div>


            <div class="footer">
              <div class="contact">
                <p>
                  Your Name<br />
                  What You Are<br />
                  your@email.com
                </p>
              </div>
              <div class="contact">
                <p>
                  <a href="http://github.com/lyuehh/">github.com/lyuehh</a><br />
                  <a href="http://twitter.com/lyuehh/">twitter.com/lyuehh</a><br />
                </p>
              </div>
            </div>
          </div>
        </div> <!-- /container -->

    </body>
</html>
