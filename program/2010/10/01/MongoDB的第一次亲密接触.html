<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>MongoDB的第一次亲密接触</title>
        <meta name="viewport" content="width=device-width">

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/google_reader/css/syntax.css">

        <!-- Custom CSS -->
        <link rel="stylesheet" href="/google_reader/css/main.css">

    </head>
    <body>

        <div class="container">
          <div class="site">
            <div class="header">
              <h1 class="title"><a href="/google_reader/">Google Reader</a></h1>
              <a class="extra" href="/google_reader/">home</a>
            </div>

                <h2>MongoDB的第一次亲密接触</h2>
<p class="meta">2010-10-01 00:01</p>

<div class="post">
<h2>MongoDB的第一次亲密接触</h2>

<h3>by 麦子君子兰</h3>

<h3>at 2010-09-30 16:01:00</h3>

<h3>original <a href="http://www.cnblogs.com/mad/archive/2010/09/30/1839568.html">http://www.cnblogs.com/mad/archive/2010/09/30/1839568.html</a></h3>

<p><a href="http://www.cnblogs.com/mad/"><img src="http://pic.cnblogs.com/face/u11157.jpg" alt="" border="0"></a><br>作者: <a href="http://www.cnblogs.com/mad/">麦子|君子兰</a> 发表于 2010-09-30 16:01 <a href="http://www.cnblogs.com/mad/archive/2010/09/30/1839568.html">原文链接</a> 阅读: 745 评论: 1</p>


<div><br></div>


<div><span style="white-space:pre">　　</span>园子里已经有不好朋友发过MongoDB的帖子，但是都比较高端，我在这里就写下比较基础的应用，算是MongoDB的第一次接触有所了解。呵呵。我们去Mongodb.org看一看。首页赫然写着 <strong>The Best Features of Document Databases,Key-Value Stores,and RDBMSes。</strong>意思是最牛逼的文档数据库，键值对的存储并且是RDBMS（relational database management system关系型数据库管理系统）。<span style="color:#999999">下面解释说MongoDB缩小了KV存储和传统RDBMS的差距。</span></div>


<div><br></div>


<div><span style="white-space:pre"><strong>　　</strong></span><strong>Document-oriented storage</strong></div>


<div><span style="white-space:pre">　　</span>Json格式的文档存储。用过ajax的朋友都知道Json长啥样{"key","value"}</div>


<div><br></div>


<div><span style="white-space:pre"><strong>　　</strong></span><strong>Full Index Support</strong></div>


<div><span style="white-space:pre">　　</span>和数据库一样，MongoDB也支持索引。</div>


<div><span style="white-space:pre">  </span></div>


<div><span style="white-space:pre"><strong>　　</strong></span><strong>Replication &amp; High Availability</strong></div>


<div><span style="white-space:pre">　　</span>MongoDB也良好的支持多台Server之间的数据同步，保证一个挂掉还能继续干活。</div>


<div><br></div>


<div><span style="white-space:pre"><strong>　　</strong></span><strong>Auto-Sharding</strong></div>


<div><span style="white-space:pre">　　</span>自动发现Server，负载均衡，避免单点故障。</div>


<div><span style="white-space:pre">    </span></div>


<div><span style="white-space:pre"><strong>　　</strong></span><strong>Querying</strong></div>


<div><span style="white-space:pre">　　</span>丰富的基于document的查询。后面我们会举例介绍。</div>


<div><br></div>


<div><span style="white-space:pre"><strong>　　</strong></span><strong>Fast In-Place Updates</strong></div>


<div><span style="white-space:pre">　　</span>会根据不同的情况进行数据更新</div>


<div><br></div>


<div><span style="white-space:pre"><strong>　　</strong></span><strong>Map/Reduce</strong></div>


<div><span style="white-space:pre">　　</span>灵活的聚集和数据处理。</div>


<div><br></div>


<div><span style="white-space:pre"><strong>　　</strong></span><strong>GridFS</strong></div>


<div><span style="white-space:pre">　　</span>GirdFS是MongoDB的大文件存储系统，比如图片、音频、视频。</div>


<div><br></div>


<div><span style="white-space:pre">　　</span>呵呵，心动不如行动，我们可以试试他的Try It Out，进行命令行的操作。当然，这不是C#。</div>


<div><br></div>


<div><br></div>


<div><span style="white-space:pre">　　</span>下载MongoDB，自己使用版本无所谓，服务器使用如果处理大文件，就要用64bit的，因为32的只能处理&lt;2G的文件。</div>


<div><span style="white-space:pre">　　</span>关于安装，很多朋友的博文都有介绍，搜索一下就可以了，都是图文并茂的。但是有一点我要提醒下，就是关于安装成Windows 服务，是有点问题的，起码Windows 7是这样，我们首先要建立一个log.txt，然后使用 <span style="color:#ff0000">--logpath ="\"d:\mongodb\log.txt"" --install</span>来进行安装，然后<span style="color:#ff0000">去注册表把此服务的值改成 --dbpath="\"d:\mongodb\db\"" --service</span>。因为很多人的介绍不是用 --install，这样我是安装不成功的。</div>


<div><br></div>


<div>C#客户端</div>


<p>　　我们.NET自然要去使用C#来和MongoD服务进行通信，幸好有社区的好心人写了MongoDB的.NET Driver 。有三种，Mongodb-csharp、Simple-cshapr和NoRM(<a href="http://www.mongodb.org/display/DOCS/C+Sharp+Language+Center">http://www.mongodb.org/display/DOCS/C+Sharp+Language+Center</a> )。我就使用Mongodb-csharp(<a href="http://github.com/samus/mongodb-csharp">http://github.com/samus/mongodb-csharp</a>)，因为他支持Document和Linq两种方式。如果担心Linq的性能问题可以使用document。</p>


<div>　　引用Mongodb-csharp的dll，我们就可以操作MongoDB了。下面是别人写的简单的使用方法：<br><br></div>


<div><div><span style="color:#000000">var mongo </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">new</span><span style="color:#000000"> Mongo();<br>mongo.Connect();<br></span><span style="color:#008000">//</span><span style="color:#008000"> 打开myorders数据库.</span><span style="color:#008000"><br></span><span style="color:#000000">Database db </span><span style="color:#000000">=</span><span style="color:#000000"> mongo.GetDatabase( </span><span style="color:#800000">"</span><span style="color:#800000">myorders</span><span style="color:#800000">"</span><span style="color:#000000"> );<br></span><span style="color:#008000">//</span><span style="color:#008000"> 获取orders 集合.</span><span style="color:#008000"><br></span><span style="color:#000000">IMongoCollection orders </span><span style="color:#000000">=</span><span style="color:#000000"> db.GetCollection( </span><span style="color:#800000">"</span><span style="color:#800000">orders</span><span style="color:#800000">"</span><span style="color:#000000"> );<br></span><span style="color:#008000">//</span><span style="color:#008000">插入文档</span><span style="color:#008000"><br></span><span style="color:#000000">   var order </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">new</span><span style="color:#000000"> Document();<br>   order[</span><span style="color:#800000">"</span><span style="color:#800000">OrderAmount</span><span style="color:#800000">"</span><span style="color:#000000">] </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#800080">57.22</span><span style="color:#000000">;<br>   order[</span><span style="color:#800000">"</span><span style="color:#800000">CustomerName</span><span style="color:#800000">"</span><span style="color:#000000">] </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#800000">"</span><span style="color:#800000">Elmer Fudd</span><span style="color:#800000">"</span><span style="color:#000000">;<br>   </span><span style="color:#008000">//</span><span style="color:#008000"> Add the new order to the mongo orders colleciton.</span><span style="color:#008000"><br></span><span style="color:#000000">   orders.Insert( order );<br></span><span style="color:#008000">//</span><span style="color:#008000">插入多个文档<br>   </span><span style="color:#008000">//</span><span style="color:#008000"> Create new orders.</span><span style="color:#008000"><br></span><span style="color:#000000">   var order1 </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">new</span><span style="color:#000000"> Document();<br>   order1[</span><span style="color:#800000">"</span><span style="color:#800000">OrderAmount</span><span style="color:#800000">"</span><span style="color:#000000">] </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#800080">100.23</span><span style="color:#000000">;<br>   order1[</span><span style="color:#800000">"</span><span style="color:#800000">CustomerName</span><span style="color:#800000">"</span><span style="color:#000000">] </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#800000">"</span><span style="color:#800000">Bugs Bunny</span><span style="color:#800000">"</span><span style="color:#000000">;<br>   var order2 </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">new</span><span style="color:#000000"> Document();<br>   order2[</span><span style="color:#800000">"</span><span style="color:#800000">OrderAmount</span><span style="color:#800000">"</span><span style="color:#000000">] </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#800080">0.01</span><span style="color:#000000">;<br>   order2[</span><span style="color:#800000">"</span><span style="color:#800000">CustomerName</span><span style="color:#800000">"</span><span style="color:#000000">] </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#800000">"</span><span style="color:#800000">Daffy Duck</span><span style="color:#800000">"</span><span style="color:#000000">;<br>   IEnumerable</span><span style="color:#000000">&lt;</span><span style="color:#000000"> Document </span><span style="color:#000000">&gt;</span><span style="color:#000000"> orderList </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">new</span><span style="color:#000000"> List</span><span style="color:#000000">&lt;</span><span style="color:#000000"> Document </span><span style="color:#000000">&gt;</span><span style="color:#000000"> {order1, order2};<br>   </span><span style="color:#008000">//</span><span style="color:#008000"> Insert an IEnumerable.</span><span style="color:#008000"><br></span><span style="color:#000000">   orders.Insert( orderList );<br></span><span style="color:#008000">//</span><span style="color:#008000">更新</span><span style="color:#008000"><br></span><span style="color:#000000">   var selector </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">new</span><span style="color:#000000"> Document ;<br>   Document docToUpdate </span><span style="color:#000000">=</span><span style="color:#000000"> orders.FindOne( selector );<br>   Console.WriteLine( </span><span style="color:#800000">"</span><span style="color:#800000">Before Update: </span><span style="color:#800000">"</span><span style="color:#000000"> </span><span style="color:#000000">+</span><span style="color:#000000"> docToUpdate );<br>   </span><span style="color:#008000">//</span><span style="color:#008000"> I&#39;m in the money!</span><span style="color:#008000"><br></span><span style="color:#000000">   docToUpdate[</span><span style="color:#800000">"</span><span style="color:#800000">OrderAmount</span><span style="color:#800000">"</span><span style="color:#000000">] </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#800080">1000000.00</span><span style="color:#000000">;<br>   </span><span style="color:#008000">//</span><span style="color:#008000"> Update Daffy&#39;s account before Hasaan finds him.</span><span style="color:#008000"><br></span><span style="color:#000000">   orders.Update( docToUpdate );<br></span><span style="color:#008000">//</span><span style="color:#008000">查找<br>   </span><span style="color:#008000">//</span><span style="color:#008000"> Create a specification to query the orders collection.</span><span style="color:#008000"><br></span><span style="color:#000000">   var spec </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">new</span><span style="color:#000000"> Document();<br>   spec[</span><span style="color:#800000">"</span><span style="color:#800000">CustomerName</span><span style="color:#800000">"</span><span style="color:#000000">] </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#800000">"</span><span style="color:#800000">Elmer Fudd</span><span style="color:#800000">"</span><span style="color:#000000">;<br>   </span><span style="color:#008000">//</span><span style="color:#008000"> Run the query.</span><span style="color:#008000"><br></span><span style="color:#000000">   Document result </span><span style="color:#000000">=</span><span style="color:#000000"> orders.FindOne( spec )<br></span><span style="color:#008000">//</span><span style="color:#008000">linq 查找<br>   </span><span style="color:#008000">//</span><span style="color:#008000"> Query the orders collection.</span><span style="color:#008000"><br></span><span style="color:#000000">   IQueryable</span><span style="color:#000000">&lt;</span><span style="color:#000000">Document</span><span style="color:#000000">&gt;</span><span style="color:#000000"> results </span><span style="color:#000000">=</span><span style="color:#000000"><br>     from doc </span><span style="color:#0000ff">in</span><span style="color:#000000"> orders.AsQueryable()<br>     </span><span style="color:#0000ff">where</span><span style="color:#000000"> doc.Key(</span><span style="color:#800000">"</span><span style="color:#800000">CustomerName</span><span style="color:#800000">"</span><span style="color:#000000">) </span><span style="color:#000000">==</span><span style="color:#000000"> </span><span style="color:#800000">"</span><span style="color:#800000">Elmer Fudd</span><span style="color:#800000">"</span><span style="color:#000000"><br>     select doc;<br>   Document result </span><span style="color:#000000">=</span><span style="color:#000000"> results.FirstOrDefault();<br></span><span style="color:#008000">//</span><span style="color:#008000">删除<br>   </span><span style="color:#008000">//</span><span style="color:#008000"> Delete documents matching a criteria.</span><span style="color:#008000"><br></span><span style="color:#000000">   orders.Delete( </span><span style="color:#0000ff">new</span><span style="color:#000000"> Document  );<br>   Console.WriteLine( </span><span style="color:#0000ff">string</span><span style="color:#000000">.Format( </span><span style="color:#800000">"</span><span style="color:#800000">Document Count After Deleting Elmer Fudd: [ {0} ]</span><span style="color:#800000">"</span><span style="color:#000000">, orders.Count() ) );<br><br>   </span><span style="color:#008000">//</span><span style="color:#008000"> Delete all docs.</span><span style="color:#008000"><br></span><span style="color:#000000">   orders.Delete( </span><span style="color:#0000ff">new</span><span style="color:#000000"> Document() );</span></div></div>


<p>　</p>


<p>　　如果向像SqlServer那样查看数据库的数据，目前也有很多客户端支持，<span style="font-family:arial,sans-serif;line-height:20px;font-size:small">MongoVUE不错，我用过。我想大家可以试着自己写哥客户端：）</span>　 </p>


<div>　　当我们查看具体集合的时候发现一个问题 ，就是MongoDB会自动增加一个_id字段，其值长的很像Guid，默认为索引字段。如果我们要自定义这个字段的话，在设计实体类时，在“主键”字段上增加一个属性[MongoId]即可。</div>


<p>　　在设计实体类时，字段也不能用于偏僻的类型，比如XElement，在读的时候Mongodb-csharp反序列化会抛出异常，所以建议使用string来代替。如果不爱使用document，喜欢linq查询，存储的时候如果某个集合存储某个类型的各种子类，在GetCollection&lt;T&gt;的时候也不能完成正确子类的反序列化，这些问题大家在使用的过程中会慢慢发现，也可以邮件订阅Mongodb-csharp的google group（发送空邮件到<span style="font-family:arial,sans-serif;line-height:normal;font-size:13px;border-collapse:collapse">mongodb-csharp@googlegroups.com</span>）。</p>


<p>　　后面我会使用MongoDB来开发一个系统，同时会牵扯到MongoDB的使用讲解。敬请关注。十一下班咯~~~<strong style="color:#ff0000">祝大家国庆快乐</strong>。 </p>


<div><br></div>


<p><img src="http://www.cnblogs.com/mad/aggbug/1839568.html?type=1" width="1" height="1" alt=""><p>评论: 1　<a href="http://www.cnblogs.com/mad/archive/2010/09/30/1839568.html#pagedcomment">查看评论</a>　<a href="http://www.cnblogs.com/mad/archive/2010/09/30/1839568.html#commentform">发表评论</a></p><p><a href="http://job.cnblogs.com/">程序员找工作，就在博客园</a></p><hr><p>最新新闻：<br>· <a href="http://news.cnblogs.com/n/76205/">分析称谷歌新图像格式WebP前景难预测</a><span style="color:gray">(2010-10-01 20:05)</span><br>· <a href="http://news.cnblogs.com/n/76204/">分析师称Facebook CEO成功抵御《社交网络》</a><span style="color:gray">(2010-10-01 20:00)</span><br>· <a href="http://news.cnblogs.com/n/76203/">张朝阳力挺360保护用户隐私 称腾讯垄断需制衡</a><span style="color:gray">(2010-10-01 19:55)</span><br>· <a href="http://news.cnblogs.com/n/76202/">意大利科学家称可能已经观察到“霍金辐射”</a><span style="color:gray">(2010-10-01 19:53)</span><br>· <a href="http://news.cnblogs.com/n/76201/">微软宣布IE9 beta发布两周下载600万次</a><span style="color:gray">(2010-10-01 19:49)</span><br></p><p>编辑推荐：<a href="http://news.cnblogs.com/n/76023/">软件编程21法则</a><br></p><p>网站导航：<a href="http://www.cnblogs.com">博客园首页</a>  <a href="http://home.cnblogs.com/">个人主页</a>  <a href="http://news.cnblogs.com">新闻</a>  <a href="http://home.cnblogs.com/ing/">闪存</a>  <a href="http://home.cnblogs.com/group/">小组</a>  <a href="http://space.cnblogs.com/q/">博问</a>  <a href="http://space.cnblogs.com">社区</a>  <a href="http://kb.cnblogs.com">知识库</a></p></p>

</div>


            <div class="footer">
              <div class="contact">
                <p>
                  Your Name<br />
                  What You Are<br />
                  your@email.com
                </p>
              </div>
              <div class="contact">
                <p>
                  <a href="http://github.com/lyuehh/">github.com/lyuehh</a><br />
                  <a href="http://twitter.com/lyuehh/">twitter.com/lyuehh</a><br />
                </p>
              </div>
            </div>
          </div>
        </div> <!-- /container -->

    </body>
</html>
