<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Asp.Net MVC2.0  Url 路由入门</title>
        <meta name="viewport" content="width=device-width">

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/css/syntax.css">

        <!-- Custom CSS -->
        <link rel="stylesheet" href="/css/main.css">

    </head>
    <body>

        <div class="container">
          <div class="site">
            <div class="header">
              <h1 class="title"><a href="/">Your New Jekyll Site</a></h1>
              <a class="extra" href="/">home</a>
            </div>

                <h2>Asp.Net MVC2.0  Url 路由入门</h2>
<p class="meta">09 Oct 2010</p>

<div class="post">
<h2>Asp.Net MVC2.0  Url 路由入门</h2>

<h3>by FlyDragon</h3>

<h3>at 2010-10-08 18:22:00</h3>

<h3>original <a href="http://www.cnblogs.com/fly_dragon/archive/2010/10/08/1846009.html">http://www.cnblogs.com/fly_dragon/archive/2010/10/08/1846009.html</a></h3>

<p><a href="http://www.cnblogs.com/fly_dragon/"><img src="http://pic.cnblogs.com/face/u154994.jpg" alt="" border="0"></a><br>作者: <a href="http://www.cnblogs.com/fly_dragon/">FlyDragon</a> 发表于 2010-10-08 18:22 <a href="http://www.cnblogs.com/fly_dragon/archive/2010/10/08/1846009.html">原文链接</a> 阅读: 1300 评论: 8</p>


<p>     本篇文章是<a href="http://www.cnblogs.com/fly_dragon/archive/2010/09/26/1836169.html">初识Asp.Net MVC2.0</a> 的后续的介绍。此文将从Routing未开放源代码开始，还会对Asp.Net的Url重写技术做个简单介绍。并简单介绍Asp.Net MVC2.0 Url路由技术的使用。</p>


<p>     Url路由是MVC很重要的核心的一部分。<strong>不过它是单独于MVC项目，而且没有开源。</strong>新建一个MVC Web项目，打开Global.asax。我们看到系统帮我们添加了using System.Web.Routing 引用。Routing作为一个单独的dll被我们的项目引用。微软并没有对Routing进行开放源代码。所以：Asp.Net MVC是开源的,但是Routing不是开源的！</p>


<p>    <strong> 首先讲一下Asp.Net的Url重写技术。</strong>一种最简单实现Url重写技术就是在Global.asax文件中</p>


<p>     protected void Application_BeginRequest(object sender, EventArgs e)<br>     {
</p>


<p> 　　　　<span style="color:#000000">　   string originalUrl </span><span style="color:#000000">=</span><span style="color:#000000"> Request.Url.PathAndQuery;//获取原先的Url请求（假的请求）</span></p>


<p><span style="color:#000000">　　　　　　 //转化成真的url请求....<br></span></p>


<p><span style="color:#000000">　　　　　　 </span><span style="color:#000000">HttpContext.Current.RewritePath(newurl);//将针对Url请求交给</span><span style="color:#000000">HttpContext</span></p>


<p>     }</p>


<p>     举个例子：一个假的Url地址：http://www.xxx.com/news/sports-2009-1-1-201.html</p>


<p>     看到上面的那个url其实很多情况下那不是一个真正的url，不一定存在sports-2009-1-1.html这么一个html页。我们如果在Application_BeginRequest事件中将这个url重写成这样：</p>


<p>http://www.xxx.com/news/sports.aspx?date=2009-1-1&amp;id=201 这才是真正的url！</p>


<p>     <strong>现在开始讲Asp.Net MVC的路由机制</strong>，首先要有个观念就是：Asp.Net MVC的url地址是表现的web程序的一个逻辑的结构。新建一个Asp.Net MVC Web项目。然后按F5直接可以运行。页面会自动跳转到http://localhost:端口号/Home/Index页面。玄机还是在Global.asax中。看下面代码：</p>


<div>
<pre><div><span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">static</span><span style="color:#000000"> </span><span style="color:#0000ff">void</span><span style="color:#000000"> RegisterRoutes(RouteCollection routes)<br>        {<br>            routes.IgnoreRoute(</span><span style="color:#800000">"</span><span style="color:#800000">{resource}.axd/{*pathInfo}</span><span style="color:#800000">"</span><span style="color:#000000">);<br><br>            routes.MapRoute(<br>                </span><span style="color:#800000">"</span><span style="color:#800000">Default</span><span style="color:#800000">"</span><span style="color:#000000">, </span><span style="color:#008000">//</span><span style="color:#008000"> 路由名称</span><span style="color:#008000"><br></span><span style="color:#000000">                </span><span style="color:#800000">"</span><span style="color:#800000">{controller}/{action}/{id}</span><span style="color:#800000">"</span><span style="color:#000000">, </span><span style="color:#008000">//</span><span style="color:#008000"> 带有参数的 URL</span><span style="color:#008000"><br></span><span style="color:#000000">                </span><span style="color:#0000ff">new</span><span style="color:#000000"> { controller </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#800000">"</span><span style="color:#800000">Home</span><span style="color:#800000">"</span><span style="color:#000000">, action </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#800000">"</span><span style="color:#800000">Index</span><span style="color:#800000">"</span><span style="color:#000000">, id </span><span style="color:#000000">=</span><span style="color:#000000"> UrlParameter.Optional }, </span><span style="color:#008000">//</span><span style="color:#008000"> 参数默认值</span><span style="color:#008000"><br></span><span style="color:#000000">                </span><span style="color:#0000ff">new</span><span style="color:#000000"> </span><span style="color:#0000ff">string</span><span style="color:#000000">[] { </span><span style="color:#800000">"</span><span style="color:#800000">MvcDemo.Controllers</span><span style="color:#800000">"</span><span style="color:#000000"> }<br>            );</span></div></pre>
</div>


<p> </p>


<p> </p>


<pre>Global.asax中的<span style="color:#000000">RegisterRoutes</span><span style="color:#0000ff">方法中注册了一个名字叫：</span><span style="color:#800000">Default的路由，格式是：<br></span>http://localhost:端口号/<span style="color:#800000">controller</span>/<span style="color:#800000">action</span><span style="color:#000000"><br>并添加了这条路由的默认值new { controller </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#800000">"</span><span style="color:#800000">Home</span><span style="color:#800000">"</span><span style="color:#000000">, action </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#800000">"</span><span style="color:#800000">Index</span><span style="color:#800000">"</span><span style="color:#000000">}。所以我们按F5启动的时候，<br>地址栏是：</span>http://localhost:端口号/<br>这个样子，则匹配到我们的这条路由，并没有具体值，就匹配了我们的默认值。<br>页面会则自动跳转到http://localhost:端口号/Home/Index页面<br><br>先写到这，先回家吃饭！待续未完！<br></pre>


<p><img src="http://www.cnblogs.com/fly_dragon/aggbug/1846009.html?type=1" width="1" height="1" alt=""><p>评论: 8　<a href="http://www.cnblogs.com/fly_dragon/archive/2010/10/08/1846009.html#pagedcomment">查看评论</a>　<a href="http://www.cnblogs.com/fly_dragon/archive/2010/10/08/1846009.html#commentform">发表评论</a></p><p><a href="http://job.cnblogs.com/">程序员找工作，就在博客园</a></p><hr><p>最新新闻：<br>· <a href="http://news.cnblogs.com/n/76718/">回味老漫画：神秘的程序员们</a><span style="color:gray">(2010-10-09 14:23)</span><br>· <a href="http://news.cnblogs.com/n/76717/">Mono 2.8发布，支持C# 4.0</a><span style="color:gray">(2010-10-09 14:09)</span><br>· <a href="http://news.cnblogs.com/n/76716/">IBM获得1亿美元澳大利亚智能电网项目订单</a><span style="color:gray">(2010-10-09 14:04)</span><br>· <a href="http://news.cnblogs.com/n/76715/">亦真亦假！金山浏览器更多截图被公开</a><span style="color:gray">(2010-10-09 14:02)</span><br>· <a href="http://news.cnblogs.com/n/76714/">开发者必读：如何在 Chrome Web Store 发布你的作品</a><span style="color:gray">(2010-10-09 13:49)</span><br></p><p>编辑推荐：<a href="http://news.cnblogs.com/n/76477/">远离.NET</a><br></p><p>网站导航：<a href="http://www.cnblogs.com">博客园首页</a>  <a href="http://home.cnblogs.com/">个人主页</a>  <a href="http://news.cnblogs.com">新闻</a>  <a href="http://home.cnblogs.com/ing/">闪存</a>  <a href="http://home.cnblogs.com/group/">小组</a>  <a href="http://space.cnblogs.com/q/">博问</a>  <a href="http://space.cnblogs.com">社区</a>  <a href="http://kb.cnblogs.com">知识库</a></p></p>

</div>


            <div class="footer">
              <div class="contact">
                <p>
                  Your Name<br />
                  What You Are<br />
                  your@email.com
                </p>
              </div>
              <div class="contact">
                <p>
                  <a href="http://github.com/yourusername/">github.com/yourusername</a><br />
                  <a href="http://twitter.com/yourusername/">twitter.com/yourusername</a><br />
                </p>
              </div>
            </div>
          </div>
        </div> <!-- /container -->

    </body>
</html>
