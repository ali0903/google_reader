<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>探索Asp.net mvc 的文件上传(由浅入深)</title>
        <meta name="viewport" content="width=device-width">

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/google_reader/css/syntax.css">

        <!-- Custom CSS -->
        <link rel="stylesheet" href="/google_reader/css/main.css">

    </head>
    <body>

        <div class="container">
          <div class="site">
            <div class="header">
              <h1 class="title"><a href="/google_reader/">Google Reader</a></h1>
              <a class="extra" href="/google_reader/">home</a>
            </div>

                <h2>探索Asp.net mvc 的文件上传(由浅入深)</h2>
<p class="meta">2010-10-16 07:06</p>

<div class="post">
<h2>探索Asp.net mvc 的文件上传(由浅入深)</h2>

<h3>by Nic Pei</h3>

<h3>at 2010-10-15 23:06:00</h3>

<h3>original <a href="http://www.cnblogs.com/n-pei/archive/2010/10/15/1852635.html">http://www.cnblogs.com/n-pei/archive/2010/10/15/1852635.html</a></h3>

<p><p><span style="font-size:12pt">代码下载：<a href="http://files.cnblogs.com/n-pei/mvcfileupload.zip">http://files.cnblogs.com/n-pei/mvcfileupload.zip</a></span></p>
<p><span style="font-size:12pt">最近因为<a href="http://temvideos.codeplex.com/">TeamVideo</a>需要用到视频和图片上传功能，所以试着Google了很多资料，和大家分享下。 </span></p>
<p><span style="font-size:12pt">1．最基本的文件上传。 </span></p>
<p><span style="font-size:12pt"><a href="http://images.cnblogs.com/cnblogs_com/n-pei/Windows-Live-Writer/352a9feea839_141A4/clip_image001_2.png"><img style="background-image:none;padding-left:0px;padding-right:0px;display:inline;padding-top:0px;border:0px" title="clip_image001" src="http://images.cnblogs.com/cnblogs_com/n-pei/Windows-Live-Writer/352a9feea839_141A4/clip_image001_thumb.png" border="0" alt="clip_image001" width="442" height="172"></a> </span></p>
<p><span style="font-size:12pt">在View界面通过Form把数据POST到控制端(Controller)，Controller把文件存储到服务器，再Redirect到其他页面。 </span></p>
<p><span style="font-size:12pt">View部分的代码： </span></p>
<p><span style="font-size:12pt"><a href="http://images.cnblogs.com/cnblogs_com/n-pei/Windows-Live-Writer/352a9feea839_141A4/clip_image003_2.jpg"><img style="background-image:none;padding-left:0px;padding-right:0px;display:inline;padding-top:0px;border:0px" title="clip_image003" src="http://images.cnblogs.com/cnblogs_com/n-pei/Windows-Live-Writer/352a9feea839_141A4/clip_image003_thumb.jpg" border="0" alt="clip_image003" width="580" height="123"></a> </span></p>
<p><span style="font-size:12pt">Controller部分需要判断是否有Post过来文件，有文件就保存，再重定向到index页面。 </span></p>
<p><span style="font-size:12pt"><a href="http://images.cnblogs.com/cnblogs_com/n-pei/Windows-Live-Writer/352a9feea839_141A4/clip_image005_2.jpg"><img style="background-image:none;padding-left:0px;padding-right:0px;display:inline;padding-top:0px;border:0px" title="clip_image005" src="http://images.cnblogs.com/cnblogs_com/n-pei/Windows-Live-Writer/352a9feea839_141A4/clip_image005_thumb.jpg" border="0" alt="clip_image005" width="568" height="289"></a> </span></p>
<p><span style="font-size:12pt">上面的例子是最简单的，下一步我们考虑给它加上一个jQuery的UI，让上传文件时的样子变成如下： </span></p>
<p><span style="font-size:12pt"><a href="http://images.cnblogs.com/cnblogs_com/n-pei/Windows-Live-Writer/352a9feea839_141A4/clip_image006_2.png"><img style="background-image:none;padding-left:0px;padding-right:0px;display:inline;padding-top:0px;border:0px" title="clip_image006" src="http://images.cnblogs.com/cnblogs_com/n-pei/Windows-Live-Writer/352a9feea839_141A4/clip_image006_thumb.png" border="0" alt="clip_image006" width="361" height="303"></a> </span></p>
<p><span style="font-size:12pt">要达到这个效果，首先需要下载jQuery UI的几个插件。 </span></p>
<p><span style="font-size:12pt"><a href="http://images.cnblogs.com/cnblogs_com/n-pei/Windows-Live-Writer/352a9feea839_141A4/clip_image007_2.png"><img style="background-image:none;padding-left:0px;padding-right:0px;display:inline;padding-top:0px;border:0px" title="clip_image007" src="http://images.cnblogs.com/cnblogs_com/n-pei/Windows-Live-Writer/352a9feea839_141A4/clip_image007_thumb.png" border="0" alt="clip_image007" width="241" height="335"></a> </span></p>
<p><span style="font-size:12pt">在模板中添加这些脚本: </span></p>
<p><span style="font-size:12pt"><a href="http://images.cnblogs.com/cnblogs_com/n-pei/Windows-Live-Writer/352a9feea839_141A4/clip_image009_2.jpg"><img style="background-image:none;padding-left:0px;padding-right:0px;display:inline;padding-top:0px;border:0px" title="clip_image009" src="http://images.cnblogs.com/cnblogs_com/n-pei/Windows-Live-Writer/352a9feea839_141A4/clip_image009_thumb.jpg" border="0" alt="clip_image009" width="580" height="176"></a> </span></p>
<p><span style="font-size:12pt">把上面实现的简单的文件上传放到一个DIV中，我们需要实现的功能是当鼠标点击某个按钮时，这个DIV会弹出来。 </span></p>
<p><span style="font-size:12pt"><a href="http://images.cnblogs.com/cnblogs_com/n-pei/Windows-Live-Writer/352a9feea839_141A4/clip_image011_2.jpg"><img style="background-image:none;padding-left:0px;padding-right:0px;display:inline;padding-top:0px;border:0px" title="clip_image011" src="http://images.cnblogs.com/cnblogs_com/n-pei/Windows-Live-Writer/352a9feea839_141A4/clip_image011_thumb.jpg" border="0" alt="clip_image011" width="579" height="131"></a> </span></p>
<p><span style="font-size:12pt">最后是DIV弹出的脚本: </span></p>
<p><span style="font-size:12pt"><a href="http://images.cnblogs.com/cnblogs_com/n-pei/Windows-Live-Writer/352a9feea839_141A4/clip_image012_2.png"><img style="background-image:none;padding-left:0px;padding-right:0px;display:inline;padding-top:0px;border:0px" title="clip_image012" src="http://images.cnblogs.com/cnblogs_com/n-pei/Windows-Live-Writer/352a9feea839_141A4/clip_image012_thumb.png" border="0" alt="clip_image012" width="291" height="285"></a> </span></p>
<p><span style="font-size:12pt">接下来我们考虑把图片上传到服务器后再让它显示在当前页面中。显示的效果如下: </span></p>
<p><span style="font-size:12pt"><a href="http://images.cnblogs.com/cnblogs_com/n-pei/Windows-Live-Writer/352a9feea839_141A4/clip_image014_2.jpg"><img style="background-image:none;padding-left:0px;padding-right:0px;display:inline;padding-top:0px;border:0px" title="clip_image014" src="http://images.cnblogs.com/cnblogs_com/n-pei/Windows-Live-Writer/352a9feea839_141A4/clip_image014_thumb.jpg" border="0" alt="clip_image014" width="580" height="263"></a> </span></p>
<p><span style="font-size:12pt">也就是说我们在上传图片到服务器端后，需要得到此图片的创建时间，大小名称等。 </span></p>
<p><span style="font-size:12pt"><a href="http://images.cnblogs.com/cnblogs_com/n-pei/Windows-Live-Writer/352a9feea839_141A4/clip_image016_2.jpg"><img style="background-image:none;padding-left:0px;padding-right:0px;display:inline;padding-top:0px;border:0px" title="clip_image016" src="http://images.cnblogs.com/cnblogs_com/n-pei/Windows-Live-Writer/352a9feea839_141A4/clip_image016_thumb.jpg" border="0" alt="clip_image016" width="580" height="283"></a> </span></p>
<p><span style="font-size:12pt">FileRepository把文件的信息放到一个List中： </span></p>
<p><span style="font-size:12pt"><a href="http://images.cnblogs.com/cnblogs_com/n-pei/Windows-Live-Writer/352a9feea839_141A4/clip_image017_2.png"><img style="background-image:none;padding-left:0px;padding-right:0px;display:inline;padding-top:0px;border:0px" title="clip_image017" src="http://images.cnblogs.com/cnblogs_com/n-pei/Windows-Live-Writer/352a9feea839_141A4/clip_image017_thumb.png" border="0" alt="clip_image017" hspace="12" width="567" height="458"></a>通过Controller部分把这个List传递给View。 </span></p>
<p><span style="font-size:12pt">View部分的代码请参考附件。 </span></p>
<p><span style="font-size:12pt">对于图片的存储，我下一步想着把它存储在数据库中。 </span></p>
<p><span style="font-size:12pt">首先是创建表结构： </span></p>
<p><span style="font-size:12pt"><a href="http://images.cnblogs.com/cnblogs_com/n-pei/Windows-Live-Writer/352a9feea839_141A4/clip_image018_2.png"><img style="background-image:none;padding-left:0px;padding-right:0px;display:inline;padding-top:0px;border:0px" title="clip_image018" src="http://images.cnblogs.com/cnblogs_com/n-pei/Windows-Live-Writer/352a9feea839_141A4/clip_image018_thumb.png" border="0" alt="clip_image018" width="335" height="147"></a> </span></p>
<p><span style="font-size:12pt">使用ADO.NET Data Model来存储数据,所以我们需要创建一个edmx文件。 </span></p>
<p><span style="font-size:12pt"><a href="http://images.cnblogs.com/cnblogs_com/n-pei/Windows-Live-Writer/352a9feea839_141A4/clip_image019_2.png"><img style="background-image:none;padding-left:0px;padding-right:0px;display:inline;padding-top:0px;border:0px" title="clip_image019" src="http://images.cnblogs.com/cnblogs_com/n-pei/Windows-Live-Writer/352a9feea839_141A4/clip_image019_thumb.png" border="0" alt="clip_image019" width="526" height="294"></a> </span></p>
<p><span style="font-size:12pt">保存到图片到数据库中的Controller部分： </span></p>
<p><span style="font-size:12pt"><a href="http://images.cnblogs.com/cnblogs_com/n-pei/Windows-Live-Writer/352a9feea839_141A4/clip_image020_2.png"><img style="background-image:none;padding-left:0px;padding-right:0px;display:inline;padding-top:0px;border:0px" title="clip_image020" src="http://images.cnblogs.com/cnblogs_com/n-pei/Windows-Live-Writer/352a9feea839_141A4/clip_image020_thumb.png" border="0" alt="clip_image020" width="608" height="517"></a> </span></p>
<p><span style="font-size:12pt">View部分代码： </span></p>
<p><span style="font-size:12pt"><a href="http://images.cnblogs.com/cnblogs_com/n-pei/Windows-Live-Writer/352a9feea839_141A4/clip_image022_2.jpg"><img style="background-image:none;padding-left:0px;padding-right:0px;display:inline;padding-top:0px;border:0px" title="clip_image022" src="http://images.cnblogs.com/cnblogs_com/n-pei/Windows-Live-Writer/352a9feea839_141A4/clip_image022_thumb.jpg" border="0" alt="clip_image022" width="579" height="284"></a> </span></p>
<p><span style="font-size:12pt">过程如下图： </span></p>
<p><span style="font-size:12pt"><a href="http://images.cnblogs.com/cnblogs_com/n-pei/Windows-Live-Writer/352a9feea839_141A4/clip_image024_2.jpg"><img style="background-image:none;padding-left:0px;padding-right:0px;display:inline;padding-top:0px;border:0px" title="clip_image024" src="http://images.cnblogs.com/cnblogs_com/n-pei/Windows-Live-Writer/352a9feea839_141A4/clip_image024_thumb.jpg" border="0" alt="clip_image024" width="580" height="195"></a> </span></p>
<p><span style="font-size:12pt">这里需要一个辅助类来帮助输入文本的Post。你可以在下载的代码中看到。 </span></p>
<p><span style="font-size:12pt">上传图片并保存到数据库中，我们还需要来把图片显示出来，这个相对来说就比较麻烦了。 </span></p>
<p><span style="font-size:12pt">搜索了很久才找到的方法如下： </span></p>
<p><span style="font-size:12pt"><a href="http://images.cnblogs.com/cnblogs_com/n-pei/Windows-Live-Writer/352a9feea839_141A4/clip_image025_2.png"><img style="background-image:none;padding-left:0px;padding-right:0px;display:inline;padding-top:0px;border:0px" title="clip_image025" src="http://images.cnblogs.com/cnblogs_com/n-pei/Windows-Live-Writer/352a9feea839_141A4/clip_image025_thumb.png" border="0" alt="clip_image025" width="514" height="515"></a> </span></p>
<p><span style="font-size:12pt">保存图片到数据库后的查询结果： </span></p>
<p><span style="font-size:12pt"><a href="http://images.cnblogs.com/cnblogs_com/n-pei/Windows-Live-Writer/352a9feea839_141A4/clip_image027_2.jpg"><img style="background-image:none;padding-left:0px;padding-right:0px;display:inline;padding-top:0px;border:0px" title="clip_image027" src="http://images.cnblogs.com/cnblogs_com/n-pei/Windows-Live-Writer/352a9feea839_141A4/clip_image027_thumb.jpg" border="0" alt="clip_image027" width="547" height="42"></a> </span></p>
<p><span style="font-size:12pt">目前我还不知道如何把一个List的图片显示出来。希望谁能够提供一个好的解决方案。 </span></p>
<p><span style="font-size:12pt">传统的方法来存储文件(图片)上面的介绍已经很多了。如何使用AJAX方法来存储文件到服务器呢？ </span></p>
<p><span style="font-size:12pt">我搜索了下，比较多的是使用jQuery Form这个插件来实现的。 </span></p>
<p><span style="font-size:12pt"><a href="http://images.cnblogs.com/cnblogs_com/n-pei/Windows-Live-Writer/352a9feea839_141A4/clip_image029_2.jpg"><img style="background-image:none;padding-left:0px;padding-right:0px;display:inline;padding-top:0px;border:0px" title="clip_image029" src="http://images.cnblogs.com/cnblogs_com/n-pei/Windows-Live-Writer/352a9feea839_141A4/clip_image029_thumb.jpg" border="0" alt="clip_image029" width="580" height="173"></a> </span></p>
<p><span style="font-size:12pt">你需要去下载jQuery Form这个插件，放到你的Script文件夹中。并在Master模板中添加。 </span></p>
<p><span style="font-size:12pt">当你点击Button时，创建一个Form并使用AJAX方式POST到服务器端保存。保存方式就不说了，下面是使用jQuery Form的JS代码： </span></p>
<p><span style="font-size:12pt"><a href="http://images.cnblogs.com/cnblogs_com/n-pei/Windows-Live-Writer/352a9feea839_141A4/clip_image031_2.jpg"><img style="background-image:none;padding-left:0px;padding-right:0px;display:inline;padding-top:0px;border:0px" title="clip_image031" src="http://images.cnblogs.com/cnblogs_com/n-pei/Windows-Live-Writer/352a9feea839_141A4/clip_image031_thumb.jpg" border="0" alt="clip_image031" width="544" height="567"></a> </span></p>
<p><span style="font-size:12pt">除了使用jQuery form这个插件还有其他的AJAX方式实现文件的上传： </span></p>
<p><span style="font-size:12pt">我举两个例子： </span></p>
<p><span style="font-size:12pt">1. jQuery &amp; Flash AJAX上传文件。 </span></p>
<p><span style="font-size:12pt">代码地址：<a href="http://swfupload.googlecode.com/">http://swfupload.googlecode.com/</a> </span></p>
<p><span style="font-size:12pt">主要是通过Flash和js的交互用flash程序来post数据到后台的Controller。 </span></p>
<p><span style="font-size:12pt">除了flash部分，其它的和上面介绍的代码大同小异。我会在代码包里放上这部分的代码，供大家下载。 </span></p>
<p><span style="font-size:12pt">效果： </span></p>
<p><span style="font-size:12pt"><a href="http://images.cnblogs.com/cnblogs_com/n-pei/Windows-Live-Writer/352a9feea839_141A4/clip_image032_2.png"><img style="background-image:none;padding-left:0px;padding-right:0px;display:inline;padding-top:0px;border:0px" title="clip_image032" src="http://images.cnblogs.com/cnblogs_com/n-pei/Windows-Live-Writer/352a9feea839_141A4/clip_image032_thumb.png" border="0" alt="clip_image032" width="442" height="97"></a> </span></p>
<p><span style="font-size:12pt">2. 纯jQueryAJAX上传文件(<a href="http://valums.com/ajax-upload/">http://valums.com/ajax-upload/</a>) </span></p>
<p><span style="font-size:12pt">这个推荐大家看一下。 </span></p>
<p><span style="font-size:12pt"><a href="http://images.cnblogs.com/cnblogs_com/n-pei/Windows-Live-Writer/352a9feea839_141A4/clip_image033_2.png"><img style="background-image:none;padding-left:0px;padding-right:0px;display:inline;padding-top:0px;border:0px" title="clip_image033" src="http://images.cnblogs.com/cnblogs_com/n-pei/Windows-Live-Writer/352a9feea839_141A4/clip_image033_thumb.png" border="0" alt="clip_image033" width="584" height="128"></a> </span></p>
<p><span style="font-size:12pt">看这边文章的同仁们，周末愉快，呵呵。 </span></p>
<p><span style="font-size:12pt">参考资料： </span></p>
<p><span style="font-size:12pt"><a href="http://weblogs.asp.net/imranbaloch/archive/2010/04/03/image-preview-in-asp-net-mvc.aspx">http://weblogs.asp.net/imranbaloch/archive/2010/04/03/image-preview-in-asp-net-mvc.aspx</a>、 </span></p>
<p><span style="font-size:12pt"><a href="http://weblogs.asp.net/jgalloway/archive/2008/01/08/large-file-uploads-in-asp-net.aspx">http://weblogs.asp.net/jgalloway/archive/2008/01/08/large-file-uploads-in-asp-net.aspx</a> </span></p>
<p><span style="font-size:12pt"><a href="http://www.highoncoding.com/Articles/689_Uploading_and_Displaying_Files_Using_ASP_NET_MVC_Framework.aspx">http://www.highoncoding.com/Articles/689_Uploading_and_Displaying_Files_Using_ASP_NET_MVC_Framework.aspx</a> </span></p>
<p><span style="font-size:12pt"><a href="http://www.mikesdotnetting.com/Article/125/ASP.NET-MVC-Uploading-and-Downloading-Files">http://www.mikesdotnetting.com/Article/125/ASP.NET-MVC-Uploading-and-Downloading-Files</a> </span></p>
<p><span style="font-size:12pt"><a href="http://valums.com/ajax-upload/">http://valums.com/ajax-upload/</a> </span></p>
<p><span style="font-size:12pt">Cheers</span></p><img src="http://www.cnblogs.com/n-pei/aggbug/1852635.html?type=1" width="1" height="1" alt=""><p>作者: <a href="http://www.cnblogs.com/n-pei/">Nic Pei</a> 发表于 2010-10-15 23:06 <a href="http://www.cnblogs.com/n-pei/archive/2010/10/15/1852635.html">原文链接</a></p><p>评论: 15　<a href="http://www.cnblogs.com/n-pei/archive/2010/10/15/1852635.html#pagedcomment">查看评论</a>　<a href="http://www.cnblogs.com/n-pei/archive/2010/10/15/1852635.html#commentform">发表评论</a></p><hr><p>最新新闻：<br>· <a href="http://news.cnblogs.com/n/77541/">微软为求AT&amp;T员工认同免费派送WP7手机</a><span style="color:gray">(2010-10-16 22:58)</span><br>· <a href="http://news.cnblogs.com/n/77539/">HTML5技术或改变社交游戏未来 跨平台显现优势</a><span style="color:gray">(2010-10-16 22:26)</span><br>· <a href="http://news.cnblogs.com/n/77538/">Facebook用事实反驳W3C称HTML5不成熟的谬论</a><span style="color:gray">(2010-10-16 22:21)</span><br>· <a href="http://news.cnblogs.com/n/77537/">上半年中国电子商务交易额达到2.25万亿元</a><span style="color:gray">(2010-10-16 22:12)</span><br>· <a href="http://news.cnblogs.com/n/77536/">分析称AOL与雅虎联姻的新闻只为博取眼球</a><span style="color:gray">(2010-10-16 22:11)</span><br></p><p>编辑推荐：<a href="http://news.cnblogs.com/n/77430/">C++程序语言25年周年</a><br></p><p>网站导航：<a href="http://www.cnblogs.com">博客园首页</a>  <a href="http://home.cnblogs.com/">我的园子</a>  <a href="http://news.cnblogs.com">新闻</a>  <a href="http://home.cnblogs.com/ing/">闪存</a>  <a href="http://home.cnblogs.com/group/">小组</a>  <a href="http://space.cnblogs.com/q/">博问</a>  <a href="http://kb.cnblogs.com">知识库</a></p></p>


</div>


            <div class="footer">
              <div class="contact">
                <p>
                  Your Name<br />
                  What You Are<br />
                  your@email.com
                </p>
              </div>
              <div class="contact">
                <p>
                  <a href="http://github.com/lyuehh/">github.com/lyuehh</a><br />
                  <a href="http://twitter.com/lyuehh/">twitter.com/lyuehh</a><br />
                </p>
              </div>
            </div>
          </div>
        </div> <!-- /container -->

    </body>
</html>
