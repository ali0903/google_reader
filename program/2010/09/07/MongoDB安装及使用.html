<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>MongoDB安装及使用</title>
        <meta name="viewport" content="width=device-width">

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/google_reader/css/syntax.css">

        <!-- Custom CSS -->
        <link rel="stylesheet" href="/google_reader/css/main.css">

    </head>
    <body>

        <div class="container">
          <div class="site">
            <div class="header">
              <h1 class="title"><a href="/google_reader/">Google Reader</a></h1>
              <a class="extra" href="/google_reader/">home</a>
            </div>

                <h2>MongoDB安装及使用</h2>
<p class="meta">2010-09-07 19:02</p>

<div class="post">
<h2>MongoDB安装及使用</h2>

<h3>by</h3>

<h3>at 2010-09-07 11:02:35</h3>

<h3>original <a href="http://www.javaeye.com/topic/757301">http://www.javaeye.com/topic/757301</a></h3>

<p style="text-align:center" align="center"><strong></strong><strong><span style="font-size:15pt" lang="EN-US"></span></strong></p>


<p><span><span style="font-size:small"><span lang="EN-US">    mongodb</span>由<span lang="EN-US">C</span>＋＋写就，其名字来自</span><span style="font-size:small"><span lang="EN-US">hu<strong><span>mongo</span></strong>us</span>这个单词的中间部分，从名字可见其野心所在就是海量数据的处理。关于它的一个最简洁描述为：<span style="color:red" lang="EN-US">scalable, high-performance, open source, schema-free, document-oriented database</span><span style="color:red">。</span><span lang="EN-US">MongoDB</span>的主要目标是在键<span lang="EN-US">/</span>值存储方式（提供了高性能和高度伸缩性）以及传统的<span lang="EN-US">RDBMS</span>系统（丰富的功能）架起一座桥梁，集两者的优势于一身。</span></span></p>


<p><span><span style="font-size:small">   
<p><strong><span style="font-size:14pt;color:black">安装及使用：<span lang="EN-US"></span></span></strong></p>
<p style="background:white;margin:0cm 0cm 18pt;line-height:18pt"><span>首先在</span><span style="color:#333333;font-family:Georgia" lang="EN-US">Ubuntu</span><span>上安装</span><span style="color:#333333;font-family:Georgia" lang="EN-US">MongoDB</span><span>。</span><span style="color:#333333;font-family:Georgia" lang="EN-US"></span></p>
<p style="background:white;margin:0cm 0cm 18pt;line-height:18pt"><span style="color:#333333;font-family:Georgia" lang="EN-US"><a href="http://www.mongodb.org/display/DOCS/Downloads"><span lang="EN-US"><span lang="EN-US">下载</span></span>MongoDB</a>, </span><span>现在最新的生产版本</span><span style="color:#333333;font-family:Georgia" lang="EN-US">1.7.0</span><span style="color:#333333;font-family:Georgia" lang="EN-US"></span></p>
<p align="left"><span style="color:#333333;font-family:Georgia" lang="EN-US"><span>1.<span style="font:7pt &quot;Times New Roman&quot;">                   </span></span></span><span>解压文件</span><span style="color:#333333;font-family:Georgia" lang="EN-US">. </span></p>
<p style="background:#f7f7f7;margin:0cm 0cm 18pt 18pt;line-height:15.75pt"><span style="font-size:11.5pt;color:#222222;font-family:Courier" lang="EN-US">$ tar -xvf mongodb-linux-i686-1.4.3.tgz</span></p>
<p align="left"><span style="font-size:12pt;color:#333333;font-family:Georgia" lang="EN-US"><span>2.<span style="font:7pt &quot;Times New Roman&quot;">                  </span></span></span><span>为</span><span style="color:#333333;font-family:Georgia" lang="EN-US">MongoDB</span><span>创建数据目录，默认情况下它将数据存储在</span><span style="color:#333333;font-family:Georgia" lang="EN-US">/data/db </span><span style="font-size:12pt;color:#333333;font-family:Georgia" lang="EN-US"></span></p>
<p style="background:#f7f7f7;margin:0cm 0cm 18pt;text-indent:17.25pt;line-height:15.75pt;text-align:left" align="left"><span style="font-size:11.5pt;color:#222222;font-family:Courier" lang="EN-US">$ sudo mkdir -p /data/db/</span></p>
<p style="background:#f7f7f7;margin:0cm 0cm 18pt 18pt;line-height:15.75pt"><span style="font-size:11.5pt;color:#222222;font-family:Courier" lang="EN-US">$ sudo chown `id -u` /data/db</span></p>
<p align="left"><span style="font-size:12pt;color:#333333;font-family:Georgia" lang="EN-US"><span>3.<span style="font:7pt &quot;Times New Roman&quot;">                  </span></span></span><span>启动</span><span style="color:#333333;font-family:Georgia" lang="EN-US">MongoDB</span><span>服务</span><span style="color:#333333;font-family:Georgia" lang="EN-US">. </span><span style="font-size:12pt;color:#333333;font-family:Georgia" lang="EN-US"></span></p>
<p style="background:#f7f7f7;margin:0cm 0cm 18pt;text-indent:17.25pt;line-height:15.75pt;text-align:left" align="left"><span style="font-size:11.5pt;color:#222222;font-family:Courier" lang="EN-US">$ cd mongodb-linux-i686-1.4.3/bin</span></p>
<p style="background:#f7f7f7;margin:0cm 0cm 18pt 18pt;line-height:15.75pt"><span style="font-size:11.5pt;color:#222222;font-family:Courier" lang="EN-US">$ ./mongod</span></p>
<p align="left"><span style="font-size:12pt;color:#333333;font-family:Georgia" lang="EN-US"><span>4.<span style="font:7pt &quot;Times New Roman&quot;">                  </span></span></span><span>打开另一个终端，并确保你在</span><span style="color:#333333;font-family:Georgia" lang="EN-US">MongoDB</span><span>的</span><span style="color:#333333;font-family:Georgia" lang="EN-US">bin</span><span>目录，输入如下命令</span><span style="color:#333333;font-family:Georgia" lang="EN-US">. </span><span style="font-size:12pt;color:#333333;font-family:Georgia" lang="EN-US"></span></p>
<p style="background:#f7f7f7;margin:0cm 0cm 18pt 18pt;line-height:15.75pt"><span style="font-size:11.5pt;color:#222222;font-family:Courier" lang="EN-US">$ ./mongo</span></p>
<h3 style="margin:auto 0cm">
<strong><span>一些概念</span></strong><span style="font-size:14pt" lang="EN-US"></span>
</h3>
<p style="margin:0cm 0cm 11.25pt 7.5pt;line-height:18pt;text-align:left" align="left"><span>一个</span><span style="font-size:12pt" lang="EN-US"><span style="font-family:Times New Roman">mongod</span></span><span>服务可以有建立多个数据库，每个数据库可以有多张表，这里的表名叫</span><span style="font-size:12pt" lang="EN-US"><span style="font-family:Times New Roman">collection</span></span><span>，每个</span><span style="font-size:12pt" lang="EN-US"><span style="font-family:Times New Roman">collection</span></span><span>可以存放多个文档（</span><span style="font-size:12pt" lang="EN-US"><span style="font-family:Times New Roman">document</span></span><span>），每个文档都以</span><span style="font-size:12pt" lang="EN-US"><span style="font-family:Times New Roman">BSON</span></span><span>（</span><span style="font-size:12pt" lang="EN-US"><span style="font-family:Times New Roman">binary json</span></span><span>）的形式存放于硬盘中，</span><span>因此可以存储比较复杂的数据类型。</span><span>它是以单文档为单位存储的，你可以任意给一个或一批文档新增或删除字段，而不会对其它文档造成影响，这就是所谓的</span><span style="font-size:12pt" lang="EN-US"><span style="font-family:Times New Roman">schema-free</span></span><span>，这也是文档型数据库最主要的优点。跟一般的</span><span style="font-size:12pt" lang="EN-US"><span style="font-family:Times New Roman">key-value</span></span><span>数据库不一样的是，它的</span><span style="font-size:12pt" lang="EN-US"><span style="font-family:Times New Roman">value</span></span><span>中存储了结构信息，所以你又可以像关系型数据库那样对某些域进行读写、统计等操作。</span><span lang="EN">Mongo</span><span>最大的特点是他支持的查询语言非常强大，其语法有点类似于面向对象的查询语言，几乎可以实现类似关系数据库单表查询的绝大部分功能，而且还支持对数据建立索引。</span><span lang="EN">Mongo</span><span>还可以解决海量数据的查询效率，根据官方文档，当数据量达到</span><span lang="EN">50GB</span><span>以上数据时，</span><span lang="EN">Mongo</span><span>数据库访问速度是</span><span lang="EN">MySQL10 </span><span>倍以上。</span><span lang="EN"></span></p>
<p style="margin:0cm 0cm 0pt"><strong><span style="font-size:14pt" lang="EN-US"><span style="font-family:Times New Roman">BSON</span></span></strong></p>
<p style="margin:0cm 0cm 0pt"><span lang="EN-US"><span style="font-family:Times New Roman">BSON</span></span><span>是</span><span lang="EN-US"><span style="font-family:Times New Roman">Binary JSON </span></span><span>的简称，是一个</span><span lang="EN-US"><span style="font-family:Times New Roman">JSON</span></span><span>文档对象的二进制编码格式。</span><span lang="EN-US"><span style="font-family:Times New Roman">BSON</span></span><span>同</span><span lang="EN-US"><span style="font-family:Times New Roman">JSON</span></span><span>一样支持往其它文档对象和数组中再插入文档对象和数组，同时扩展了</span><span lang="EN-US"><span style="font-family:Times New Roman">JSON</span></span><span>的数据类型。如：</span><span lang="EN-US"><span style="font-family:Times New Roman">BSON</span></span><span>有</span><span lang="EN-US"><span style="font-family:Times New Roman">Date</span></span><span>类型和</span><span lang="EN-US"><span style="font-family:Times New Roman">BinDate</span></span><span>类型。</span></p>
<p style="margin:0cm 0cm 0pt"><span lang="EN-US"><span style="font-family:Times New Roman">BSON</span></span><span>被比作二进制的交换格式，如同</span><span lang="EN-US"><span style="font-family:Times New Roman">Protocol Buffers</span></span><span>，但</span><span lang="EN-US"><span style="font-family:Times New Roman">BSON</span></span><span>比它更“</span><span lang="EN-US"><span style="font-family:Times New Roman">schema-less</span></span><span>”，非常好的灵活性但空间占用稍微大一点。</span></p>
<p style="margin:0cm 0cm 0pt"><span lang="EN-US"><span style="font-family:Times New Roman">BSON</span></span><span>有以下三个特点：</span></p>
<p><span lang="EN-US"><span><span style="font-family:Times New Roman">1．<span style="font:7pt &quot;Times New Roman&quot;"><span style="font-size:small">  </span></span></span></span></span><span>轻量级</span></p>
<p><span lang="EN-US"><span><span style="font-family:Times New Roman">2．<span style="font:7pt &quot;Times New Roman&quot;"><span style="font-size:small">  </span></span></span></span></span><span>跨平台</span></p>
<p><span lang="EN-US"><span><span style="font-family:Times New Roman">3．<span style="font:7pt &quot;Times New Roman&quot;"><span style="font-size:small">  </span></span></span></span></span><span>效率高</span></p>
<p><strong><span style="font-size:14pt">命名空间<span lang="EN-US"></span></span></strong></p>
<p><span lang="EN-US">MongoDB</span>存储<span lang="EN-US">BSON</span>对象到<span lang="EN-US">collections,</span>这一系列的数据库名和<span lang="EN-US">collection</span>名被称为一个命名空间。如同：<span lang="EN-US">java.util.List;</span>用来管理数据库中的数据。</p>
<h3 style="margin:auto 0cm">
<strong><span>索引</span></strong><span style="font-size:14pt" lang="EN-US"></span>
</h3>
<p><span lang="EN-US">mongodb</span>可以对某个字段建立索引，可以建立组合索引、唯一索引，也可以删除索引，建立索引就意味着增加空间开销。默认情况下每个表都会有一个唯一索引：<span lang="EN-US">_id</span>，如果插入数据时没有指定<span lang="EN-US">_id</span>，服务会自动生成一个<span lang="EN-US">_id</span>，为了充分利用已有索引，减少空间开销，最好是自己指定一个<span lang="EN-US">unique</span>的<span lang="EN-US">key</span>为<span lang="EN-US">_id</span>，通常用对象的<span lang="EN-US">ID</span>比较合适，比如商品的<span lang="EN-US">ID</span>。</p>
<p style="margin:0cm 0cm 11.25pt 7.5pt;line-height:18pt;text-align:left" align="left"><span lang="EN"> </span></p>
<p style="margin:0cm 0cm 0pt"><strong><span lang="EN-US">shell</span></strong><strong><span>操作数据库： <span lang="EN-US"></span></span></strong></p>
<p style="margin:0cm 0cm 0pt"><span lang="EN-US"> </span></p>
<p style="margin:0cm 0cm 0pt"><span lang="EN-US"><span>  </span></span><span lang="EN-US"><span> </span>1.<span>  </span></span><span>超级用户相关：<span lang="EN-US"></span></span></p>
<p style="margin:0cm 0cm 0pt"><span lang="EN-US"><span>        </span></span><span lang="EN-US"><span> </span>1. #</span><span>进入数据库<span lang="EN-US">admin</span></span></p>
<p style="margin:0cm 0cm 0pt;text-indent:60pt"><span lang="EN-US">use admin</span></p>
<p style="margin:0cm 0cm 0pt"><span lang="EN-US"><span>         </span>2. #</span><span>增加或修改用户密码<span lang="EN-US"></span></span></p>
<p style="margin:0cm 0cm 0pt"><span lang="EN-US"><span>          </span>db.addUser('name','pwd')</span></p>
<p style="margin:0cm 0cm 0pt"><span lang="EN-US"><span>         </span>3. #</span><span>查看用户列表<span lang="EN-US"></span></span></p>
<p style="margin:0cm 0cm 0pt"><span lang="EN-US"><span>       </span><span>  </span><span> </span>db.system.users.find()</span></p>
<p style="margin:0cm 0cm 0pt"><span lang="EN-US"><span>         </span>4. #</span><span>用户认证<span lang="EN-US"></span></span></p>
<p style="margin:0cm 0cm 0pt"><span lang="EN-US"><span>          </span>db.auth('name','pwd')</span></p>
<p style="margin:0cm 0cm 0pt"><span lang="EN-US"><span>         </span>5. #</span><span>删除用户<span lang="EN-US"></span></span></p>
<p style="margin:0cm 0cm 0pt"><span lang="EN-US"><span>        </span><span> </span><span> </span>db.removeUser('name')</span></p>
<p style="margin:0cm 0cm 0pt"><span lang="EN-US"><span> </span><span>     </span><span>  </span><span> </span>6. #</span><span>查看所有用户<span lang="EN-US"></span></span></p>
<p style="margin:0cm 0cm 0pt"><span lang="EN-US"><span>       </span><span>   </span>show users</span></p>
<p style="margin:0cm 0cm 0pt"><span lang="EN-US"><span>        </span><span> </span>7. #</span><span>查看所有数据库<span lang="EN-US"></span></span></p>
<p style="margin:0cm 0cm 0pt"><span lang="EN-US"><span>        </span><span> </span><span> </span>show dbs</span></p>
<p style="margin:0cm 0cm 0pt"><span lang="EN-US"><span>      </span><span>  </span><span> </span>8. #</span><span>查看所有的<span lang="EN-US">collection</span></span></p>
<p style="margin:0cm 0cm 0pt"><span lang="EN-US"><span>    </span><span>   </span><span>  </span><span> </span>show collections</span></p>
<p style="margin:0cm 0cm 0pt"><span lang="EN-US"><span>       </span><span> </span><span> </span>9. #</span><span>查看各<span lang="EN-US">collection</span>的状态<span lang="EN-US"></span></span></p>
<p style="margin:0cm 0cm 0pt"><span lang="EN-US"><span>        </span><span> </span><span> </span>db.printCollectionStats()</span></p>
<p style="margin:0cm 0cm 0pt"><span lang="EN-US"><span>        </span>10. #</span><span>查看主从复制状态<span lang="EN-US"></span></span></p>
<p style="margin:0cm 0cm 0pt"><span lang="EN-US"><span>        </span><span> </span><span> </span>db.printReplicationInfo()</span></p>
<p style="margin:0cm 0cm 0pt"><span lang="EN-US"><span>        </span>11. #</span><span>修复数据库<span lang="EN-US"></span></span></p>
<p style="margin:0cm 0cm 0pt"><span lang="EN-US"><span>       </span><span>  </span><span> </span>db.repairDatabase()</span></p>
<p style="margin:0cm 0cm 0pt"><span lang="EN-US"><span>        </span>12. #</span><span>设置记录<span lang="EN-US">profiling</span>，<span lang="EN-US">0=off 1=slow 2=all</span></span></p>
<p style="margin:0cm 0cm 0pt"><span lang="EN-US"><span>       </span><span>  </span><span> </span>db.setProfilingLevel(1)</span></p>
<p style="margin:0cm 0cm 0pt"><span lang="EN-US"><span>        </span>13. #</span><span>查看<span lang="EN-US">profiling</span></span></p>
<p style="margin:0cm 0cm 0pt"><span lang="EN-US"><span>        </span><span>  </span>show profile</span></p>
<p style="margin:0cm 0cm 0pt"><span lang="EN-US"><span>      </span><span> </span><span> </span>14. #</span><span>拷贝数据库<span lang="EN-US"></span></span></p>
<p style="margin:0cm 0cm 0pt"><span lang="EN-US"><span>       </span><span>   </span>db.copyDatabase('mail_addr','mail_addr_tmp')</span></p>
<p style="margin:0cm 0cm 0pt"><span lang="EN-US"><span>    </span><span>    </span>15. #</span><span>删除<span lang="EN-US">collection</span></span></p>
<p style="margin:0cm 0cm 0pt"><span lang="EN-US"><span>        </span><span> </span><span> </span>db.mail_addr.drop()</span></p>
<p style="margin:0cm 0cm 0pt"><span lang="EN-US"><span>        </span>16. #</span><span>删除当前的数据库<span lang="EN-US"></span></span></p>
<p style="margin:0cm 0cm 0pt"><span lang="EN-US"><span>       </span><span>  </span><span> </span>db.dropDatabase()</span></p>
<p style="margin:0cm 0cm 0pt"><span lang="EN-US"><span>        </span></span></p>
<p style="margin:0cm 0cm 0pt"><span lang="EN-US"><span>   </span>2</span><span lang="EN-US">. </span><span>增删改</span><span lang="EN-US"></span></p>
<p style="margin:0cm 0cm 0pt"><span lang="EN-US"><span>         </span></span><span lang="EN-US">1. #</span><span>存储嵌套的对象<span lang="EN-US"></span></span></p>
<p style="margin:0cm 0cm 0pt;text-indent:66pt"><span lang="EN-US">db.foo.save({'name':'ysz','address':{'city':'beijing','post':100096},'phone':[138,139]})</span></p>
<p style="margin:0cm 0cm 0pt"><span lang="EN-US"> </span></p>
<p style="margin:0cm 0cm 0pt"><span lang="EN-US"><span>         </span>2. #</span><span>存储数组对象<span lang="EN-US"></span></span></p>
<p style="margin:0cm 0cm 0pt;text-indent:72pt"><span lang="EN-US">db.user_addr.save({'Uid':'yushunzhi@sohu.com','Al':['test-1@sohu.com','test-2@sohu.com']})</span></p>
<p style="margin:0cm 0cm 0pt"><span lang="EN-US"> </span></p>
<p style="margin:0cm 0cm 0pt"><span lang="EN-US"><span>         </span>3. #</span><span>根据<span lang="EN-US">query</span>条件修改，如果不存在则插入，允许修改多条记录<span lang="EN-US"></span></span></p>
<p><span lang="EN-US"><span>       </span><span>   </span><span> </span><span> </span>db.foo.update({'yy':5},{'$set':{'xx':2}},upsert=true,multi=true)</span></p>
<p style="margin:0cm 0cm 0pt"><span lang="EN-US"><span>         </span>4. #</span><span>删除<span lang="EN-US">yy=5</span>的记录<span lang="EN-US"></span></span></p>
<p style="margin:0cm 0cm 0pt"><span lang="EN-US"><span>         </span><span>  </span><span> </span>db.foo.remove({'yy':5})</span></p>
<p style="margin:0cm 0cm 0pt"><span lang="EN-US"><span>         </span>5. #</span><span>删除所有的记录<span lang="EN-US"></span></span></p>
<p style="margin:0cm 0cm 0pt"><span lang="EN-US"><span>       </span><span>    </span><span> </span>db.foo.remove()</span></p>
<p style="margin:0cm 0cm 0pt"><span lang="EN-US"> </span></p>
<p style="margin:0cm 0cm 0pt"><span lang="EN-US"><span>   </span></span><span lang="EN-US">3. </span><span>索引<span lang="EN-US"></span></span></p>
<p style="margin:0cm 0cm 0pt"><span lang="EN-US"><span>        </span></span><span lang="EN-US"><span> </span>1. #</span><span>增加索引：<span lang="EN-US">1(ascending),-1(descending)</span></span></p>
<p style="margin:0cm 0cm 0pt"><span lang="EN-US"><span>         </span>2. db.foo.ensureIndex({firstname: 1, lastname: 1}, {unique: true});</span></p>
<p style="margin:0cm 0cm 0pt"><span lang="EN-US"><span>         </span>3. #</span><span>索引子对象<span lang="EN-US"></span></span></p>
<p style="margin:0cm 0cm 0pt"><span lang="EN-US"><span>         </span>4. db.user_addr.ensureIndex({'Al.Em': 1})</span></p>
<p style="margin:0cm 0cm 0pt"><span lang="EN-US"><span>         </span>5. #</span><span>查看索引信息<span lang="EN-US"></span></span></p>
<p style="margin:0cm 0cm 0pt"><span lang="EN-US"><span>         </span>6. db.foo.getIndexes()</span></p>
<p style="margin:0cm 0cm 0pt"><span lang="EN-US"><span>         </span>7. db.foo.getIndexKeys()</span></p>
<p style="margin:0cm 0cm 0pt"><span lang="EN-US"><span>         </span>8. #</span><span>根据索引名删除索引<span lang="EN-US"></span></span></p>
<p style="margin:0cm 0cm 0pt"><span lang="EN-US"><span>         </span>9. db.user_addr.dropIndex('Al.Em_1')</span></p>
<p style="margin:0cm 0cm 0pt"><span lang="EN-US"> </span></p>
<p style="margin:0cm 0cm 0pt"><span lang="EN-US"><span>  </span></span><span lang="EN-US"><span> </span>4. </span><span>查询<span lang="EN-US"></span></span></p>
<p style="margin:0cm 0cm 0pt"><span lang="EN-US"><span>       </span></span><span lang="EN-US"><span>  </span>1. #</span><span>查找所有<span lang="EN-US"></span></span></p>
<p style="margin:0cm 0cm 0pt"><span lang="EN-US"><span>       </span><span> </span>2. db.foo.find()</span></p>
<p style="margin:0cm 0cm 0pt"><span lang="EN-US"><span>        </span>3. #</span><span>查找一条记录<span lang="EN-US"></span></span></p>
<p style="margin:0cm 0cm 0pt"><span lang="EN-US"><span>       </span><span> </span>4. db.foo.findOne()</span></p>
<p style="margin:0cm 0cm 0pt"><span lang="EN-US"><span>       </span><span> </span>5. #</span><span>根据条件检索<span lang="EN-US">10</span>条记录<span lang="EN-US"></span></span></p>
<p style="margin:0cm 0cm 0pt"><span lang="EN-US"><span>       </span><span> </span>6. db.foo.find({'msg':'Hello 1'}).limit(10)</span></p>
<p style="margin:0cm 0cm 0pt"><span lang="EN-US"><span>       </span><span> </span>7. #sort</span><span>排序<span lang="EN-US"></span></span></p>
<p><span lang="EN-US"><span>        </span>8. db.deliver_status.find({'From':'ixigua@sina.com'}).sort({'Dt',-1})</span></p>
<p style="margin:0cm 0cm 0pt"><span lang="EN-US"><span>         </span>9. db.deliver_status.find().sort({'Ct':-1}).limit(1)</span></p>
<p style="margin:0cm 0cm 0pt"><span lang="EN-US"><span>        </span>10. #count</span><span>操作<span lang="EN-US"></span></span></p>
<p style="margin:0cm 0cm 0pt"><span lang="EN-US"><span>        </span>11. db.user_addr.count()</span></p>
<p style="margin:0cm 0cm 0pt"><span lang="EN-US"><span>        </span>12. #distinct</span><span>操作<span lang="EN-US">,</span>查询指定列，去重复<span lang="EN-US"></span></span></p>
<p style="margin:0cm 0cm 0pt"><span lang="EN-US"><span>        </span>13. db.foo.distinct('msg')</span></p>
<p style="margin:0cm 0cm 0pt"><span lang="EN-US"><span>        </span>14. #”&gt;=”</span><span>操作<span lang="EN-US"></span></span></p>
<p style="margin:0cm 0cm 0pt"><span lang="EN-US"><span>        </span>15. db.foo.find({"timestamp": {"$gte" : 2}})</span></p>
<p style="margin:0cm 0cm 0pt"><span lang="EN-US"><span>        </span>16. #</span><span>子对象的查找<span lang="EN-US"></span></span></p>
<p style="margin:0cm 0cm 0pt"><span lang="EN-US"><span>        </span>17. db.foo.find({'address.city':'beijing'})</span></p>
<p style="margin:0cm 0cm 0pt"><span lang="EN-US"><span>   </span></span><span lang="EN-US">5. </span><span>管理<span lang="EN-US"></span></span></p>
<p style="margin:0cm 0cm 0pt"><span lang="EN-US"><span>       </span></span><span lang="EN-US"><span>  </span>1. #</span><span>查看<span lang="EN-US">collection</span>数据的大小<span lang="EN-US"></span></span></p>
<p style="margin:0cm 0cm 0pt"><span lang="EN-US"><span>         </span>2. db.deliver_status.dataSize()</span></p>
<p style="margin:0cm 0cm 0pt"><span lang="EN-US"><span>         </span>3. #</span><span>查看<span lang="EN-US">colleciont</span>状态<span lang="EN-US"></span></span></p>
<p style="margin:0cm 0cm 0pt"><span lang="EN-US"><span>         </span>4. db.deliver_status.stats()</span></p>
<p style="margin:0cm 0cm 0pt"><span lang="EN-US"><span>         </span>5. #</span><span>查询所有索引的大小<span lang="EN-US"></span></span></p>
<p style="margin:0cm 0cm 0pt"><span lang="EN-US"><span>         </span>6. db.deliver_status.totalIndexSize()</span></p>
<p style="margin:0cm 0cm 0pt"><span lang="EN-US"> </span></p>
<p><span lang="EN-US"><span>5.<span style="font:7pt &quot;Times New Roman&quot;">  </span></span></span><span lang="EN-US">advanced queries:</span><span>高级查询<span lang="EN-US"></span></span></p>
<p style="margin:0cm 0cm 0pt 42pt;line-height:150%"><span style="font-size:12pt;color:black;line-height:150%;font-family:simsun" lang="EN-US"><br></span><span>条件操作符</span><span style="font-size:12pt;color:black;line-height:150%;font-family:simsun" lang="EN-US"> <br>$gt : &gt; <br>$lt : &lt; <br>$gte: &gt;= <br>$lte: &lt;= <br>$ne : !=</span><span>、</span><span style="font-size:12pt;color:black;line-height:150%;font-family:simsun" lang="EN-US">&lt;&gt; <br>$in : in <br>$nin: not in <br>$all: all <br>$not: </span><span>反匹配</span><span style="font-size:12pt;color:black;line-height:150%;font-family:simsun" lang="EN-US">(1.3.3</span><span>及以上版本</span><span style="font-size:12pt;color:black;line-height:150%;font-family:simsun" lang="EN-US">) <br><br></span><span>查询</span><span style="font-size:12pt;color:black;line-height:150%;font-family:simsun" lang="EN-US"> name &lt;&gt; &quot;bruce&quot; and age &gt;= 18 </span><span>的数据</span><span style="font-size:12pt;color:black;line-height:150%;font-family:simsun" lang="EN-US"> <br>db.users.find({name: {$ne: "bruce"}, age: {$gte: 18}}); <br><br></span><span>查询</span><span style="font-size:12pt;color:black;line-height:150%;font-family:simsun" lang="EN-US"> creation_date &gt; &#39;2010-01-01&#39; and creation_date &lt;= &#39;2010-12-31&#39; </span><span>的数据</span><span style="font-size:12pt;color:black;line-height:150%;font-family:simsun" lang="EN-US"> <br>db.users.find({creation_date:{$gt:new Date(2010,0,1), $lte:new Date(2010,11,31)}); <br><br></span><span>查询</span><span style="font-size:12pt;color:black;line-height:150%;font-family:simsun" lang="EN-US"> age in (20,22,24,26) </span><span>的数据</span><span style="font-size:12pt;color:black;line-height:150%;font-family:simsun" lang="EN-US"> <br>db.users.find({age: {$in: [20,22,24,26]}}); <br><br></span><span>查询</span><span style="font-size:12pt;color:black;line-height:150%;font-family:simsun" lang="EN-US"> age</span><span>取模</span><span style="font-size:12pt;color:black;line-height:150%;font-family:simsun" lang="EN-US">10</span><span>等于</span><span style="font-size:12pt;color:black;line-height:150%;font-family:simsun" lang="EN-US">0 </span><span>的数据</span><span style="font-size:12pt;color:black;line-height:150%;font-family:simsun" lang="EN-US"> <br>db.users.find('this.age % 10 == 0'); <br></span><span>或者</span><span style="font-size:12pt;color:black;line-height:150%;font-family:simsun" lang="EN-US"> <br>db.users.find({age : {$mod : [10, 0]}}); <br><br></span><span>匹配所有</span><span style="font-size:12pt;color:black;line-height:150%;font-family:simsun" lang="EN-US"> <br>db.users.find({favorite_number : {$all : [6, 8]}}); <br></span><span>可以查询出</span><span style="font-size:12pt;color:black;line-height:150%;font-family:simsun" lang="EN-US">{name: 'David', age: 26, favorite_number: [ 6, 8, 9 ] } <br></span><span>可以不查询出</span><span style="font-size:12pt;color:black;line-height:150%;font-family:simsun" lang="EN-US">{name: 'David', age: 26, favorite_number: [ 6, 7, 9 ] } <br><br></span><span>查询不匹配</span><span style="font-size:12pt;color:black;line-height:150%;font-family:simsun" lang="EN-US">name=B*</span><span>带头的记录</span><span style="font-size:12pt;color:black;line-height:150%;font-family:simsun" lang="EN-US"> <br>db.users.find({name: {$not: /^B.*/}}); <br></span><span>查询</span><span style="font-size:12pt;color:black;line-height:150%;font-family:simsun" lang="EN-US"> age</span><span>取模</span><span style="font-size:12pt;color:black;line-height:150%;font-family:simsun" lang="EN-US">10</span><span>不等于</span><span style="font-size:12pt;color:black;line-height:150%;font-family:simsun" lang="EN-US">0 </span><span>的数据</span><span style="font-size:12pt;color:black;line-height:150%;font-family:simsun" lang="EN-US"> <br>db.users.find({age : {$not: {$mod : [10, 0]}}}); <br><br>#</span><span>返回部分字段</span><span style="font-size:12pt;color:black;line-height:150%;font-family:simsun" lang="EN-US"> <br></span><span>选择返回</span><span style="font-size:12pt;color:black;line-height:150%;font-family:simsun" lang="EN-US">age</span><span>和</span><span style="font-size:12pt;color:black;line-height:150%;font-family:simsun" lang="EN-US">_id</span><span>字段</span><span style="font-size:12pt;color:black;line-height:150%;font-family:simsun" lang="EN-US">(_id</span><span>字段总是会被返回</span><span style="font-size:12pt;color:black;line-height:150%;font-family:simsun" lang="EN-US">) <br>db.users.find({}, {age:1}); <br>db.users.find({}, {age:3}); <br>db.users.find({}, {age:true}); <br>db.users.find({ name : "bruce" }, {age:1}); <br>0</span><span>为</span><span style="font-size:12pt;color:black;line-height:150%;font-family:simsun" lang="EN-US">false, </span><span>非</span><span style="font-size:12pt;color:black;line-height:150%;font-family:simsun" lang="EN-US">0</span><span>为</span><span style="font-size:12pt;color:black;line-height:150%;font-family:simsun" lang="EN-US">true <br><br></span><span>选择返回</span><span style="font-size:12pt;color:black;line-height:150%;font-family:simsun" lang="EN-US">age</span><span>、</span><span style="font-size:12pt;color:black;line-height:150%;font-family:simsun" lang="EN-US">address</span><span>和</span><span style="font-size:12pt;color:black;line-height:150%;font-family:simsun" lang="EN-US">_id</span><span>字段</span><span style="font-size:12pt;color:black;line-height:150%;font-family:simsun" lang="EN-US"> <br>db.users.find({ name : "bruce" }, {age:1, address:1}); <br><br></span><span>排除返回</span><span style="font-size:12pt;color:black;line-height:150%;font-family:simsun" lang="EN-US">age</span><span>、</span><span style="font-size:12pt;color:black;line-height:150%;font-family:simsun" lang="EN-US">address</span><span>和</span><span style="font-size:12pt;color:black;line-height:150%;font-family:simsun" lang="EN-US">_id</span><span>字段</span><span style="font-size:12pt;color:black;line-height:150%;font-family:simsun" lang="EN-US"> <br>db.users.find({}, {age:0, address:false}); <br>db.users.find({ name : "bruce" }, {age:0, address:false}); <br><br></span><span>数组元素个数判断</span><span style="font-size:12pt;color:black;line-height:150%;font-family:simsun" lang="EN-US"> <br></span><span>对于</span><span style="font-size:12pt;color:black;line-height:150%;font-family:simsun" lang="EN-US">{name: 'David', age: 26, favorite_number: [ 6, 7, 9 ] }</span><span>记录</span><span style="font-size:12pt;color:black;line-height:150%;font-family:simsun" lang="EN-US"> <br></span><span>匹配</span><span style="font-size:12pt;color:black;line-height:150%;font-family:simsun" lang="EN-US">db.users.find({favorite_number: {$size: 3}}); <br></span><span>不匹配</span><span style="font-size:12pt;color:black;line-height:150%;font-family:simsun" lang="EN-US">db.users.find({favorite_number: {$size: 2}}); <br><br>$exists</span><span>判断字段是否存在</span><span style="font-size:12pt;color:black;line-height:150%;font-family:simsun" lang="EN-US"> <br></span><span>查询所有存在</span><span style="font-size:12pt;color:black;line-height:150%;font-family:simsun" lang="EN-US">name</span><span>字段的记录</span><span style="font-size:12pt;color:black;line-height:150%;font-family:simsun" lang="EN-US"> <br>db.users.find({name: {$exists: true}}); <br></span><span>查询所有不存在</span><span style="font-size:12pt;color:black;line-height:150%;font-family:simsun" lang="EN-US">phone</span><span>字段的记录</span><span style="font-size:12pt;color:black;line-height:150%;font-family:simsun" lang="EN-US"> <br>db.users.find({phone: {$exists: false}}); <br><br>$type</span><span>判断字段类型</span><span style="font-size:12pt;color:black;line-height:150%;font-family:simsun" lang="EN-US"> <br></span><span>查询所有</span><span style="font-size:12pt;color:black;line-height:150%;font-family:simsun" lang="EN-US">name</span><span>字段是字符类型的</span><span style="font-size:12pt;color:black;line-height:150%;font-family:simsun" lang="EN-US"> <br>db.users.find({name: {$type: 2}}); <br></span><span>查询所有</span><span style="font-size:12pt;color:black;line-height:150%;font-family:simsun" lang="EN-US">age</span><span>字段是整型的</span><span style="font-size:12pt;color:black;line-height:150%;font-family:simsun" lang="EN-US"> <br>db.users.find({age: {$type: 16}}); <br><br></span><span>对于字符字段，可以使用正则表达式</span><span style="font-size:12pt;color:black;line-height:150%;font-family:simsun" lang="EN-US"> <br></span><span>查询以字母</span><span style="font-size:12pt;color:black;line-height:150%;font-family:simsun" lang="EN-US">b</span><span>或者</span><span style="font-size:12pt;color:black;line-height:150%;font-family:simsun" lang="EN-US">B</span><span>带头的所有记录</span><span style="font-size:12pt;color:black;line-height:150%;font-family:simsun" lang="EN-US"> <br>db.users.find({name: /^b.*/i}); <br><br>$elemMatch(1.3.1</span><span>及以上版本</span><span style="font-size:12pt;color:black;line-height:150%;font-family:simsun" lang="EN-US">) <br></span><span>为数组的字段中匹配其中某个元素</span><span style="font-size:12pt;color:black;line-height:150%;font-family:simsun" lang="EN-US"> <br><br>Javascript</span><span>查询和</span><span style="font-size:12pt;color:black;line-height:150%;font-family:simsun" lang="EN-US">$where</span><span>查询</span><span style="font-size:12pt;color:black;line-height:150%;font-family:simsun" lang="EN-US"> <br></span><span>查询</span><span style="font-size:12pt;color:black;line-height:150%;font-family:simsun" lang="EN-US"> age &gt; 18 </span><span>的记录，以下查询都一样</span><span style="font-size:12pt;color:black;line-height:150%;font-family:simsun" lang="EN-US"> <br>db.users.find({age: {$gt: 18}}); <br>db.users.find({$where: &quot;this.age &gt; 18&quot;}); <br>db.users.find(&quot;this.age &gt; 18&quot;); <br>f = function() {return this.age &gt; 18} db.users.find(f); <br><br></span><span>排序</span><span style="font-size:12pt;color:black;line-height:150%;font-family:simsun" lang="EN-US">sort() <br></span><span>以年龄升序</span><span style="font-size:12pt;color:black;line-height:150%;font-family:simsun" lang="EN-US">asc <br>db.users.find().sort({age: 1}); <br></span><span>以年龄降序</span><span style="font-size:12pt;color:black;line-height:150%;font-family:simsun" lang="EN-US">desc <br>db.users.find().sort({age: -1}); <br><br></span><span>限制返回记录数量</span><span style="font-size:12pt;color:black;line-height:150%;font-family:simsun" lang="EN-US">limit() <br></span><span>返回</span><span style="font-size:12pt;color:black;line-height:150%;font-family:simsun" lang="EN-US">5</span><span>条记录</span><span style="font-size:12pt;color:black;line-height:150%;font-family:simsun" lang="EN-US"> <br>db.users.find().limit(5); <br></span><span>返回</span><span style="font-size:12pt;color:black;line-height:150%;font-family:simsun" lang="EN-US">3</span><span>条记录并打印信息</span><span style="font-size:12pt;color:black;line-height:150%;font-family:simsun" lang="EN-US"> <br>db.users.find().limit(3).forEach(function(user) {print('my age is ' + user.age)}); <br></span><span>结果</span><span style="font-size:12pt;color:black;line-height:150%;font-family:simsun" lang="EN-US"> <br>my age is 18 <br>my age is 19 <br>my age is 20 <br><br></span><span>限制返回记录的开始点</span><span style="font-size:12pt;color:black;line-height:150%;font-family:simsun" lang="EN-US">skip() <br></span><span>从第</span><span style="font-size:12pt;color:black;line-height:150%;font-family:simsun" lang="EN-US">3</span><span>条记录开始，返回</span><span style="font-size:12pt;color:black;line-height:150%;font-family:simsun" lang="EN-US">5</span><span>条记录</span><span style="font-size:12pt;color:black;line-height:150%;font-family:simsun" lang="EN-US">(limit 3, 5) <br>db.users.find().skip(3).limit(5); <br><br></span><span>查询记录条数</span><span style="font-size:12pt;color:black;line-height:150%;font-family:simsun" lang="EN-US">count() <br>db.users.find().count(); <br>db.users.find({age:18}).count(); <br></span><span>以下返回的不是</span><span style="font-size:12pt;color:black;line-height:150%;font-family:simsun" lang="EN-US">5</span><span>，而是</span><span style="font-size:12pt;color:black;line-height:150%;font-family:simsun" lang="EN-US">user</span><span>表中所有的记录数量</span><span style="font-size:12pt;color:black;line-height:150%;font-family:simsun" lang="EN-US"> <br>db.users.find().skip(10).limit(5).count(); <br></span><span>如果要返回限制之后的记录数量，要使用</span><span style="font-size:12pt;color:black;line-height:150%;font-family:simsun" lang="EN-US">count(true)</span><span>或者</span><span style="font-size:12pt;color:black;line-height:150%;font-family:simsun" lang="EN-US">count(</span><span>非</span><span style="font-size:12pt;color:black;line-height:150%;font-family:simsun" lang="EN-US">0) <br>db.users.find().skip(10).limit(5).count(true); <br><br></span><span>分组</span><span style="font-size:12pt;color:black;line-height:150%;font-family:simsun" lang="EN-US">group() <br></span><span>假设</span><span style="font-size:12pt;color:black;line-height:150%;font-family:simsun" lang="EN-US">test</span><span>表只有以下一条数据</span><span style="font-size:12pt;color:black;line-height:150%;font-family:simsun" lang="EN-US"> <br>{ domain: "www.mongodb.org" <br>, invoked_at: {d:"2009-11-03", t:"17:14:05"} <br>, response_time: 0.05 <br>, http_action: "GET /display/DOCS/Aggregation" <br>} <br></span><span>使用</span><span style="font-size:12pt;color:black;line-height:150%;font-family:simsun" lang="EN-US">group</span><span>统计</span><span style="font-size:12pt;color:black;line-height:150%;font-family:simsun" lang="EN-US">test</span><span>表</span><span style="font-size:12pt;color:black;line-height:150%;font-family:simsun" lang="EN-US">11</span><span>月份的数据</span><span style="font-size:12pt;color:black;line-height:150%;font-family:simsun" lang="EN-US">count:count(*)</span><span>、</span><span style="font-size:12pt;color:black;line-height:150%;font-family:simsun" lang="EN-US">total_time:sum(response_time)</span><span>、</span><span style="font-size:12pt;color:black;line-height:150%;font-family:simsun" lang="EN-US">avg_time:total_time/count; <br>db.test.group( <br>{ cond: {"invoked_at.d": {$gt: "2009-11", $lt: "2009-12"}} <br>, key: {http_action: true} <br>, initial: {count: 0, total_time:0} <br>, reduce: function(doc, out){ out.count++; out.total_time+=doc.response_time } <br>, finalize: function(out){ out.avg_time = out.total_time / out.count } <br>} ); <br><br>[ <br>{ <br>"http_action" : "GET /display/DOCS/Aggregation", <br>"count" : 1, <br>"total_time" : 0.05, <br>"avg_time" : 0.05 <br>} <br>]</span><span style="font-size:12pt;color:#464646;line-height:150%;font-family:simsun" lang="EN-US"> </span></p>
<p style="margin:0cm 0cm 0pt 42pt;line-height:150%"><strong><span style="font-size:14pt;color:#464646;line-height:150%;font-family:simsun" lang="EN-US"> </span></strong></p>
<p style="margin:0cm 0cm 0pt;text-align:left" align="left"><strong><span style="font-size:14pt" lang="EN-US"><span style="font-family:Times New Roman">Java </span></span></strong><strong><span>应用示例<span lang="EN-US"> </span></span></strong></p>
<p style="margin:0cm 0cm 0pt;text-align:left" align="left"><span>要使用</span><span lang="EN-US"><span style="font-family:Times New Roman">Java</span></span><span>操作</span><span lang="EN-US"><span style="font-family:Times New Roman">MongoDB</span></span><span>的话，要到官方网站下载一个驱动包，把包导入后，可以尝试来操作了（记得一定要开着服务器）<span lang="EN-US"> </span></span></p>
<p style="margin:0cm 0cm 0pt;text-align:left" align="left"><span>首先介绍一下比较常用的几个类<span lang="EN-US"> </span></span></p>
<p style="margin:0cm 0cm 0pt;text-align:left" align="left"><strong><span lang="EN-US">Mongo</span></strong><span>：连接服务器，执行一些数据库操作的选项，如新建立一个数据库等<span lang="EN-US"> </span></span></p>
<p style="margin:0cm 0cm 0pt;text-align:left" align="left"><strong><span lang="EN-US">DB</span></strong><span>：对应一个数据库，可以用来建立集合等操作<span lang="EN-US"> </span></span></p>
<p style="margin:0cm 0cm 0pt;text-align:left" align="left"><strong><span lang="EN-US">DBCollection</span></strong><span>：对应一个集合（类似表），可能是我们用得最多的，可以添加删除记录等<span lang="EN-US"> </span></span></p>
<p style="margin:0cm 0cm 0pt;text-align:left" align="left"><strong><span lang="EN-US">DBObjec</span></strong><span>：接口和</span><span lang="EN-US"><span style="font-family:Times New Roman">BasicDBObject</span></span><span>对象：表示一个具体的记录，</span><span lang="EN-US"><span style="font-family:Times New Roman">BasicDBObject</span></span><span>实现了</span><span lang="EN-US"><span style="font-family:Times New Roman">DBObject</span></span><span>，因为是</span><span lang="EN-US"><span style="font-family:Times New Roman">key-value</span></span><span>的数据结构，所以用起来其实和</span><span lang="EN-US"><span style="font-family:Times New Roman">HashMap</span></span><span>是基本一致的<span lang="EN-US"> </span></span></p>
<p style="margin:0cm 0cm 0pt;text-align:left" align="left"><strong><span lang="EN-US">DBCursor</span></strong><span>：用来遍历取得的数据，实现了</span><span lang="EN-US"><span style="font-family:Times New Roman">Iterable</span></span><span>和</span><span lang="EN-US"><span style="font-family:Times New Roman">Iterator</span></span><span lang="EN-US"> </span></p>
<p style="margin:0cm 0cm 0pt;text-align:left" align="left"><span>接下来实际的操作一下，代码如下：<span lang="EN-US"> </span></span></p>
<p style="margin:0cm 0cm 0pt;text-align:left" align="left"><strong><span lang="EN-US">import</span></strong><span lang="EN-US"> java.net.UnknownHostException;</span><span lang="EN-US"> </span></p>
<p style="margin:0cm 0cm 0pt;text-align:left" align="left"><strong><span lang="EN-US">import</span></strong><span lang="EN-US"> java.util.List;</span><span lang="EN-US"> </span></p>
<p style="margin:0cm 0cm 0pt;text-align:left" align="left"><strong><span lang="EN-US">import</span></strong><span lang="EN-US"> java.util.Set;</span><span lang="EN-US"> </span></p>
<p style="margin:0cm 0cm 0pt;text-align:left" align="left"><strong><span lang="EN-US">import</span></strong><span lang="EN-US"> com.mongodb.BasicDBObject;</span><span lang="EN-US"> </span></p>
<p style="margin:0cm 0cm 0pt;text-align:left" align="left"><strong><span lang="EN-US">import</span></strong><span lang="EN-US"> com.mongodb.DB;</span><span lang="EN-US"> </span></p>
<p style="margin:0cm 0cm 0pt;text-align:left" align="left"><strong><span lang="EN-US">import</span></strong><span lang="EN-US"> com.mongodb.DBCollection;</span><span lang="EN-US"> </span></p>
<p style="margin:0cm 0cm 0pt;text-align:left" align="left"><strong><span lang="EN-US">import</span></strong><span lang="EN-US"> com.mongodb.DBCursor;</span><span lang="EN-US"> </span></p>
<p style="margin:0cm 0cm 0pt;text-align:left" align="left"><strong><span lang="EN-US">import</span></strong><span lang="EN-US"> com.mongodb.DBObject;</span><span lang="EN-US"> </span></p>
<p style="margin:0cm 0cm 0pt;text-align:left" align="left"><strong><span lang="EN-US">import</span></strong><span lang="EN-US"> com.mongodb.Mongo;</span><span lang="EN-US"> </span></p>
<p style="margin:0cm 0cm 0pt;text-align:left" align="left"><strong><span lang="EN-US">import</span></strong><span lang="EN-US"> com.mongodb.MongoException;</span><span lang="EN-US"> </span></p>
<p style="margin:0cm 0cm 0pt;text-align:left" align="left"><strong><span lang="EN-US">public</span></strong><span lang="EN-US"> </span><strong><span lang="EN-US">class</span></strong><span lang="EN-US"> MongoDbTest {</span><span lang="EN-US"> </span></p>
<p style="margin:0cm 0cm 0pt;text-align:left" align="left"><span lang="EN-US">  </span><strong><span lang="EN-US">public</span></strong><span lang="EN-US"> </span><strong><span lang="EN-US">static</span></strong><span lang="EN-US"> </span><strong><span lang="EN-US">void</span></strong><span lang="EN-US"> main(String[] args) </span><strong><span lang="EN-US">throws</span></strong><span lang="EN-US"> UnknownHostException, MongoException {</span><span lang="EN-US"> </span></p>
<p style="margin:0cm 0cm 0pt;text-align:left" align="left"><span lang="EN-US">    </span><span lang="EN-US">//Mongo m = new Mongo();</span><span lang="EN-US"> </span></p>
<p style="margin:0cm 0cm 0pt;text-indent:20.25pt;text-align:left" align="left"><span lang="EN-US">//Mongo m = new Mongo("localhost");</span><span lang="EN-US"> </span></p>
<p style="margin:0cm 0cm 0pt;text-indent:20.25pt;text-align:left" align="left"><span lang="EN-US">//</span><span>获得数据库服务<span lang="EN-US"></span></span></p>
<p style="margin:0cm 0cm 0pt;text-indent:20.25pt;text-align:left" align="left"><span lang="EN-US">Mongo m = </span><strong><span lang="EN-US">new</span></strong><span lang="EN-US"> Mongo(</span><span lang="EN-US">"localhost"</span><span lang="EN-US">, 27017);</span><span lang="EN-US"> </span></p>
<p style="margin:0cm 0cm 0pt;text-indent:20.25pt;text-align:left" align="left"><span lang="EN-US">//</span><span>得到数据库<span lang="EN-US">mytest</span></span></p>
<p style="margin:0cm 0cm 0pt;text-indent:20.25pt;text-align:left" align="left"><span lang="EN-US">DB db = m.getDB(</span><span lang="EN-US">"mytest"</span><span lang="EN-US">);</span><span lang="EN-US"> </span></p>
<p style="margin:0cm 0cm 0pt;text-indent:20.25pt;text-align:left" align="left"><span lang="EN-US">//</span><span>得到<span lang="EN-US">mytest</span>数据库下所有表名<span lang="EN-US"></span></span></p>
<p style="margin:0cm 0cm 0pt;text-align:left" align="left"><span lang="EN-US">    Set&lt;String&gt; colls = db.getCollectionNames();</span><span lang="EN-US"> </span></p>
<p style="margin:0cm 0cm 0pt;text-align:left" align="left"><span lang="EN-US">    </span><strong><span lang="EN-US">for</span></strong><span lang="EN-US"> (String s : colls) {</span><span lang="EN-US"> </span></p>
<p style="margin:0cm 0cm 0pt;text-align:left" align="left"><span lang="EN-US">        System.</span><em><span lang="EN-US">out</span></em><span lang="EN-US">.println(s);</span><span lang="EN-US"> </span></p>
<p style="margin:0cm 0cm 0pt;text-indent:20.25pt;text-align:left" align="left"><span lang="EN-US">}</span><span lang="EN-US"> </span></p>
<p style="margin:0cm 0cm 0pt;text-indent:20.25pt;text-align:left" align="left"><span lang="EN-US">//</span><span>得到<span lang="EN-US">testCollection</span>表<span lang="EN-US"></span></span></p>
<p style="margin:0cm 0cm 0pt;text-indent:20.25pt;text-align:left" align="left"><span lang="EN-US">DBCollection coll = db.getCollection(</span><span lang="EN-US">"testCollection"</span><span lang="EN-US">);</span><span lang="EN-US"> </span></p>
<p style="margin:0cm 0cm 0pt;text-indent:20.25pt;text-align:left" align="left"><span lang="EN-US">//new </span><span>一个</span><span style="font-size:12pt;color:#339966" lang="EN-US"><span style="font-family:Times New Roman">BasicDBObject</span></span><span>对象</span><span style="font-family:Times New Roman"><span style="font-size:12pt;color:#339966" lang="EN-US">doc</span><span lang="EN-US"></span></span></p>
<p style="margin:0cm 0cm 0pt;text-indent:20.25pt;text-align:left" align="left"><span lang="EN-US">BasicDBObject doc = </span><strong><span lang="EN-US">new</span></strong><span lang="EN-US"> BasicDBObject();</span><span lang="EN-US"> </span></p>
<p style="margin:0cm 0cm 0pt;text-indent:20.25pt;text-align:left" align="left"><span lang="EN-US">//</span><span>赋值<span lang="EN-US"></span></span></p>
<p style="margin:0cm 0cm 0pt;text-align:left" align="left"><span lang="EN-US">    doc.put(</span><span lang="EN-US">"name"</span><span lang="EN-US">, </span><span lang="EN-US">"MongoDB"</span><span lang="EN-US">);</span><span lang="EN-US"> </span></p>
<p style="margin:0cm 0cm 0pt;text-align:left" align="left"><span lang="EN-US">    doc.put(</span><span lang="EN-US">"type"</span><span lang="EN-US">, </span><span lang="EN-US">"database"</span><span lang="EN-US">);</span><span lang="EN-US"> </span></p>
<p style="margin:0cm 0cm 0pt;text-indent:20.25pt;text-align:left" align="left"><span lang="EN-US">doc.put(</span><span lang="EN-US">"count"</span><span lang="EN-US">, 1);</span><span lang="EN-US"> </span></p>
<p style="margin:0cm 0cm 0pt;text-indent:20.25pt;text-align:left" align="left"><span lang="EN-US">//</span><span>又<span lang="EN-US">new </span>一个</span><span style="font-size:12pt;color:#339966" lang="EN-US"><span style="font-family:Times New Roman">BasicDBObject</span></span><span>对象</span><span style="font-family:Times New Roman"><span style="font-size:12pt;color:#339966" lang="EN-US">info</span><span lang="EN-US"></span></span></p>
<p style="margin:0cm 0cm 0pt;text-align:left" align="left"><span lang="EN-US">    BasicDBObject info = </span><strong><span lang="EN-US">new</span></strong><span lang="EN-US"> BasicDBObject();</span><span lang="EN-US"> </span></p>
<p style="margin:0cm 0cm 0pt;text-align:left" align="left"><span lang="EN-US">    info.put(</span><span lang="EN-US">"x"</span><span lang="EN-US">, 203);</span><span lang="EN-US"> </span></p>
<p style="margin:0cm 0cm 0pt;text-indent:20.25pt;text-align:left" align="left"><span lang="EN-US">info.put(</span><span lang="EN-US">"y"</span><span lang="EN-US">, 102);</span><span lang="EN-US"> </span></p>
<p style="margin:0cm 0cm 0pt;text-indent:20.25pt;text-align:left" align="left"><span lang="EN-US">//</span><span>把<span lang="EN-US">info</span>放入<span lang="EN-US">doc</span></span></p>
<p style="margin:0cm 0cm 0pt;text-indent:20.25pt;text-align:left" align="left"><span lang="EN-US">doc.put(</span><span lang="EN-US">"info"</span><span lang="EN-US">, info);</span><span lang="EN-US"> </span></p>
<p style="margin:0cm 0cm 0pt;text-indent:20.25pt;text-align:left" align="left"><span lang="EN-US">//</span><span>向<span lang="EN-US">testCollection</span>表中插入一条数据<span lang="EN-US"></span></span></p>
<p style="margin:0cm 0cm 0pt;text-indent:20.25pt;text-align:left" align="left"><span lang="EN-US">coll.insert(doc);</span><span lang="EN-US"> </span></p>
<p style="margin:0cm 0cm 0pt;text-indent:20.25pt;text-align:left" align="left"><span lang="EN-US">//</span><span>查询一条数据<span lang="EN-US"></span></span></p>
<p style="margin:0cm 0cm 0pt;text-align:left" align="left"><span lang="EN-US">    DBObject myDoc = coll.findOne();</span><span lang="EN-US"> </span></p>
<p style="margin:0cm 0cm 0pt;text-align:left" align="left"><span lang="EN-US">    System.</span><em><span lang="EN-US">out</span></em><span lang="EN-US">.println(myDoc);</span><span lang="EN-US"> </span></p>
<p style="margin:0cm 0cm 0pt;text-align:left" align="left"><span lang="EN-US">    </span><span lang="EN-US"></span></p>
<p style="margin:0cm 0cm 0pt;text-align:left" align="left"><span lang="EN-US">    </span><span lang="EN-US">//</span><span>循环插入<span lang="EN-US">100</span>条数据到<span lang="EN-US">testCollection</span></span><span lang="EN-US"></span></p>
<p style="margin:0cm 0cm 0pt;text-align:left" align="left"><span lang="EN-US">    </span><strong><span lang="EN-US">for</span></strong><span lang="EN-US"> (</span><strong><span lang="EN-US">int</span></strong><span lang="EN-US"> i=0; i &lt; 100; i++) {</span><span lang="EN-US"> </span></p>
<p style="margin:0cm 0cm 0pt;text-align:left" align="left"><span lang="EN-US">      coll.insert(</span><strong><span lang="EN-US">new</span></strong><span lang="EN-US"> BasicDBObject().append(</span><span lang="EN-US">"i"</span><span lang="EN-US">, i));</span><span lang="EN-US"> </span></p>
<p style="margin:0cm 0cm 0pt;text-align:left" align="left"><span lang="EN-US">    }</span><span lang="EN-US"> </span></p>
<p style="margin:0cm 0cm 0pt;text-align:left" align="left"><span lang="EN-US">    </span><span lang="EN-US"></span></p>
<p style="margin:0cm 0cm 0pt;text-align:left" align="left"><span lang="EN-US">    </span><span lang="EN-US"></span></p>
<p style="margin:0cm 0cm 0pt;text-align:left" align="left"><span lang="EN-US">    </span><span lang="EN-US">//Counting Documents in A Collection</span><span lang="EN-US"> </span></p>
<p style="margin:0cm 0cm 0pt;text-align:left" align="left"><span lang="EN-US">    System.</span><em><span lang="EN-US">out</span></em><span lang="EN-US">.println(coll.getCount());</span><span lang="EN-US"> </span></p>
<p style="margin:0cm 0cm 0pt;text-align:left" align="left"><span lang="EN-US">    </span><span lang="EN-US"></span></p>
<p style="margin:0cm 0cm 0pt;text-align:left" align="left"><span lang="EN-US">    </span><span lang="EN-US">//Using a Cursor to Get All the Documents</span><span lang="EN-US"> </span></p>
<p style="margin:0cm 0cm 0pt;text-align:left" align="left"><span lang="EN-US">    DBCursor <span style="background:yellow">cur</span> = coll.find();</span><span lang="EN-US"> </span></p>
<p style="margin:0cm 0cm 0pt;text-align:left" align="left"><span lang="EN-US">    </span><strong><span lang="EN-US">while</span></strong><span lang="EN-US">(<span style="background:yellow">cur</span>.hasNext()) {</span><span></span><br>
          作者: <a href="http://yh15915798591.javaeye.com">yh15915798591</a> 
          <br>
          声明: 本文系JavaEye网站发布的原创文章，未经作者书面许可，严禁任何网站转载本文，否则必将追究法律责任！
          <br><br>
          <span style="color:red">
            <a href="http://www.javaeye.com/topic/757301" style="color:red">已有 <strong>1</strong> 人发表回复，猛击-&gt;&gt;<strong>这里</strong>&lt;&lt;-参与讨论</a>
          </span>
          <br><br><br>
<span style="color:#e28822">JavaEye推荐</span>
<br>
<ul><li><a href="http://www.iteye.com/clicks/138"><span style="color:red;font-weight:bold">上海：高薪诚聘Python开发人员</span></a></li><li><a href="http://www.iteye.com/clicks/269"><span style="color:red;font-weight:bold">北京：手机之家网站诚聘PHP程序员</span></a></li></ul>
<br><br><br></p></span></span></p>


</div>


            <div class="footer">
              <div class="contact">
                <p>
                  Your Name<br />
                  What You Are<br />
                  your@email.com
                </p>
              </div>
              <div class="contact">
                <p>
                  <a href="http://github.com/lyuehh/">github.com/lyuehh</a><br />
                  <a href="http://twitter.com/lyuehh/">twitter.com/lyuehh</a><br />
                </p>
              </div>
            </div>
          </div>
        </div> <!-- /container -->

    </body>
</html>
