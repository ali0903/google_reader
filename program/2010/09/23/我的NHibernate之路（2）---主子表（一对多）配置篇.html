<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>我的NHibernate之路（2）---主子表（一对多）配置篇</title>
        <meta name="viewport" content="width=device-width">

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/css/syntax.css">

        <!-- Custom CSS -->
        <link rel="stylesheet" href="/css/main.css">

    </head>
    <body>

        <div class="container">
          <div class="site">
            <div class="header">
              <h1 class="title"><a href="/">Your New Jekyll Site</a></h1>
              <a class="extra" href="/">home</a>
            </div>

                <h2>我的NHibernate之路（2）---主子表（一对多）配置篇</h2>
<p class="meta">23 Sep 2010</p>

<div class="post">
<h2>我的NHibernate之路（2）---主子表（一对多）配置篇</h2>

<h3>by tyb1222</h3>

<h3>at 2010-09-23 00:40:00</h3>

<h3>original <a href="http://www.cnblogs.com/tyb1222/archive/2010/09/23/1833222.html">http://www.cnblogs.com/tyb1222/archive/2010/09/23/1833222.html</a></h3>

<p>作者: <a href="http://www.cnblogs.com/tyb1222/">tyb1222</a> 发表于 2010-09-23 00:40 <a href="http://www.cnblogs.com/tyb1222/archive/2010/09/23/1833222.html">原文链接</a> 阅读: 262 评论: 2</p>


<p>　　通过我上篇文章的配置，单独做一张表的操作已经够了。但是在我们实际开发的过程中，很多时候数据库中都存在着主子表等关系，这时候就存在主表中的一条记录可能对应多条字表中的记录。那么这种情况下，我们还用上篇文章的的简单配置就不够了。下面我通过一个实际的例子说说Nhibernate中主子表的配置。</p>


<p>　　先介绍开发环境和软件版本：VS2008 SP1、NHibernate-2.1.2.GA-bin。在下面的例子中，就两张表，一张Class表，一张Student表。这就是一个典型的主子表的关系。</p>


<p>　　<img src="http://pic002.cnblogs.com/images/2010/53750/2010092223524782.jpg" alt=""></p>


<p>　　这种情况下的Nhibernate配置与上篇中的相同，所需要改变的是映射文件的配置。操作如下：</p>


<p>　　1、映射文件配置。</p>


<p>　　主表的映射：一对多的关系。配置如下：</p>


<p>　　<span style="color:#ff0000">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;</span><br><span style="color:#ff0000">&lt;hibernate-mapping xmlns=&quot;urn:nhibernate-mapping-2.2&quot; assembly=&quot;Model&quot; namespace=&quot;NHibernateSample.Model&quot;&gt;</span><br><span style="color:#ff0000">    &lt;class name=&quot;NHibernateSample.Model.Class, Model&quot; table=&quot;`Class`&quot;&gt;</span><br><span style="color:#ff0000">        &lt;id name=&quot;Id&quot; type=&quot;Int32&quot; unsaved-value=&quot;0&quot;&gt;</span><br><span style="color:#ff0000">            &lt;column name=&quot;ClassId&quot; length=&quot;4&quot; sql-type=&quot;int&quot; not-null=&quot;true&quot; unique=&quot;true&quot; index=&quot;PK_Class&quot;/&gt;</span><br><span style="color:#ff0000">            &lt;generator class=&quot;native&quot; /&gt;</span><br><span style="color:#ff0000">        &lt;/id&gt;</span><br><span style="color:#ff0000">        &lt;property name=&quot;ClassCode&quot; type=&quot;String&quot;&gt;</span><br><span style="color:#ff0000">            &lt;column name=&quot;ClassCode&quot; length=&quot;50&quot; sql-type=&quot;varchar&quot; not-null=&quot;false&quot;/&gt;</span><br><span style="color:#ff0000">        &lt;/property&gt;</span><br><span style="color:#ff0000">        &lt;property name=&quot;PeopleCount&quot; type=&quot;Int32&quot;&gt;</span><br><span style="color:#ff0000">            &lt;column name=&quot;PeopleCount&quot; length=&quot;4&quot; sql-type=&quot;int&quot; not-null=&quot;false&quot;/&gt;</span><br><span style="color:#ff0000">        &lt;/property&gt;</span><br><span style="color:#000000">        &lt;bag name=&quot;Students&quot; inverse=&quot;true&quot; lazy=&quot;true&quot; cascade=&quot;all-delete-orphan&quot;&gt;</span><br><span style="color:#000000">            &lt;key column=&quot;ClassId&quot;/&gt;</span><br><span style="color:#000000">            &lt;one-to-many class=&quot;NHibernateSample.Model.Student, Model&quot;/&gt;</span><br><span style="color:#000000">        &lt;/bag&gt;</span><br><span style="color:#ff0000">    &lt;/class&gt;</span><br><span style="color:#ff0000">&lt;/hibernate-mapping&gt;</span></p>


<p><span style="color:#ff0000"><span style="color:#000000">　　其中，黑色部分便是对一对多关系的配置。说明如下：</span></span></p>


<p><span style="color:#ff0000"><span style="color:#000000">　　bag：对象结合。结合中的元素可以重复。相当于.Net中的IList或者IList&lt;T&gt;.name=&quot;Students&quot;说的是在实体类Class</span>中<span style="color:#000000">有一个Students的属性。</span></span><span style="color:#000000">inverse=“TRUE”说名是子实体类维护关联关系，它默认为FALSE，即夫实维护关联关系。</span><span style="color:#000000">cascade=&quot;all-delete-orphan&quot;指明当添加主表中的记录时，会添加相关的记录到字表中，此时相当于“save-update”。当删除主表中的记录时，会级联删除字表中相关联的记录，此时相当于“delete”在父类中删除对应数据库记录时。即在子表中不会出现一些与主表无关联的数据。</span></p>


<p><span style="color:#000000">　　key:</span><span style="color:#000000">column="ClassId"说明是</span><span style="color:#000000">"ClassId"列与字表关联</span></p>


<p><span style="color:#000000">　　</span><span style="color:#000000">one-to-many class="NHibernateSample.Model.Student, Model"。one-to-many指明是一对多的关系。在此映射文件中一当然是指Class实体。多指的是</span><span style="color:#000000">Model程序集中的、命名空间为</span><span style="color:#000000">NHibernateSample.Model的Student实体</span></p>


<p>　　字表的映射：多对已的关系。配置如下：</p>


<p>　　<span style="color:#ff0000">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;</span><br><span style="color:#ff0000">&lt;hibernate-mapping xmlns=&quot;urn:nhibernate-mapping-2.2&quot; assembly=&quot;Model&quot; namespace=&quot;NHibernateSample.Model&quot;&gt;</span><br><span style="color:#ff0000">    &lt;class name=&quot;NHibernateSample.Model.Student, Model&quot; table=&quot;Student&quot;&gt;</span><br><span style="color:#ff0000">        &lt;id name=&quot;Id&quot; type=&quot;Int32&quot; unsaved-value=&quot;0&quot;&gt;</span><br><span style="color:#ff0000">            &lt;column name=&quot;StudentID&quot; length=&quot;4&quot; sql-type=&quot;int&quot; not-null=&quot;true&quot; unique=&quot;true&quot; index=&quot;PK_Student&quot;/&gt;</span><br><span style="color:#ff0000">            &lt;generator  class=&quot;native&quot; /&gt;</span><br><span style="color:#ff0000">        &lt;/id&gt;</span><br><span style="color:#ff0000">        &lt;property name=&quot;Name&quot; type=&quot;String&quot;&gt;</span><br><span style="color:#ff0000">            &lt;column name=&quot;Name&quot; length=&quot;50&quot; sql-type=&quot;varchar&quot; not-null=&quot;false&quot;/&gt;</span><br><span style="color:#ff0000">        &lt;/property&gt;</span><br><span style="color:#ff0000">        &lt;property name=&quot;Tel&quot; type=&quot;String&quot;&gt;</span><br><span style="color:#ff0000">            &lt;column name=&quot;Tel&quot; length=&quot;50&quot; sql-type=&quot;varchar&quot; not-null=&quot;false&quot;/&gt;</span><br><span style="color:#ff0000">        &lt;/property&gt;</span><br>       <span style="color:#000000"> &lt;many-to-one name=&quot;Class&quot; class=&quot;NHibernateSample.Model.Class, Model&quot;&gt;</span><br><span style="color:#000000">            &lt;column name=&quot;ClassId&quot; length=&quot;4&quot; sql-type=&quot;int&quot; not-null=&quot;false&quot;/&gt;</span><br><span style="color:#000000">        &lt;/many-to-one&gt;</span><br><span style="color:#ff0000">    &lt;/class&gt;</span><br><span style="color:#ff0000">&lt;/hibernate-mapping&gt;</span></p>


<p>　　这里我也只说说many-to-one含义.</p>


<p>　　many-to-one：指的是多个Student对应一个Class，<span style="color:#000000"> name="Class"指Student实体中有一个Class的属性。Class位于程序集Model中，它对应的是</span><span style="color:#000000">NHibernateSample.Model.Class类。</span></p>


<p><span style="color:#000000">　　</span><span style="color:#000000">column name</span><span style="color:#000000">e="ClassId"指的是</span><span style="color:#000000">ClassId和Class表关联</span></p>


<p>　　2、对涉及的主子表的添加操作。　　</p>


<p>　　　 Class c = new Class();     　　　　　　//班级类</p>


<p>            Student stu = new Student();　　　//学生类<br>            stu.Name = &quot;tao&quot;;<br>            stu.Tel = &quot;123123123&quot;;<br>            stu.Class = c;</p>


<p>            c.PeopleCount = 30;　　　　　　<br>            c.ClassCode = &quot;03510236&quot;;<br>            c.Students.Add(stu);　　　　　　//将学生添加到班级中</p>


<p>            ClassBLL cBLL = new ClassBLL();<br>            cBLL.AddClass(c);　　　　　　　//将班级、学生持久化到数据库</p>


<p>　　总结：多对一得映射和没有主子表关联关系的表不同的地方就是需要在主、子表中分别指明映射关系，即主子表是如何映射的。添加的时候只需要将子表对应的实体添加到主表对应的实体中，然后添加主表对应的实体即完成了对主子表的操作。</p>


<p>　　谢谢您的阅读,希望此文对你有一定的帮助！</p>


<p><img src="http://www.cnblogs.com/tyb1222/aggbug/1833222.html?type=1" width="1" height="1" alt=""><p>评论: 2　<a href="http://www.cnblogs.com/tyb1222/archive/2010/09/23/1833222.html#pagedcomment">查看评论</a>　<a href="http://www.cnblogs.com/tyb1222/archive/2010/09/23/1833222.html#commentform">发表评论</a></p><p><a href="http://job.cnblogs.com/">程序员找工作，就在博客园</a></p><hr><p>最新新闻：<br>· <a href="http://news.cnblogs.com/n/75185/">TCL年底前国内推出Android手机：明年再推数款</a><span style="color:gray">(2010-09-23 10:32)</span><br>· <a href="http://news.cnblogs.com/n/75183/">传Twitter第四季向部分企业提供免费分析工具</a><span style="color:gray">(2010-09-23 10:25)</span><br>· <a href="http://news.cnblogs.com/n/75173/">OpenIndiana从OpenSolaris倒下的地方站了起来</a><span style="color:gray">(2010-09-23 10:24)</span><br>· <a href="http://news.cnblogs.com/n/75180/">加拿大结束Facebook隐私调查 称整改措施到位</a><span style="color:gray">(2010-09-23 10:18)</span><br>· <a href="http://news.cnblogs.com/n/75179/">Java之父首度谈论离开甲骨文原因：薪水太低</a><span style="color:gray">(2010-09-23 10:13)</span><br></p><p>编辑推荐：<a href="http://www.cnblogs.com/parry/archive/2010/09/20/ASP_NET_Security_Vulnerability_Padding_Oracle.html">详解ASP.NET的最新安全漏洞</a><br></p><p>网站导航：<a href="http://www.cnblogs.com">博客园首页</a>  <a href="http://home.cnblogs.com/">个人主页</a>  <a href="http://news.cnblogs.com">新闻</a>  <a href="http://home.cnblogs.com/ing/">闪存</a>  <a href="http://home.cnblogs.com/group/">小组</a>  <a href="http://space.cnblogs.com/q/">博问</a>  <a href="http://space.cnblogs.com">社区</a>  <a href="http://kb.cnblogs.com">知识库</a></p></p>

</div>


            <div class="footer">
              <div class="contact">
                <p>
                  Your Name<br />
                  What You Are<br />
                  your@email.com
                </p>
              </div>
              <div class="contact">
                <p>
                  <a href="http://github.com/yourusername/">github.com/yourusername</a><br />
                  <a href="http://twitter.com/yourusername/">twitter.com/yourusername</a><br />
                </p>
              </div>
            </div>
          </div>
        </div> <!-- /container -->

    </body>
</html>
