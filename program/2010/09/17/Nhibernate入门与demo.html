<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Nhibernate入门与demo</title>
        <meta name="viewport" content="width=device-width">

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/google_reader/css/syntax.css">

        <!-- Custom CSS -->
        <link rel="stylesheet" href="/google_reader/css/main.css">

    </head>
    <body>

        <div class="container">
          <div class="site">
            <div class="header">
              <h1 class="title"><a href="/google_reader/">Google Reader</a></h1>
              <a class="extra" href="/google_reader/">home</a>
            </div>

                <h2>Nhibernate入门与demo</h2>
<p class="meta">2010-09-17 00:03</p>

<div class="post">
<h2>Nhibernate入门与demo</h2>

<h3>by FlyDragon</h3>

<h3>at 2010-09-16 16:03:00</h3>

<h3>original <a href="http://www.cnblogs.com/fly_dragon/archive/2010/09/16/1828192.html">http://www.cnblogs.com/fly_dragon/archive/2010/09/16/1828192.html</a></h3>

<p><a href="http://www.cnblogs.com/fly_dragon/"><img src="http://pic.cnblogs.com/face/u154994.jpg" alt="" border="0"></a><br>作者: <a href="http://www.cnblogs.com/fly_dragon/">FlyDragon</a> 发表于 2010-09-16 16:03 <a href="http://www.cnblogs.com/fly_dragon/archive/2010/09/16/1828192.html">原文链接</a> 阅读: 1352 评论: 23</p>


<p>      学习和使用Nhibernate已经很久了，一直想写点东西和大家一起学习使用Nhibernate。博客园里也有很多大牛写了很多关于Nhibernate入门的文章。其中：<span>李永京的博客</span>http://www.cnblogs.com/lyj/tag/NHibernate/  内容最为丰富。而且在李哥的博客里面学了很多东西，在此致谢！</p>


<p>      本篇文章阅读对象是：Nhibernate初学者！如果你是Nhibernate的研究者或者已经很熟练的运用Nhibernate请不吝赐教，对本文不足之处进行指教。</p>


<p>     带着问题去学习！学完这些后，希望你能回答下面几个问题：</p>


<p>     1、<strong>Nhibernate是什么？</strong></p>


<p>     2、Nhibernate能做什么？带给我们的什么？</p>


<p>     3、怎么搭建Nhibernate？</p>


<p>     4、怎么使用Nhibernate？</p>


<p>     好，我们就带着这几个问题开始我们的Nhibernate的旅程。</p>


<p><strong>    第一个问题：</strong></p>


<p>     要明白Nhibernate是什么，就要首先明白什么是ORM。</p>


<p>      先看一张经典的图：</p>


<p><img src="http://pic002.cnblogs.com/img/malun666/201009/2010091615361932.png"></p>


<p>     ORM：对象关系映射(O/R Mapping，Object Relational Mapping)表示一种技术，用来把对象模型表示的对象映射到基于SQL 的关系模型数据结构中去。通俗讲，就是我们操作实体类，然后让ORM框架自动映射到数据库中。</p>


<p>     而Nhibernate就是：.Net环境下实现ORM的技术的一个框架！</p>


<p><strong>     第二个问题：</strong></p>


<p>     Nhibernate能做什么呢？</p>


<p>     看下面代码：
</p>


<div>
<pre><div><span style="color:#000000">User myUser </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">new</span><span style="color:#000000"> User();<br></span><span style="color:#008000">//</span><span style="color:#008000">User初始化........</span><span style="color:#008000"><br></span><span style="color:#000000">session.Save(myUser);</span><span style="color:#008000">//</span><span style="color:#008000">保存一个用户</span><span style="color:#008000"><br></span><span style="color:#000000">session.Update(myUser);</span><span style="color:#008000">//</span><span style="color:#008000">更新用户</span><span style="color:#008000"><br></span><span style="color:#000000">session.Delete(myUser);</span><span style="color:#008000">//</span><span style="color:#008000">删除用户</span><span style="color:#008000"><br></span><span style="color:#000000">User user </span><span style="color:#000000">=</span><span style="color:#000000"> session.Get</span><span style="color:#000000">&lt;</span><span style="color:#000000">User</span><span style="color:#000000">&gt;</span><span style="color:#000000">(Id) </span><span style="color:#0000ff">as</span><span style="color:#000000"> User;</span><span style="color:#008000">//</span><span style="color:#008000">根据主键获取用户的 用户实例</span></div></pre>
</div>


<p>      session哇！这么牛，不用写一句sql   session就帮你把所有的活都干了！那session设计肯定很难吧？告诉你吧，session是我们只需要一个配置文件就可以随处调用了。这么神奇？</p>


<p>     Nhibernate带给我们的就是：对于开发者通常的数据持久化相关的编程任务，解放其中的95%！</p>


<p>    <strong> 第三个问题：</strong></p>


<p>     这是本文的关键，是怎么搭建呢？</p>


<p>     先看项目整体图，作为初学的demo 没有层次，没有优化，只是作为入门的一个简单介绍！</p>


<p>     <img src="http://pic002.cnblogs.com/img/malun666/201009/2010091617341971.png"></p>


<p>     第一步：设计数据库中的表。建立一个User表。代码如下：     </p>


<div><img src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif"><img src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif"><span>代码</span>
<div>
<pre><div><span style="color:#0000ff">CREATE</span><span style="color:#000000"> </span><span style="color:#0000ff">TABLE</span><span style="color:#000000"> Hksj_User<br>(<br>    Id </span><span style="color:#0000ff">INT</span><span style="color:#000000"> </span><span style="color:#ff00ff">IDENTITY</span><span style="color:#000000">(</span><span style="color:#800000;font-weight:bold">1</span><span style="color:#000000">,</span><span style="color:#800000;font-weight:bold">1</span><span style="color:#000000">) </span><span style="color:#808080">NOT</span><span style="color:#000000"> </span><span style="color:#0000ff">NULL</span><span style="color:#000000">,           </span><span style="color:#008080">--</span><span style="color:#008080">id主键</span><span style="color:#008080"><br></span><span style="color:#000000">    SName </span><span style="color:#0000ff">NVARCHAR</span><span style="color:#000000">(</span><span style="color:#800000;font-weight:bold">20</span><span style="color:#000000">) </span><span style="color:#808080">NOT</span><span style="color:#000000"> </span><span style="color:#0000ff">NULL</span><span style="color:#000000">,        </span><span style="color:#008080">--</span><span style="color:#008080">用户名</span><span style="color:#008080"><br></span><span style="color:#000000">    SNickName </span><span style="color:#0000ff">NVARCHAR</span><span style="color:#000000">(</span><span style="color:#800000;font-weight:bold">20</span><span style="color:#000000">),                  </span><span style="color:#008080">--</span><span style="color:#008080">真实姓名</span><span style="color:#008080"><br></span><span style="color:#000000">    SPassWord </span><span style="color:#0000ff">NVARCHAR</span><span style="color:#000000">(</span><span style="color:#800000;font-weight:bold">30</span><span style="color:#000000">) </span><span style="color:#808080">NOT</span><span style="color:#000000"> </span><span style="color:#0000ff">NULL</span><span style="color:#000000">, </span><span style="color:#008080">--</span><span style="color:#008080">密码</span><span style="color:#008080"><br></span><span style="color:#000000">    DCreateDate </span><span style="color:#0000ff">DATETIME</span><span style="color:#000000"> ,                      </span><span style="color:#008080">--</span><span style="color:#008080">创建 日期</span><span style="color:#008080"><br></span><span style="color:#000000">    SCreator </span><span style="color:#0000ff">NVARCHAR</span><span style="color:#000000">(</span><span style="color:#800000;font-weight:bold">20</span><span style="color:#000000">),                      </span><span style="color:#008080">--</span><span style="color:#008080">创建人</span><span style="color:#008080"><br></span><span style="color:#000000">    SEmail </span><span style="color:#0000ff">NVARCHAR</span><span style="color:#000000">(</span><span style="color:#800000;font-weight:bold">50</span><span style="color:#000000">),                          </span><span style="color:#008080">--</span><span style="color:#008080">Email</span><span style="color:#008080"><br></span><span style="color:#000000">    SPhone </span><span style="color:#0000ff">NVARCHAR</span><span style="color:#000000">(</span><span style="color:#800000;font-weight:bold">50</span><span style="color:#000000">),                         </span><span style="color:#008080">--</span><span style="color:#008080">电话</span><span style="color:#008080"><br></span><span style="color:#000000">    SIdentifyId </span><span style="color:#0000ff">NVARCHAR</span><span style="color:#000000">(</span><span style="color:#800000;font-weight:bold">30</span><span style="color:#000000">),                    </span><span style="color:#008080">--</span><span style="color:#008080">身份证</span><span style="color:#008080"><br></span><span style="color:#000000">    DLastTimeLogOn </span><span style="color:#0000ff">DATETIME</span><span style="color:#000000">                   </span><span style="color:#008080">--</span><span style="color:#008080">上次登录日期     </span><span style="color:#008080"><br></span><span style="color:#000000">    <br>    </span><span style="color:#0000ff">PRIMARY</span><span style="color:#000000"> </span><span style="color:#0000ff">KEY</span><span style="color:#000000"> </span><span style="color:#0000ff">CLUSTERED</span><span style="color:#000000"><br>    (<br>        Id </span><span style="color:#0000ff">ASC</span><span style="color:#000000"><br>    )</span><span style="color:#0000ff">WITH</span><span style="color:#000000"> (IGNORE_DUP_KEY </span><span style="color:#808080">=</span><span style="color:#000000"> </span><span style="color:#0000ff">OFF</span><span style="color:#000000">) </span><span style="color:#0000ff">ON</span><span style="color:#000000"> </span><span style="color:#ff0000">[</span><span style="color:#ff0000">PRIMARY</span><span style="color:#ff0000">]</span><span style="color:#000000"><br>) </span><span style="color:#0000ff">ON</span><span style="color:#000000"> </span><span style="color:#ff0000">[</span><span style="color:#ff0000">PRIMARY</span><span style="color:#ff0000">]</span><span style="color:#000000"><br></span><span style="color:#0000ff">END</span><span style="color:#000000"><br><br></span></div></pre>
</div>
</div>


<p>    第二步：设计User类。 代码如下：
</p>


<div><img src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif"><img src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif"><span>代码</span>
<div>
<pre><div><span style="color:#0000ff">using</span><span style="color:#000000"> System;<br></span><span style="color:#0000ff">using</span><span style="color:#000000"> System.Collections.Generic;<br></span><span style="color:#0000ff">using</span><span style="color:#000000"> System.Linq;<br></span><span style="color:#0000ff">using</span><span style="color:#000000"> System.Text;<br><br></span><span style="color:#0000ff">namespace</span><span style="color:#000000"> MyWeb.WebTemp.Model<br>{<br>    </span><span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">class</span><span style="color:#000000"> User<br>    {<br>        </span><span style="color:#808080">///</span><span style="color:#008000"> </span><span style="color:#808080">&lt;summary&gt;</span><span style="color:#008000"><br>        </span><span style="color:#808080">///</span><span style="color:#008000"> 用户id<br>        </span><span style="color:#808080">///</span><span style="color:#008000"> </span><span style="color:#808080">&lt;/summary&gt;</span><span style="color:#808080"><br></span><span style="color:#000000">        </span><span style="color:#0000ff">public</span><span style="color:#000000"> Int32 Id<br>        {<br>            </span><span style="color:#0000ff">get</span><span style="color:#000000">;<br>            </span><span style="color:#0000ff">set</span><span style="color:#000000">;<br>        }<br><br>        </span><span style="color:#808080">///</span><span style="color:#008000"> </span><span style="color:#808080">&lt;summary&gt;</span><span style="color:#008000"><br>        </span><span style="color:#808080">///</span><span style="color:#008000"> 用户名，登录所用的名字<br>        </span><span style="color:#808080">///</span><span style="color:#008000"> </span><span style="color:#808080">&lt;/summary&gt;</span><span style="color:#808080"><br></span><span style="color:#000000">        </span><span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">string</span><span style="color:#000000"> Name<br>        {<br>            </span><span style="color:#0000ff">get</span><span style="color:#000000">;<br>            </span><span style="color:#0000ff">set</span><span style="color:#000000">;<br>        }<br><br>        </span><span style="color:#808080">///</span><span style="color:#008000"> </span><span style="color:#808080">&lt;summary&gt;</span><span style="color:#008000"><br>        </span><span style="color:#808080">///</span><span style="color:#008000"> 真实姓名<br>        </span><span style="color:#808080">///</span><span style="color:#008000"> </span><span style="color:#808080">&lt;/summary&gt;</span><span style="color:#808080"><br></span><span style="color:#000000">        </span><span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">string</span><span style="color:#000000"> NickName<br>        {<br>            </span><span style="color:#0000ff">get</span><span style="color:#000000">;<br>            </span><span style="color:#0000ff">set</span><span style="color:#000000">;<br>        }<br><br>        </span><span style="color:#808080">///</span><span style="color:#008000"> </span><span style="color:#808080">&lt;summary&gt;</span><span style="color:#008000"><br>        </span><span style="color:#808080">///</span><span style="color:#008000"> 密码<br>        </span><span style="color:#808080">///</span><span style="color:#008000"> </span><span style="color:#808080">&lt;/summary&gt;</span><span style="color:#808080"><br></span><span style="color:#000000">        </span><span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">string</span><span style="color:#000000"> PassWord<br>        {<br>            </span><span style="color:#0000ff">get</span><span style="color:#000000">;<br>            </span><span style="color:#0000ff">set</span><span style="color:#000000">;<br>        }<br><br>        </span><span style="color:#808080">///</span><span style="color:#008000"> </span><span style="color:#808080">&lt;summary&gt;</span><span style="color:#008000"><br>        </span><span style="color:#808080">///</span><span style="color:#008000"> 创建日期<br>        </span><span style="color:#808080">///</span><span style="color:#008000"> </span><span style="color:#808080">&lt;/summary&gt;</span><span style="color:#808080"><br></span><span style="color:#000000">        </span><span style="color:#0000ff">public</span><span style="color:#000000"> DateTime CreateTime<br>        {<br>            </span><span style="color:#0000ff">get</span><span style="color:#000000">;<br>            </span><span style="color:#0000ff">set</span><span style="color:#000000">;<br>        }<br><br>        </span><span style="color:#808080">///</span><span style="color:#008000"> </span><span style="color:#808080">&lt;summary&gt;</span><span style="color:#008000"><br>        </span><span style="color:#808080">///</span><span style="color:#008000"> 创建人<br>        </span><span style="color:#808080">///</span><span style="color:#008000"> </span><span style="color:#808080">&lt;/summary&gt;</span><span style="color:#808080"><br></span><span style="color:#000000">        </span><span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">string</span><span style="color:#000000"> Creator<br>        {<br>            </span><span style="color:#0000ff">get</span><span style="color:#000000">;<br>            </span><span style="color:#0000ff">set</span><span style="color:#000000">;<br>        }<br><br>        </span><span style="color:#808080">///</span><span style="color:#008000"> </span><span style="color:#808080">&lt;summary&gt;</span><span style="color:#008000"><br>        </span><span style="color:#808080">///</span><span style="color:#008000"> Email<br>        </span><span style="color:#808080">///</span><span style="color:#008000"> </span><span style="color:#808080">&lt;/summary&gt;</span><span style="color:#808080"><br></span><span style="color:#000000">        </span><span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">string</span><span style="color:#000000"> Email<br>        {<br>            </span><span style="color:#0000ff">get</span><span style="color:#000000">;<br>            </span><span style="color:#0000ff">set</span><span style="color:#000000">;<br>        }<br><br>        </span><span style="color:#808080">///</span><span style="color:#008000"> </span><span style="color:#808080">&lt;summary&gt;</span><span style="color:#008000"><br>        </span><span style="color:#808080">///</span><span style="color:#008000"> 联系电话<br>        </span><span style="color:#808080">///</span><span style="color:#008000"> </span><span style="color:#808080">&lt;/summary&gt;</span><span style="color:#808080"><br></span><span style="color:#000000">        </span><span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">string</span><span style="color:#000000"> Phone<br>        {<br>            </span><span style="color:#0000ff">get</span><span style="color:#000000">;<br>            </span><span style="color:#0000ff">set</span><span style="color:#000000">;<br>        }<br><br>        </span><span style="color:#808080">///</span><span style="color:#008000"> </span><span style="color:#808080">&lt;summary&gt;</span><span style="color:#008000"><br>        </span><span style="color:#808080">///</span><span style="color:#008000"> 身份证<br>        </span><span style="color:#808080">///</span><span style="color:#008000"> </span><span style="color:#808080">&lt;/summary&gt;</span><span style="color:#808080"><br></span><span style="color:#000000">        </span><span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">string</span><span style="color:#000000"> IdentifyId<br>        {<br>            </span><span style="color:#0000ff">get</span><span style="color:#000000">;<br>            </span><span style="color:#0000ff">set</span><span style="color:#000000">;<br>        }<br><br>        </span><span style="color:#808080">///</span><span style="color:#008000"> </span><span style="color:#808080">&lt;summary&gt;</span><span style="color:#008000"><br>        </span><span style="color:#808080">///</span><span style="color:#008000"> 最后一次登录时间<br>        </span><span style="color:#808080">///</span><span style="color:#008000"> </span><span style="color:#808080">&lt;/summary&gt;</span><span style="color:#808080"><br></span><span style="color:#000000">        </span><span style="color:#0000ff">public</span><span style="color:#000000"> DateTime LastTimeLogOn<br>        {<br>            </span><span style="color:#0000ff">get</span><span style="color:#000000">;<br>            </span><span style="color:#0000ff">set</span><span style="color:#000000">;<br>        }<br>    }<br>}<br></span></div></pre>
</div>
</div>


<p>
     第三步：创建User类的映射文件 命名规则：User.hbm.xml  代码如下：    
</p>


<div><img src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif"><img src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif"><span>代码</span>
<div>
<pre><div><span style="color:#0000ff">&lt;?</span><span style="color:#ff00ff">xml version="1.0" encoding="utf-8" </span><span style="color:#0000ff">?&gt;</span><span style="color:#000000"><br></span><span style="color:#0000ff">&lt;</span><span style="color:#800000">hibernate-mapping </span><span style="color:#ff0000">xmlns</span><span style="color:#0000ff">="urn:nhibernate-mapping-2.2"</span><span style="color:#0000ff">&gt;</span><span style="color:#000000"><br>  </span><span style="color:#0000ff">&lt;</span><span style="color:#800000">class </span><span style="color:#ff0000">name</span><span style="color:#0000ff">="MyWeb.WebTemp.Model.User,MyWeb.WebTemp.Model"</span><span style="color:#ff0000"> table</span><span style="color:#0000ff">="Hksj_User"</span><span style="color:#ff0000"> lazy</span><span style="color:#0000ff">="false"</span><span style="color:#0000ff">&gt;</span><span style="color:#000000"><br>    </span><span style="color:#0000ff">&lt;</span><span style="color:#800000">id </span><span style="color:#ff0000">name</span><span style="color:#0000ff">="Id"</span><span style="color:#ff0000"> column</span><span style="color:#0000ff">="Id"</span><span style="color:#ff0000"> type</span><span style="color:#0000ff">="Int32"</span><span style="color:#0000ff">&gt;</span><span style="color:#000000"><br>      </span><span style="color:#0000ff">&lt;</span><span style="color:#800000">generator </span><span style="color:#ff0000">class</span><span style="color:#0000ff">="native"</span><span style="color:#ff0000"> </span><span style="color:#0000ff">/&gt;</span><span style="color:#000000"><br>    </span><span style="color:#0000ff">&lt;/</span><span style="color:#800000">id</span><span style="color:#0000ff">&gt;</span><span style="color:#000000"><br>    </span><span style="color:#0000ff">&lt;</span><span style="color:#800000">property </span><span style="color:#ff0000">name</span><span style="color:#0000ff">="Name"</span><span style="color:#ff0000"> column</span><span style="color:#0000ff">="SName"</span><span style="color:#ff0000"> type</span><span style="color:#0000ff">="String"</span><span style="color:#ff0000"> length</span><span style="color:#0000ff">="20"</span><span style="color:#ff0000"> </span><span style="color:#0000ff">/&gt;</span><span style="color:#000000"><br>    </span><span style="color:#0000ff">&lt;</span><span style="color:#800000">property </span><span style="color:#ff0000">name</span><span style="color:#0000ff">="NickName"</span><span style="color:#ff0000"> column</span><span style="color:#0000ff">="SNickName"</span><span style="color:#ff0000"> type</span><span style="color:#0000ff">="String"</span><span style="color:#ff0000"> length</span><span style="color:#0000ff">="20"</span><span style="color:#ff0000"> </span><span style="color:#0000ff">/&gt;</span><span style="color:#000000"><br>    </span><span style="color:#0000ff">&lt;</span><span style="color:#800000">property </span><span style="color:#ff0000">name</span><span style="color:#0000ff">="PassWord"</span><span style="color:#ff0000"> column</span><span style="color:#0000ff">="SPassWord"</span><span style="color:#ff0000"> type</span><span style="color:#0000ff">="String"</span><span style="color:#ff0000"> length</span><span style="color:#0000ff">="30"</span><span style="color:#ff0000"> </span><span style="color:#0000ff">/&gt;</span><span style="color:#000000"><br>    </span><span style="color:#0000ff">&lt;</span><span style="color:#800000">property </span><span style="color:#ff0000">name</span><span style="color:#0000ff">="IdentifyId"</span><span style="color:#ff0000"> column</span><span style="color:#0000ff">="SIdentifyId"</span><span style="color:#ff0000"> type</span><span style="color:#0000ff">="String"</span><span style="color:#ff0000"> length</span><span style="color:#0000ff">="30"</span><span style="color:#ff0000"> </span><span style="color:#0000ff">/&gt;</span><span style="color:#000000"><br>    </span><span style="color:#0000ff">&lt;</span><span style="color:#800000">property </span><span style="color:#ff0000">name</span><span style="color:#0000ff">="Phone"</span><span style="color:#ff0000"> column</span><span style="color:#0000ff">="SPhone"</span><span style="color:#ff0000"> type</span><span style="color:#0000ff">="String"</span><span style="color:#ff0000"> length</span><span style="color:#0000ff">="50"</span><span style="color:#ff0000"> </span><span style="color:#0000ff">/&gt;</span><span style="color:#000000"><br>    </span><span style="color:#0000ff">&lt;</span><span style="color:#800000">property </span><span style="color:#ff0000">name</span><span style="color:#0000ff">="Email"</span><span style="color:#ff0000"> column</span><span style="color:#0000ff">="SEmail"</span><span style="color:#ff0000"> type</span><span style="color:#0000ff">="String"</span><span style="color:#ff0000"> length</span><span style="color:#0000ff">="50"</span><span style="color:#ff0000"> </span><span style="color:#0000ff">/&gt;</span><span style="color:#000000"><br>    </span><span style="color:#0000ff">&lt;</span><span style="color:#800000">property </span><span style="color:#ff0000">name</span><span style="color:#0000ff">="CreateTime"</span><span style="color:#ff0000"> column</span><span style="color:#0000ff">="DCreateDate"</span><span style="color:#ff0000"> type</span><span style="color:#0000ff">="DateTime"</span><span style="color:#ff0000"> </span><span style="color:#0000ff">/&gt;</span><span style="color:#000000"><br>    </span><span style="color:#0000ff">&lt;</span><span style="color:#800000">property </span><span style="color:#ff0000">name</span><span style="color:#0000ff">="Creator"</span><span style="color:#ff0000"> column</span><span style="color:#0000ff">="SCreator"</span><span style="color:#ff0000"> type</span><span style="color:#0000ff">="String"</span><span style="color:#ff0000"> length</span><span style="color:#0000ff">="20"</span><span style="color:#ff0000"> </span><span style="color:#0000ff">/&gt;</span><span style="color:#000000"><br>    </span><span style="color:#0000ff">&lt;</span><span style="color:#800000">property </span><span style="color:#ff0000">name</span><span style="color:#0000ff">="LastTimeLogOn"</span><span style="color:#ff0000"> column</span><span style="color:#0000ff">="DLastTimeLogOn"</span><span style="color:#ff0000"> type</span><span style="color:#0000ff">="DateTime"</span><span style="color:#ff0000"> </span><span style="color:#0000ff">/&gt;</span><span style="color:#000000"><br>  </span><span style="color:#0000ff">&lt;/</span><span style="color:#800000">class</span><span style="color:#0000ff">&gt;</span><span style="color:#000000"><br></span><span style="color:#0000ff">&lt;/</span><span style="color:#800000">hibernate-mapping</span><span style="color:#0000ff">&gt;</span></div></pre>
</div>
</div>


<p>
     简单解释一下：</p>


<p>      1、&lt;property name=&quot;Email&quot; column=&quot;SEmail&quot; type=&quot;String&quot; length=&quot;50&quot; /&gt;    意思： property name指的是：User类的属性名字 Email对应数据库的列SEmail 类型是String，长度50个字符。</p>


<p>     2、&lt;class name=&quot;MyWeb.WebTemp.Model.User,MyWeb.WebTemp.Model&quot; table=&quot;Hksj_User&quot; lazy=&quot;false&quot;&gt;</p>


<p>         这个是配置类的全名称，以及所属的程序集。然后对应数据库的表名。设置延迟加载为false。具体可以参考Nhibernate官方文档。</p>


<p>    <span style="background-color:#ff0000"><strong> 3、一定要将这个文件的属性：生成操作设置为嵌入资源！</strong></span></p>


<p>     第四步：创建Nhibernate的配置文件：Nhibernate.cfg.xml   代码如下：    
</p>


<div><img src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif"><img src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif"><span>代码</span>
<div>
<pre><div><span style="color:#0000ff">&lt;?</span><span style="color:#ff00ff">xml version="1.0" encoding="utf-8" </span><span style="color:#0000ff">?&gt;</span><span style="color:#000000"><br></span><span style="color:#0000ff">&lt;</span><span style="color:#800000">hibernate-configuration </span><span style="color:#ff0000">xmlns</span><span style="color:#0000ff">="urn:nhibernate-configuration-2.2"</span><span style="color:#0000ff">&gt;</span><span style="color:#000000"><br>  </span><span style="color:#0000ff">&lt;</span><span style="color:#800000">session-factory</span><span style="color:#0000ff">&gt;</span><span style="color:#000000"><br>    </span><span style="color:#008000">&lt;!--</span><span style="color:#008000"> properties </span><span style="color:#008000">--&gt;</span><span style="color:#000000"><br>    </span><span style="color:#0000ff">&lt;</span><span style="color:#800000">property </span><span style="color:#ff0000">name</span><span style="color:#0000ff">="connection.provider"</span><span style="color:#0000ff">&gt;</span><span style="color:#000000">NHibernate.Connection.DriverConnectionProvider</span><span style="color:#0000ff">&lt;/</span><span style="color:#800000">property</span><span style="color:#0000ff">&gt;</span><span style="color:#000000"><br>    </span><span style="color:#0000ff">&lt;</span><span style="color:#800000">property </span><span style="color:#ff0000">name</span><span style="color:#0000ff">="connection.driver_class"</span><span style="color:#0000ff">&gt;</span><span style="color:#000000">NHibernate.Driver.SqlClientDriver</span><span style="color:#0000ff">&lt;/</span><span style="color:#800000">property</span><span style="color:#0000ff">&gt;</span><span style="color:#000000"><br>    </span><span style="color:#0000ff">&lt;</span><span style="color:#800000">property </span><span style="color:#ff0000">name</span><span style="color:#0000ff">="connection.connection_string"</span><span style="color:#0000ff">&gt;</span><span style="color:#000000">server=.;uid=sa;pwd=123;database=HkTemp;</span><span style="color:#0000ff">&lt;/</span><span style="color:#800000">property</span><span style="color:#0000ff">&gt;</span><span style="color:#000000"><br>    </span><span style="color:#0000ff">&lt;</span><span style="color:#800000">property </span><span style="color:#ff0000">name</span><span style="color:#0000ff">="dialect"</span><span style="color:#0000ff">&gt;</span><span style="color:#000000">NHibernate.Dialect.MsSql2005Dialect</span><span style="color:#0000ff">&lt;/</span><span style="color:#800000">property</span><span style="color:#0000ff">&gt;</span><span style="color:#000000"><br>    </span><span style="color:#0000ff">&lt;</span><span style="color:#800000">property </span><span style="color:#ff0000">name</span><span style="color:#0000ff">="show_sql"</span><span style="color:#0000ff">&gt;</span><span style="color:#000000">true </span><span style="color:#0000ff">&lt;/</span><span style="color:#800000">property</span><span style="color:#0000ff">&gt;</span><span style="color:#000000"><br>    </span><span style="color:#0000ff">&lt;</span><span style="color:#800000">property </span><span style="color:#ff0000">name</span><span style="color:#0000ff">="use_outer_join"</span><span style="color:#0000ff">&gt;</span><span style="color:#000000">true</span><span style="color:#0000ff">&lt;/</span><span style="color:#800000">property</span><span style="color:#0000ff">&gt;</span><span style="color:#000000"><br>    </span><span style="color:#0000ff">&lt;</span><span style="color:#800000">property </span><span style="color:#ff0000">name</span><span style="color:#0000ff">="query.substitutions"</span><span style="color:#0000ff">&gt;</span><span style="color:#000000">true 1, false 0, yes 'Y', no 'N'</span><span style="color:#0000ff">&lt;/</span><span style="color:#800000">property</span><span style="color:#0000ff">&gt;</span><span style="color:#000000"><br>    </span><span style="color:#008000">&lt;!--</span><span style="color:#008000"> 代理工厂,可以试用Castle,也可以试用LinFu </span><span style="color:#008000">--&gt;</span><span style="color:#000000"><br>    </span><span style="color:#008000">&lt;!--</span><span style="color:#008000"> &lt;property name=&quot;proxyfactory.factory_class&quot;&gt;NHibernate.ByteCode.LinFu.ProxyFactoryFactory, NHibernate.ByteCode.LinFu&lt;/property&gt;</span><span style="color:#008000">--&gt;</span><span style="color:#000000"><br>    </span><span style="color:#0000ff">&lt;</span><span style="color:#800000">property </span><span style="color:#ff0000">name</span><span style="color:#0000ff">='proxyfactory.factory_class'</span><span style="color:#0000ff">&gt;</span><span style="color:#000000">NHibernate.ByteCode.Castle.ProxyFactoryFactory, NHibernate.ByteCode.Castle</span><span style="color:#0000ff">&lt;/</span><span style="color:#800000">property</span><span style="color:#0000ff">&gt;</span><span style="color:#000000"><br><br>    </span><span style="color:#008000">&lt;!--</span><span style="color:#008000"> mapping files 领域对象映射文件所在程序集 </span><span style="color:#008000">--&gt;</span><span style="color:#000000"><br>    </span><span style="color:#0000ff">&lt;</span><span style="color:#800000">mapping </span><span style="color:#ff0000">assembly</span><span style="color:#0000ff">="NhibernateDemo"</span><span style="color:#0000ff">/&gt;</span><span style="color:#000000"><br>  </span><span style="color:#0000ff">&lt;/</span><span style="color:#800000">session-factory</span><span style="color:#0000ff">&gt;</span><span style="color:#000000"><br></span><span style="color:#0000ff">&lt;/</span><span style="color:#800000">hibernate-configuration</span><span style="color:#0000ff">&gt;</span></div></pre>
</div>
</div>


<p>
解释：</p>


<p>1、<span style="color:#008000">&lt;!--</span><span style="color:#008000"> mapping files 领域对象映射文件所在程序集 </span><span style="color:#008000">--&gt;</span></p>


<pre><span style="color:#000000">    </span><span style="color:#0000ff">&lt;</span><span style="color:#800000">mapping </span><span style="color:#ff0000">assembly</span><span style="color:#0000ff">="NhibernateDemo"</span><span style="color:#0000ff">/&gt;</span><span style="color:#000000">  这是将User.hbm.xml所在的程序集。Nhibernate自动去找Mapping映射！</span></pre>


<p>2、&lt;property name=&quot;connection.connection_string&quot;&gt;server=.;uid=sa;pwd=123;database=HkTemp;&lt;/property&gt;是配置数据库连接字符串。</p>


<p>其他的都是Nhibernate最重要的数据库provider，sessionfactory等。不详细说。看官方文档！</p>


<p>     <strong> 第四个问题：  </strong>   </p>


<p>      使用和测试你的配置【可以爽一把了！】</p>


<p>     在Default.aspx   代码文件中添加如下代码</p>


<div><img src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif"><img src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif"><span>代码</span>
<div>
<pre><div><span style="color:#000000">Configuration cfg = new Configuration();<br>            cfg.Configure(Server.MapPath("~") + "Nhibernate.cfg.xml");<br>            ISessionFactory _SessionFactory = cfg.BuildSessionFactory();//建立Session工厂<br>            ISession session = _SessionFactory.OpenSession();//打开Session<br>MyWeb.WebTemp.Model.User myUser = new User {IdentifyId="122222",Email="22222",CreateTime=DateTime.Now, LastTimeLogOn = DateTime.Now, Name= "ml",NickName="malun",PassWord="123",Phone="nihao" };<br>           session.Save(myUser);<br>           session.Flush();<br>            session.Delete(User);</span></div></pre>
</div>
</div>


<p>
     查看数据库中，有没有一条数据保存了？</p>


<p>     Nhibernate做的不只是这些！搭载Spring.Net  Nhibernate能做的更多！而且代码会更加优美！</p>


<p> </p>


<p>     源码下载：<a href="http://files.cnblogs.com/fly_dragon/NhibernateDemo.zip">NhibernateDemo.zip</a></p>


<p><img src="http://www.cnblogs.com/fly_dragon/aggbug/1828192.html?type=1" width="1" height="1" alt=""><p>评论: 23　<a href="http://www.cnblogs.com/fly_dragon/archive/2010/09/16/1828192.html#pagedcomment">查看评论</a>　<a href="http://www.cnblogs.com/fly_dragon/archive/2010/09/16/1828192.html#commentform">发表评论</a></p><p><a href="http://job.cnblogs.com/">程序员找工作，就在博客园</a></p><hr><p>最新新闻：<br>· <a href="http://news.cnblogs.com/n/74612/">黑客正准备发布iOS 4.1永久越狱程序</a><span style="color:gray">(2010-09-17 11:49)</span><br>· <a href="http://news.cnblogs.com/n/74610/">世界首款MeeGo Tablet解密</a><span style="color:gray">(2010-09-17 11:46)</span><br>· <a href="http://news.cnblogs.com/n/74611/">互联网/移动互联网小团队如何白手起家创业</a><span style="color:gray">(2010-09-17 11:44)</span><br>· <a href="http://news.cnblogs.com/n/74609/">Google重新推出Instantiations的开发工具 — 现在全部免费</a><span style="color:gray">(2010-09-17 11:32)</span><br>· <a href="http://news.cnblogs.com/n/74608/">SCO集团出售UNIX资产</a><span style="color:gray">(2010-09-17 11:30)</span><br></p><p>编辑推荐：<a href="http://news.cnblogs.com/n/74574/">Google声称Chrome7浏览器将提速60倍</a><br></p><p>网站导航：<a href="http://www.cnblogs.com">博客园首页</a>  <a href="http://home.cnblogs.com/">个人主页</a>  <a href="http://news.cnblogs.com">新闻</a>  <a href="http://home.cnblogs.com/ing/">闪存</a>  <a href="http://home.cnblogs.com/group/">小组</a>  <a href="http://space.cnblogs.com/q/">博问</a>  <a href="http://space.cnblogs.com">社区</a>  <a href="http://kb.cnblogs.com">知识库</a></p></p>

</div>


            <div class="footer">
              <div class="contact">
                <p>
                  Your Name<br />
                  What You Are<br />
                  your@email.com
                </p>
              </div>
              <div class="contact">
                <p>
                  <a href="http://github.com/lyuehh/">github.com/lyuehh</a><br />
                  <a href="http://twitter.com/lyuehh/">twitter.com/lyuehh</a><br />
                </p>
              </div>
            </div>
          </div>
        </div> <!-- /container -->

    </body>
</html>
