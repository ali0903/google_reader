<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Asp.net MVC 2 + Castle + NHibernate 项目实战(1)</title>
        <meta name="viewport" content="width=device-width">

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/css/syntax.css">

        <!-- Custom CSS -->
        <link rel="stylesheet" href="/css/main.css">

    </head>
    <body>

        <div class="container">
          <div class="site">
            <div class="header">
              <h1 class="title"><a href="/">Your New Jekyll Site</a></h1>
              <a class="extra" href="/">home</a>
            </div>

                <h2>Asp.net MVC 2 + Castle + NHibernate 项目实战(1)</h2>
<p class="meta">28 Sep 2010</p>

<div class="post">
<h2>Asp.net MVC 2 + Castle + NHibernate 项目实战(1)</h2>

<h3>by 李锡远</h3>

<h3>at 2010-09-28 13:00:00</h3>

<h3>original <a href="http://www.cnblogs.com/taven/archive/2010/09/28/1837478.html">http://www.cnblogs.com/taven/archive/2010/09/28/1837478.html</a></h3>

<p><a href="http://www.cnblogs.com/taven/"><img src="http://pic.cnblogs.com/face/u59940.jpg" alt="" border="0"></a><br>作者: <a href="http://www.cnblogs.com/taven/">李锡远</a> 发表于 2010-09-28 13:00 <a href="http://www.cnblogs.com/taven/archive/2010/09/28/1837478.html">原文链接</a> 阅读: 829 评论: 6</p>


<p>本文将开始一步一步地使用Asp.net MVC 2 + Castle + NHibernate 开发一个项目。</p>


<p> </p>


<p>首先，第一步是创建一个解决方案，项目结构如下：</p>


<p><img src="http://images.cnblogs.com/cnblogs_com/taven/pic01/2010-09-28_132231.png" width="299" height="583" alt=""> </p>


<p>需要引用的DLL库文件，我们全部放在RoRoWo.Common.DependLib下：</p>


<p> <img src="http://images.cnblogs.com/cnblogs_com/taven/pic01/2010-09-28_133010.png" width="293" height="241" alt=""></p>


<p> 根据表的结构，如图： </p>


<p> <img src="http://images.cnblogs.com/cnblogs_com/taven/pic01/2010-09-28_132938.png" width="759" height="690" alt=""></p>


<p> </p>


<p>现在我们开始为表结构创建实体类，以BlogCategory表为例，我们根据该表的字段名称和数据类型创建一个POCO类，放在RoRoWo.Domain.Entities下，代码内容如下：</p>


<p> <span style="font-family:&#39;Courier New&#39;;font-size:13px"><img src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif"><span>代码</span></span></p>


<div><div><div><span style="color:#0000ff">namespace</span><span style="color:#000000"> RoRoWo.Domain {<br>    <br>    </span><span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">class</span><span style="color:#000000"> Blogcategory {<br>        </span><span style="color:#0000ff">public</span><span style="color:#000000"> Blogcategory() { }<br>        </span><span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">virtual</span><span style="color:#000000"> </span><span style="color:#0000ff">int</span><span style="color:#000000"> Cateid { </span><span style="color:#0000ff">get</span><span style="color:#000000">; </span><span style="color:#0000ff">set</span><span style="color:#000000">; }<br>        </span><span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">virtual</span><span style="color:#000000"> IList</span><span style="color:#000000">&lt;</span><span style="color:#000000">Blogarticle</span><span style="color:#000000">&gt;</span><span style="color:#000000"> Blogarticles { </span><span style="color:#0000ff">get</span><span style="color:#000000">; </span><span style="color:#0000ff">set</span><span style="color:#000000">; }<br>        </span><span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">virtual</span><span style="color:#000000"> </span><span style="color:#0000ff">string</span><span style="color:#000000"> Catename { </span><span style="color:#0000ff">get</span><span style="color:#000000">; </span><span style="color:#0000ff">set</span><span style="color:#000000">; }<br>        </span><span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">virtual</span><span style="color:#000000"> </span><span style="color:#0000ff">int</span><span style="color:#000000"> Parentid { </span><span style="color:#0000ff">get</span><span style="color:#000000">; </span><span style="color:#0000ff">set</span><span style="color:#000000">; }<br>        </span><span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">virtual</span><span style="color:#000000"> </span><span style="color:#0000ff">int</span><span style="color:#000000"> State { </span><span style="color:#0000ff">get</span><span style="color:#000000">; </span><span style="color:#0000ff">set</span><span style="color:#000000">; }<br>        </span><span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">virtual</span><span style="color:#000000"> </span><span style="color:#0000ff">int</span><span style="color:#000000"> Sortid { </span><span style="color:#0000ff">get</span><span style="color:#000000">; </span><span style="color:#0000ff">set</span><span style="color:#000000">; }<br>        </span><span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">virtual</span><span style="color:#000000"> </span><span style="color:#0000ff">int</span><span style="color:#000000"> Articlecount { </span><span style="color:#0000ff">get</span><span style="color:#000000">; </span><span style="color:#0000ff">set</span><span style="color:#000000">; }<br>        </span><span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">virtual</span><span style="color:#000000"> System.DateTime Createtime { </span><span style="color:#0000ff">get</span><span style="color:#000000">; </span><span style="color:#0000ff">set</span><span style="color:#000000">; }<br>        </span><span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">virtual</span><span style="color:#000000"> </span><span style="color:#0000ff">string</span><span style="color:#000000"> Note { </span><span style="color:#0000ff">get</span><span style="color:#000000">; </span><span style="color:#0000ff">set</span><span style="color:#000000">; }<br>    }<br>}</span></div></div></div>


<p> </p>


<p> 在这里，我推荐一个可以生成NHibernate映射对象代码的工具（开源的），项目地址：<a href="http://nmg.codeplex.com/">NHibernate Mapping Generator</a>（它同时支持 hbm.xml文件的方式、Fluent Mapping方式、Castle ActiveRecord方式）</p>


<p>接下来，要为这个类创建一个映射关系，我这里使用配置文件的方式，但是正式项目推荐使用Fluent方式。我们创建一个XML文件，文件名为“Blogcategory.hbm.xml”，放在RoRoWo.Domain.Mappings下，内容如下：</p>


<div><img src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt=""><img src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif"><span>代码</span><div><div><span style="color:#000000">&lt;?</span><span style="color:#000000">xml version</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">1.0</span><span style="color:#800000">"</span><span style="color:#000000"> encoding</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">utf-8</span><span style="color:#800000">"</span><span style="color:#000000">?&gt;</span><span style="color:#000000"><br></span><span style="color:#000000">&lt;</span><span style="color:#000000">hibernate</span><span style="color:#000000">-</span><span style="color:#000000">mapping assembly</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">RoRoWo.Domain</span><span style="color:#800000">"</span><span style="color:#000000"> </span><span style="color:#0000ff">namespace</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">RoRoWo.Domain</span><span style="color:#800000">"</span><span style="color:#000000"> xmlns</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">urn:nhibernate-mapping-2.2</span><span style="color:#800000">"</span><span style="color:#000000"> </span><span style="color:#0000ff">default</span><span style="color:#000000">-</span><span style="color:#000000">lazy</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">false</span><span style="color:#800000">"</span><span style="color:#000000">&gt;</span><span style="color:#000000"><br>    </span><span style="color:#000000">&lt;</span><span style="color:#0000ff">class</span><span style="color:#000000"> name</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">Blogcategory</span><span style="color:#800000">"</span><span style="color:#000000"> table</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">BlogCategory</span><span style="color:#800000">"</span><span style="color:#000000">&gt;</span><span style="color:#000000"><br>        </span><span style="color:#000000">&lt;</span><span style="color:#000000">id name</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">Cateid</span><span style="color:#800000">"</span><span style="color:#000000"> column</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">CateID</span><span style="color:#800000">"</span><span style="color:#000000">&gt;</span><span style="color:#000000"><br>            </span><span style="color:#000000">&lt;</span><span style="color:#000000">generator </span><span style="color:#0000ff">class</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">native</span><span style="color:#800000">"</span><span style="color:#000000"> </span><span style="color:#000000">/&gt;</span><span style="color:#000000"><br>        </span><span style="color:#000000">&lt;/</span><span style="color:#000000">id</span><span style="color:#000000">&gt;</span><span style="color:#000000"><br>        </span><span style="color:#000000">&lt;</span><span style="color:#000000">property name</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">Catename</span><span style="color:#800000">"</span><span style="color:#000000"> column</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">CateName</span><span style="color:#800000">"</span><span style="color:#000000"> </span><span style="color:#000000">/&gt;</span><span style="color:#000000"><br>        </span><span style="color:#000000">&lt;</span><span style="color:#000000">property name</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">Parentid</span><span style="color:#800000">"</span><span style="color:#000000"> column</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">ParentID</span><span style="color:#800000">"</span><span style="color:#000000"> </span><span style="color:#000000">/&gt;</span><span style="color:#000000"><br>        </span><span style="color:#000000">&lt;</span><span style="color:#000000">property name</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">State</span><span style="color:#800000">"</span><span style="color:#000000"> column</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">State</span><span style="color:#800000">"</span><span style="color:#000000"> </span><span style="color:#000000">/&gt;</span><span style="color:#000000"><br>        </span><span style="color:#000000">&lt;</span><span style="color:#000000">property name</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">Sortid</span><span style="color:#800000">"</span><span style="color:#000000"> column</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">SortID</span><span style="color:#800000">"</span><span style="color:#000000"> </span><span style="color:#000000">/&gt;</span><span style="color:#000000"><br>        </span><span style="color:#000000">&lt;</span><span style="color:#000000">property name</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">Articlecount</span><span style="color:#800000">"</span><span style="color:#000000"> column</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">ArticleCount</span><span style="color:#800000">"</span><span style="color:#000000"> </span><span style="color:#000000">/&gt;</span><span style="color:#000000"><br>        </span><span style="color:#000000">&lt;</span><span style="color:#000000">property name</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">Createtime</span><span style="color:#800000">"</span><span style="color:#000000"> column</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">CreateTime</span><span style="color:#800000">"</span><span style="color:#000000"> </span><span style="color:#000000">/&gt;</span><span style="color:#000000"><br>        </span><span style="color:#000000">&lt;</span><span style="color:#000000">property name</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">Note</span><span style="color:#800000">"</span><span style="color:#000000"> column</span><span style="color:#000000">=</span><span style="color:#800000">"</span><span style="color:#800000">Note</span><span style="color:#800000">"</span><span style="color:#000000"> </span><span style="color:#000000">/&gt;</span><span style="color:#000000"><br>    </span><span style="color:#000000">&lt;/</span><span style="color:#0000ff">class</span><span style="color:#000000">&gt;</span><span style="color:#000000"><br></span><span style="color:#000000">&lt;/</span><span style="color:#000000">hibernate</span><span style="color:#000000">-</span><span style="color:#000000">mapping</span><span style="color:#000000">&gt;</span></div></div></div>


<p> </p>


<p> </p>


<p>这里就是一个典型的映射关系了，如果有一对多，多对多的表关系，也是在这个配置中进行维护。</p>


<p>创建这个XML后，还有个很重要的操作，就是将其设为“嵌入的资源” ，鼠标右键查看“Blogcategory.hbm.xml”文件属性，将“生成操作”项的“内容”改为“嵌入的资源”，如图：</p>


<p><img src="http://images.cnblogs.com/cnblogs_com/taven/pic01/2010-09-28_134644.png" width="285" height="214" alt=""> </p>


<p> 到此，一个映射关系的实体就建立好了，下面我们就要来实现NHibernate对该表的增删改查操作了，我们把这些操作的实现放在RoRoWo.Data中。</p>


<div><div><span style="color:#000000">注意，RoRoWo.Data需要添加对 “Castle.Core.dll” </span><span style="color:#800000">"</span><span style="color:#800000">Castle.DynamicProxy2.dll</span><span style="color:#800000">"</span><span style="color:#000000"> </span><span style="color:#800000">"</span><span style="color:#800000">NHibernate.dll</span><span style="color:#800000">"</span><span style="color:#000000"> </span><span style="color:#800000">"</span><span style="color:#800000">RoRoWo.Domain</span><span style="color:#800000">"</span><span style="color:#000000"> 的引用。</span></div></div>


<p> </p>


<p>在创建数据库操作类之前，我们需要创建一个 “SessionManager”类，它负责维护整个ORM中的上下文，这里我使用李永京的一个类,其代码如下：</p>


<div><img src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt=""><img src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif"><span>代码</span><div><div><span style="color:#0000ff">using</span><span style="color:#000000"> System;<br></span><span style="color:#0000ff">using</span><span style="color:#000000"> System.Collections.Generic;<br></span><span style="color:#0000ff">using</span><span style="color:#000000"> System.Linq;<br></span><span style="color:#0000ff">using</span><span style="color:#000000"> System.Text;<br><br></span><span style="color:#0000ff">using</span><span style="color:#000000"> NHibernate;<br></span><span style="color:#0000ff">using</span><span style="color:#000000"> NHibernate.Cfg;<br><br></span><span style="color:#0000ff">namespace</span><span style="color:#000000"> RoRoWo.Data<br>{<br>    </span><span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">class</span><span style="color:#000000"> SessionManager<br>    {<br>        </span><span style="color:#0000ff">private</span><span style="color:#000000"> ISessionFactory _sessionFactory;<br>        </span><span style="color:#0000ff">public</span><span style="color:#000000"> SessionManager()<br>        {<br>            _sessionFactory </span><span style="color:#000000">=</span><span style="color:#000000"> GetSessionFactory();<br>        }<br>        </span><span style="color:#0000ff">private</span><span style="color:#000000"> ISessionFactory GetSessionFactory()<br>        {<br>            </span><span style="color:#0000ff">return</span><span style="color:#000000"> (</span><span style="color:#0000ff">new</span><span style="color:#000000"> Configuration()).Configure().BuildSessionFactory();<br>        }<br>        </span><span style="color:#0000ff">public</span><span style="color:#000000"> ISession GetSession()<br>        {<br>            </span><span style="color:#0000ff">return</span><span style="color:#000000"> _sessionFactory.OpenSession();<br>        }<br>    }<br>}<br></span></div></div></div>


<p> </p>


<p> </p>


<p>我们创建一个“BlogCategoryRespository.cs”文件，其代码如下：</p>


<div><img src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt=""><img src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif"><span>代码</span><div><div><span style="color:#0000ff">using</span><span style="color:#000000"> System;<br></span><span style="color:#0000ff">using</span><span style="color:#000000"> System.Collections.Generic;<br></span><span style="color:#0000ff">using</span><span style="color:#000000"> System.Linq;<br></span><span style="color:#0000ff">using</span><span style="color:#000000"> System.Text;<br><br></span><span style="color:#0000ff">using</span><span style="color:#000000"> NHibernate;<br></span><span style="color:#0000ff">using</span><span style="color:#000000"> NHibernate.Cfg;<br></span><span style="color:#0000ff">using</span><span style="color:#000000"> NHibernate.Criterion;<br></span><span style="color:#0000ff">using</span><span style="color:#000000"> RoRoWo.Domain;<br><br></span><span style="color:#0000ff">namespace</span><span style="color:#000000"> RoRoWo.Data<br>{<br>    </span><span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">class</span><span style="color:#000000"> BlogCategoryRespository<br>    {<br>        </span><span style="color:#0000ff">private</span><span style="color:#000000"> ISession _session;<br>        </span><span style="color:#0000ff">public</span><span style="color:#000000"> ISession Session<br>        {<br>            </span><span style="color:#0000ff">set</span><span style="color:#000000"><br>            {<br>                _session </span><span style="color:#000000">=</span><span style="color:#000000"> value;<br>            }<br>        }<br><br>        </span><span style="color:#0000ff">public</span><span style="color:#000000"> BlogCategoryRespository(ISession session)<br>        {<br>            _session </span><span style="color:#000000">=</span><span style="color:#000000"> session;<br>        }<br><br>        </span><span style="color:#0000ff">public</span><span style="color:#000000"> Blogcategory GetById(</span><span style="color:#0000ff">int</span><span style="color:#000000"> cateId)<br>        {<br><br>            </span><span style="color:#0000ff">return</span><span style="color:#000000"> _session.Get</span><span style="color:#000000">&lt;</span><span style="color:#000000">Blogcategory</span><span style="color:#000000">&gt;</span><span style="color:#000000">(cateId);<br>        }<br><br>        </span><span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">void</span><span style="color:#000000"> Create(Blogcategory dto)<br>        {<br>            _session.Save(dto);<br>            _session.Flush();<br>        }<br><br>        </span><span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">int</span><span style="color:#000000"> CreateAndReturn(Blogcategory dto)<br>        {<br>            </span><span style="color:#0000ff">int</span><span style="color:#000000"> newid </span><span style="color:#000000">=</span><span style="color:#000000"> (</span><span style="color:#0000ff">int</span><span style="color:#000000">)_session.Save(dto);<br>            _session.Flush();<br>            </span><span style="color:#0000ff">return</span><span style="color:#000000"> newid;<br>        }<br><br>        </span><span style="color:#808080">///</span><span style="color:#008000"> </span><span style="color:#808080">&lt;summary&gt;</span><span style="color:#008000"><br>        </span><span style="color:#808080">///</span><span style="color:#008000"> 使用事务<br>        </span><span style="color:#808080">///</span><span style="color:#008000"> </span><span style="color:#808080">&lt;/summary&gt;</span><span style="color:#008000"><br>        </span><span style="color:#808080">///</span><span style="color:#008000"> </span><span style="color:#808080">&lt;param name=&quot;dto&quot;&gt;&lt;/param&gt;</span><span style="color:#008000"><br>        </span><span style="color:#808080">///</span><span style="color:#008000"> </span><span style="color:#808080">&lt;returns&gt;&lt;/returns&gt;</span><span style="color:#808080"><br></span><span style="color:#000000">        </span><span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">int</span><span style="color:#000000"> CreateTransaction(Blogcategory dto)<br>        {<br>            </span><span style="color:#0000ff">using</span><span style="color:#000000"> (ITransaction tx </span><span style="color:#000000">=</span><span style="color:#000000"> _session.BeginTransaction())<br>            {<br>                </span><span style="color:#0000ff">try</span><span style="color:#000000"><br>                {<br>                    </span><span style="color:#0000ff">int</span><span style="color:#000000"> newId </span><span style="color:#000000">=</span><span style="color:#000000"> (</span><span style="color:#0000ff">int</span><span style="color:#000000">)_session.Save(dto);<br>                    _session.Flush();<br>                    tx.Commit();<br>                    </span><span style="color:#0000ff">return</span><span style="color:#000000"> newId;<br>                }<br>                </span><span style="color:#0000ff">catch</span><span style="color:#000000"> (HibernateException)<br>                {<br>                    tx.Rollback();<br>                    </span><span style="color:#0000ff">throw</span><span style="color:#000000">;<br>                }<br>            }<br>        }<br><br>        </span><span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">void</span><span style="color:#000000"> UpdateCustomer(Blogcategory dto)<br>        {<br>            _session.Update(dto);<br>            _session.Flush();<br>        }<br><br>        </span><span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">void</span><span style="color:#000000"> SaveOrUpdate(IList</span><span style="color:#000000">&lt;</span><span style="color:#000000">Blogcategory</span><span style="color:#000000">&gt;</span><span style="color:#000000"> dtos)<br>        {<br>            </span><span style="color:#0000ff">foreach</span><span style="color:#000000"> (var c </span><span style="color:#0000ff">in</span><span style="color:#000000"> dtos)<br>            {<br>                _session.SaveOrUpdate(c);<br>            }<br>            _session.Flush();<br>        }<br><br>        </span><span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">void</span><span style="color:#000000"> Delete(Blogcategory dto)<br>        {<br>            _session.Delete(dto);<br>            _session.Flush();<br>        }<br><br>        </span><span style="color:#0000ff">public</span><span style="color:#000000"> IList</span><span style="color:#000000">&lt;</span><span style="color:#000000">Blogcategory</span><span style="color:#000000">&gt;</span><span style="color:#000000"> From()<br>        {<br>            </span><span style="color:#008000">//</span><span style="color:#008000">返回所有Blogcategory类的实例</span><span style="color:#008000"><br></span><span style="color:#000000">            </span><span style="color:#0000ff">return</span><span style="color:#000000"> _session.CreateQuery(</span><span style="color:#800000">"</span><span style="color:#800000">from Blogcategory</span><span style="color:#800000">"</span><span style="color:#000000">)<br>                .List</span><span style="color:#000000">&lt;</span><span style="color:#000000">Blogcategory</span><span style="color:#000000">&gt;</span><span style="color:#000000">();<br>        }<br><br>        </span><span style="color:#0000ff">public</span><span style="color:#000000"> IList</span><span style="color:#000000">&lt;</span><span style="color:#0000ff">int</span><span style="color:#000000">&gt;</span><span style="color:#000000"> Select()<br>        {<br>            </span><span style="color:#008000">//</span><span style="color:#008000">返回所有Blogcategory的CateId</span><span style="color:#008000"><br></span><span style="color:#000000">            </span><span style="color:#0000ff">return</span><span style="color:#000000"> _session.CreateQuery(</span><span style="color:#800000">"</span><span style="color:#800000">select c.CateId from Blogcategory c</span><span style="color:#800000">"</span><span style="color:#000000">)<br>                .List</span><span style="color:#000000">&lt;</span><span style="color:#0000ff">int</span><span style="color:#000000">&gt;</span><span style="color:#000000">();<br>        }<br><br>        </span><span style="color:#0000ff">public</span><span style="color:#000000"> IList</span><span style="color:#000000">&lt;</span><span style="color:#000000">Blogcategory</span><span style="color:#000000">&gt;</span><span style="color:#000000"> Where()<br>        {<br>            </span><span style="color:#0000ff">return</span><span style="color:#000000"> _session.CreateQuery(</span><span style="color:#800000">"</span><span style="color:#800000">from Blogcategory c where c.CateId=&#39;3&#39;</span><span style="color:#800000">"</span><span style="color:#000000">)<br>                .List</span><span style="color:#000000">&lt;</span><span style="color:#000000">Blogcategory</span><span style="color:#000000">&gt;</span><span style="color:#000000">();<br>        }<br><br>        </span><span style="color:#0000ff">public</span><span style="color:#000000"> IList</span><span style="color:#000000">&lt;</span><span style="color:#000000">Blogcategory</span><span style="color:#000000">&gt;</span><span style="color:#000000"> GetGreaterThan(</span><span style="color:#0000ff">int</span><span style="color:#000000"> CateId)<br>        {<br>            </span><span style="color:#008000">//</span><span style="color:#008000">return _session.CreateQuery(&quot;select from Blogcategory c where c.CateId &gt; :cid&quot;)<br>            </span><span style="color:#008000">//</span><span style="color:#008000">    .SetInt32(&quot;cid&quot;, CateId)<br>            </span><span style="color:#008000">//</span><span style="color:#008000">    .List&lt;Blogcategory&gt;();</span><span style="color:#008000"><br></span><span style="color:#000000"><br>            </span><span style="color:#0000ff">return</span><span style="color:#000000"> _session.CreateCriteria(</span><span style="color:#0000ff">typeof</span><span style="color:#000000">(Blogcategory))<br>            .Add(Restrictions.Gt(</span><span style="color:#800000">"</span><span style="color:#800000">CateId</span><span style="color:#800000">"</span><span style="color:#000000">, CateId))<br>            .List</span><span style="color:#000000">&lt;</span><span style="color:#000000">Blogcategory</span><span style="color:#000000">&gt;</span><span style="color:#000000">();<br><br>        }<br><br>        </span><span style="color:#0000ff">public</span><span style="color:#000000"> IList</span><span style="color:#000000">&lt;</span><span style="color:#000000">Blogcategory</span><span style="color:#000000">&gt;</span><span style="color:#000000"> CreateCriteria()<br>        {<br>            ICriteria crit </span><span style="color:#000000">=</span><span style="color:#000000"> _session.CreateCriteria(</span><span style="color:#0000ff">typeof</span><span style="color:#000000">(Blogcategory));<br>            crit.SetMaxResults(</span><span style="color:#800080">50</span><span style="color:#000000">);<br>            IList</span><span style="color:#000000">&lt;</span><span style="color:#000000">Blogcategory</span><span style="color:#000000">&gt;</span><span style="color:#000000"> blogcategorys </span><span style="color:#000000">=</span><span style="color:#000000"> crit.List</span><span style="color:#000000">&lt;</span><span style="color:#000000">Blogcategory</span><span style="color:#000000">&gt;</span><span style="color:#000000">();<br>            </span><span style="color:#0000ff">return</span><span style="color:#000000"> blogcategorys;<br>        }<br><br>        </span><span style="color:#0000ff">public</span><span style="color:#000000"> IList</span><span style="color:#000000">&lt;</span><span style="color:#000000">Blogcategory</span><span style="color:#000000">&gt;</span><span style="color:#000000"> Narrowing()<br>        {<br>            IList</span><span style="color:#000000">&lt;</span><span style="color:#000000">Blogcategory</span><span style="color:#000000">&gt;</span><span style="color:#000000"> blogcategorys </span><span style="color:#000000">=</span><span style="color:#000000"> _session.CreateCriteria(</span><span style="color:#0000ff">typeof</span><span style="color:#000000">(Blogcategory))<br>                .Add(Restrictions.Like(</span><span style="color:#800000">"</span><span style="color:#800000">Catename</span><span style="color:#800000">"</span><span style="color:#000000">, </span><span style="color:#800000">"</span><span style="color:#800000">s%</span><span style="color:#800000">"</span><span style="color:#000000">))<br>                .Add(Restrictions.Between(</span><span style="color:#800000">"</span><span style="color:#800000">Parentid</span><span style="color:#800000">"</span><span style="color:#000000">, </span><span style="color:#800000">"</span><span style="color:#800000">1</span><span style="color:#800000">"</span><span style="color:#000000">, </span><span style="color:#800000">"</span><span style="color:#800000">3</span><span style="color:#800000">"</span><span style="color:#000000">))<br>                .List</span><span style="color:#000000">&lt;</span><span style="color:#000000">Blogcategory</span><span style="color:#000000">&gt;</span><span style="color:#000000">();<br>            </span><span style="color:#0000ff">return</span><span style="color:#000000"> blogcategorys;<br>        }<br><br>        </span><span style="color:#0000ff">public</span><span style="color:#000000"> IList</span><span style="color:#000000">&lt;</span><span style="color:#000000">Blogcategory</span><span style="color:#000000">&gt;</span><span style="color:#000000"> Query()<br>        {<br>            Blogcategory dtoSample </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">new</span><span style="color:#000000"> Blogcategory() { Catename </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#800000">"</span><span style="color:#800000">sss</span><span style="color:#800000">"</span><span style="color:#000000">, Parentid </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#800080">0</span><span style="color:#000000"> };<br>            </span><span style="color:#0000ff">return</span><span style="color:#000000"> _session.CreateCriteria(</span><span style="color:#0000ff">typeof</span><span style="color:#000000">(Blogcategory))<br>                .Add(Example.Create(dtoSample))<br>                .List</span><span style="color:#000000">&lt;</span><span style="color:#000000">Blogcategory</span><span style="color:#000000">&gt;</span><span style="color:#000000">();<br>        }<br><br>        </span><span style="color:#0000ff">public</span><span style="color:#000000"> IList</span><span style="color:#000000">&lt;</span><span style="color:#000000">Blogcategory</span><span style="color:#000000">&gt;</span><span style="color:#000000"> UseQueryByExample_Get(Blogcategory dtoSample)<br>        {<br>            Example example </span><span style="color:#000000">=</span><span style="color:#000000"> Example.Create(dtoSample)<br>                .IgnoreCase()<br>                .EnableLike()<br>                .SetEscapeCharacter(</span><span style="color:#800000">'</span><span style="color:#800000">&amp;</span><span style="color:#800000">'</span><span style="color:#000000">);<br>            </span><span style="color:#0000ff">return</span><span style="color:#000000"> _session.CreateCriteria(</span><span style="color:#0000ff">typeof</span><span style="color:#000000">(Blogcategory))<br>               .Add(example)<br>               .List</span><span style="color:#000000">&lt;</span><span style="color:#000000">Blogcategory</span><span style="color:#000000">&gt;</span><span style="color:#000000">();<br>        }<br><br>    }<br>}<br></span></div></div></div>


<p> </p>


<p> </p>


<p>该代码具有了对一个表的基本操作，现在我们就来创建一个单元测试，测试一下插入数据。</p>


<p>在创建插入操作时，我们要能使NHibernate正常工作，还需要创建一个配置文件，我们创建一个XML文件，文件名为“hibernate.cfg.xml”，放在RoRoWo.UnitTest下，其内容为：</p>


<div><img src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt=""><img src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif"><span>代码</span><div><div><span style="color:#0000ff">&lt;?</span><span style="color:#ff00ff">xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;</span><span style="color:#0000ff">?&gt;</span><span style="color:#000000"><br></span><span style="color:#0000ff">&lt;</span><span style="color:#800000">hibernate-configuration  </span><span style="color:#ff0000">xmlns</span><span style="color:#0000ff">="urn:nhibernate-configuration-2.2"</span><span style="color:#ff0000"> </span><span style="color:#0000ff">&gt;</span><span style="color:#000000"><br>    </span><span style="color:#0000ff">&lt;</span><span style="color:#800000">session-factory</span><span style="color:#0000ff">&gt;</span><span style="color:#000000"><br>        </span><span style="color:#0000ff">&lt;</span><span style="color:#800000">property </span><span style="color:#ff0000">name</span><span style="color:#0000ff">="connection.driver_class"</span><span style="color:#0000ff">&gt;</span><span style="color:#000000">NHibernate.Driver.SqlClientDriver</span><span style="color:#0000ff">&lt;/</span><span style="color:#800000">property</span><span style="color:#0000ff">&gt;</span><span style="color:#000000"><br>        </span><span style="color:#0000ff">&lt;</span><span style="color:#800000">property </span><span style="color:#ff0000">name</span><span style="color:#0000ff">="connection.connection_string"</span><span style="color:#0000ff">&gt;</span><span style="color:#000000"><br>            Data Source=.;Initial Catalog=RoRoWoDB;User ID=sa;Password=2010;<br>        </span><span style="color:#0000ff">&lt;/</span><span style="color:#800000">property</span><span style="color:#0000ff">&gt;</span><span style="color:#000000"><br>        </span><span style="color:#0000ff">&lt;</span><span style="color:#800000">property </span><span style="color:#ff0000">name</span><span style="color:#0000ff">="adonet.batch_size"</span><span style="color:#0000ff">&gt;</span><span style="color:#000000">10</span><span style="color:#0000ff">&lt;/</span><span style="color:#800000">property</span><span style="color:#0000ff">&gt;</span><span style="color:#000000"><br>        </span><span style="color:#0000ff">&lt;</span><span style="color:#800000">property </span><span style="color:#ff0000">name</span><span style="color:#0000ff">="show_sql"</span><span style="color:#0000ff">&gt;</span><span style="color:#000000">true</span><span style="color:#0000ff">&lt;/</span><span style="color:#800000">property</span><span style="color:#0000ff">&gt;</span><span style="color:#000000"><br>        </span><span style="color:#0000ff">&lt;</span><span style="color:#800000">property </span><span style="color:#ff0000">name</span><span style="color:#0000ff">="dialect"</span><span style="color:#0000ff">&gt;</span><span style="color:#000000">NHibernate.Dialect.MsSql2005Dialect</span><span style="color:#0000ff">&lt;/</span><span style="color:#800000">property</span><span style="color:#0000ff">&gt;</span><span style="color:#000000"><br>        </span><span style="color:#0000ff">&lt;</span><span style="color:#800000">property </span><span style="color:#ff0000">name</span><span style="color:#0000ff">="use_outer_join"</span><span style="color:#0000ff">&gt;</span><span style="color:#000000">true</span><span style="color:#0000ff">&lt;/</span><span style="color:#800000">property</span><span style="color:#0000ff">&gt;</span><span style="color:#000000"><br>        </span><span style="color:#0000ff">&lt;</span><span style="color:#800000">property </span><span style="color:#ff0000">name</span><span style="color:#0000ff">="command_timeout"</span><span style="color:#0000ff">&gt;</span><span style="color:#000000">10</span><span style="color:#0000ff">&lt;/</span><span style="color:#800000">property</span><span style="color:#0000ff">&gt;</span><span style="color:#000000"><br>        </span><span style="color:#0000ff">&lt;</span><span style="color:#800000">property </span><span style="color:#ff0000">name</span><span style="color:#0000ff">="query.substitutions"</span><span style="color:#0000ff">&gt;</span><span style="color:#000000">true 1, false 0, yes &#39;Y&#39;, no &#39;N&#39;</span><span style="color:#0000ff">&lt;/</span><span style="color:#800000">property</span><span style="color:#0000ff">&gt;</span><span style="color:#000000"><br>        </span><span style="color:#0000ff">&lt;</span><span style="color:#800000">property </span><span style="color:#ff0000">name</span><span style="color:#0000ff">="proxyfactory.factory_class"</span><span style="color:#0000ff">&gt;</span><span style="color:#000000"><br>            NHibernate.ByteCode.Castle.ProxyFactoryFactory,<br>            NHibernate.ByteCode.Castle<br>        </span><span style="color:#0000ff">&lt;/</span><span style="color:#800000">property</span><span style="color:#0000ff">&gt;</span><span style="color:#000000"><br>        </span><span style="color:#0000ff">&lt;</span><span style="color:#800000">mapping </span><span style="color:#ff0000">assembly</span><span style="color:#0000ff">="RoRoWo.Domain"</span><span style="color:#0000ff">/&gt;</span><span style="color:#000000"><br>    </span><span style="color:#0000ff">&lt;/</span><span style="color:#800000">session-factory</span><span style="color:#0000ff">&gt;</span><span style="color:#000000"><br></span><span style="color:#0000ff">&lt;/</span><span style="color:#800000">hibernate-configuration</span><span style="color:#0000ff">&gt;</span></div></div></div>


<p> </p>


<p> 其中“Data Source=.;Initial Catalog=RoRoWoDB;User ID=sa;Password=2010;”是我的数据库连接，您可以改为您的。</p>


<p> </p>


<p>现在我们添加一个单元测试（不明白如何添加的请参考相关资料），先测试插入方法，其代码如下：</p>


<p> <span style="font-family:&#39;Courier New&#39;;font-size:13px"><img src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif"></span><span style="font-family:&#39;Courier New&#39;;font-size:13px"><span>代码</span></span></p>


<div><div><div><span style="color:#000000">        </span><span style="color:#808080">///</span><span style="color:#008000"> </span><span style="color:#808080">&lt;summary&gt;</span><span style="color:#008000"><br>        </span><span style="color:#808080">///</span><span style="color:#008000">Create 的测试<br>        </span><span style="color:#808080">///</span><span style="color:#808080">&lt;/summary&gt;</span><span style="color:#808080"><br></span><span style="color:#000000">        [TestMethod()]<br>        </span><span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">void</span><span style="color:#000000"> CreateTest()<br>        {<br>            SessionManager sessionManager </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">new</span><span style="color:#000000"> SessionManager();<br>            ISession session </span><span style="color:#000000">=</span><span style="color:#000000"> sessionManager.GetSession();<br>            BlogCategoryRespository target </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">new</span><span style="color:#000000"> BlogCategoryRespository(session);<br>            Blogcategory dto </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">new</span><span style="color:#000000"> Blogcategory();<br><br>            dto.Catename </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#800000">"</span><span style="color:#800000">新分类</span><span style="color:#800000">"</span><span style="color:#000000"> </span><span style="color:#000000">+</span><span style="color:#000000"> </span><span style="color:#0000ff">new</span><span style="color:#000000"> Random().Next(</span><span style="color:#800080">100000</span><span style="color:#000000">, </span><span style="color:#800080">999999</span><span style="color:#000000">).ToString();<br>            dto.Parentid </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#800080">0</span><span style="color:#000000">;<br>            dto.State </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#800080">0</span><span style="color:#000000">;<br>            dto.Createtime </span><span style="color:#000000">=</span><span style="color:#000000"> DateTime.Now;<br><br>            </span><span style="color:#0000ff">int</span><span style="color:#000000"> newid </span><span style="color:#000000">=</span><span style="color:#000000"> target.CreateAndReturn(dto);<br>            Assert.IsTrue(newid </span><span style="color:#000000">&gt;</span><span style="color:#000000"> </span><span style="color:#800080">0</span><span style="color:#000000">);<br>        }</span></div></div></div>


<p> </p>


<p> 执行单元测试，可以通过测试，并且在数据库中已经成功插入了一条记录，结果完全正确；</p>


<p>我们接着对查询方法进行测试，我们将测试代码如下：</p>


<p></p>


<div><img src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt=""><img src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif"><span>代码</span><div><div><span style="color:#000000">        </span><span style="color:#808080">///</span><span style="color:#008000"> </span><span style="color:#808080">&lt;summary&gt;</span><span style="color:#008000"><br>        </span><span style="color:#808080">///</span><span style="color:#008000">GetById 的测试<br>        </span><span style="color:#808080">///</span><span style="color:#808080">&lt;/summary&gt;</span><span style="color:#808080"><br></span><span style="color:#000000">        [TestMethod()]<br>        </span><span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">void</span><span style="color:#000000"> GetByIdTest()<br>        {<br>            SessionManager sessionManager </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">new</span><span style="color:#000000"> SessionManager();<br>            ISession session </span><span style="color:#000000">=</span><span style="color:#000000"> sessionManager.GetSession();<br>            BlogCategoryRespository target </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">new</span><span style="color:#000000"> BlogCategoryRespository(session);<br>            </span><span style="color:#0000ff">int</span><span style="color:#000000"> cateId </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#800080">3</span><span style="color:#000000">;<br>            Blogcategory actual;<br>            actual </span><span style="color:#000000">=</span><span style="color:#000000"> target.GetById(cateId);<br>            Assert.AreEqual(cateId, actual.Cateid);<br><br>        }<br><br>        </span><span style="color:#808080">///</span><span style="color:#008000"> </span><span style="color:#808080">&lt;summary&gt;</span><span style="color:#008000"><br>        </span><span style="color:#808080">///</span><span style="color:#008000">From 的测试<br>        </span><span style="color:#808080">///</span><span style="color:#808080">&lt;/summary&gt;</span><span style="color:#808080"><br></span><span style="color:#000000">        [TestMethod()]<br>        </span><span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">void</span><span style="color:#000000"> FromTest()<br>        {<br>            SessionManager sessionManager </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">new</span><span style="color:#000000"> SessionManager();<br>            ISession session </span><span style="color:#000000">=</span><span style="color:#000000"> sessionManager.GetSession();<br>            BlogCategoryRespository target </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">new</span><span style="color:#000000"> BlogCategoryRespository(session);<br>            IList</span><span style="color:#000000">&lt;</span><span style="color:#000000">Blogcategory</span><span style="color:#000000">&gt;</span><span style="color:#000000"> actual;<br>            actual </span><span style="color:#000000">=</span><span style="color:#000000"> target.From();<br>            Assert.IsTrue(actual.Count </span><span style="color:#000000">&gt;</span><span style="color:#000000"> </span><span style="color:#800080">0</span><span style="color:#000000">);<br><br>        }<br><br>        </span><span style="color:#808080">///</span><span style="color:#008000"> </span><span style="color:#808080">&lt;summary&gt;</span><span style="color:#008000"><br>        </span><span style="color:#808080">///</span><span style="color:#008000">Select 的测试<br>        </span><span style="color:#808080">///</span><span style="color:#808080">&lt;/summary&gt;</span><span style="color:#808080"><br></span><span style="color:#000000">        [TestMethod()]<br>        </span><span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">void</span><span style="color:#000000"> SelectTest()<br>        {<br>            SessionManager sessionManager </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">new</span><span style="color:#000000"> SessionManager();<br>            ISession session </span><span style="color:#000000">=</span><span style="color:#000000"> sessionManager.GetSession();<br>            BlogCategoryRespository target </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">new</span><span style="color:#000000"> BlogCategoryRespository(session);<br>            IList</span><span style="color:#000000">&lt;</span><span style="color:#0000ff">int</span><span style="color:#000000">&gt;</span><span style="color:#000000"> actual;<br>            actual </span><span style="color:#000000">=</span><span style="color:#000000"> target.Select();<br>            Assert.IsTrue(actual.Count </span><span style="color:#000000">&gt;</span><span style="color:#000000"> </span><span style="color:#800080">0</span><span style="color:#000000">);<br>        }<br><br>        </span><span style="color:#808080">///</span><span style="color:#008000"> </span><span style="color:#808080">&lt;summary&gt;</span><span style="color:#008000"><br>        </span><span style="color:#808080">///</span><span style="color:#008000">Where 的测试<br>        </span><span style="color:#808080">///</span><span style="color:#808080">&lt;/summary&gt;</span><span style="color:#808080"><br></span><span style="color:#000000">        [TestMethod()]<br>        </span><span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">void</span><span style="color:#000000"> WhereTest()<br>        {<br>            SessionManager sessionManager </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">new</span><span style="color:#000000"> SessionManager();<br>            ISession session </span><span style="color:#000000">=</span><span style="color:#000000"> sessionManager.GetSession();<br>            BlogCategoryRespository target </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">new</span><span style="color:#000000"> BlogCategoryRespository(session);<br><br>            IList</span><span style="color:#000000">&lt;</span><span style="color:#000000">Blogcategory</span><span style="color:#000000">&gt;</span><span style="color:#000000"> actual;<br>            actual </span><span style="color:#000000">=</span><span style="color:#000000"> target.Where();<br>            Assert.IsTrue(actual.Count </span><span style="color:#000000">&gt;</span><span style="color:#000000"> </span><span style="color:#800080">0</span><span style="color:#000000">);<br>        }<br><br>        </span><span style="color:#808080">///</span><span style="color:#008000"> </span><span style="color:#808080">&lt;summary&gt;</span><span style="color:#008000"><br>        </span><span style="color:#808080">///</span><span style="color:#008000">GetGreaterThan 的测试<br>        </span><span style="color:#808080">///</span><span style="color:#808080">&lt;/summary&gt;</span><span style="color:#808080"><br></span><span style="color:#000000">        [TestMethod()]<br>        </span><span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">void</span><span style="color:#000000"> GetGreaterThanTest()<br>        {<br>            SessionManager sessionManager </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">new</span><span style="color:#000000"> SessionManager();<br>            ISession session </span><span style="color:#000000">=</span><span style="color:#000000"> sessionManager.GetSession();<br>            BlogCategoryRespository target </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">new</span><span style="color:#000000"> BlogCategoryRespository(session);<br>            </span><span style="color:#0000ff">int</span><span style="color:#000000"> CateId </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#800080">0</span><span style="color:#000000">; </span><span style="color:#008000">//</span><span style="color:#008000"> TODO: 初始化为适当的值</span><span style="color:#008000"><br></span><span style="color:#000000">            IList</span><span style="color:#000000">&lt;</span><span style="color:#000000">Blogcategory</span><span style="color:#000000">&gt;</span><span style="color:#000000"> actual;<br>            actual </span><span style="color:#000000">=</span><span style="color:#000000"> target.GetGreaterThan(CateId);<br>            Assert.IsTrue(actual.Count </span><span style="color:#000000">&gt;</span><span style="color:#000000"> </span><span style="color:#800080">0</span><span style="color:#000000">);<br><br>        }</span></div></div></div>


<p> </p>


<p> </p>


<p> 测试结果全部绿灯通过：</p>


<p> <img src="http://images.cnblogs.com/cnblogs_com/taven/pic01/2010-09-28_141320.png" width="437" height="253" alt=""></p>


<p>下一篇，我将谈谈如何配置一对多和多对多的表映射关系。</p>


<p> </p>


<p>该例子的完整代码可以到开源平台下载，地址： <a href="http://rorowoproject.codeplex.com/">http://rorowoproject.codeplex.com</a></p>


<p>文章中如有不足之处，望大家多指正。</p>


<p> </p>


<p> </p>


<p> </p>


<p> <img src="http://www.cnblogs.com/taven/aggbug/1837478.html?type=1" width="1" height="1" alt=""><p>评论: 6　<a href="http://www.cnblogs.com/taven/archive/2010/09/28/1837478.html#pagedcomment">查看评论</a>　<a href="http://www.cnblogs.com/taven/archive/2010/09/28/1837478.html#commentform">发表评论</a></p><p><a href="http://job.cnblogs.com/">程序员找工作，就在博客园</a></p><hr><p>最新新闻：<br>· <a href="http://news.cnblogs.com/n/75881/">张朝阳反思搜狐微博 亲自挂帅挑战新浪</a><span style="color:gray">(2010-09-28 22:28)</span><br>· <a href="http://news.cnblogs.com/n/75880/">调查显示1/4的美国人想要购买Android平板电脑</a><span style="color:gray">(2010-09-28 22:22)</span><br>· <a href="http://news.cnblogs.com/n/75877/">Windows Live Spaces气数未尽，网易、搜狐争先抢“尸”</a><span style="color:gray">(2010-09-28 21:40)</span><br>· <a href="http://news.cnblogs.com/n/75876/">ZFS文件系统建立者离开Oracle</a><span style="color:gray">(2010-09-28 21:36)</span><br>· <a href="http://news.cnblogs.com/n/75875/">雅虎为何难以实施分红？</a><span style="color:gray">(2010-09-28 21:35)</span><br></p><p>编辑推荐：<a href="http://www.cnblogs.com/zc22/archive/2010/09/27/1837043.html">今天你抛弃了ASP.NET了吗？问题篇</a><br></p><p>网站导航：<a href="http://www.cnblogs.com">博客园首页</a>  <a href="http://home.cnblogs.com/">个人主页</a>  <a href="http://news.cnblogs.com">新闻</a>  <a href="http://home.cnblogs.com/ing/">闪存</a>  <a href="http://home.cnblogs.com/group/">小组</a>  <a href="http://space.cnblogs.com/q/">博问</a>  <a href="http://space.cnblogs.com">社区</a>  <a href="http://kb.cnblogs.com">知识库</a></p></p>

</div>


            <div class="footer">
              <div class="contact">
                <p>
                  Your Name<br />
                  What You Are<br />
                  your@email.com
                </p>
              </div>
              <div class="contact">
                <p>
                  <a href="http://github.com/yourusername/">github.com/yourusername</a><br />
                  <a href="http://twitter.com/yourusername/">twitter.com/yourusername</a><br />
                </p>
              </div>
            </div>
          </div>
        </div> <!-- /container -->

    </body>
</html>
