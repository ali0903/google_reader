<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Use Blanket.js instead of jscover</title>
        <meta name="viewport" content="width=device-width">

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/google_reader/css/syntax.css">

        <!-- Custom CSS -->
        <link rel="stylesheet" href="/google_reader/css/main.css">

    </head>
    <body>

        <div class="container">
          <div class="site">
            <div class="header">
              <h1 class="title"><a href="/google_reader/">Google Reader</a></h1>
              <a class="extra" href="/google_reader/">home</a>
            </div>

                <h2>Use Blanket.js instead of jscover</h2>
<p class="meta">2013-06-07 19:16</p>

<div class="post">
<h2>Use Blanket.js instead of jscover</h2>

<h3>by MK2</h3>

<h3>at 2013-06-07 11:16:00</h3>

<h3>original <a href="http://www.cnblogs.com/fengmk2/archive/2013/06/07/blanketjs-instead-of-jscover.html">http://www.cnblogs.com/fengmk2/archive/2013/06/07/blanketjs-instead-of-jscover.html</a></h3>

<p>在遇到 <a href="http://blanketjs.org/">Blanket.js</a> 之前，我一直使用这 <a href="https://github.com/fengmk2/jscover">jscover</a> 来做代码覆盖率测试。</p>


<p><br><br><h2>jscover</h2><br><br><p>使用 <a href="https://github.com/fengmk2/jscover">jscover</a> ，好处是不需要编译，直接使用 java 版本；缺点是需要 java 环境依赖。<br>通过 Makefile 来驱动整个测试执行，如 <a href="https://github.com/TBEDP/urllib/blob/0.3.4/Makefile">urllib/Makefile</a></p><br><br><pre><code>TESTS = test/<em>.test.js<br>REPORTER = spec<br>TIMEOUT = 20000<br>JSCOVERAGE = ./node_modules/jscover/bin/jscover<br><br>test:<br>  @NODE_ENV=test ./node_modules/mocha/bin/mocha \<br>    --reporter $(REPORTER) \<br>    --timeout $(TIMEOUT) \<br>    $(TESTS)<br><br>test-cov:<br>  @rm -rf ./lib-cov<br>  @$(JSCOVERAGE) lib lib-cov<br>  @URLLIB_COV=1 $(MAKE) test REPORTER=dot<br>  @URLLIB_COV=1 $(MAKE) test REPORTER=html-cov &gt; coverage.html<br><br>.PHONY: test test-cov</code></pre><br><br><p>执行代码覆盖率测试:</p><br><br><pre><code>$ make test-cov</code></pre><br><br><p>打开 <a href="http://fengmk2.github.io/coverage/urllib.html">coverage.html</a> 就能看到覆盖情况了。</p><br><br><h2>Blanket.js</h2><br><br><p>某天在github上看到 <a href="http://blanketjs.org/">Blanket.js</a> ，算是意外收获，终于能摆脱代码转换依赖了。</p><br><br><blockquote><br><p>Blanket.js is an easy to install, easy to configure, and easy to use JavaScript code coverage library that works both in-browser and with nodejs.</p><br></blockquote><br><br><p>使用上 <a href="http://blanketjs.org/">Blanket.js</a> 以后，不再需要将代码转换落地成文件，也不需要java依赖。</p><br><br><p>还是以 <a href="https://github.com/TBEDP/urllib/blob/master/Makefile">urllib/Makefile</a> 为例:</p><br><br><pre><code>TESTS = test/</em>.test.js<br>REPORTER = spec<br>TIMEOUT = 20000<br>MOCHA_OPTS =<br><br>test:<br>  @NODE_ENV=test ./node_modules/mocha/bin/mocha \<br>    --reporter $(REPORTER) \<br>    --timeout $(TIMEOUT) \<br>    $(MOCHA_OPTS) \<br>    $(TESTS)<br><br>test-cov:<br>  @URLLIB_COV=1 $(MAKE) test MOCHA_OPTS=&#39;--require blanket&#39; REPORTER=dot<br>  @URLLIB_COV=1 $(MAKE) test MOCHA_OPTS=&#39;--require blanket&#39; REPORTER=html-cov &gt; coverage.html<br><br>.PHONY: test test-cov</code></pre><br><br><p>参考 <a href="https://github.com/alex-seville/blanket/blob/master/docs/getting_started_node.md">Getting Started Guide (nodejs version)</a></p><br><br><p>在 <a href="https://github.com/TBEDP/urllib/blob/master/package.json">package.json</a> 添加上 blanket 的代码匹配模式，确定你需要对那个路径下的代码进行转换。</p><br><br><pre><code>&quot;scripts&quot;: {<br>  &quot;test&quot;: &quot;make test&quot;,<br>  &quot;blanket&quot;: { &quot;pattern&quot;: &quot;urllib/lib&quot; }<br>},</code></pre><br><br><p>执行命令还是保持一致：</p><br><br><pre><code>$ make test-cov</code></pre><br><br><p><code>coverage.html</code> 跟使用 <a href="https://github.com/fengmk2/jscover">jscover</a> 的报告结果一致，缺没有了文件生成，也不再需要去服务器上安装java了。</p><br><br><h2>Project</h2><br><br><p>对于非lib类项目，如普通的应用项目，进行代码覆盖率测试，同样可以使用 <a href="http://blanketjs.org/">Blanket.js</a> 很好地做到。</p><br><br><p>以 <a href="https://github.com/fengmk2/urlrar">urlrar</a> 为例:</p><br><br><p>Markfile</p><br><br><pre><code>TESTS = test/<em>.test.js<br>REPORTER = spec<br>TIMEOUT = 10000<br>MOCHA_OPTS =<br><br>install:<br>  @npm install<br><br>test: install<br>  @NODE_ENV=test ./node_modules/mocha/bin/mocha \<br>    --reporter $(REPORTER) \<br>    --timeout $(TIMEOUT) \<br>    $(MOCHA_OPTS) \<br>    $(TESTS)<br><br>test-cov: <br>  @URLRAR_COV=1 $(MAKE) test MOCHA_OPTS=&#39;--require blanket&#39; REPORTER=html-cov &gt; coverage.html<br>  @URLRAR_COV=1 $(MAKE) test MOCHA_OPTS=&#39;--require blanket&#39; REPORTER=travis-cov<br><br>test-all: test test-cov<br><br>.PHONY: test-cov test test-all</code></pre><br><br><p>package.json</p><br><br><pre><code>&quot;devDependencies&quot;: {<br>    &quot;travis-cov&quot;: &quot;</em>&quot;,<br>    &quot;blanket&quot;: &quot;<em>&quot;,<br>    // ...<br>  },<br>  &quot;scripts&quot;: {<br>    &quot;test&quot;: &quot;make test-all&quot;,<br>    &quot;blanket&quot;: { <br>      &quot;pattern&quot;: &quot;//^((?!(node_modules|test)).)</em>$/&quot;,<br>      &quot;data-cover-flags&quot;: {<br>        &quot;debug&quot;: false<br>      }<br>    },<br>    &quot;travis-cov&quot;: {<br>      &quot;threshold&quot;: 93<br>    }<br>  },</code></pre><br><br><pre><code>$ npm test </code></pre><br><br><p>运行结果: 包含测试结果和代码覆盖率.</p><br><br><br><img src="http://nfs.nodeblog.org/f/a/fa73ef3685d050f6efcdf8b7a1f428c1.png" alt="1"><br>1<br><br><br><br><h2>有爱</h2><br><br><p>^_^ 希望本文对你有用。</p><img src="http://www.cnblogs.com/fengmk2/aggbug/3123499.html?type=1" width="1" height="1" alt=""><p><a href="http://www.cnblogs.com/fengmk2/archive/2013/06/07/blanketjs-instead-of-jscover.html">本文链接</a></p></p>

</div>


            <div class="footer">
              <div class="contact">
                <p>
                  Your Name<br />
                  What You Are<br />
                  your@email.com
                </p>
              </div>
              <div class="contact">
                <p>
                  <a href="http://github.com/lyuehh/">github.com/lyuehh</a><br />
                  <a href="http://twitter.com/lyuehh/">twitter.com/lyuehh</a><br />
                </p>
              </div>
            </div>
          </div>
        </div> <!-- /container -->

    </body>
</html>
