<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>基于用户投票的排名算法（一）：Delicious和Hacker News</title>
        <meta name="viewport" content="width=device-width">

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/css/syntax.css">

        <!-- Custom CSS -->
        <link rel="stylesheet" href="/css/main.css">

    </head>
    <body>

        <div class="container">
          <div class="site">
            <div class="header">
              <h1 class="title"><a href="/">Your New Jekyll Site</a></h1>
              <a class="extra" href="/">home</a>
            </div>

                <h2>基于用户投票的排名算法（一）：Delicious和Hacker News</h2>
<p class="meta">25 Feb 2012</p>

<div class="post">
<h2>基于用户投票的排名算法（一）：Delicious和Hacker News</h2>

<h3>by</h3>

<h3>at 2012-02-24 21:50:24</h3>

<h3>original <a href="http://www.ruanyifeng.com/blog/2012/02/ranking_algorithm_hacker_news.html">http://www.ruanyifeng.com/blog/2012/02/ranking_algorithm_hacker_news.html</a></h3>

<p>互联网的出现，意味着"信息大爆炸"。</p>


<p>用户担心的，不再是信息太少，而是信息太多。如何从大量信息之中，快速有效地找出最重要的内容，成了互联网的一大核心问题。</p>




<p><img src="http://image.beekka.com/blog/201202/bg2012022401.jpg"></p>




<p>各种各样的排名算法，是目前过滤信息的主要手段之一。对信息进行排名，意味着将信息按照重要性依次排列，并且及时进行更新。排列的依据，可以基于信息本身的特征，也可以基于用户的投票，即让用户决定，什么样的信息可以排在第一位。</p>




<p>下面，我将整理和分析一些基于用户投票的排名算法，打算分成六个部分连载，今天是第一篇。</p>




<p><strong>一、Delicious</strong></p>




<p>最直觉、最简单的算法，莫过于按照单位时间内用户的投票数进行排名。得票最多的项目，自然就排在第一位。</p>




<p>旧版的<a href="http://www.google.com/url?sa=D&amp;q=http://del.icio.us/&amp;usg=AFQjCNFp5KllThyYtlA74rqSRKdqRtAjxw">Delicious</a>，有一个"热门书签排行榜"，就是这样统计出来的。</p>




<p><img src="http://image.beekka.com/blog/201202/bg2012022402.png"></p>




<p>它按照<strong>"过去60分钟内被收藏的次数"</strong>进行排名。每过60分钟，就统计一次。</p>




<p>这个算法的优点是比较简单、容易部署、内容更新相当快；缺点是，一方面，排名变化不够平滑，前一个小时还排名靠前的内容，往往第二个小时就一落千丈，另一方面，缺乏自动淘汰旧项目的机制，某些热门内容可能会长期占据排行榜前列。</p>




<p><strong>二、Hacker News</strong></p>




<p><a href="http://news.ycombinator.com/">Hacker News</a>是一个网络社区，可以张贴链接，或者讨论某个主题。</p>




<p><img src="http://image.beekka.com/blog/201202/bg2012022403.png"></p>




<p>每个帖子前面有一个向上的三角形，如果你觉得这个内容很好，就点击一下，投上一票。根据得票数，系统自动统计出热门文章排行榜。但是，并非得票最多的文章排在第一位，还要考虑时间因素，新文章应该比旧文章更容易得到好的排名。</p>




<p>Hacker News使用Paul Graham开发的Arc语言编写，源码可以从<a href="http://arclanguage.org/">arclanguage.org</a>下载。它的排名算法是<a href="http://pastebin.com/ZF57qQPi">这样</a>实现的：</p>




<p><a href="http://pastebin.com/ZF57qQPi"><img src="http://image.beekka.com/blog/201202/bg2012022404.png"></a></p>




<p>将上面的代码还原为数学公式：</p>




<p><img src="http://chart.googleapis.com/chart?cht=tx&amp;chl=Score%3D%5Cfrac%7BP-1%7D%7B(T%2B2)%5E%7BG%7D%7D&amp;chs=60" style="border:none"></p>




<p>其中，</p>




<p>　　P表示帖子的得票数，减去1是为了忽略发帖人的投票。</p>




<p>　　T表示距离发帖的时间（单位为小时），加上2是为了防止最新的帖子导致分母过小（之所以选择2，可能是因为从原始文章出现在其他网站，到转贴至Hacker News，平均需要两个小时）。</p>




<p>　　G表示"重力因子"（gravityth power），即将帖子排名往下拉的力量，默认值为1.8，后文会详细讨论这个值。</p>




<p>从这个公式来看，决定帖子排名有三个因素：</p>




<p><strong>第一个因素是得票数P。</strong></p>




<p>在其他条件不变的情况下，得票越多，排名越高。</p>




<p><a href="http://www.wolframalpha.com/input/?i=plot(+(30+-+1)+%2F+(t+%2B+2)%5E1.8%2C++(60+-+1)+%2F+(t+%2B+2)%5E1.8%2C+(200+-+1)+%2F+(t+%2B+2)%5E1.8+)+where+t%3D0..24"><img src="http://image.beekka.com/blog/201202/bg2012022405.png"></a></p>




<p>从<a href="http://www.wolframalpha.com/input/?i=plot(+(30+-+1)+%2F+(t+%2B+2)%5E1.8%2C++(60+-+1)+%2F+(t+%2B+2)%5E1.8%2C+(200+-+1)+%2F+(t+%2B+2)%5E1.8+)+where+t%3D0..24">上图</a>可以看到，有三个同时发表的帖子，得票分别为200票、60票和30票（减1后为199、59和29），分别以黄色、紫色和蓝色表示。在任一个时间点上，都是黄色曲线在最上方，蓝色曲线在最下方。</p>




<p>如果你不想让"高票帖子"与"低票帖子"的差距过大，可以在得票数上加一个小于1的指数，比如(P-1)^0.8。</p>




<p><strong>第二个因素是距离发帖的时间T。</strong></p>




<p>在其他条件不变的情况下，越是新发表的帖子，排名越高。或者说，一个帖子的排名，会随着时间不断下降。</p>




<p>从前一张图可以看到，经过24小时之后，所有帖子的得分基本上都小于1，这意味着它们都将跌到排行榜的末尾，保证了排名前列的都将是较新的内容。</p>




<p><strong>第三个因素是重力因子G。</strong></p>




<p>它的数值大小决定了排名随时间下降的速度。</p>




<p><a href="http://www.wolframalpha.com/input/?i=plot%28+%28p+-+1%29+%2F+%28t+%2B+2%29%5E2.0%2C++%28p+-+1%29+%2F+%28t+%2B+2%29%5E1.8%2C+%28p+-+1%29+%2F+%28t+%2B+2%29%5E1.5+%29+where+t%3D0..24%2C+p%3D10"><img src="http://image.beekka.com/blog/201202/bg2012022406.png"></a></p>




<p>从<a href="http://www.wolframalpha.com/input/?i=plot%28+%28p+-+1%29+%2F+%28t+%2B+2%29%5E2.0%2C++%28p+-+1%29+%2F+%28t+%2B+2%29%5E1.8%2C+%28p+-+1%29+%2F+%28t+%2B+2%29%5E1.5+%29+where+t%3D0..24%2C+p%3D10">上图</a>可以看到，三根曲线的其他参数都一样，G的值分别为1.5、1.8和2.0。G值越大，曲线越陡峭，排名下降得越快，意味着排行榜的更新速度越快。</p>




<p>知道了算法的构成，就可以调整参数的值，以适用你自己的应用程序。</p>




<p><strong>[参考文献]</strong></p>




<p>　　* <a href="http://amix.dk/blog/post/19574">How Hacker News ranking algorithm works</a></p>




<p>　　* <a href="http://blog.linkibol.com/2010/05/07/how-to-build-a-popularity-algorithm-you-can-be-proud-of/">How to Build a Popularity Algorithm You can be Proud of</a></p>




<p>（完）</p>


<div style="color:#556677;line-height:160%;padding:0.3em 0.5em;border:1px solid #d3d3d3;margin:1em;background-color:#aad2f0;border-radius:10px"><h3>文档信息</h3>
<ul>
<li>版权声明：自由转载-非商用-非衍生-保持署名 | <a href="http://creativecommons.org/licenses/by-nc-nd/3.0/deed.zh">Creative Commons BY-NC-ND 3.0</a></li>
<li>原文网址：<a href="http://www.ruanyifeng.com/blog/2012/02/ranking_algorithm_hacker_news.html">http://www.ruanyifeng.com/blog/2012/02/ranking_algorithm_hacker_news.html</a></li>
<li>最后修改时间：2012年3月20日 22:07</li>
<li>付费支持：<a href="https://mai.alipay.com/p.htm?id=2012033102826278"><img src="http://www.ruanyifeng.com/blog/images/rmb_32.png" alt="支付宝担保交易" style="border:none;vertical-align:middle"></a> | <a href="https://www.paypal.com/cgi-bin/webscr?cmd=_xclick&amp;business=yifeng.ruan@gmail.com&amp;currency_code=USD&amp;amount=2.99&amp;return=http://www.ruanyifeng.com/thank.html&amp;item_name=Ruan%20YiFeng&#39;s%20Blog&amp;undefined_quantity=1&amp;no_note=0"><img src="http://www.ruanyifeng.com/blog/images/dollar_32.png" alt="paypal" style="border:none;vertical-align:middle"></a> </li>
</ul></div>


<div style="color:#556677;line-height:160%;padding:0.3em 0.5em;margin:1em;border-radius:10px"><p><a href="http://yipinzao.com/" style="border:none"><img src="http://www.ruanyifeng.com/blog/images/ad_yipinzao.jpg" style="border:none"></a>
</p></div>


</div>


            <div class="footer">
              <div class="contact">
                <p>
                  Your Name<br />
                  What You Are<br />
                  your@email.com
                </p>
              </div>
              <div class="contact">
                <p>
                  <a href="http://github.com/yourusername/">github.com/yourusername</a><br />
                  <a href="http://twitter.com/yourusername/">twitter.com/yourusername</a><br />
                </p>
              </div>
            </div>
          </div>
        </div> <!-- /container -->

    </body>
</html>
