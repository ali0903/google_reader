<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>如何更好的使用Cookie</title>
        <meta name="viewport" content="width=device-width">

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/google_reader/css/syntax.css">

        <!-- Custom CSS -->
        <link rel="stylesheet" href="/google_reader/css/main.css">

    </head>
    <body>

        <div class="container">
          <div class="site">
            <div class="header">
              <h1 class="title"><a href="/google_reader/">Google Reader</a></h1>
              <a class="extra" href="/google_reader/">home</a>
            </div>

                <h2>如何更好的使用Cookie</h2>
<p class="meta">2012-06-20 06:58</p>

<div class="post">
<h2>如何更好的使用Cookie</h2>

<h3>by JerryQu</h3>

<h3>at 2012-06-19 22:58:31</h3>

<h3>original <a href="http://www.udpwork.com/item/7508.html">http://www.udpwork.com/item/7508.html</a></h3>

<p>Cookie是非常古老的技术，相信每个人都知道它怎么用，用来做什么。每一个http请求，无论是JS、CSS还是图片等，都会包含相应作用域的Cookie，越多的Cookie会导致请求头越大。所以实际使用时，需要多花些心思。</p>


<p>首先，对于页面上的静态资源，应该使用cookie-free域名，现在各大公司的xxcdn.com/xxximg.cn除了可以让资源并行下载，不同大域也可以确保不会被主站Cookie污染到。</p>


<p>其次，对于服务端完全不关心的用户数据，尽可能使用其它存储形式，例如userData、localStorage、Flash Cookie等。现在各大JS库都有提供相应的封装，我的博客之前也详细介绍过一些，这里不重点讲，自己挑一个用得顺手的就行。PS：最近我都是用的<a href="https://github.com/irideas/cacheSvc">曜子写的的那份</a>。</p>


<p>那些一定要记在Cookie的数据，也有一定的优化余地，来看例子：</p>


<p><img src="http://st.imququ.com/uploads/2012/06/m_1.jpg"></p>


<p>local_area字段记录了一些城市，编码后非常长，如果选择存放数字编号会短不少。\u007C对应的|，也可以选择不编码存放。</p>


<p>noticeguoqing顾名思义是一个标识，这里用的true/false，可以改为1和0。另外key也可以精简下，虽说key越短可读性越差，但可以通过维护对照表文档来弥补。</p>


<p><img src="http://st.imququ.com/uploads/2012/06/m_3.jpg"></p>


<p>上图中mpp这个字段，用的query string形式来表示。如果数据类型固定，可以改成特殊符号例如|或:分割，会短不少。</p>


<p>tg、mt、ck1等字段，可以合并为一个字段通过特殊符号隔开存储。Cookie个数也有上限，能省就省。不过，有些人习惯把JS对象用JSON.stringify序列化后再存，这样未尝不可，但如果能采用定制化的序列化策略，会更省。</p>


<p>l字段，记录了一个时间戳，长达13位。可以使用下面的方法来优化时间戳：</p>


<pre>//选定一个基准时间戳
var base_time = 1338480000000; //2012-06-01
var time = 1340117354383; //待优化的时间戳
var new_time = (time - base_time).toString(36); //&quot;r2u6q7&quot;</pre>


<p>减去一个固定值，是为了让结果更短。如果嫌麻烦，直接toString(36)也能短不少。</p>


<p>除了上面两个例子，还有一些场景是小域Cookie使用不当，被放在了大域下，影响面也比较广。</p>


<p>自己的项目里，由于CDN的使用，静态资源域名cookie-free做得很好；能不用Cookie的场景也都使用了其它的本地存储方案；对于必须使用Cookie的场景，无论是Cookie名、Cookie值，还是Cookie个数、作用域都比较混乱，一些是历史原因，需要逐步规范和统一，任重道远。</p>


<pre><code>        &lt;div style="margin-top:8px;padding:6px 0;border-top:1px solid #3cf"&gt;
            &lt;div style="text-align:center;margin:16px 0;padding:6px;border:0px dashed #999;font-family:arial;font-size:26px;font-weight:bold"&gt;
&lt;a href="http://www.udpwork.com/item/7508.html#review_form" title="不喜欢" style="text-decoration:none"&gt;
    &lt;img src="http://www.udpwork.com//images/thumb_down24.gif" alt=""&gt;
    &lt;span style="color:#f33"&gt;0&lt;/span&gt;
&lt;/a&gt;
   
&lt;a href="http://www.udpwork.com/item/7508.html#review_form" title="喜欢" style="text-decoration:none"&gt;
    &lt;img src="http://www.udpwork.com//images/thumb_up24.gif" alt=""&gt;
    &lt;span style="color:#3c3"&gt;0&lt;/span&gt;
&lt;/a&gt;
</code></pre>

<p></div>              <p>
                    由 <a href="http://www.udpwork.com/">IT 牛人博客聚合网站(udpwork.com)</a> 聚合
                    |
                    <a href="http://www.udpwork.com/item/7508.html#reviews">评论: 0</a>
                    |
                    <a href="http://book.benegg.com/tag/%E7%BC%96%E7%A8%8B?from=udpwork-feed">10000+ 本编程/Linux PDF/CHM 电子书下载</a>
                </p>
            </div></p>

</div>


            <div class="footer">
              <div class="contact">
                <p>
                  Your Name<br />
                  What You Are<br />
                  your@email.com
                </p>
              </div>
              <div class="contact">
                <p>
                  <a href="http://github.com/lyuehh/">github.com/lyuehh</a><br />
                  <a href="http://twitter.com/lyuehh/">twitter.com/lyuehh</a><br />
                </p>
              </div>
            </div>
          </div>
        </div> <!-- /container -->

    </body>
</html>
