<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>jQuery1.8 css模块评析</title>
        <meta name="viewport" content="width=device-width">

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/css/syntax.css">

        <!-- Custom CSS -->
        <link rel="stylesheet" href="/css/main.css">

    </head>
    <body>

        <div class="container">
          <div class="site">
            <div class="header">
              <h1 class="title"><a href="/">Your New Jekyll Site</a></h1>
              <a class="extra" href="/">home</a>
            </div>

                <h2>jQuery1.8 css模块评析</h2>
<p class="meta">04 Sep 2012</p>

<div class="post">
<h2>jQuery1.8 css模块评析</h2>

<h3>by 司徒正美</h3>

<h3>at 2012-09-04 15:10:00</h3>

<h3>original <a href="http://www.cnblogs.com/rubylouvre/archive/2012/09/04/2670391.html">http://www.cnblogs.com/rubylouvre/archive/2012/09/04/2670391.html</a></h3>

<p>jQuery早期的核心设施早都是DE大神那里拿过来的,什么选择器，事件系统，精确计算样式……现在CSS模块集中了DE大神的两个伟大的HACK</p>


<p>一个是用于在标准浏览器下转换百分比值为更有用的像素值</p>


<p><br>// A tribute to the "awesome hack by Dean Edwards"<br>// Chrome &lt; 17 and Safari 5.0 uses &quot;computed value&quot; instead of &quot;used value&quot; for margin-right<br>// Safari 5.1.7 (at least) returns percentage for a larger set of values, but width seems to be reliably pixels<br>// this is against the CSSOM draft spec: http://dev.w3.org/csswg/cssom/#resolved-values<br>if ( rnumnonpx.test( ret ) &amp;&amp; rmargin.test( name ) ) {<br>width = style.width;<br>minWidth = style.minWidth;<br>maxWidth = style.maxWidth;<br><br>style.minWidth = style.maxWidth = style.width = ret;<br>ret = computed.width;<br><br>style.width = width;<br>style.minWidth = minWidth;<br>style.maxWidth = maxWidth;<br>}<br><p>一个是在IE下刷新原始值为当前的计算值(像素值)。</p><br>// From the awesome hack by Dean Edwards<br>// http://erik.eae.net/archives/2007/07/27/18.54.15/#comment-102291<br><br>// If we're not dealing with a regular pixel number<br>// but a number that has a weird ending, we need to convert it to pixels<br>// but not position css attributes, as those are proportional to the parent element instead<br>// and we can't measure the parent instead because it might trigger a "stacking dolls" problem<br>if ( rnumnonpx.test( ret ) &amp;&amp; !rposition.test( name ) ) {<br><br>// Remember the original values<br>left = style.left;<br>rsLeft = elem.runtimeStyle &amp;&amp; elem.runtimeStyle.left;<br><br>// Put in the new values to get a computed value out<br>if ( rsLeft ) {<br>elem.runtimeStyle.left = elem.currentStyle.left;<br>}<br>style.left = name === "fontSize" ? "1em" : ret;<br>ret = style.pixelLeft + "px";<br><br>// Revert the changed values<br>style.left = left;<br>if ( rsLeft ) {<br>elem.runtimeStyle.left = rsLeft;<br>}<br>}<br><br>return ret === "" ? "auto" : ret;<br><p>浏览器内部肯定有一套获取精确的像素值（对于某些样式属性来说）的机制，被DE大神发现了它们的触发条件。</p><p>此外,jquery还提供两个单独的API,width, height获取元素的长宽,它们甚至可以取得隐藏元素的长宽。出于性能的考量，浏览器对隐藏元素的样式是统统不计算的，有一套默认值返回给你，对于长宽就是0。对于动画来说，这有点不方便，比如show, slideDown等特效！因此jQuery等偷偷让它们显示出来，取得精确值，再隐藏回来，这个是由jquery.swap方法来干。不过到了jquery1.8中，是否要调用这swap方法的条件严格了，</p><br>rdisplayswap = /^(none|table(?!-c[ea]).+)/,<br>jQuery.each([ "height", "width" ], function( i, name ) {<br>jQuery.cssHooks[ name ] = {<br>get: function( elem, computed, extra ) {<br>if ( computed ) {<br>// certain elements can have dimension info if we invisibly show them<br>// however, it must have a current display style that would benefit from this<br>if ( elem.offsetWidth === 0 &amp;&amp; rdisplayswap.test( curCSS( elem, &quot;display&quot; ) ) ) {<br>return jQuery.swap( elem, cssShow, function() {<br>return getWidthOrHeight( elem, name, extra );<br>});<br>} else {<br>return getWidthOrHeight( elem, name, extra );<br>}<br>}<br>},<br><br>set: function( elem, value, extra ) {}<br>};<br>});<br><p>rdisplayswap这个正则意思是，以 none 或者 table （但后面不是 -ce 或 -ca）开头的display值。换言之，下面这几种display值会进入swap分支</p><br>none table-column table-column-group table-footer-group table-header-group table-row table-row-group<br><p>此外，我们在设置宽高时，jquery会根据当前的box-sizing选择盒子模型，于是有了augmentWidthOrHeight这个方法。</p><p>为了不用用户自己写CSS3私有实现的前缀，jquery还会贴心地帮你补上它们，于是有了vendorPropName方法。</p><p>由于现在-webkit-的私有属性基本上事实的标准，opera也开始支持-webkit-前缀，我们可以看到<strong>cssPrefixes = [ "Webkit", "O", "Moz", "ms" ]</strong>是这样排列的！</p><p>有些样式，必须添加单位才能效，而jquery搞了个cssNumber，帮你在这些样式之外的样式补上“px”。总之，jquery在背后帮你做了许多事情，你写一行代码，jQuery帮你写了剩下的五十行或三百行！</p><img src="http://www.cnblogs.com/rubylouvre/aggbug/2670391.html?type=1" width="1" height="1" alt=""><p><a href="http://www.cnblogs.com/rubylouvre/archive/2012/09/04/2670391.html">本文链接</a></p></p>

</div>


            <div class="footer">
              <div class="contact">
                <p>
                  Your Name<br />
                  What You Are<br />
                  your@email.com
                </p>
              </div>
              <div class="contact">
                <p>
                  <a href="http://github.com/yourusername/">github.com/yourusername</a><br />
                  <a href="http://twitter.com/yourusername/">twitter.com/yourusername</a><br />
                </p>
              </div>
            </div>
          </div>
        </div> <!-- /container -->

    </body>
</html>
