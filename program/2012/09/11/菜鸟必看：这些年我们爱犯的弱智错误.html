<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>菜鸟必看：这些年我们爱犯的弱智错误</title>
        <meta name="viewport" content="width=device-width">

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/google_reader/css/syntax.css">

        <!-- Custom CSS -->
        <link rel="stylesheet" href="/google_reader/css/main.css">

    </head>
    <body>

        <div class="container">
          <div class="site">
            <div class="header">
              <h1 class="title"><a href="/google_reader/">Google Reader</a></h1>
              <a class="extra" href="/google_reader/">home</a>
            </div>

                <h2>菜鸟必看：这些年我们爱犯的弱智错误</h2>
<p class="meta">2012-09-11 17:29</p>

<div class="post">
<h2>菜鸟必看：这些年我们爱犯的弱智错误</h2>

<h3>by</h3>

<h3>at 2012-09-11 09:29:34</h3>

<h3>original <a href="http://kb.cnblogs.com/page/133036/">http://kb.cnblogs.com/page/133036/</a></h3>

<p>　　做了开源以后，最大的感触就是：沟通增加了，信息来源增加了。提问的朋友很多，各种问题都会有，有时候在解答时也是很郁闷，这两天感觉适当总结一下自己以及周围朋友在制作 js 时爱犯的弱智错误，还是很有必要的。这些弱智错误经常会让我们抓狂——这么简单的东西怎么就是总出错呢?反复检查好几遍就是找不到错误，一旦你恍然大悟时，必然会惊呼：啊!太弱智了。。。。</p>


<p>　　这篇文章肯定无法帮助你应付面试(面试一般不会考你“弱智错误”的)，也肯定不会让你的技术水平得到深入的提高(弱智错误一般和你使用的技术深浅无关)，但应该能让你在调试代码的过程中提高效率(更多是一种习惯，或者说还是“细节决定成败”)，如果能对这些弱智错误牢记心间的话，当你遇到那些怎么改都改不对的时候，就要想想“是不是我犯了弱智错误??”，所以本篇文章主要献给菜鸟们，对于老手来说，欢迎多多提供自己的经验教训，让菜鸟们能够更快的成长起来。</p>


<p>　　闲言少叙，直接看正文：</p>


<p><strong>　　<span style="font-size:large">No.1 大小写不一致</span></strong></p>


<p>　　把这个弱智错误名列榜首，可是当之无愧，从菜鸟到高手，能有几人逃得过?</p>


<p><strong>　　错误描述：</strong>一会儿用 id、pid; 一会儿又是 Id、pId。当然要乱套了。</p>


<p><strong>　　避免办法：</strong>养成良好的命名习惯很重要。看着文档做功课时要仔细。</p>


<p><strong>　　<span style="font-size:large">No.2 输入错误</span></strong></p>


<p>　　其实这个错误和大小写不一致类似。</p>


<p><strong>　　错误描述：</strong>输入变量时左右手指出现了节奏时差，变量名中某两个字母站错了位置，本来应该输入 function 结果一不小心输入了 fucntion，如果不仔细看怎么看怎么对。另外多个字母少个字母的情况也时有发生。</p>


<p><strong>　　避免办法：</strong>敲代码时要尽量集中精神，避免三心二意。检查错误时可以把正常的代码和错误部分的代码粘贴到一起，对比查看，往往很容易能够发现这种错误。(推荐多玩玩儿“找不同”，也会不同程度的提升纠错能力)</p>


<div style="background-color:#f5f5f5;border:1px solid #cccccc;padding:10px"><span>//</span><span style="color:#008000">两行放在一起对比，是不是一眼就能看出来错误的地方呢？  </span><span style="color:#008000"><br></span>var children = function() { var _this = <span style="color:#0000ff">this</span>; var iCounter = 0;  iCounter++;}  <br>var children = funtcion() { var _this = <span style="color:#0000ff">this</span>; var iCounter = 0;  icounter++;} </div>


<p><strong>　　<span style="font-size:large">No.3 多余的逗号</span></strong></p>


<p>　　相信10个人中至少有8个人犯过这种错误。</p>


<p><strong>　　错误描述：</strong>主要是对于 JSON 对象中，最后一个对象后面仍保留一个逗号。这种情况下对于 Firefox、Chrome 等浏览器来说运行起来一切正常，可是放到 IE 上就报错，再加上 IE 还很难调试，所以对于菜鸟来说往往很难找到源头。</p>


<p>　　举例： {"a":1, "b":2, "c":3,}</p>


<p>　　出现这种错误最常见的情况就是在 Server 端利用循环语句批量生成 JSON 数据字符串的时候。</p>


<p><strong>　　避免办法：</strong>这个的确没有太好的办法彻底避免，只能是让你的脑子里多一根经，一旦批量制作 JSON 格式的内容时，就要小心最后面是不是会多一个逗号。</p>


<p><strong>　　<span style="font-size:large">No.4 数组的长度</span></strong></p>


<p><strong>　　错误描述：</strong>关于数组的使用时，总会时不时的出现一些下标越界 或者 null 方面的错误。</p>


<p>　　举例：某个 function 中一段代码 a[0] = a[1]+1; 大部分时候正常，但偶尔会出现错误。</p>


<p><strong>　　避免办法：</strong>产生这个错误一般来说是没有养成使用数组时要首先对数组对象进行检查的习惯，例如首先判断 a!=null; 另外还要判断 a.length 是否满足你需要用到的 index 值。这个就是个习惯问题。</p>


<p><strong>　　<span style="font-size:large">No.5 诡异的计数器</span></strong></p>


<p>　　这是一个 zTree 中曾经犯下的弱智错误，但由于原先使用多棵树的用户并不多，所以很长时间都没有暴露出来。</p>


<p><strong>　　错误描述</strong>：有一个全局变量用于计数，但有多个不同的地方都在使用这一个计数器，当其中某处忘记了其他地方还在使用这个计数器时，可能会对其进行清零重置。。OMG，这样可就糟糕了吧，别的地方因为计数器归零会容易导致某些值冲突。</p>


<p><strong>　　避免办法：</strong>对于全局变量的使用要规范，对于改变全局变量的地方越少越好，或者封装成固定的方法，要清楚全局变量的作用，修改时一定要慎重。</p>


<p><strong>　　<span style="font-size:large">No.6 难以理解的等式</span></strong></p>


<p>　　写代码就少不了 if; 你在使用 if 的时候是否总会出现莫名其妙的结果呢? 看看下面这段代码的结果，比较一下 a/b 的等式结果吧：</p>


<div style="background-color:#f5f5f5;border:1px solid #cccccc;padding:10px">var a = 0;  <br>var b = "0";       <br><span style="color:#0000ff">if</span> (a) {console.log(1);}             <span style="color:#008000">//</span><span style="color:#008000"> false  </span><span style="color:#008000"><br></span><span style="color:#0000ff">if</span> (!!a) {console.log(2);}           <span style="color:#008000">//</span><span style="color:#008000">  false  </span><span style="color:#008000"><br></span><span style="color:#0000ff">if</span> (b) {console.log(3);}             <span style="color:#008000">//</span><span style="color:#008000">  true  </span><span style="color:#008000"><br></span><span style="color:#0000ff">if</span> (!!b) {console.log(4);}           <span style="color:#008000">//</span><span style="color:#008000">  true  </span><span style="color:#008000"><br></span><span style="color:#0000ff">if</span> (a == <span style="color:#0000ff">false</span>) {console.log(5);}    <span style="color:#008000">//</span><span style="color:#008000"> true  </span><span style="color:#008000"><br></span><span style="color:#0000ff">if</span> (!!a == <span style="color:#0000ff">false</span>) {console.log(6);}  <span style="color:#008000">//</span><span style="color:#008000">  true  </span><span style="color:#008000"><br></span><span style="color:#0000ff">if</span> (b == <span style="color:#0000ff">false</span>) {console.log(7);}    <span style="color:#008000">//</span><span style="color:#008000">  true  </span><span style="color:#008000"><br></span><span style="color:#0000ff">if</span> (!!b == <span style="color:#0000ff">true</span>) {console.log(8);}   <span style="color:#008000">//</span><span style="color:#008000">  true</span></div>


<p><strong>　　错误描述：</strong>对于 number 和 string 在 if 表达式中，如果值是 0 或 "0" 时总会让你措手不及。</p>


<p><strong>　　避免办法：</strong>建议对于非 boolean 对象的在判定时采用 !! 进行标准的 boolean 转换，同时要记住 js 中对于 0 这个特殊情况的判定，再结合你的需求编写正确的判定表达式。</p>


<p><strong>　　<span style="font-size:large">No.7 JSON 对象的理解</span></strong></p>


<p>　　有的初学者对于 server 端的对象能够争取理解，但是放到 js 中时往往开始变得糊涂了。</p>


<p><strong>　　错误描述：</strong>错误的认为只要{}里面的内容相同，那么这两个对象就是一样的。</p>


<p>　　举例：认为 var a = {"id":1}; var b = {"id":1} 那么 a == b (正确答案： a != b)</p>


<p><strong>　　避免办法：</strong>需要正确理解 JSON 对象的定义。 每次 {} 就相当于生成一个新的 JSON 对象。</p>


<p><strong>　　<span style="font-size:large">No.8 js 文件加载顺序</span></strong></p>


<p>　　你是不是出现过js文件都加载了，可是还总报 undefined 的错误呢?</p>


<p>　　错误描述：由于先加载了使用某个对象的代码，后加载了定义该对象的代码，导致报错。</p>


<p>　　举例：</p>


<div style="background-color:#f5f5f5;border:1px solid #cccccc;padding:10px"><span style="color:#008000">//</span><span style="color:#008000"> a.js 文件  </span><span style="color:#008000"><br></span>function a() {<span style="color:#0000ff">return</span> "a";}  <br>     <br><span style="color:#008000">//</span><span style="color:#008000"> b.js 文件  </span><span style="color:#008000"><br></span>alert(a()); </div>


<p><strong>　　避免办法：</strong>牢记先要定义对象，然后才能使用对象，确保 js 文件的加载顺序。</p>


<p><strong>　　<span style="font-size:large">No.9 浏览器的兼容问题</span></strong></p>


<p>　　前两天看到一句话，大概意思是：“作为一个前端程序员来说，很少有人能够如此幸运——只兼容一款浏览器”。</p>


<p><strong>　　错误描述：</strong>在某个浏览器下调整的好好的，怎么换个浏览器就不好使了??</p>


<p><strong>　　避免办法：</strong>如果让你完全牢记所有会出现兼容问题的代码，貌似不太现实。一般来说只能记住一些常用的，或者是利用 jQuery 等架构减轻遇到这些问题的可能性。再有就是要提高警惕，一旦出现此类情况，就要考虑一下是不是因为 js 的兼容问题造成的呢?</p>


<p>　　补充：在不少情况下，往往是 css 的兼容出现了错误，让你误以为是 js 的错误。</p>


<p><strong>　　<span style="font-size:large">No.10 异步加载的疏忽(一)</span></strong></p>


<p>　　对于一个菜鸟来说，对于异步加载的理解很关键，也是一个经常容易犯错误的地方。</p>


<p><strong>　　错误描述：</strong>用 Ajax 去给某个对象赋值，紧接着 Ajax 的代码后面就执行了使用这个对象的代码。然后你就会发现明明 Ajax 返回的结果是正确的，为何还不能正常执行呢??</p>


<p><strong>　　避免办法：</strong>对于需要确保 Ajax 执行完毕后才能执行的代码，一定要在 Ajax 的 success 和 error 这两个回调函数中进行。绝对不能紧跟在 Ajax 的代码后面立刻执行。 一定要深刻理解“异步加载”的含义，以及它最简单的工作原理。</p>


<p><strong>　　<span style="font-size:large">No.11 异步加载的疏忽(二)</span></strong></p>


<p>　　上面说了一定要在 Ajax 的 success 和 error 这两个回调函数中执行必要代码，success 不就可以了，为何还要在 error 中执行呢??</p>


<p><strong>　　错误描述：</strong>对于某些在 Ajax 前设定的标识，只在 Ajax 的 success 中修改标识，会发现一旦 server 或 网络异常导致 Ajax 出错时，就会出现一些很难理解的错误现象。</p>


<p>　　举例：</p>


<div style="background-color:#f5f5f5;border:1px solid #cccccc;padding:10px"><span style="color:#008000">//</span><span style="color:#008000">这段代码简单的实现避免同时多个 ajax 执行的代码，只有当 ajax 完成后才能重新 ajax  </span><span style="color:#008000"><br>//</span><span style="color:#008000">一旦ajax过程出现错误后，这段代码将导致 goAjax 永远不会再进行 ajax 调用  </span><br><span style="color:#0000ff">var</span> a = <span style="color:#0000ff">true</span><span style="color:#000000">; <br></span><span style="color:#0000ff">function</span><span style="color:#000000"> goAjax() {  <br>    </span><span style="color:#0000ff">if</span><span style="color:#000000"> (a) {  <br>    a </span>= <span style="color:#0000ff">false</span><span style="color:#000000">;  <br>    </span><span style="color:#008000">//</span><span style="color:#008000">这里用 jQuery 的 ajax 调用举例  </span><br><span style="color:#000000">    $.ajax({  <br>        success: </span><span style="color:#0000ff">function</span><span style="color:#000000">(msg) {  <br>            a </span>= <span style="color:#0000ff">true</span><span style="color:#000000">;  <br>        }  <br>     <br>    });  <br>    }  <br>}</span></div>


<p><strong>　　避免办法：</strong>对于必要的标识，一定要在 error 中设置相应的数据恢复，避免由于 ajax 异常导致程序逻辑错误。</p>


<p>　　例如上面的代码需要增加:</p>


<div style="background-color:#f5f5f5;border:1px solid #cccccc;padding:10px">error: function() { a = <span style="color:#0000ff">true</span>;} </div>


<p><strong>　　<span style="font-size:large">No.12 jQuery 搜索DOM对象是否存在的判定</span></strong></p>


<p>　　这是一个刚使用 jQuery 时非常容易犯的错误。</p>


<p><strong>　　错误描述：</strong>var a = $("#test"); if(!!a) {alert("ok!");} 运行这段代码你会发现，永远都会 alert，不管是否存在 id = "test" 的DOM</p>


<p><strong>　　避免办法：</strong>jQuery 的 $ 方法查找对象，始终都会返回一个 jQuery 对象的，不管是否存在查找的结果。检查是否有结果请利用 length 属性，比如 if(a.length&gt;0) {alert(&quot;ok!&quot;);}</p>


</div>


            <div class="footer">
              <div class="contact">
                <p>
                  Your Name<br />
                  What You Are<br />
                  your@email.com
                </p>
              </div>
              <div class="contact">
                <p>
                  <a href="http://github.com/lyuehh/">github.com/lyuehh</a><br />
                  <a href="http://twitter.com/lyuehh/">twitter.com/lyuehh</a><br />
                </p>
              </div>
            </div>
          </div>
        </div> <!-- /container -->

    </body>
</html>
