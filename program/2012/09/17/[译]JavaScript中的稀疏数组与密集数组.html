<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>[译]JavaScript中的稀疏数组与密集数组</title>
        <meta name="viewport" content="width=device-width">

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/css/syntax.css">

        <!-- Custom CSS -->
        <link rel="stylesheet" href="/css/main.css">

    </head>
    <body>

        <div class="container">
          <div class="site">
            <div class="header">
              <h1 class="title"><a href="/">Your New Jekyll Site</a></h1>
              <a class="extra" href="/">home</a>
            </div>

                <h2>[译]JavaScript中的稀疏数组与密集数组</h2>
<p class="meta">17 Sep 2012</p>

<div class="post">
<h2>[译]JavaScript中的稀疏数组与密集数组</h2>

<h3>by 司徒正美</h3>

<h3>at 2012-09-16 22:47:00</h3>

<h3>original <a href="http://www.cnblogs.com/rubylouvre/archive/2012/09/16/2687998.html">http://www.cnblogs.com/rubylouvre/archive/2012/09/16/2687998.html</a></h3>

<p>原文(被墙):<a href="http://www.2ality.com/2012/06/dense-arrays.html">http://www.2ality.com/2012/06/dense-arrays.html</a></p>


<hr><p> </p><p>一般来说,JavaScript中的数组是稀疏的,也就是说,数组中的元素之间可以有空隙,因为一个数组其实就是一个键值映射.本文解释了如何创建稀疏数组和不稀疏的数组.</p><p> </p><h2>1.稀疏数组<p>创建一个指定长度的稀疏数组很简单:</p><br>&gt; var a = new Array(3);<br>&gt; a<br>[ , ,  ]<br>&gt; a.length<br>3<br>&gt; a[0]<br>undefined<br><p>当你遍历它时,你会发现,它并没有元素.JavaScript会跳过这些缝隙.</p><br>&gt; a.forEach(function (x, i) { console.log(i+&quot;. &quot;+x) });<br><br>&gt; a.map(function (x, i) { return i })<br>[ , ,  ]<br><p>译者注:还有一些其他情况会生成稀疏数组,比如</p><br>&gt;var arr = [];<br>&gt;arr[0] = 0;<br>&gt;arr[100] = 100<br><br>&gt;a.forEach(function (x, i) { console.log(i+&quot;. &quot;+x) });<br>0. 0<br>100. 100<br><h2>2.密集数组<p><a href="http://bbenvie.com/">Brandon Benvie </a>最近在<a href="http://www.ecmascript.org/community.php">es-discuss邮件讨论组</a>中提到了一个<a href="https://mail.mozilla.org/pipermail/es-discuss/2012-April/022273.html">创建密集数组的技巧</a>:</p><br>&gt; var a = Array.apply(null, Array(3));<br>&gt; a<br>[ undefined, undefined, undefined ]<br><p>上面的语句其实等同于:</p><br>Array(undefined, undefined, undefined)<br><p>但从表面上看,貌似这个数组和之前的稀疏数组并没有太多的区别:</p><br>&gt; a.length<br>3<br>&gt; a[0]<br>undefined<br><p>可是,你现在可以遍历到这些数组元素了,还可以为每个元素重新赋值:</p><br><br>&gt; a.forEach(function (x, i) { console.log(i+&quot;. &quot;+x) });<br>0. undefined<br>1. undefined<br>2. undefined<br><br>&gt; a.map(function (x, i) { return i })<br>[ 0, 1, 2 ]<br><p>译者注:实际上,JavaScript并没有常规的数组,所有的数组其实就是个对象,只不过会自动管理一些"数字"属性和length属性罢了.说的更直接一点,JavaScript中的数组根本没有索引,因为索引应该是数字,而JavaScript中数组的索引其实是字符串.arr[1]其实就是arr["1"],给arr["1000"] = 1,arr.length也会自动变为1001.这些表现的根本原因就是,JavaScript中的对象就是字符串到任意值的键值对.注意键只能是字符串.这和AWK类似.不信可以试试awk 'BEGIN{a[1]=1;print(a["1"])}'.也许这是因为<a href="https://brendaneich.com/">Brendan Eich</a>在发明JavaScript时<a href="http://www.slideshare.net/BrendanEich">参考了不少awk的设计</a>的原因.不过目前,ES6中已经有了类似于Java等语言的Map类型,键可以是任意类型的值.请参考我翻译的MDN文档<a href="https://developer.mozilla.org/zh-CN/docs/JavaScript/Reference/Global_Objects/Map">Map</a></p><h2>3.另一个技巧<p>邮件里还提到了另外一个技巧:</p><br>&gt; Array.apply(null, Array(3)).map(Function.prototype.call.bind(Number))<br>[ 0, 1, 2 ]<br><p>这大概等同于下面的写法</p><br>&gt; Array.apply(null, Array(3)).map(Function.prototype.call.bind(Number))<br>[ 0, 1, 2 ]<br><br><p>注意,<tt>x</tt>是call方法的第一个参数,它作为了Number函数中的<tt>this值</tt>.这个值没有什么意义,相当于被忽略.我更喜欢下面这个能让人一眼就看明白的写法:</p><br>Array.apply(null, Array(3)).map(function (x,i) { return i })<br><p>译者注:</p><br><br>Array.apply(null, Array(3)).map(Function.prototype.call.bind(Number))<br>//等同于<br>Array.apply(null, Array(3)).map(Function.prototype.call,Number)<br><br><p>虽然使用自定义的函数更清晰,但自定义的函数肯定没有原生方法快.举个例子:</p><br>var a = ["aaa  ", "  bbb", "  ccc  "]<br><br>a.map(function(x) { return x.trim(); });               // ['aaa', 'bbb', 'ccc']<br>a.map(Function.prototype.call, String.prototype.trim); // ['aaa', 'bbb', 'ccc']<br><br><p>上面使用map方法来trim掉每个数组元素的空格,使用原生的方法虽然难理解.但效率高.看不懂的可以查看下我翻译的MDN文档<a href="https://developer.mozilla.org/zh-CN/docs/JavaScript/Reference/Global_Objects/Array/map">Array.prototype.map()</a></p><h2>4.实际用途?<p>在实际生产中,使用上面讲的创建密集数组的方法会让别人无法读懂你的代码.所以封装成一个工具函数会更好,比如 <a href="http://documentcloud.github.com/underscore/"><tt>_.range</tt></a>:</p><br>&gt; _.range(3)<br>[ 0, 1, 2 ]<br><br><p>和map配合使用,可以使用某个指定的值填充整个数组.</p><br>&gt; _.range(3).map(function () { return &quot;a&quot; })<br>[ 'a', 'a', 'a' ]<br><br><p>译者注:其他语言里,都有方便的生成递增数字列表的办法,比如perl和ruby里使用1..100,python里使用range(100),还有一个常见的需求就是生成一个重复某个字段的字符串,在ruby和python里,可以用"a"*100,在perl里用"a"x100,在JavaScript中,可以用Array(100)<span style="color:#000000">.join("a")</span></p><h2>5.相关文章<ol><li><a href="http://www.2ality.com/2011/04/iterating-over-arrays-and-objects-in.html">Iterating over arrays and objects in JavaScript</a>(已墙)</li><li><a href="http://www.2ality.com/2012/01/underscore-on-nodejs.html">Trying out Underscore on Node.js</a>(已墙)</li><img src="http://www.cnblogs.com/rubylouvre/aggbug/2687998.html?type=1" width="1" height="1" alt=""><p><a href="http://www.cnblogs.com/rubylouvre/archive/2012/09/16/2687998.html">本文链接</a></p></ol></h2></h2></h2></h2></h2>


</div>


            <div class="footer">
              <div class="contact">
                <p>
                  Your Name<br />
                  What You Are<br />
                  your@email.com
                </p>
              </div>
              <div class="contact">
                <p>
                  <a href="http://github.com/yourusername/">github.com/yourusername</a><br />
                  <a href="http://twitter.com/yourusername/">twitter.com/yourusername</a><br />
                </p>
              </div>
            </div>
          </div>
        </div> <!-- /container -->

    </body>
</html>
