<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>couchDB学习笔记</title>
        <meta name="viewport" content="width=device-width">

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/google_reader/css/syntax.css">

        <!-- Custom CSS -->
        <link rel="stylesheet" href="/google_reader/css/main.css">

    </head>
    <body>

        <div class="container">
          <div class="site">
            <div class="header">
              <h1 class="title"><a href="/google_reader/">Google Reader</a></h1>
              <a class="extra" href="/google_reader/">home</a>
            </div>

                <h2>couchDB学习笔记</h2>
<p class="meta">2012-08-25 06:28</p>

<div class="post">
<h2>couchDB学习笔记</h2>

<h3>by 司徒正美</h3>

<h3>at 2012-08-24 22:28:00</h3>

<h3>original <a href="http://www.cnblogs.com/rubylouvre/archive/2012/08/24/2653863.html">http://www.cnblogs.com/rubylouvre/archive/2012/08/24/2653863.html</a></h3>

<p><a href="http://couchdb.apache.org/">couchDB</a>是一个非常易用的nosql数据库，到官网下载安装并启动它，然后新建一JS文件：</p>


<pre>var http = require('http');var options = {    port: 5984,    method: 'GET', //   path:"/_all_dbs"};//这个回调果真只有一个参数，即http.createServer(function(req, res) {})var req = http.request(options, function(res) {    console.log('STATUS: ' + res.statusCode);    console.log('HEADERS: ' + JSON.stringify(res.headers));    res.setEncoding('utf8');    var body = ""    res.on('data', function (chunk) {        body += chunk    });    res.once("end", function(){        var json = JSON.parse(body);        console.log(json)    })});req.end()req.on('error', function(e) {    console.log('problem with request: ' + e.message);});</pre>


<p>然后用node.js打开它！控制台输出如下消息，表示成功：</p>


<pre>STATUS: 200HEADERS: {"server":"CouchDB/1.2.0 (Erlang OTP/R14B04)","date":"Fri, 24 Aug 201202:53:18 GMT","content-type":"text/plain; charset=utf-8","content-length":"40","cache-control":"must-revalidate"}{ couchdb: 'Welcome', version: '1.2.0' }</pre>


<p>然后我们修改一下上面的options对象，查看里面已经有多少个数据库</p>


<pre>var options = {    port: 5984,    method: 'GET',    path:"/_all_dbs"};</pre>


<p>会输出一个数组</p>


<pre>[ '_replicator', '_users' ]</pre>


<p>创建一个数据库，为PUT请求，path为数据库名</p>


<pre>var options = {    port: 5984,    method: 'PUT',    path:"/aaa"};</pre>


<p>输出ok=true表示成功</p>


<pre>{ ok: true }</pre>


<p>注,不能重复创建相同数据库,我们试再发一次上面的请求,会返回上面请求</p>


<pre>{ error: 'file_exists',  reason: 'The database could not be created, the file already exists.' }</pre>


<p>删除一个数据库就用DELETE请求,path为数据库名</p>


<pre>var options = {    port: 5984,    method: 'DELETE',    path:"/aaa"};</pre>


<p>在一个数据库内插入一条记录,因为上面的aaa被我们删掉了, 我们就再搞个albums</p>


<pre>var options = {    port: 5984,    method: 'PUT',    path:"/albums"};</pre>


<p>插入新记录,记录在nosql数据库大多数称之为文档.它要求有一个UUID,你就随便造一个吧</p>


<pre>var http = require('http');//创建一个名为baseball的数据库var options = {    port: 5984,    method: 'PUT',    path:"/albums/1"};var req = http.request(options, function(res) {    console.log('STATUS: ' + res.statusCode);    console.log('HEADERS: ' + JSON.stringify(res.headers));    res.setEncoding('utf8');    var body = ""    res.on('data', function (chunk) {        body += chunk    });    res.once("end", function(){        var json = JSON.parse(body);        console.log(json)    })});req.setHeader("Content-Type", "application/json")//这时请补上文档内容req.write(JSON.stringify({    "title":"There is Nothing Left to Lose",    "artist":"Foo Fighters"}))req.end()req.on('error', function(e) {    console.log('problem with request: ' + e.message);});</pre>


<p>当然,上面这样搞出来的UUID太不安全了,因此你可以利用couthDB给你的UUID</p>


<pre>var options = {    port: 5984,    method: 'GET',    path:"/_uuids"};</pre>


<p>我们再把刚才保存的文档取出来吧,就是数据库加ID名,GET请求</p>


<pre>var options = {    port: 5984,    method: 'GET',    path:"/albums/1"};</pre>


<p><img src="http://www.cnblogs.com/rubylouvre/aggbug/2653863.html?type=1" width="1" height="1" alt=""><p><a href="http://www.cnblogs.com/rubylouvre/archive/2012/08/24/2653863.html">本文链接</a></p></p>

</div>


            <div class="footer">
              <div class="contact">
                <p>
                  Your Name<br />
                  What You Are<br />
                  your@email.com
                </p>
              </div>
              <div class="contact">
                <p>
                  <a href="http://github.com/lyuehh/">github.com/lyuehh</a><br />
                  <a href="http://twitter.com/lyuehh/">twitter.com/lyuehh</a><br />
                </p>
              </div>
            </div>
          </div>
        </div> <!-- /container -->

    </body>
</html>
