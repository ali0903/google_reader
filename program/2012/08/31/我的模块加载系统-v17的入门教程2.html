<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>我的模块加载系统 v17的入门教程2</title>
        <meta name="viewport" content="width=device-width">

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/google_reader/css/syntax.css">

        <!-- Custom CSS -->
        <link rel="stylesheet" href="/google_reader/css/main.css">

    </head>
    <body>

        <div class="container">
          <div class="site">
            <div class="header">
              <h1 class="title"><a href="/google_reader/">Google Reader</a></h1>
              <a class="extra" href="/google_reader/">home</a>
            </div>

                <h2>我的模块加载系统 v17的入门教程2</h2>
<p class="meta">2012-08-31 00:04</p>

<div class="post">
<h2>我的模块加载系统 v17的入门教程2</h2>

<h3>by 司徒正美</h3>

<h3>at 2012-08-30 16:04:00</h3>

<h3>original <a href="http://www.cnblogs.com/rubylouvre/archive/2012/08/30/2663759.html">http://www.cnblogs.com/rubylouvre/archive/2012/08/30/2663759.html</a></h3>

<p>第一节，我们聊到相对于当前目录用“./”，相对于父目录用“../”，相对于父父目录用“http://www.cnblogs.com/”，如果是远程文件直接用URL。其实模块标识还有一种是相对于根目录，这特指是mass.js所在的目录。当然你可以通过配置手段修改根目录，但不建议这样干。比如aaa.js与mass.js是会于同一目录,用么沿着第一节的例子:</p>


<pre>&lt;!DOCTYPE HTML&gt;&lt;html&gt;    &lt;head&gt;        &lt;title&gt;AMD&lt;/title&gt;        &lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8&quot;&gt;        &lt;script src=&quot;mass.js&quot;&gt;        &lt;/script&gt;        &lt;script&gt;       //相当于$.require(&quot;./aaa&quot;, fn),只有模块与mass.js是位于同一模块才能这样干           $.require(&quot;aaa&quot;, function(a,b){      alert(a+b)   })        &lt;/script&gt;    &lt;/head&gt;    &lt;body&gt;        &lt;h2&gt;欢迎加入mass Framework团队！&lt;/h2&gt;     &lt;/body&gt;&lt;/html&gt;</pre>


<p><img src="http://images.cnblogs.com/cnblogs_com/rubylouvre/205314/o_amd_root.jpg"></p>


<p><strong>别名机制</strong></p>


<p>比如一个项目,a页面引用N个JS文件,b页面要引用N个js文件,那么当我们用$.require调用它们可能很麻烦,不断地通过"./","../"来定位到目标JS文件中。这时我们可能用一个专门的JS文件对这些模块进行别名，方便引用。</p>


<p>比如我们在第一节提到aaa.js, bbb.js, ccc.js, ddd.js，我们用一个modules保存它们的别名.</p>


<pre>//$.core.base 为mass.js的目录$.config({  alias:{     $aaa: $.core.base + "aaa.js",     $bbb: $.core.base + "bbb.js",     $ccc: $.core.base + "ccc.js",     $ddd: $.core.base + "ddd/ddd.js"   }})</pre>


<p>然后在页面上这样引用ddd.js模块</p>


<pre>&lt;!DOCTYPE HTML&gt;&lt;html&gt;    &lt;head&gt;        &lt;title&gt;AMD&lt;/title&gt;        &lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8&quot;&gt;        &lt;script src=&quot;mass.js&quot;&gt;         &lt;/script&gt;&lt;script src=&quot;modules.js&quot;&gt;         &lt;/script&gt;        &lt;script&gt;       //相当于$.require(&quot;./aaa&quot;, fn),只有模块与mass.js是位于同一模块才能这样干           $.require(&quot;$ddd&quot;, function(d){              alert(d)           })        &lt;/script&gt;    &lt;/head&gt;    &lt;body&gt;        &lt;h2&gt;欢迎加入mass Framework团队！&lt;/h2&gt;     &lt;/body&gt;&lt;/html&gt;</pre>


<p>相对应的,这些JS模块也可以改为</p>


<pre>//aaa.js 没有依赖不用改define("aaa",function(){    return 1})//bbb.js  没有依赖不用改define("bbb",function(){    return 2});//ccc.jsdefine("ccc",["$aaa"],function(a){    return 10+a})//ddd/ddd.jsdefine("ddd",["$ddd"], function(c){   return c+100});</pre>


<p>那么它就会正确弹出111!</p>


<p><img src="http://images.cnblogs.com/cnblogs_com/rubylouvre/205314/o_amd_ddd.jpg"></p>


<p>万一有一天,我们把ddd.js移到其他目录,如变成http://xdsfsd/sadfs/ddd.js,那么我们只需要改modules目录就行了!不用改$.require,也不用改ddd的依赖列表!</p>


<pre>//$.core.base 为mass.js的目录$.config({  alias:{     $aaa: $.core.base + "aaa.js",     $bbb: $.core.base + "bbb.js",     $ccc: $.core.base + "ccc.js",     $ddd: "http://xdsfsd/sadfs/ddd.js"   }})</pre>


<p>好了,我们再来看看jQuery与mass.js的使用。jQuery虽说是加了几行支持AMD，其实非常鸡肋！不过jQuery的多库共存做得很不错！我们只需要在外面包一层就能用了。到<a href="http://jquery.com/">jQuery官网</a>下载jQuery源码，无论是压缩版还是注释版。新建一个jquery.js文件，与mass.js同一目录，内容如下：</p>


<pre>define("jquery", function(){    //*********jquery源码*********      return jQuery.noConflict(true);})</pre>


<pre>&lt;!DOCTYPE HTML&gt;&lt;html&gt;    &lt;head&gt;        &lt;title&gt;AMD&lt;/title&gt;        &lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8&quot;&gt;        &lt;script src=&quot;mass.js&quot; &gt;        &lt;/script&gt;        &lt;script&gt;            $.require(&quot;jquery&quot;, function(jQuery){                $.log(jQuery.fn.jquery);//这是jquery                $.log($.mass); //这是mass.js            })            setTimeout(function(){                $.log($)//这也是mass.js，jquery没有污染都外边的            },1000)        &lt;/script&gt;    &lt;/head&gt;    &lt;body&gt;    &lt;/body&gt;&lt;/html&gt;</pre>


<p>我们打开firebug可以看到以下日志：</p>


<p><img src="http://images.cnblogs.com/cnblogs_com/rubylouvre/205314/o_amd_log.jpg"></p>


<p>jquery插件的使用，也是外包一层</p>


<pre>(function($) $.fn.overlabel = function() {    this.each(function(index) {        var label = $(this); var field;        var id = this.htmlFor || label.attr(&#39;for&#39;);        if (id &amp;&amp; (field = document.getElementById(id))) {            var control = $(field);            label.addClass(&quot;overlabel-apply&quot;);            if (field.value !== &#39;&#39;) {                label.css(&quot;text-indent&quot;, &quot;-1000px&quot;);            }            control.focus(function () {label.css(&quot;text-indent&quot;, &quot;-1000px&quot;);}).blur(function () {                if (this.value === &#39;&#39;) {                    label.css(&quot;text-indent&quot;, &quot;0px&quot;);                }            });            label.click(function() {                var label = $(this); var field;                var id = this.htmlFor || label.attr(&#39;for&#39;);                if (id &amp;&amp; (field = document.getElementById(id))) {                    field.focus();                }            });        }    });};})(jQuery)</pre>


<p>改造为</p>


<pre>define("jquery_overlabel",["./jquery"], function(jQuery){  (function($){      //************  })(jQuery);})</pre>


<p>本节完！</p>


<p><img src="http://www.cnblogs.com/rubylouvre/aggbug/2663759.html?type=1" width="1" height="1" alt=""><p><a href="http://www.cnblogs.com/rubylouvre/archive/2012/08/30/2663759.html">本文链接</a></p></p>

</div>


            <div class="footer">
              <div class="contact">
                <p>
                  Your Name<br />
                  What You Are<br />
                  your@email.com
                </p>
              </div>
              <div class="contact">
                <p>
                  <a href="http://github.com/lyuehh/">github.com/lyuehh</a><br />
                  <a href="http://twitter.com/lyuehh/">twitter.com/lyuehh</a><br />
                </p>
              </div>
            </div>
          </div>
        </div> <!-- /container -->

    </body>
</html>
