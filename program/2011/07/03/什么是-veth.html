<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>什么是 veth</title>
        <meta name="viewport" content="width=device-width">

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/google_reader/css/syntax.css">

        <!-- Custom CSS -->
        <link rel="stylesheet" href="/google_reader/css/main.css">

    </head>
    <body>

        <div class="container">
          <div class="site">
            <div class="header">
              <h1 class="title"><a href="/google_reader/">Google Reader</a></h1>
              <a class="extra" href="/google_reader/">home</a>
            </div>

                <h2>什么是 veth</h2>
<p class="meta">2011-07-03 21:32</p>

<div class="post">
<h2>什么是 veth</h2>

<h3>by 王 聪</h3>

<h3>at 2011-07-03 13:32:52</h3>

<h3>original <a href="http://wangcong.org/blog/archives/1704">http://wangcong.org/blog/archives/1704</a></h3>

<p>Linux container 中用到一个叫做veth的东西，这是一种新的设备，专门为 container 所建。</p>


<p>veth 从名字上来看是 Virtual ETHernet 的缩写，它的作用很简单，就是要把从一个 network namespace 发出的数据包转发到另一个 namespace。veth 设备是成对的，一个是 container 之中，另一个在 container 之外，即在真实机器上能看到的。</p>


<p>建立 veth 类型的设备可以用下面的命令：</p>


<p>ip link add name n1.0.1 type veth peer name n1.0</p>


<p>这里建立了一对veth设备，名字分别是 n1.0.1 和 n1.0。注意，这两个设备是完全对称的，也就是说，除了名字不一样，它们的作用是完全相同的，从其中一个发出就会从另一个收到。从代码（drivers/net/veth.c::veth_newlink()）我们也可以看得出来：</p>


<div><span><a href="http://wangcong.org/blog#">PLAIN TEXT</a></span></div>


<div><span>C:</span>
<div>
<div style="font-family:monospace">
<ol>
<li style="font-weight:normal;color:#3a6a8b">
<div style="font-family:&#39;Courier New&#39;,Courier,monospace;font-weight:normal;font-style:normal">priv <span style="color:#339933">=</span> netdev_priv<span style="color:#009900">(</span>dev<span style="color:#009900">)</span>;</div>
</li>
<li style="font-weight:bold;color:#26536a">
<div style="font-family:&#39;Courier New&#39;,Courier,monospace;font-weight:normal;font-style:normal">        priv<span style="color:#339933">-</span>&gt;peer <span style="color:#339933">=</span> peer;</div>
</li>
<li style="font-weight:normal;color:#3a6a8b">
<div style="font-family:&#39;Courier New&#39;,Courier,monospace;font-weight:normal;font-style:normal"> </div>
</li>
<li style="font-weight:bold;color:#26536a">
<div style="font-family:&#39;Courier New&#39;,Courier,monospace;font-weight:normal;font-style:normal">        priv <span style="color:#339933">=</span> netdev_priv<span style="color:#009900">(</span>peer<span style="color:#009900">)</span>;</div>
</li>
<li style="font-weight:normal;color:#3a6a8b">
<div style="font-family:&#39;Courier New&#39;,Courier,monospace;font-weight:normal;font-style:normal">        priv<span style="color:#339933">-</span>&gt;peer <span style="color:#339933">=</span> dev;</div>
</li>
</ol>
</div>
</div>
</div>


<p></p>


<p>然后我们可以用下面的命令设置它们的 namespace：</p>


<p>ip link set n1.0 netns `pidof lxc`</p>


<p>通常 veth 会和 bridge 搭配使用（我们在lxc的配置文件中也可以看出），这样一来，从外面进来的包（比如 eth0）就可以转发到 container 之中了。</p>


</div>


            <div class="footer">
              <div class="contact">
                <p>
                  Your Name<br />
                  What You Are<br />
                  your@email.com
                </p>
              </div>
              <div class="contact">
                <p>
                  <a href="http://github.com/lyuehh/">github.com/lyuehh</a><br />
                  <a href="http://twitter.com/lyuehh/">twitter.com/lyuehh</a><br />
                </p>
              </div>
            </div>
          </div>
        </div> <!-- /container -->

    </body>
</html>
