<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Javascript继承机制的设计思想</title>
        <meta name="viewport" content="width=device-width">

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/google_reader/css/syntax.css">

        <!-- Custom CSS -->
        <link rel="stylesheet" href="/google_reader/css/main.css">

    </head>
    <body>

        <div class="container">
          <div class="site">
            <div class="header">
              <h1 class="title"><a href="/google_reader/">Google Reader</a></h1>
              <a class="extra" href="/google_reader/">home</a>
            </div>

                <h2>Javascript继承机制的设计思想</h2>
<p class="meta">2011-06-06 04:06</p>

<div class="post">
<h2>Javascript继承机制的设计思想</h2>

<h3>by</h3>

<h3>at 2011-06-05 20:06:58</h3>

<h3>original <a href="http://www.ruanyifeng.com/blog/2011/06/designing_ideas_of_inheritance_mechanism_in_javascript.html">http://www.ruanyifeng.com/blog/2011/06/designing_ideas_of_inheritance_mechanism_in_javascript.html</a></h3>

<p>我一直很难理解Javascript语言的继承机制。</p>


<p>它没有"子类"和"父类"的概念，也没有"类"（class）和"实例"（instance）的区分，全靠一种很奇特的"原型链"（prototype chain）模式，来实现继承。</p>




<p>我花了很多时间，学习这个部分，还做了很多笔记。但是都属于强行记忆，无法从根本上理解。</p>




<p><img src="http://image.beekka.com/blog/201106/bg2011060501.jpg"></p>




<p>直到昨天，我读到法国程序员<a href="http://blog.vjeux.com/2011/javascript/how-prototypal-inheritance-really-works.html">Vjeux</a>的解释，才恍然大悟，完全明白了Javascript为什么这样设计。</p>




<p>下面，我尝试用自己的语言，来解释它的设计思想。彻底说明白prototype对象到底是怎么回事。其实根本就没那么复杂，真相非常简单。</p>




<p><strong>一、从古代说起</strong></p>




<p>要理解Javascript的设计思想，必须从它的诞生说起。</p>




<p>1994年，网景公司（Netscape）发布了Navigator浏览器0.9版。这是历史上第一个比较成熟的网络浏览器，轰动一时。但是，这个版本的浏览器只能用来浏览，不具备与访问者互动的能力。比如，如果网页上有一栏"用户名"要求填写，浏览器就无法判断访问者是否真的填写了，只有让服务器端判断。如果没有填写，服务器端就返回错误，要求用户重新填写，这太浪费时间和服务器资源了。</p>




<p><img src="http://image.beekka.com/blog/201106/bg2011060502.png"></p>




<p>因此，网景公司急需一种网页脚本语言，使得浏览器可以与网页互动。工程师<a href="http://brendaneich.com/">Brendan Eich</a>负责开发这种新语言。他觉得，没必要设计得很复杂，这种语言只要能够完成一些简单操作就够了，比如判断用户有没有填写表单。</p>




<p><img src="http://image.beekka.com/blog/201106/bg2011060503.jpg"></p>




<p>1994年正是面向对象编程（object-oriented programming）最兴盛的时期，C++是当时最流行的语言，而Java语言的1.0版即将于第二年推出，Sun公司正在大肆造势。</p>




<p>Brendan Eich无疑受到了影响，Javascript里面所有的数据类型都是对象（object），这一点与Java非常相似。但是，他随即就遇到了一个难题，到底要不要设计"继承"机制呢？</p>




<p><strong>二、Brendan Eich的选择</strong></p>




<p>如果真的是一种简易的脚本语言，其实不需要有"继承"机制。但是，Javascript里面都是对象，必须有一种机制，将所有对象联系起来。所以，Brendan Eich最后还是设计了"继承"。</p>




<p>但是，他不打算引入"类"（class）的概念，因为一旦有了"类"，Javascript就是一种完整的面向对象编程语言了，这好像有点太正式了，而且增加了初学者的入门难度。</p>




<p>他考虑到，C++和Java语言都使用new命令，生成实例。</p>




<p>C++的写法是：</p>




<blockquote>

<p>　　ClassName *object = new ClassName(param);</p>

</blockquote>




<p>Java的写法是：</p>




<blockquote>

<p>　　Foo foo = new Foo();</p>

</blockquote>




<p>因此，他就把new命令引入了Javascript，用来从原型对象生成一个实例对象。但是，Javascript没有"类"，怎么来表示原型对象呢？</p>




<p>这时，他想到C++和Java使用new命令时，都会调用"类"的构造函数（constructor）。他就做了一个简化的设计，在Javascript语言中，new命令后面跟的不是类，而是构造函数。</p>




<p>举例来说，现在有一个叫做DOG的构造函数，表示狗对象的原型。</p>




<blockquote>

<p>　　function DOG(name){</p>

<p>　　　　this.name = name;</p>

<p>　　}</p>

</blockquote>




<p>对这个构造函数使用new，就会生成一个狗对象的实例。</p>




<blockquote>

<p>　　<strong>var dogA = new DOG('大毛');</strong></p>

<p>　　alert(dogA.name); // 大毛</p>

</blockquote>




<p>注意构造函数中的<a href="http://www.ruanyifeng.com/blog/2010/04/using_this_keyword_in_javascript.html">this关键字</a>，它就代表了新创建的实例对象。</p>




<p><strong>三、new运算符的缺点</strong></p>




<p>用构造函数生成实例对象，有一个缺点，那就是无法共享属性和方法。</p>




<p>比如，在DOG对象的构造函数中，设置一个实例对象的共有属性species。</p>




<blockquote>

<p>　　function DOG(name){</p>

<p>　　　　this.name = name;</p>

<p>　　　　<strong>this.species = '犬科';</strong></p>

<p>　　}</p>

</blockquote>




<p>然后，生成两个实例对象：</p>




<blockquote>

<p>　　var dogA = new DOG('大毛');</p>

<p>　　var dogB = new DOG('二毛');</p>

</blockquote>




<p>这两个对象的species属性是独立的，修改其中一个，不会影响到另一个。</p>




<blockquote>

<p>　　<strong>dogA.species = '猫科';</strong></p>

<p>　　alert(dogB.species); // 显示"犬科"，不受dogA的影响</p>

</blockquote>




<p>每一个实例对象，都有自己的属性和方法的副本。这不仅无法做到数据共享，也是极大的资源浪费。</p>




<p><strong>四、prototype属性的引入</strong></p>




<p>考虑到这一点，Brendan Eich决定为构造函数设置一个prototype属性。</p>




<p>这个属性包含一个对象（以下简称"prototype对象"），所有实例对象需要共享的属性和方法，都放在这个对象里面；那些不需要共享的属性和方法，就放在构造函数里面。</p>




<p>实例对象一旦创建，将自动引用prototype对象的属性和方法。也就是说，实例对象的属性和方法，分成两种，一种是本地的，另一种是引用的。</p>




<p>还是以DOG构造函数为例，现在用prototype属性进行改写：</p>




<blockquote>

<p>　　function DOG(name){</p>

<p>　　　　this.name = name;</p>

<p>　　}</p>

<p>　　<strong>DOG.prototype = { species : '犬科' };</strong></p>

<p><br>
　　var dogA = new DOG('大毛');</p>

<p>　　var dogB = new DOG('二毛');</p>

<p><br>
　　alert(dogA.species); // 犬科</p>

<p>　　alert(dogB.species); // 犬科</p>

</blockquote>




<p>现在，species属性放在prototype对象里，是两个实例对象共享的。只要修改了prototype对象，就会同时影响到两个实例对象。</p>




<blockquote>

<p>　　<strong>DOG.prototype.species = '猫科'; </strong></p>

<p><br>
　　alert(dogA.species); // 猫科</p>

<p>　　alert(dogB.species); // 猫科</p>

</blockquote>




<p><strong>五、总结</strong></p>




<p>由于所有的实例对象共享同一个prototype对象，那么从外界看起来，prototype对象就好像是实例对象的原型，而实例对象则好像"继承"了prototype对象一样。</p>




<p>这就是Javascript继承机制的设计思想。不知道我说清楚了没有，继承机制的具体应用方法，可以参考我写的系列文章：</p>




<p>　　* <a href="http://www.ruanyifeng.com/blog/2010/05/object-oriented_javascript_encapsulation.html">《Javascript面向对象编程（一）：封装》</a></p>




<p>　　* <a href="http://www.ruanyifeng.com/blog/2010/05/object-oriented_javascript_inheritance.html">《Javascript面向对象编程（二）：构造函数的继承》</a></p>




<p>　　* <a href="http://www.ruanyifeng.com/blog/2010/05/object-oriented_javascript_inheritance_continued.html">《Javascript面向对象编程（三）：非构造函数的继承》 </a></p>




<p>（完）<br>
</p>


<div style="color:#556677;line-height:160%;padding:0.3em 0.5em;border:1px solid #d3d3d3;margin:1em;background-color:#aad2f0;border-radius:10px"><h3>文档信息</h3>
<ul>
<li>版权声明：自由转载-非商用-非衍生-保持署名 | <a href="http://creativecommons.org/licenses/by-nc-nd/3.0/deed.zh">Creative Commons BY-NC-ND 3.0</a></li>
<li>原文网址：<a href="http://www.ruanyifeng.com/blog/2011/06/designing_ideas_of_inheritance_mechanism_in_javascript.html">http://www.ruanyifeng.com/blog/2011/06/designing_ideas_of_inheritance_mechanism_in_javascript.html</a></li>
<li>最后修改时间：2011年6月29日 14:31</li>
<li>付费支持（<a href="http://www.ruanyifeng.com/blog/2011/05/my_google_adsense_is_disabled.html" style="text-decoration:underline">说明</a>）：<a href="https://lab.alipay.com/p.htm?id=2011051700196144"><img src="http://www.ruanyifeng.com/blog/images/rmb_32.png" alt="支付宝担保交易" style="border:none;vertical-align:middle"></a> | <a href="https://www.paypal.com/cgi-bin/webscr?cmd=_xclick&amp;business=yifeng.ruan@gmail.com&amp;currency_code=USD&amp;amount=0.3&amp;return=http://www.ruanyifeng.com/thank.html&amp;item_name=Ruan%20YiFeng&#39;s%20Blog&amp;undefined_quantity=1&amp;no_note=0"><img src="http://www.ruanyifeng.com/blog/images/dollar_32.png" alt="paypal" style="border:none;vertical-align:middle"></a> </li>
</ul></div>


</div>


            <div class="footer">
              <div class="contact">
                <p>
                  Your Name<br />
                  What You Are<br />
                  your@email.com
                </p>
              </div>
              <div class="contact">
                <p>
                  <a href="http://github.com/lyuehh/">github.com/lyuehh</a><br />
                  <a href="http://twitter.com/lyuehh/">twitter.com/lyuehh</a><br />
                </p>
              </div>
            </div>
          </div>
        </div> <!-- /container -->

    </body>
</html>
