<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Java 调用底层接口的几种方法</title>
        <meta name="viewport" content="width=device-width">

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/css/syntax.css">

        <!-- Custom CSS -->
        <link rel="stylesheet" href="/css/main.css">

    </head>
    <body>

        <div class="container">
          <div class="site">
            <div class="header">
              <h1 class="title"><a href="/">Your New Jekyll Site</a></h1>
              <a class="extra" href="/">home</a>
            </div>

                <h2>Java 调用底层接口的几种方法</h2>
<p class="meta">05 Mar 2011</p>

<div class="post">
<h2>Java 调用底层接口的几种方法</h2>

<h3>by ShaPherD</h3>

<h3>at 2011-03-05 15:39:00</h3>

<h3>original <a href="http://www.cnblogs.com/shapherd/archive/2011/03/05/1971636.html">http://www.cnblogs.com/shapherd/archive/2011/03/05/1971636.html</a></h3>

<p><h1>Java 调用底层接口</h1>
<p>Java 调用底层接口要通过动态链接库进行，在windows下是dll文件，linux是so文件</p>
<p>Java调用动态库所需要关心的问题： </p>
<ul>
<li>
    如何装载文件，以及如何定位所要使用的方法； </li>
</ul>
<ul>
<li>
     数据类型是如何对应的； </li>
</ul>
<ul>
<li>
    如何给使用的方法传递参数； </li>
</ul>
<ul>
<li>
    如何获取返回的值。</li>
</ul>
<p>目前调用底层接口用的比较多的技术包括jni、jna、jnative、Nativecall等</p>
<h1>JNI 封装本地接口</h1>
<p>JAVA可以通过JNI接口访问本地的动态连接库，从而扩展JAVA的功能。使用JAVA JNI接口主要包括以下步骤：</p>
<p>²  编写JAVA代码，注明要访问的本地动态连接库和本地方法；</p>
<p>²  编译JAVA代码得到.class文件；</p>
<p>²  使用javah -jni 生成该类对应的C语言.h文件；</p>
<p>²  使用C/C++实现（3）生成的.h文件中声明的各函数；</p>
<p>²  编译C/C++实现代码生成动态连接库。<br>
本文使用一个简单的helloWorld示例演示JNI的使用。<br>
<br>
</p>
<h2>编写JAVA代码</h2>

<div><img src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif"><img src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif"><span>View Code </span>
<div>
<pre><div><span style="color:#008080"> 1</span> <span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">class</span><span style="color:#000000"> helloWorld<br></span><span style="color:#008080"> 2</span> <span style="color:#000000"><br></span><span style="color:#008080"> 3</span> <span style="color:#000000">{<br></span><span style="color:#008080"> 4</span> <span style="color:#000000"><br></span><span style="color:#008080"> 5</span> <span style="color:#000000">    </span><span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">native</span><span style="color:#000000"> </span><span style="color:#0000ff">void</span><span style="color:#000000"> SayHello(String name);<br></span><span style="color:#008080"> 6</span> <span style="color:#000000"><br></span><span style="color:#008080"> 7</span> <span style="color:#000000"> <br></span><span style="color:#008080"> 8</span> <span style="color:#000000"><br></span><span style="color:#008080"> 9</span> <span style="color:#000000">    </span><span style="color:#0000ff">static</span><span style="color:#000000"><br></span><span style="color:#008080">10</span> <span style="color:#000000"><br></span><span style="color:#008080">11</span> <span style="color:#000000">    {<br></span><span style="color:#008080">12</span> <span style="color:#000000"><br></span><span style="color:#008080">13</span> <span style="color:#000000">        System.loadLibrary(</span><span style="color:#000000">"</span><span style="color:#000000">jniHelloworld</span><span style="color:#000000">"</span><span style="color:#000000">);<br></span><span style="color:#008080">14</span> <span style="color:#000000"><br></span><span style="color:#008080">15</span> <span style="color:#000000">    }<br></span><span style="color:#008080">16</span> <span style="color:#000000"><br></span><span style="color:#008080">17</span> <span style="color:#000000"> <br></span><span style="color:#008080">18</span> <span style="color:#000000"><br></span><span style="color:#008080">19</span> <span style="color:#000000">    </span><span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">static</span><span style="color:#000000"> </span><span style="color:#0000ff">void</span><span style="color:#000000"> main(String [] argv)<br></span><span style="color:#008080">20</span> <span style="color:#000000"><br></span><span style="color:#008080">21</span> <span style="color:#000000">    {<br></span><span style="color:#008080">22</span> <span style="color:#000000"><br></span><span style="color:#008080">23</span> <span style="color:#000000">        helloWorld hello </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">new</span><span style="color:#000000"> helloWorld();<br></span><span style="color:#008080">24</span> <span style="color:#000000"><br></span><span style="color:#008080">25</span> <span style="color:#000000">        hello.SayHello(</span><span style="color:#000000">"</span><span style="color:#000000">world </span><span style="color:#000000">"</span><span style="color:#000000">);<br></span><span style="color:#008080">26</span> <span style="color:#000000"><br></span><span style="color:#008080">27</span> <span style="color:#000000">    }<br></span><span style="color:#008080">28</span> <span style="color:#000000">}</span></div></pre>
</div>
</div>

<h2>
<br>
编译JAVA代码</h2>
<p>javac helloWorld.java</p>
<h2><br>
生成实现函数头文件</h2>
<p align="left"><br>
javah -classpath . helloWorld<br>
<b><br>
</b>得到的helloWorld.h文件内容如下：<br>
<br>
</p>
<div><img src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif"><img src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif"><span>View Code </span>
<div>
<pre><div><span style="color:#008080"> 1</span> <span style="color:#008000">/*</span><span style="color:#008000"> DO NOT EDIT THIS FILE - it is machine generated </span><span style="color:#008000">*/</span><span style="color:#000000"><br></span><span style="color:#008080"> 2</span> <span style="color:#000000"><br></span><span style="color:#008080"> 3</span> <span style="color:#000000">#include </span><span style="color:#000000">&lt;</span><span style="color:#000000">jni.h</span><span style="color:#000000">&gt;</span><span style="color:#000000"><br></span><span style="color:#008080"> 4</span> <span style="color:#000000"><br></span><span style="color:#008080"> 5</span> <span style="color:#000000"> </span><span style="color:#008000">/*</span><span style="color:#008000"> Header for class helloWorld </span><span style="color:#008000">*/</span><span style="color:#000000"><br></span><span style="color:#008080"> 6</span> <span style="color:#000000"><br></span><span style="color:#008080"> 7</span> <span style="color:#000000"> <br></span><span style="color:#008080"> 8</span> <span style="color:#000000"><br></span><span style="color:#008080"> 9</span> <span style="color:#000000">#ifndef _Included_helloWorld<br></span><span style="color:#008080">10</span> <span style="color:#000000"><br></span><span style="color:#008080">11</span> <span style="color:#000000"> </span><span style="color:#0000ff">#define</span><span style="color:#000000"> _Included_helloWorld</span><span style="color:#000000"><br></span><span style="color:#008080">12</span> <span style="color:#000000"><br></span><span style="color:#008080">13</span> <span style="color:#000000">#ifdef __cplusplus<br></span><span style="color:#008080">14</span> <span style="color:#000000"><br></span><span style="color:#008080">15</span> <span style="color:#000000"> </span><span style="color:#0000ff">extern</span><span style="color:#000000"> </span><span style="color:#800000">"</span><span style="color:#800000">C</span><span style="color:#800000">"</span><span style="color:#000000"> {<br></span><span style="color:#008080">16</span> <span style="color:#000000"><br></span><span style="color:#008080">17</span> <span style="color:#000000"> </span><span style="color:#0000ff">#endif</span><span style="color:#000000"><br></span><span style="color:#008080">18</span> <span style="color:#000000"><br></span><span style="color:#008080">19</span> <span style="color:#000000"> </span><span style="color:#008000">/*</span><span style="color:#008000"><br></span><span style="color:#008080">20</span> <span style="color:#008000"><br></span><span style="color:#008080">21</span> <span style="color:#008000"> * Class:     helloWorld<br></span><span style="color:#008080">22</span> <span style="color:#008000"><br></span><span style="color:#008080">23</span> <span style="color:#008000"> * Method:    SayHello<br></span><span style="color:#008080">24</span> <span style="color:#008000"><br></span><span style="color:#008080">25</span> <span style="color:#008000"> * Signature: (Ljava/lang/String;)V<br></span><span style="color:#008080">26</span> <span style="color:#008000"><br></span><span style="color:#008080">27</span> <span style="color:#008000"> </span><span style="color:#008000">*/</span><span style="color:#000000"><br></span><span style="color:#008080">28</span> <span style="color:#000000"><br></span><span style="color:#008080">29</span> <span style="color:#000000">JNIEXPORT </span><span style="color:#0000ff">void</span><span style="color:#000000"> JNICALL Java_helloWorld_SayHello<br></span><span style="color:#008080">30</span> <span style="color:#000000"><br></span><span style="color:#008080">31</span> <span style="color:#000000">  (JNIEnv </span><span style="color:#000000">*</span><span style="color:#000000">, jobject, jstring);<br></span><span style="color:#008080">32</span> <span style="color:#000000"><br></span><span style="color:#008080">33</span> <span style="color:#000000"> <br></span><span style="color:#008080">34</span> <span style="color:#000000"><br></span><span style="color:#008080">35</span> <span style="color:#000000">#ifdef __cplusplus<br></span><span style="color:#008080">36</span> <span style="color:#000000"><br></span><span style="color:#008080">37</span> <span style="color:#000000">}<br></span><span style="color:#008080">38</span> <span style="color:#000000"><br></span><span style="color:#008080">39</span> <span style="color:#000000"> </span><span style="color:#0000ff">#endif</span><span style="color:#000000"><br></span><span style="color:#008080">40</span> <span style="color:#000000"><br></span><span style="color:#008080">41</span> <span style="color:#000000"> </span><span style="color:#0000ff">#endif</span></div></pre>
</div>
</div>
<p align="left"> </p>
<p align="left"> </p>
<h2>在VS中创建工程并实现该函数<br>
<br>
</h2>
<div><img src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif"><img src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif"><span>View Code </span>
<div>
<pre><div><span style="color:#008080"> 1</span> <span style="color:#000000">#include </span><span style="color:#800000">"</span><span style="color:#800000">helloWorld.h</span><span style="color:#800000">"</span><span style="color:#000000"><br></span><span style="color:#008080"> 2</span> <span style="color:#000000"><br></span><span style="color:#008080"> 3</span> <span style="color:#000000">#include </span><span style="color:#000000">&lt;</span><span style="color:#000000">stdio.h</span><span style="color:#000000">&gt;</span><span style="color:#000000"><br></span><span style="color:#008080"> 4</span> <span style="color:#000000"><br></span><span style="color:#008080"> 5</span> <span style="color:#000000">#include </span><span style="color:#000000">&lt;</span><span style="color:#0000ff">string</span><span style="color:#000000">.h</span><span style="color:#000000">&gt;</span><span style="color:#000000"><br></span><span style="color:#008080"> 6</span> <span style="color:#000000"><br></span><span style="color:#008080"> 7</span> <span style="color:#000000"> </span><span style="color:#0000ff">void</span><span style="color:#000000"> JNICALL Java_helloWorld_SayHello(JNIEnv </span><span style="color:#000000">*</span><span style="color:#000000"> env, jobject obj, jstring str)<br></span><span style="color:#008080"> 8</span> <span style="color:#000000"><br></span><span style="color:#008080"> 9</span> <span style="color:#000000">{<br></span><span style="color:#008080">10</span> <span style="color:#000000"><br></span><span style="color:#008080">11</span> <span style="color:#000000">     jboolean  b  </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#0000ff">true</span><span style="color:#000000">;<br></span><span style="color:#008080">12</span> <span style="color:#000000"><br></span><span style="color:#008080">13</span> <span style="color:#000000">     </span><span style="color:#0000ff">char</span><span style="color:#000000"> s[</span><span style="color:#800080">80</span><span style="color:#000000">];<br></span><span style="color:#008080">14</span> <span style="color:#000000"><br></span><span style="color:#008080">15</span> <span style="color:#000000">     memset(s, </span><span style="color:#800080">0</span><span style="color:#000000">, </span><span style="color:#0000ff">sizeof</span><span style="color:#000000">(s));<br></span><span style="color:#008080">16</span> <span style="color:#000000"><br></span><span style="color:#008080">17</span> <span style="color:#000000">     strcpy_s(s ,(</span><span style="color:#0000ff">char</span><span style="color:#000000">*</span><span style="color:#000000">)env</span><span style="color:#000000">-&gt;</span><span style="color:#000000">GetStringUTFChars(str, </span><span style="color:#000000">&amp;</span><span style="color:#000000">b));<br></span><span style="color:#008080">18</span> <span style="color:#000000"><br></span><span style="color:#008080">19</span> <span style="color:#000000">     printf(</span><span style="color:#800000">"</span><span style="color:#800000">Hello, %s</span><span style="color:#800000">"</span><span style="color:#000000">, s);<br></span><span style="color:#008080">20</span> <span style="color:#000000"><br></span><span style="color:#008080">21</span> <span style="color:#000000">     env</span><span style="color:#000000">-&gt;</span><span style="color:#000000">ReleaseStringUTFChars(str , NULL);<br></span><span style="color:#008080">22</span> <span style="color:#000000"><br></span><span style="color:#008080">23</span> <span style="color:#000000">}</span></div></pre>
</div>
</div>
<p><br>
  这是JNI的关键：通过env我们可以使用JAVA提供的一组函数操作与转换函数传递的参数。
</p>
<h2><br>
编译VC项目得到动态连接库 helloWorld.dll。</h2>
<p>把工程输出文件的位置设置成helloWorld类所在的目录，编译之前要把jdk的include目录加到工程属性中</p>
<p>然后在命令行中执行 </p>
<p>Java helloWorld 会输出helloWorld</p>
<h1>JNA封装本地接口</h1>
<p><a href="http://jna.java.net/#demos">http://jna.java.net/#demos</a></p>
<p align="left"><b> </b></p>
<div><img src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif"><img src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif"><span>View Code </span>
<div>
<pre><div><span style="color:#008080"> 1</span> <span style="color:#000000">package com.sun.jna.examples;<br></span><span style="color:#008080"> 2</span> <span style="color:#000000"><br></span><span style="color:#008080"> 3</span> <span style="color:#000000"> <br></span><span style="color:#008080"> 4</span> <span style="color:#000000"><br></span><span style="color:#008080"> 5</span> <span style="color:#000000">import com.sun.jna.Library;<br></span><span style="color:#008080"> 6</span> <span style="color:#000000"><br></span><span style="color:#008080"> 7</span> <span style="color:#000000">import com.sun.jna.Native;<br></span><span style="color:#008080"> 8</span> <span style="color:#000000"><br></span><span style="color:#008080"> 9</span> <span style="color:#000000">import com.sun.jna.Platform;<br></span><span style="color:#008080">10</span> <span style="color:#000000"><br></span><span style="color:#008080">11</span> <span style="color:#000000"> <br></span><span style="color:#008080">12</span> <span style="color:#000000"><br></span><span style="color:#008080">13</span> <span style="color:#000000"> </span><span style="color:#008000">/*</span><span style="color:#008000">* Simple example of JNA interface mapping and usage. </span><span style="color:#008000">*/</span><span style="color:#000000"><br></span><span style="color:#008080">14</span> <span style="color:#000000"><br></span><span style="color:#008080">15</span> <span style="color:#000000"> </span><span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">class</span><span style="color:#000000"> HelloWorld {<br></span><span style="color:#008080">16</span> <span style="color:#000000"><br></span><span style="color:#008080">17</span> <span style="color:#000000"> <br></span><span style="color:#008080">18</span> <span style="color:#000000"><br></span><span style="color:#008080">19</span> <span style="color:#000000">    </span><span style="color:#008000">//</span><span style="color:#008000"> This is the standard, stable way of mapping, which supports extensive<br></span><span style="color:#008080">20</span> <span style="color:#008000"><br></span><span style="color:#008080">21</span> <span style="color:#008000">    </span><span style="color:#008000">//</span><span style="color:#008000"> customization and mapping of Java to native types.</span><span style="color:#008000"><br></span><span style="color:#008080">22</span> <span style="color:#008000"> </span><span style="color:#000000"><br></span><span style="color:#008080">23</span> <span style="color:#000000">    </span><span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">interface</span><span style="color:#000000"> CLibrary extends Library {<br></span><span style="color:#008080">24</span> <span style="color:#000000"><br></span><span style="color:#008080">25</span> <span style="color:#000000">        CLibrary INSTANCE </span><span style="color:#000000">=</span><span style="color:#000000"> (CLibrary)<br></span><span style="color:#008080">26</span> <span style="color:#000000"><br></span><span style="color:#008080">27</span> <span style="color:#000000">            Native.loadLibrary((Platform.isWindows() </span><span style="color:#000000">?</span><span style="color:#000000"> </span><span style="color:#800000">"</span><span style="color:#800000">msvcrt</span><span style="color:#800000">"</span><span style="color:#000000"> : </span><span style="color:#800000">"</span><span style="color:#800000">c</span><span style="color:#800000">"</span><span style="color:#000000">),<br></span><span style="color:#008080">28</span> <span style="color:#000000"><br></span><span style="color:#008080">29</span> <span style="color:#000000">                               CLibrary.</span><span style="color:#0000ff">class</span><span style="color:#000000">);<br></span><span style="color:#008080">30</span> <span style="color:#000000"><br></span><span style="color:#008080">31</span> <span style="color:#000000"> <br></span><span style="color:#008080">32</span> <span style="color:#000000"><br></span><span style="color:#008080">33</span> <span style="color:#000000">        </span><span style="color:#0000ff">void</span><span style="color:#000000"> printf(String format, Object... args);<br></span><span style="color:#008080">34</span> <span style="color:#000000"><br></span><span style="color:#008080">35</span> <span style="color:#000000">    }<br></span><span style="color:#008080">36</span> <span style="color:#000000"><br></span><span style="color:#008080">37</span> <span style="color:#000000"> <br></span><span style="color:#008080">38</span> <span style="color:#000000"><br></span><span style="color:#008080">39</span> <span style="color:#000000">    </span><span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">static</span><span style="color:#000000"> </span><span style="color:#0000ff">void</span><span style="color:#000000"> main(String[] args) {<br></span><span style="color:#008080">40</span> <span style="color:#000000"><br></span><span style="color:#008080">41</span> <span style="color:#000000">        CLibrary.INSTANCE.printf(</span><span style="color:#800000">"</span><span style="color:#800000">Hello, World\n</span><span style="color:#800000">"</span><span style="color:#000000">);<br></span><span style="color:#008080">42</span> <span style="color:#000000"><br></span><span style="color:#008080">43</span> <span style="color:#000000">        </span><span style="color:#0000ff">for</span><span style="color:#000000"> (</span><span style="color:#0000ff">int</span><span style="color:#000000"> i</span><span style="color:#000000">=</span><span style="color:#800080">0</span><span style="color:#000000">;i </span><span style="color:#000000">&lt;</span><span style="color:#000000"> args.length;i</span><span style="color:#000000">++</span><span style="color:#000000">) {<br></span><span style="color:#008080">44</span> <span style="color:#000000"><br></span><span style="color:#008080">45</span> <span style="color:#000000">            CLibrary.INSTANCE.printf(</span><span style="color:#800000">"</span><span style="color:#800000">Argument %d: %s\n</span><span style="color:#800000">"</span><span style="color:#000000">, i, args[i]);<br></span><span style="color:#008080">46</span> <span style="color:#000000"><br></span><span style="color:#008080">47</span> <span style="color:#000000">        }<br></span><span style="color:#008080">48</span> <span style="color:#000000"><br></span><span style="color:#008080">49</span> <span style="color:#000000">    }<br></span><span style="color:#008080">50</span> <span style="color:#000000"><br></span><span style="color:#008080">51</span> <span style="color:#000000">}</span></div></pre>
</div>
</div>
<p align="left"> </p>
<p align="left"> </p>
<p align="left">JNA 可以直接调用底层接口，而不用对底层接口进行封装，像例子调用printf一样，底层接口可以通过这种方式直接把接口提供给java调用</p>
<h1>Jnative</h1>
<p>Jnative用法和jna类似，都是借助于开源项目实现对底层接口的调用，但是用法比jna简单一点，不需要在一个java接口中描述目标文件中的函数与结构，用法如下：</p>
<p>建立test_say.java文件，需要配置好JNative.jar包</p>
<p align="left"><b><span style="text-decoration:underline"> </span></b></p>
<div><img src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif"><img src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif"><span>View Code </span>
<div>
<pre><div><span style="color:#008080"> 1</span> <span style="color:#0000ff">import</span><span style="color:#000000"> org.xvolks.jnative.JNative;<br></span><span style="color:#008080"> 2</span> <span style="color:#000000"><br></span><span style="color:#008080"> 3</span> <span style="color:#000000"> </span><span style="color:#0000ff">import</span><span style="color:#000000"> org.xvolks.jnative.Type;<br></span><span style="color:#008080"> 4</span> <span style="color:#000000"><br></span><span style="color:#008080"> 5</span> <span style="color:#000000"> </span><span style="color:#0000ff">import</span><span style="color:#000000"> org.xvolks.jnative.exceptions.NativeException;<br></span><span style="color:#008080"> 6</span> <span style="color:#000000"><br></span><span style="color:#008080"> 7</span> <span style="color:#000000"></span><span style="color:#0000ff">import</span><span style="color:#000000"> org.xvolks.jnative.pointers.Pointer;<br></span><span style="color:#008080"> 8</span> <span style="color:#000000"><br></span><span style="color:#008080"> 9</span> <span style="color:#000000"></span><span style="color:#0000ff">import</span><span style="color:#000000"> org.xvolks.jnative.pointers.memory.MemoryBlockFactory;<br></span><span style="color:#008080">10</span> <span style="color:#000000"><br></span><span style="color:#008080">11</span> <span style="color:#000000"></span><span style="color:#0000ff">import</span><span style="color:#000000"> org.xvolks.jnative.pointers.memory.NativeMemoryBlock;<br></span><span style="color:#008080">12</span> <span style="color:#000000"><br></span><span style="color:#008080">13</span> <span style="color:#000000"></span><span style="color:#0000ff">import</span><span style="color:#000000"> org.xvolks.jnative.util.Callback;<br></span><span style="color:#008080">14</span> <span style="color:#000000"><br></span><span style="color:#008080">15</span> <span style="color:#000000"></span><span style="color:#008000">//</span><span style="color:#008000">import org.xvolks.test.callbacks.linux.LinuxCallback;</span><span style="color:#008000"><br></span><span style="color:#008080">16</span> <span style="color:#008000"></span><span style="color:#000000"><br></span><span style="color:#008080">17</span> <span style="color:#000000"> <br></span><span style="color:#008080">18</span> <span style="color:#000000"><br></span><span style="color:#008080">19</span> <span style="color:#000000"></span><span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">class</span><span style="color:#000000"> test_ helloWorld {<br></span><span style="color:#008080">20</span> <span style="color:#000000"><br></span><span style="color:#008080">21</span> <span style="color:#000000">    </span><span style="color:#0000ff">private</span><span style="color:#000000"> </span><span style="color:#0000ff">final</span><span style="color:#000000"> </span><span style="color:#0000ff">static</span><span style="color:#000000"> String LIB_NAME </span><span style="color:#000000">=</span><span style="color:#000000"> </span><span style="color:#000000">"</span><span style="color:#000000"> msvcrt </span><span style="color:#000000">"</span><span style="color:#000000">;    </span><span style="color:#008000">//</span><span style="color:#008000">自动判断.so 或者.dll</span><span style="color:#008000"><br></span><span style="color:#008080">22</span> <span style="color:#008000"></span><span style="color:#000000"><br></span><span style="color:#008080">23</span> <span style="color:#000000"> <br></span><span style="color:#008080">24</span> <span style="color:#000000"><br></span><span style="color:#008080">25</span> <span style="color:#000000">    </span><span style="color:#0000ff">public</span><span style="color:#000000"> </span><span style="color:#0000ff">static</span><span style="color:#000000"> </span><span style="color:#0000ff">void</span><span style="color:#000000"> main(String[] args) </span><span style="color:#0000ff">throws</span><span style="color:#000000"> NativeException, IllegalAccessException {<br></span><span style="color:#008080">26</span> <span style="color:#000000"><br></span><span style="color:#008080">27</span> <span style="color:#000000">        </span><span style="color:#0000ff">try</span><span style="color:#000000"> {<br></span><span style="color:#008080">28</span> <span style="color:#000000"><br></span><span style="color:#008080">29</span> <span style="color:#000000">            JNative printf </span><span style="color:#000000">=</span><span style="color:#0000ff">new</span><span style="color:#000000"> JNative(LIB_NAME,</span><span style="color:#000000">"</span><span style="color:#000000"> printf </span><span style="color:#000000">"</span><span style="color:#000000">);<br></span><span style="color:#008080">30</span> <span style="color:#000000"><br></span><span style="color:#008080">31</span> <span style="color:#000000">           printf.setParameter(</span><span style="color:#000000">0</span><span style="color:#000000">,”hello world”);<br></span><span style="color:#008080">32</span> <span style="color:#000000"><br></span><span style="color:#008080">33</span> <span style="color:#000000">            printf.invoke();<br></span><span style="color:#008080">34</span> <span style="color:#000000"><br></span><span style="color:#008080">35</span> <span style="color:#000000">        }<br></span><span style="color:#008080">36</span> <span style="color:#000000"><br></span><span style="color:#008080">37</span> <span style="color:#000000">        </span><span style="color:#0000ff">catch</span><span style="color:#000000"> (Exception e)<br></span><span style="color:#008080">38</span> <span style="color:#000000"><br></span><span style="color:#008080">39</span> <span style="color:#000000">        {<br></span><span style="color:#008080">40</span> <span style="color:#000000"><br></span><span style="color:#008080">41</span> <span style="color:#000000">            e.printStackTrace();<br></span><span style="color:#008080">42</span> <span style="color:#000000"><br></span><span style="color:#008080">43</span> <span style="color:#000000">        }<br></span><span style="color:#008080">44</span> <span style="color:#000000"><br></span><span style="color:#008080">45</span> <span style="color:#000000">    }<br></span><span style="color:#008080">46</span> <span style="color:#000000"><br></span><span style="color:#008080">47</span> <span style="color:#000000">}</span></div></pre>
</div>
</div><img src="http://www.cnblogs.com/shapherd/aggbug/1971636.html?type=1" width="1" height="1" alt=""><p>作者: <a href="http://www.cnblogs.com/shapherd/">ShaPherD</a> 发表于 2011-03-05 15:39 <a href="http://www.cnblogs.com/shapherd/archive/2011/03/05/1971636.html">原文链接</a></p><p>评论: 1　<a href="http://www.cnblogs.com/shapherd/archive/2011/03/05/1971636.html#pagedcomment">查看评论</a>　<a href="http://www.cnblogs.com/shapherd/archive/2011/03/05/1971636.html#commentform">发表评论</a></p><hr><p>最新新闻：<br>· <a href="http://news.cnblogs.com/n/92999/">Android再次被发现两个间谍软件</a><span style="color:gray">(2011-03-05 22:00)</span><br>· <a href="http://news.cnblogs.com/n/92998/">昨日的VeryCD</a><span style="color:gray">(2011-03-05 21:51)</span><br>· <a href="http://news.cnblogs.com/n/92996/">国外女程序员的心声：当女程序员的好处</a><span style="color:gray">(2011-03-05 21:04)</span><br>· <a href="http://news.cnblogs.com/n/92994/">值得注意的亚马逊</a><span style="color:gray">(2011-03-05 16:47)</span><br>· <a href="http://news.cnblogs.com/n/92991/">IE9 for Mobile 即将发布？也将包含浏览器内 Silverlight 支持？</a><span style="color:gray">(2011-03-05 16:24)</span><br></p><p>编辑推荐：<a href="http://news.cnblogs.com/n/92996/">国外女程序员的心声：当女程序员的好处</a><br></p><p>网站导航：<a href="http://www.cnblogs.com">博客园首页</a>  <a href="http://home.cnblogs.com/">我的园子</a>  <a href="http://news.cnblogs.com">新闻</a>  <a href="http://home.cnblogs.com/ing/">闪存</a>  <a href="http://home.cnblogs.com/group/">小组</a>  <a href="http://space.cnblogs.com/q/">博问</a>  <a href="http://kb.cnblogs.com">知识库</a></p></p>


</div>


            <div class="footer">
              <div class="contact">
                <p>
                  Your Name<br />
                  What You Are<br />
                  your@email.com
                </p>
              </div>
              <div class="contact">
                <p>
                  <a href="http://github.com/yourusername/">github.com/yourusername</a><br />
                  <a href="http://twitter.com/yourusername/">twitter.com/yourusername</a><br />
                </p>
              </div>
            </div>
          </div>
        </div> <!-- /container -->

    </body>
</html>
