<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Go 语言初学实践(3)</title>
        <meta name="viewport" content="width=device-width">

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/css/syntax.css">

        <!-- Custom CSS -->
        <link rel="stylesheet" href="/css/main.css">

    </head>
    <body>

        <div class="container">
          <div class="site">
            <div class="header">
              <h1 class="title"><a href="/">Your New Jekyll Site</a></h1>
              <a class="extra" href="/">home</a>
            </div>

                <h2>Go 语言初学实践(3)</h2>
<p class="meta">10 Mar 2011</p>

<div class="post">
<h2>Go 语言初学实践(3)</h2>

<h3>by 云风</h3>

<h3>at 2011-03-10 04:18:40</h3>

<h3>original <a href="http://blog.codingnow.com/2011/03/go_3.html">http://blog.codingnow.com/2011/03/go_3.html</a></h3>

<p>这几天一直在写个小东西，基本也做完了。抽点时间贴段代码继续这个系列。</p>




<p>我写的 http server 在支持断点续传时碰到个小的算法问题。就是我希望用户在完整下载完一次指定文件后，就让这个文件 URL 失效。而如果用户不断的从中间开始分段下载的话，很难从统计下载字节数来判定整个文件是否下载完一次。</p>




<p>我希望把下载完一次的标准定为，文件的每个字节都至少被请求一次。这个问题用<a href="http://zh.wikipedia.org/zh/%E7%BA%BF%E6%AE%B5%E6%A0%91">线段树</a>来实现最为贴切。当然还会有各种其它方案，就不展开讨论了。</p>




<p>这里的代码有很大的优化余地，但是就具体应用来说，性能方面也足够了。严谨点来说，我在服务器上额外增加了一些判断，防止被恶意攻击。比如如果分段太多（恶意的每间隔一个字节请求一个字节）对于大文件会导致这个数据结构占据过多内存。这时直接掐断服务即可，这里不展开讨论。</p>


<pre><code>    &lt;p&gt;今天贴的代码和 C 很接近。没什么特别有特色的地方。不过，Go 的 Slice 的确很好用，还有 Built-in 的函数 copy ，这些都使得 Go 比 C 在处理数据块上更方便和安全。&lt;/p&gt;
</code></pre>

<p><a href="http://blog.codingnow.com/cloud/GoSegment">代码在这里</a>。暂时 Blog 系统没支持 Go ，所以换个位置贴了。</p>




<hr>




<p>btw, 受<a href="http://blog.csdn.net/aimingoo">周爱民</a>同学邀请，明天我将去支付宝给那里的同学介绍一下 Go 语言。我自己也是初学乍练 。最近多用 Go 写点小程序，也是为了稍微熟悉一点。希望明天不要让人太失望了。</p>


</div>


            <div class="footer">
              <div class="contact">
                <p>
                  Your Name<br />
                  What You Are<br />
                  your@email.com
                </p>
              </div>
              <div class="contact">
                <p>
                  <a href="http://github.com/yourusername/">github.com/yourusername</a><br />
                  <a href="http://twitter.com/yourusername/">twitter.com/yourusername</a><br />
                </p>
              </div>
            </div>
          </div>
        </div> <!-- /container -->

    </body>
</html>
