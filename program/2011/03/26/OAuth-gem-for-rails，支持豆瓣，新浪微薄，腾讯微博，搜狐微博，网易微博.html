<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>OAuth gem for rails，支持豆瓣，新浪微薄，腾讯微博，搜狐微博，网易微博</title>
        <meta name="viewport" content="width=device-width">

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/google_reader/css/syntax.css">

        <!-- Custom CSS -->
        <link rel="stylesheet" href="/google_reader/css/main.css">

    </head>
    <body>

        <div class="container">
          <div class="site">
            <div class="header">
              <h1 class="title"><a href="/google_reader/">Google Reader</a></h1>
              <a class="extra" href="/google_reader/">home</a>
            </div>

                <h2>OAuth gem for rails，支持豆瓣，新浪微薄，腾讯微博，搜狐微博，网易微博</h2>
<p class="meta">2011-03-26 11:13</p>

<div class="post">
<h2>OAuth gem for rails，支持豆瓣，新浪微薄，腾讯微博，搜狐微博，网易微博</h2>

<h3>by</h3>

<h3>at 2011-03-26 03:13:17</h3>

<h3>original <a href="http://www.javaeye.com/topic/975805">http://www.javaeye.com/topic/975805</a></h3>

<p>地址：<a href="https://github.com/hooopo/oauth_china">https://github.com/hooopo/oauth_china</a>
<br>目前完成oauth认证和发微薄功能，欢迎测试或者fork。
<br>
<br><strong>简介</strong>
<br><div>引用</div><div>OAuth gem for rails3，支持豆瓣，新浪微薄，腾讯微博，搜狐微博，网易微博。</div>
<br><strong>安装</strong>
<br><pre name="code">gem install oauth_china</pre>
<br><strong>使用</strong>
<br>在Gemfile里添加:
<br>
<br><pre name="code">gem 'oauth'
gem 'oauth_china'</pre>
<br>
<br>添加配置文件
<br>
<br> 配置文件路径：
<br> <div>引用</div><div>config/oauth/douban.yml
<br> config/oauth/sina.yml
<br> config/oauth/qq.yml
<br> config/oauth/sohu.yml
<br> config/oauth/netease.yml</div>
<br>
<br> 配置文件格式：
<br><div>引用</div><div> development:
<br>   key:    &quot;you api key&quot;
<br>   secret: &quot;your secret&quot;
<br>   url:    &quot;http://yoursite.com&quot;
<br>   callback: &quot;http://localhost:3000/your_callback_url&quot;
<br> production:
<br>   key:    &quot;you api key&quot;
<br>   secret: &quot;your secret&quot;
<br>   url:    &quot;http://yoursite.com&quot;
<br>   callback: &quot;http://localhost:3000/your_callback_url&quot;</div>
<br><strong>演示</strong>
<br>
<br>  <pre name="code">   #config/oauth/sina.yml
     development:
           key:    &quot;you api key&quot;
           secret: &quot;your secret&quot;
           url:    &quot;http://yoursite.com&quot;
           callback: &quot;http://localhost:3000/syncs/sina/callback&quot;
         production:
           key:    &quot;you api key&quot;
           secret: &quot;your secret&quot;
           url:    &quot;http://yoursite.com&quot;
           callback: &quot;http://localhost:3000/syncs/sina/callback&quot;</p>

<pre><code> #config/routes.rb
 match &amp;quot;syncs/:type/new&amp;quot; =&amp;gt; &amp;quot;syncs#new&amp;quot;, :as =&amp;gt; :sync_new
 match &amp;quot;syncs/:type/callback&amp;quot; =&amp;gt; &amp;quot;syncs#callback&amp;quot;, :as =&amp;gt; :sync_callback

 #app/controllers/syncs_controller.rb
 # encoding: UTF-8
 class SyncsController &amp;lt; ApplicationController

   before_filter :login_required

   def new
     client = OauthChina::Sina.new
     authorize_url = client.authorize_url
     Rails.cache.write(build_oauth_token_key(client.name, client.oauth_token), client.dump)
     redirect_to authorize_url
   end

   def callback
     client = OauthChina::Sina.load(Rails.cache.read(build_oauth_token_key(params[:type], params[:oauth_token])))
     client.authorize(:oauth_verifier =&amp;gt; params[:oauth_verifier])

     results = client.dump

     if results[:access_token] &amp;amp;&amp;amp; results[:access_token_secret]
       #在这里把access token and access token secret存到db
       #下次使用的时候:
       #client = OauthChina::Sina.load(:access_token =&amp;gt; &amp;quot;xx&amp;quot;, :access_token_secret =&amp;gt; &amp;quot;xxx&amp;quot;)
       #client.add_status(&amp;quot;同步到新浪微薄..&amp;quot;)
       flash[:notice] = &amp;quot;授权成功！&amp;quot;
     else
       flash[:notice] = &amp;quot;授权失败!&amp;quot;
     end
     redirect_to account_syncs_path
   end

   private
   def build_oauth_token_key(name, oauth_token)
     [name, oauth_token].join(&amp;quot;_&amp;quot;)
   end

 end&lt;/pre&gt;
</code></pre>

<p><br><strong>注意</strong>
<br>系统时间要正确设置。否则会出现timstamps refused错误
<br>
<br>ps.抱怨一下，国内这些开放api接口新浪的是最方便的，无论文档还是认证流程。其他都是各种不按标准。。各种坑人啊。。尤其是搜狐网易。<img src="http://www.iteye.com/images/smiles/icon_arrow.gif"></p>

<pre><code>      &lt;br&gt;&lt;br&gt;
      作者: &lt;a href="http://hooopo.javaeye.com"&gt;Hooopo&lt;/a&gt; 
      &lt;br&gt;
      声明: 本文系JavaEye网站发布的原创文章，未经作者书面许可，严禁任何网站转载本文，否则必将追究法律责任！
      &lt;br&gt;&lt;br&gt;
      &lt;span style="color:red"&gt;
        &lt;a href="http://www.javaeye.com/topic/975805" style="color:red"&gt;已有 &lt;strong&gt;2&lt;/strong&gt; 人发表回复，猛击-&amp;gt;&amp;gt;&lt;strong&gt;这里&lt;/strong&gt;&amp;lt;&amp;lt;-参与讨论&lt;/a&gt;
      &lt;/span&gt;
      &lt;br&gt;&lt;br&gt;&lt;br&gt;
</code></pre>

<p><span style="color:#e28822">JavaEye推荐</span>
<br></p>

<ul><li><a href="http://www.iteye.com/clicks/433"><span style="color:red;font-weight:bold">—软件人才免语言低担保 赴美带薪读研！— </span></a></li></ul>


<p><br><br><br></p>

</div>


            <div class="footer">
              <div class="contact">
                <p>
                  Your Name<br />
                  What You Are<br />
                  your@email.com
                </p>
              </div>
              <div class="contact">
                <p>
                  <a href="http://github.com/lyuehh/">github.com/lyuehh</a><br />
                  <a href="http://twitter.com/lyuehh/">twitter.com/lyuehh</a><br />
                </p>
              </div>
            </div>
          </div>
        </div> <!-- /container -->

    </body>
</html>
